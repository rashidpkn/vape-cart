import{b6 as F,an as M,j as e,ao as N,ap as f,bf as te,B as h,aF as L,aG as k,bj as U,aq as v,ar as E,b1 as A,am as D,bk as ae,S as p,bl as oe,as as H,at as V,al as _,ae as c,aw as ne,F as T,b5 as le,aA as R,b3 as B,aE as ie,af as q,ad as de,b8 as ce,b0 as he,ag as W,ah as pe,ai as xe,aj as ue,bm as ge,bn as me,b9 as ye,bi as je,bo as O,a$ as be,T as $,aS as we}from"./index-a10391d8.js";import{C as z}from"./confirm-dialog-3758d34e.js";import{u as fe,g as Ce,e as Te}from"./use-table-49c4fd3f.js";import{T as ve,a as Pe}from"./Tabs-ea79c8c6.js";import{T as Se}from"./TableContainer-0a61dbaf.js";import{C as De}from"./CardHeader-1e9a6df7.js";function G({row:o,selected:x,onViewRow:y,onSelectRow:j,onDeleteRow:b}){const{id:t,items:d,status:l,createdAt:C,customer:a}=o,s=F(),u=F(),w=M(),g=e.jsxs(N,{hover:!0,selected:x,children:[e.jsx(f,{padding:"checkbox",children:e.jsx(te,{checked:x,onClick:j})}),e.jsx(f,{children:e.jsxs(h,{onClick:y,sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},children:["#",t.toString().padStart(3,"0")]})}),e.jsxs(f,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(L,{alt:a==null?void 0:a.name,src:a==null?void 0:a.avatarUrl,sx:{mr:2}}),e.jsx(k,{primary:a==null?void 0:a.name,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled"}})]}),e.jsx(f,{children:e.jsx(k,{primary:U(new Date(C),"dd MMM yyyy"),secondary:U(new Date(C),"p"),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsxs(f,{align:"center",children:[" ",d.length," "]}),e.jsxs(f,{children:[" ",v(d.reduce((i,m)=>i+m.price,0))," "]}),e.jsxs(f,{children:[" ",v(d.reduce((i,m)=>i+m.price,0)*.2)," "]}),e.jsx(f,{children:e.jsx(E,{variant:"soft",color:l==="completed"&&"success"||l==="pending"&&"warning"||l==="cancelled"&&"error"||"default",children:l})}),e.jsxs(f,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(A,{color:u.value?"inherit":"default",onClick:u.onToggle,sx:{...u.value&&{bgcolor:"action.hover"}},children:e.jsx(D,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(A,{color:w.open?"inherit":"default",onClick:w.onOpen,children:e.jsx(D,{icon:"eva:more-vertical-fill"})})]})]}),I=e.jsx(N,{children:e.jsx(f,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(ae,{in:u.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(p,{component:oe,sx:{m:1.5},children:d.map(i=>e.jsxs(p,{direction:"row",alignItems:"center",sx:{p:m=>m.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:m=>`solid 2px ${m.palette.background.neutral}`}},children:[e.jsx(L,{src:i.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(k,{primary:i.name,secondary:i.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs(h,{children:["x",i.quantity]}),e.jsx(h,{sx:{width:110,textAlign:"right"},children:v(i.price)})]},i.id))})})})});return e.jsxs(e.Fragment,{children:[g,I,e.jsx(H,{open:w.open,onClose:w.onClose,arrow:"right-top",sx:{width:140},children:e.jsxs(V,{onClick:()=>{s.onTrue(),w.onClose()},sx:{color:"error.main"},children:[e.jsx(D,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})}),e.jsx(z,{open:s.value,onClose:s.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(_,{variant:"contained",color:"error",onClick:b,children:"Delete"})})]})}G.propTypes={onDeleteRow:c.func,onSelectRow:c.func,onViewRow:c.func,row:c.object,selected:c.bool};const Re=[{value:"all",label:"All"},...je],Oe=[{id:"orderNumber",label:"Order",width:116},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Price",width:140},{id:"commission",label:"Commission",width:140},{id:"status",label:"Status",width:110},{id:"",width:88}],ke={name:"",status:"all",startDate:null,endDate:null};function Me(){const{user:{id:o}}=ne(),[x,y]=T.useState([]),[j,b]=T.useState([]),[t,d]=T.useState([]),l=async()=>{try{const{data:{products:r}}=await R.get("products",{params:{userId:o,perPage:100}});b(r.map(n=>n.id))}catch{alert("Error occurred while fetching products.")}},C=async()=>{try{const{data:r}=await R.get("/orders");y(r)}catch(r){console.log(r.message)}};T.useEffect(()=>{l(),C()},[]);function a(r,n){return r.map(S=>{const re=S.items.filter(se=>se.userId===n);return{...S,items:re}})}T.useEffect(()=>{const r=x.filter(n=>n.items.some(S=>j.includes(S.id))).reverse();d(a(r,o))},[x,j]);const s=fe({defaultOrderBy:"orderNumber"}),u=le(),w=F(),g=ke,I=g.startDate&&g.endDate?g.startDate.getTime()>g.endDate.getTime():!1,i=Ae({inputData:t,comparator:Ce(s.order,s.orderBy),filters:g,dateError:I}),m=i.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage),Q=s.dense?52:72,J=!!g.name||g.status!=="all"||!!g.startDate&&!!g.endDate,K=!i.length&&J||!i.length,X=T.useCallback(r=>{R.delete("orders",{data:{id:r}});const n=t.filter(S=>S.id!==r);d(n),s.onUpdatePageDeleteRow(m.length)},[m.length,s,t]),Y=T.useCallback(()=>{R.delete("orders",{data:{id:s.selected}});const r=t.filter(n=>!s.selected.includes(n.id));d(r),s.onUpdatePageDeleteRows({totalRows:t.length,totalRowsInPage:m.length,totalRowsFiltered:i.length})},[i.length,m.length,s,t]),Z=T.useCallback(r=>{u.push(B.dashboard.order.details(r))},[u]),[P,ee]=T.useState("all");return e.jsxs(e.Fragment,{children:[e.jsxs(h,{px:5,children:[e.jsx(ie,{heading:"Orders",links:[{name:"Dashboard",href:B.dashboard.root},{name:"Orders",href:B.dashboard.order.root}],sx:{mb:{xs:3,md:5}}}),e.jsxs(q,{children:[e.jsx(ve,{value:P,onChange:(r,n)=>ee(n),sx:{px:2.5,boxShadow:r=>`inset 0 -2px 0 0 ${de(r.palette.grey[500],.08)}`},children:Re.map(r=>e.jsx(Pe,{iconPosition:"end",value:r.value,label:r.label,icon:e.jsxs(E,{variant:(r.value==="all"||r.value===g.status)&&"filled"||"soft",color:r.value==="completed"&&"success"||r.value==="pending"&&"warning"||r.value==="cancelled"&&"error"||"default",children:[r.value==="all"&&t.length,r.value==="pending"&&t.filter(n=>n.status==="Order received"||n.status==="pending").length,r.value==="completed"&&t.filter(n=>n.status==="completed").length,r.value==="cancelled"&&t.filter(n=>n.status==="cancelled").length,r.value==="refunded"&&t.filter(n=>n.status==="refunded").length]})},r.value))}),e.jsxs(Se,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(ce,{dense:s.dense,numSelected:s.selected.length,rowCount:t.length,onSelectAllRows:r=>s.onSelectAllRows(r,t.map(n=>n.id)),action:e.jsx(he,{title:"Delete",children:e.jsx(A,{color:"primary",onClick:w.onTrue,children:e.jsx(D,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(W,{children:e.jsxs(pe,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(xe,{order:s.order,orderBy:s.orderBy,headLabel:Oe,rowCount:t.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:r=>s.onSelectAllRows(r,t.map(n=>n.id))}),e.jsxs(ue,{children:[i.filter(r=>P==="all"||P==="pending"&&(r.status==="pending"||r.status==="Order received")||P==="completed"&&r.status==="completed"||P==="cancelled"&&r.status==="cancelled"||P==="refunded"&&r.status==="refunded").map(r=>e.jsx(G,{row:r,selected:s.selected.includes(r.id),onSelectRow:()=>s.onSelectRow(r.id),onDeleteRow:()=>X(r.id),onViewRow:()=>Z(r.id)},r.id)),e.jsx(ge,{height:Q,emptyRows:Te(s.page,s.rowsPerPage,t.length)}),e.jsx(me,{notFound:K})]})]})})]}),e.jsx(ye,{count:i.length,page:s.page,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onRowsPerPageChange:s.onChangeRowsPerPage,onChangeDense:s.onChangeDense})]})]}),e.jsx(z,{open:w.value,onClose:w.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," items?"]}),action:e.jsx(_,{variant:"contained",color:"error",onClick:()=>{Y(),w.onFalse()},children:"Delete"})})]})}function Ae({inputData:o,comparator:x,filters:y,dateError:j}){const{status:b,name:t,startDate:d,endDate:l}=y,C=o.map((a,s)=>[a,s]);return C.sort((a,s)=>{const u=x(a[0],s[0]);return u!==0?u:a[1]-s[1]}),o=C.map(a=>a[0]),t&&(o=o.filter(a=>{var s,u;return a.orderNumber.toLowerCase().indexOf(t.toLowerCase())!==-1||((s=a.customer)==null?void 0:s.name.toLowerCase().indexOf(t.toLowerCase()))!==-1||((u=a.customer)==null?void 0:u.email.toLowerCase().indexOf(t.toLowerCase()))!==-1})),b!=="all"&&(o=o.filter(a=>a.status===b)),j||d&&l&&(o=o.filter(a=>O(a.createdAt)>=O(d)&&O(a.createdAt)<=O(l))),o}function Ie({items:o=[],shipping:x,discount:y,taxes:j,subTotal:b,totalAmount:t}){const d=e.jsxs(p,{spacing:2,alignItems:"flex-end",sx:{my:3,textAlign:"right",typography:"body2"},children:[e.jsxs(p,{direction:"row",children:[e.jsx(h,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(h,{sx:{width:160,typography:"subtitle2"},children:v(b)||"-"})]}),e.jsxs(p,{direction:"row",children:[e.jsx(h,{sx:{color:"text.secondary"},children:"Shipping"}),e.jsx(h,{sx:{width:160,...x&&{color:"error.main"}},children:x?`- ${v(x)}`:"-"})]}),e.jsxs(p,{direction:"row",children:[e.jsx(h,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(h,{sx:{width:160,...y&&{color:"error.main"}},children:y?`- ${v(y)}`:"-"})]}),e.jsxs(p,{direction:"row",children:[e.jsx(h,{sx:{color:"text.secondary"},children:"Taxes"}),e.jsx(h,{sx:{width:160},children:j?v(j):"-"})]}),e.jsxs(p,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx(h,{children:"Total"}),e.jsx(h,{sx:{width:160},children:v(t)||"-"})]})]});return e.jsxs(q,{children:[e.jsx(De,{title:"Details"}),e.jsxs(p,{sx:{px:3},children:[e.jsx(W,{children:o==null?void 0:o.map(l=>e.jsxs(p,{direction:"row",alignItems:"center",sx:{py:3,minWidth:640,borderBottom:C=>`dashed 2px ${C.palette.background.neutral}`},children:[e.jsx(L,{src:l.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(k,{primary:l.name,secondary:l.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs(h,{sx:{typography:"body2"},children:["x",l.quantity]}),e.jsx(h,{sx:{width:110,textAlign:"right",typography:"subtitle2"},children:v(l.salePrice)})]},l.id))}),d]})]})}Ie.propTypes={discount:c.number,items:c.array,shipping:c.number,subTotal:c.number,taxes:c.number,totalAmount:c.number};function Be({status:o,backLink:x,createdAt:y,orderNumber:j,statusOptions:b,onChangeStatus:t}){const d=M();return e.jsxs(e.Fragment,{children:[e.jsx(p,{spacing:3,direction:{xs:"column",md:"row"},sx:{mb:{xs:3,md:5}},children:e.jsxs(p,{spacing:1,direction:"row",alignItems:"flex-start",children:[e.jsx(A,{component:be,href:x,children:e.jsx(D,{icon:"eva:arrow-ios-back-fill"})}),e.jsxs(p,{spacing:.5,children:[e.jsxs(p,{spacing:1,direction:"row",alignItems:"center",children:[e.jsxs($,{variant:"h4",children:[" Order ",j," "]}),e.jsx(E,{variant:"soft",color:o==="completed"&&"success"||o==="pending"&&"warning"||o==="cancelled"&&"error"||"default",children:o})]}),e.jsx($,{variant:"body2",sx:{color:"text.disabled"},children:we(y)})]})]})}),e.jsx(H,{open:d.open,onClose:d.onClose,arrow:"top-right",sx:{width:140},children:b.map(l=>e.jsx(V,{selected:l.value===o,onClick:()=>{d.onClose(),t(l.value)},children:l.label},l.value))})]})}Be.propTypes={backLink:c.string,createdAt:c.instanceOf(Date),onChangeStatus:c.func,orderNumber:c.string,status:c.string,statusOptions:c.array};export{Me as O,Be as a,Ie as b};
