import{aS as ne,aF as oe,F as r,an as q,j as e,B as g,as as D,S as i,bk as ce,dk as le,dl as de,bT as ue,aw as pe,al as b,T as y,ak as E,aC as me,ao as xe}from"./index-f6071d58.js";import{u as he,F as ge}from"./form-provider-2dfaed3c.js";import{p as be}from"./product-details-description-18fc4837.js";import{R as ye}from"./Rating-d47fbc3f.js";function Pe({cart:u,product:p,onAddCart:d,onGotoStep:T,disabledActions:V,setProduct:A,...B}){var I;const L=ne(),N=oe(),{id:f,name:n,regularPrice:O,quantity:$,salePrice:m,totalRatings:z,totalReviews:G,subDescription:j,images:Q,userId:x,type:h,productGroup:w,variables:S}=p,[P,W]=r.useState([]),M=async()=>{if(h==="Variable"&&w==="parent"){const{data:s}=await me.get("/products",{params:{perPage:2e3}});W(s.products)}};r.useEffect(()=>{M()},[]);const H=(I=u==null?void 0:u.map(s=>s.id))==null?void 0:I.includes(f),v={id:f,name:n,quantity:1,price:m,images:Q},k=he({defaultValues:v}),{reset:J,watch:K,handleSubmit:U}=k,o=K();r.useEffect(()=>{p&&J(v)},[p]);const X=U(async s=>{try{H||d({...s,colors:[o.colors],subTotal:s.price*s.quantity,userId:x}),T(0),L.push(q.product.checkout)}catch(a){console.error(a)}}),Y=r.useCallback(()=>{try{d({...o,subTotal:o.price,userId:x}),console.log(o)}catch(s){console.error(s)}},[d,o]),Z=e.jsxs(g,{sx:{typography:"h5"},children:[m&&e.jsx(g,{component:"span",sx:{color:"text.disabled",textDecoration:"line-through",mr:.5},children:D(O)}),D(m)]}),_=e.jsxs(i,{direction:"row",children:[e.jsx(y,{variant:"subtitle2",sx:{flexGrow:1},children:"Quantity"}),e.jsx(i,{spacing:1,children:e.jsxs(y,{variant:"caption",component:"div",sx:{textAlign:"right"},children:["Available: ",$]})})]}),ee=e.jsxs(i,{direction:"row",spacing:2,children:[e.jsx(b,{fullWidth:!0,size:"large",color:"warning",variant:"contained",startIcon:e.jsx(xe,{icon:"solar:cart-plus-bold",width:24}),onClick:Y,sx:{whiteSpace:"nowrap"},children:"Add to Cart"}),e.jsx(b,{fullWidth:!0,size:"large",type:"submit",variant:"contained",disabled:V,children:"Buy Now"})]}),se=!!j&&be(j),te=e.jsxs(i,{direction:"row",alignItems:"center",sx:{color:"text.disabled",typography:"body2"},children:[e.jsx(ye,{size:"small",value:z,precision:.1,readOnly:!0,sx:{mr:1}}),`(${ce(G)} reviews)`]}),[c,ae]=r.useState({}),[C,F]=r.useState("");r.useEffect(()=>{F("");let s=n.split(" -")[0];Object.keys(c).map(t=>s=`${s} - ${c[t]}`);const a=P.find(t=>t.name.toLowerCase().includes(s.toLowerCase()));a&&A(t=>({...t,name:a.name,images:a.images,quantity:a.quantity,salePrice:a.salePrice,regularPrice:a.regularPrice}))},[c]);const re=h==="Variable"&&w==="parent"&&e.jsxs(g,{display:"flex",flexDirection:"column",gap:"10px",children:[Object.keys(S).map((s,a)=>e.jsxs(le,{sx:{width:"50%"},size:"small",children:[e.jsx(de,{id:"demo-simple-select-label",children:s}),e.jsx(ue,{label:s,onChange:t=>{ae(l=>({...l,[s]:t.target.value}))},children:S[s].map((t,l)=>e.jsx(pe,{value:t,children:t},l))},a)]},a)),e.jsx(b,{sx:{width:"50%"},variant:"contained",color:"success",disabled:!n.split("-")[1],onClick:()=>{let s=n.split(" -")[0];Object.keys(c).map(t=>s=`${s} - ${c[t]}`);const a=P.find(t=>t.name.toLowerCase().includes(s.toLowerCase()));if(a){const{id:t,name:l,salePrice:R,images:ie}=a;d({id:t,name:l,price:R,images:ie,subTotal:R,userId:x,quantity:1}),N(q.product.checkout)}else F("Out of stock")},children:"Buy"}),!!C&&e.jsx("p",{style:{color:"#F00A"},children:C})]});return e.jsx(ge,{methods:k,onSubmit:X,children:e.jsxs(i,{spacing:3,sx:{pt:3},...B,children:[e.jsxs(i,{spacing:2,alignItems:"flex-start",children:[e.jsx(y,{variant:"h5",children:n}),te,Z,se]}),re,e.jsx(E,{sx:{borderStyle:"dashed"}}),_,e.jsx(E,{sx:{borderStyle:"dashed"}}),h==="Simple"&&ee]})})}export{Pe as P};
