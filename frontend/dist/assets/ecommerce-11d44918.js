import{aq as O,as as H,ay as Y,at as K,r as p,j as e,C as E,a3 as U,z as G,c as W,au as V,s as Q,E as u,S as X,e as S,p as m,av as Z,u as N,a as $,k as M,v as C,B as ee,d as te,K as v,W as ae}from"./index-89ffec41.js";import{C as se,B as re}from"./chart-022dff85.js";import{C as z}from"./CardHeader-3a0b13ba.js";import{T as oe}from"./table-pagination-custom-7b9f71c5.js";import{T as ne}from"./TableContainer-48bd0ad4.js";import{T as ie,d as le,b as ce,c as B}from"./TableRow-3a454d26.js";import{A as ue}from"./Alert-8e6f3195.js";import"./Checkbox-c9abaf8c.js";import"./LastPage-08921f65.js";function pe(l){const t=O(),x={show:!0,label:"Total",color:t.palette.text.secondary,fontSize:t.typography.subtitle2.fontSize,fontWeight:t.typography.subtitle2.fontWeight,lineHeight:t.typography.subtitle2.lineHeight},d={offsetY:8,color:t.palette.text.primary,fontSize:t.typography.h3.fontSize,fontWeight:t.typography.h3.fontWeight,lineHeight:t.typography.h3.lineHeight},o={colors:[t.palette.primary.main,t.palette.warning.main,t.palette.info.main,t.palette.error.main,t.palette.success.main,t.palette.warning.dark,t.palette.success.darker,t.palette.info.dark,t.palette.info.darker],chart:{toolbar:{show:!1},zoom:{enabled:!1},foreColor:t.palette.text.disabled,fontFamily:t.typography.fontFamily},states:{hover:{filter:{type:"lighten",value:.04}},active:{filter:{type:"darken",value:.88}}},fill:{opacity:1,gradient:{type:"vertical",shadeIntensity:0,opacityFrom:.4,opacityTo:0,stops:[0,100]}},dataLabels:{enabled:!1},stroke:{width:3,curve:"smooth",lineCap:"round"},grid:{strokeDashArray:3,borderColor:t.palette.divider,xaxis:{lines:{show:!1}}},xaxis:{axisBorder:{show:!1},axisTicks:{show:!1}},markers:{size:0,strokeColors:t.palette.background.paper},tooltip:{theme:!1,x:{show:!0}},legend:{show:!0,fontSize:13,position:"top",horizontalAlign:"right",markers:{radius:12},fontWeight:500,itemMargin:{horizontal:8},labels:{colors:t.palette.text.primary}},plotOptions:{bar:{borderRadius:4,columnWidth:"28%",borderRadiusApplication:"end",borderRadiusWhenStacked:"last"},pie:{donut:{labels:{show:!0,value:d,total:x}}},radialBar:{track:{strokeWidth:"100%",background:H(t.palette.grey[500],.16)},dataLabels:{value:d,total:x}},radar:{polygons:{fill:{colors:["transparent"]},strokeColors:t.palette.divider,connectorColors:t.palette.divider}},polarArea:{rings:{strokeColor:t.palette.divider},spokes:{connectorColors:t.palette.divider}}},responsive:[{breakpoint:t.breakpoints.values.sm,options:{plotOptions:{bar:{columnWidth:"40%"}}}},{breakpoint:t.breakpoints.values.md,options:{plotOptions:{bar:{columnWidth:"32%"}}}}]};return Y(o,l)}function D({title:l,subheader:t,chart:x,...d}){const{colors:o,categories:g,series:c,options:r}=x,s=K(),[i,a]=p.useState(l==="Sales By Month"?["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][new Date().getMonth()]:"2024"),h=pe({colors:o,legend:{position:"top",horizontalAlign:"right"},xaxis:{categories:g},...r}),y=p.useCallback(n=>{s.onClose(),a(n)},[s]);return e.jsxs(e.Fragment,{children:[e.jsxs(E,{...d,children:[e.jsx(z,{title:l,subheader:t,action:e.jsxs(U,{onClick:s.onOpen,sx:{pl:1,py:.5,pr:.5,borderRadius:1,typography:"subtitle2",bgcolor:"background.neutral"},children:[i,e.jsx(G,{width:16,icon:s.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:.5}})]})}),c.map(n=>e.jsx(W,{sx:{mt:3,mx:3},children:n.year===i&&e.jsx(se,{dir:"ltr",type:"area",series:n.data,options:h,height:364})},n.year))]}),e.jsx(V,{open:s.open,onClose:s.onClose,sx:{width:140},children:c.map(n=>e.jsx(Q,{selected:n.year===i,onClick:()=>y(n.year),children:n.year},n.year))})]})}D.propTypes={chart:u.object,subheader:u.string,title:u.string};function I({title:l,subheader:t,tableData:x,tableLabels:d,...o}){return e.jsxs(E,{...o,children:[e.jsx(z,{title:l,subheader:t,sx:{mb:3}}),e.jsx(ne,{sx:{overflow:"unset"},children:e.jsx(X,{children:e.jsxs(ie,{sx:{minWidth:640},children:[e.jsx(oe,{headLabel:d}),e.jsx(le,{children:x.map(g=>e.jsx(F,{row:g},g.id))})]})})})]})}I.propTypes={subheader:u.string,tableData:u.array,tableLabels:u.array,title:u.string};function F({row:l}){return e.jsxs(ce,{children:[e.jsx(B,{children:l.name}),e.jsx(B,{children:l.category}),e.jsx(B,{children:l.storeName}),e.jsx(B,{children:l.SKU}),e.jsx(B,{children:S(l.salePrice)})]})}F.propTypes={row:u.object};function P({title:l,percent:t,total:x,chart:d,sx:o,...g}){const c=O(),{colors:r=[c.palette.primary.light,c.palette.primary.main],options:s}=d;return e.jsx(E,{sx:{display:"flex",alignItems:"center",p:3,...o},...g,children:e.jsxs(W,{sx:{flexGrow:1},children:[e.jsx(m,{variant:"subtitle2",paragraph:!0,children:l}),e.jsx(m,{variant:"h3",gutterBottom:!0,children:Z(x)})]})})}P.propTypes={chart:u.object,percent:u.number,sx:u.object,title:u.string,total:u.number};function J({title:l,sentAmount:t,currentBalance:x,orders:d=[],sx:o,...g}){const{user:c}=N(),r=$(),[s,i]=p.useState(""),[a,h]=p.useState([]),y=p.useCallback(async()=>{const{data:f}=await M.get("/payout",{params:{fName:c.displayName}});h(f)},[]);p.useEffect(()=>{y()},[]);const n=p.useMemo(()=>d==null?void 0:d.reduce((f,b)=>{var R;return f+((R=b==null?void 0:b.items)==null?void 0:R.reduce((_,L)=>_+L.quantity*L.price,0))},0),[d,c.id]),w=p.useMemo(()=>n*.3,[n]),k=p.useMemo(()=>n*.7,[n]),A=p.useMemo(()=>a.reduce((f,b)=>f+b.amount,0),[a]),j=p.useMemo(()=>a.reduce((f,b)=>b.status==="completed"?f+b.amount:f,0),[a]),T=p.useMemo(()=>A-j,[A,j]),q=p.useMemo(()=>k-A,[k,A]);return e.jsxs(E,{sx:{p:3,...o},...g,children:[e.jsx(m,{variant:"subtitle2",gutterBottom:!0,children:"Avalable Balance for requesting"}),!!s&&e.jsx(ue,{severity:"error",children:s}),e.jsxs(C,{spacing:2,children:[e.jsx(m,{variant:"h3",children:S(q)}),e.jsxs(C,{direction:"row",justifyContent:"space-between",children:[e.jsx(m,{variant:"body2",sx:{color:"text.secondary"},children:"Total Sales"}),e.jsxs(m,{variant:"body2",children:[" ",S(n)]})]}),e.jsxs(C,{direction:"row",justifyContent:"space-between",children:[e.jsx(m,{variant:"body2",sx:{color:"text.secondary"},children:"Commission"}),e.jsx(m,{variant:"body2",children:S(w)})]}),e.jsxs(C,{direction:"row",justifyContent:"space-between",children:[e.jsx(m,{variant:"body2",sx:{color:"text.secondary"},children:"Net Profit"}),e.jsx(m,{variant:"body2",children:S(k)})]}),e.jsxs(C,{direction:"row",justifyContent:"space-between",children:[e.jsx(m,{variant:"body2",sx:{color:"text.secondary"},children:"Pending Request"}),e.jsxs(m,{variant:"body2",children:[" ",S(T)]})]}),e.jsxs(C,{direction:"row",justifyContent:"space-between",children:[e.jsx(m,{variant:"body2",sx:{color:"text.secondary"},children:"Completed Request (Earned)"}),e.jsxs(m,{variant:"body2",children:[" ",S(j)]})]}),e.jsx(C,{direction:"row",spacing:1.5,children:e.jsx(ee,{fullWidth:!0,variant:"contained",color:"warning",onClick:()=>{q>=10?(sessionStorage.setItem("amount",q),r("/payment")):i("You must have a minimum balance of AED 10 to request a payout.")},children:"Request For Payout"})})]})]})}J.propTypes={currentBalance:u.number,sentAmount:u.number,sx:u.object,title:u.string};function de(){const l=O(),{user:t}=N(),[x,d]=p.useState([]),[o,g]=p.useState([]);return console.log(t),p.useEffect(()=>{(async()=>{try{const[r,s,i]=await Promise.all([M.get("products",{params:{userId:t.id}}),M.get("/orders"),M.get("/invoice")]),{products:a}=r.data,y=s.data.filter(n=>n.items.some(w=>w.userId===t.uid));g(y.map(n=>{const w=n.items.filter(j=>j.userId===t.uid),k=w.reduce((j,T)=>j+T.subTotal,0),A=w.reduce((j,T)=>j+T.quantity,0);return{...n,items:w,subTotal:k,totalAmount:k+n.shipping-n.discount,totalQuantity:A}})),d(a)}catch(r){console.error("An error occurred:",r)}})()},[t.id]),console.log(o),e.jsxs(W,{px:5,children:[e.jsx(te,{heading:"Analytics",links:[{}],sx:{mb:{xs:3,md:5}}}),e.jsxs(v,{container:!0,spacing:3,sx:{position:"relative"},children:[e.jsx(re,{products:x}),e.jsx(v,{xs:12,md:4,children:e.jsx(P,{title:"Product Sold",percent:0,total:o==null?void 0:o.reduce((c,r)=>{var s;return c+((s=r==null?void 0:r.items)==null?void 0:s.reduce((i,a)=>i+(a==null?void 0:a.quantity),0))},0),chart:{series:[0,0,0,0,0,0,0,0,0,0]}})}),e.jsx(v,{xs:12,md:4,children:e.jsx(P,{title:"Total Balance",percent:0,total:o==null?void 0:o.reduce((c,r)=>{var s;return c+((s=r==null?void 0:r.items)==null?void 0:s.reduce((i,a)=>i+(a==null?void 0:a.quantity)*(a==null?void 0:a.price),0))},0),chart:{colors:[l.palette.info.light,l.palette.info.main],series:[0,0,0,0,0,0,0,0,0,0]}})}),e.jsx(v,{xs:12,md:4,children:e.jsx(P,{title:"Sales Profit",percent:0,total:(o==null?void 0:o.reduce((c,r)=>{var s;return c+((s=r==null?void 0:r.items)==null?void 0:s.reduce((i,a)=>i+(a==null?void 0:a.quantity)*(a==null?void 0:a.price),0))},0))*.7,chart:{colors:[l.palette.warning.light,l.palette.warning.main],series:[0,0,0,0,0,0,0,0,0,0]}})}),e.jsx(v,{xs:12,md:12,lg:12,children:e.jsx(D,{title:"Sales By Month",chart:{categories:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],series:[0,1,2,3,4,5,6,7,8,9,10,11].map(c=>({year:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c],data:[{name:"Total Income",data:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31].map(r=>o.reduce((s,i)=>{var a;return new Date(i.createdAt).getMonth()===c&&new Date(i.createdAt).getDate()===r?s+((a=i==null?void 0:i.items)==null?void 0:a.reduce((h,y)=>h+(y==null?void 0:y.quantity)*(y==null?void 0:y.price),0)):s},0))}]}))}})}),e.jsx(v,{xs:12,md:12,lg:12,children:e.jsx(D,{title:"Yearly Sales",chart:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],series:[{year:"2024",data:[{name:"Total Income",data:[0,1,2,3,4,5,6,7,8,9,10,11].map(c=>o.reduce((r,s)=>{var i;return new Date(s.createdAt).getMonth()===c?r+((i=s==null?void 0:s.items)==null?void 0:i.reduce((a,h)=>a+(h==null?void 0:h.quantity)*(h==null?void 0:h.price),0)):r},0))}]}]}})}),e.jsx(v,{xs:12,md:6,lg:8,children:e.jsx(I,{title:"Top Selling Products",tableData:x,tableLabels:[{id:"Product name",label:"Product Name"},{id:"category",label:"Category"},{id:"storeName",label:"Store Name"},{id:"sku",label:"SKU"},{id:"salePrice",label:"Sale Price"}]})}),e.jsx(v,{xs:12,md:6,lg:4,children:e.jsx(J,{title:"Current Balance",currentBalance:0,sentAmount:0,orders:o})})]})]})}function we(){return e.jsxs(e.Fragment,{children:[e.jsx(ae,{children:e.jsx("title",{children:" Dashboard: Analytics"})}),e.jsx(de,{})]})}export{we as default};
