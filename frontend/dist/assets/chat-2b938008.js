import{r as l,b4 as cn,b1 as ln,b2 as ke,j as t,b5 as Et,b6 as dn,b7 as un,b8 as hn,b9 as fn,ba as xe,bb as dt,bc as pn,V as xn,Q as ve,bd as Rt,be as mn,$ as gn,N as vn,A as H,i as _e,a2 as bn,bf as yn,z as qe,bg as jn,bh as wn,bi as Cn,bj as En,bk as Rn,bl as St,bm as Sn,R as Ge,bn as Tn,bo as An,bp as kn,ac as _n,bq as be,ad as In,q as j,v as Ce,ai as On,a9 as I,w as y,s as Dn,o as Ie,br as Ln,n as Nn,bs as Tt,bt as Ee,x as E,l as G,bu as At,bv as de,a0 as kt,a4 as He,as as _t,p as ye,T as It,a8 as Mn,c as B,S as Re,bw as Ot,bx as Fn,by as Pn,bz as Vn,aI as Un,ab as Q,t as Be,C as Dt,aM as $n,bA as Wn,bB as zn,ak as qn,an as Gn,W as Hn}from"./index-eab1947b.js";import{u as Bn}from"./use-search-params-025f3a28.js";import{S as Oe,u as Yn,L as Kn}from"./lightbox-d738a425.js";import{D as Jn}from"./DialogContent-bf5a557b.js";import{F as Xn}from"./file-thumbnail-7bd312f2.js";import{C as Qn}from"./Card-4f9a49c9.js";function ut(e){return e.substring(2).toLowerCase()}function Zn(e,n){return n.documentElement.clientWidth<e.clientX||n.documentElement.clientHeight<e.clientY}function es(e){const{children:n,disableReactTree:s=!1,mouseEvent:o="onClick",onClickAway:a,touchEvent:r="onTouchEnd"}=e,i=l.useRef(!1),c=l.useRef(null),h=l.useRef(!1),d=l.useRef(!1);l.useEffect(()=>(setTimeout(()=>{h.current=!0},0),()=>{h.current=!1}),[]);const g=cn(n.ref,c),m=ln(x=>{const p=d.current;d.current=!1;const w=ke(c.current);if(!h.current||!c.current||"clientX"in x&&Zn(x,w))return;if(i.current){i.current=!1;return}let u;x.composedPath?u=x.composedPath().indexOf(c.current)>-1:u=!w.documentElement.contains(x.target)||c.current.contains(x.target),!u&&(s||!p)&&a(x)}),v=x=>p=>{d.current=!0;const w=n.props[x];w&&w(p)},f={ref:g};return r!==!1&&(f[r]=v(r)),l.useEffect(()=>{if(r!==!1){const x=ut(r),p=ke(c.current),w=()=>{i.current=!0};return p.addEventListener(x,m),p.addEventListener("touchmove",w),()=>{p.removeEventListener(x,m),p.removeEventListener("touchmove",w)}}},[m,r]),o!==!1&&(f[o]=v(o)),l.useEffect(()=>{if(o!==!1){const x=ut(o),p=ke(c.current);return p.addEventListener(x,m),()=>{p.removeEventListener(x,m)}}},[m,o]),t.jsx(l.Fragment,{children:l.cloneElement(n,f)})}var ht=1e3*60,je=60*24,ft=je*30,pt=je*365;function ts(e,n,s){var o,a,r;Et(2,arguments);var i=pn(),c=(o=(a=s==null?void 0:s.locale)!==null&&a!==void 0?a:i.locale)!==null&&o!==void 0?o:dn;if(!c.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var h=un(e,n);if(isNaN(h))throw new RangeError("Invalid time value");var d=hn(fn(s),{addSuffix:!!(s!=null&&s.addSuffix),comparison:h}),g,m;h>0?(g=xe(n),m=xe(e)):(g=xe(e),m=xe(n));var v=String((r=s==null?void 0:s.roundingMethod)!==null&&r!==void 0?r:"round"),f;if(v==="floor")f=Math.floor;else if(v==="ceil")f=Math.ceil;else if(v==="round")f=Math.round;else throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");var x=m.getTime()-g.getTime(),p=x/ht,w=dt(m)-dt(g),u=(x-w)/ht,M=s==null?void 0:s.unit,R;if(M?R=String(M):p<1?R="second":p<60?R="minute":p<je?R="hour":u<ft?R="day":u<pt?R="month":R="year",R==="second"){var D=f(x/1e3);return c.formatDistance("xSeconds",D,d)}else if(R==="minute"){var A=f(p);return c.formatDistance("xMinutes",A,d)}else if(R==="hour"){var k=f(p/60);return c.formatDistance("xHours",k,d)}else if(R==="day"){var U=f(u/je);return c.formatDistance("xDays",U,d)}else if(R==="month"){var C=f(u/ft);return C===12&&M!=="month"?c.formatDistance("xYears",1,d):c.formatDistance("xMonths",C,d)}else if(R==="year"){var L=f(u/pt);return c.formatDistance("xYears",L,d)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function ns(e,n){return Et(1,arguments),ts(e,Date.now(),n)}const ss=["children","className","component","componentsProps","max","renderSurplus","slotProps","spacing","total","variant"],xt={small:-16,medium:null},rs=e=>{const{classes:n}=e;return bn({root:["root"],avatar:["avatar"]},yn,n)},os=xn("div",{name:"MuiAvatarGroup",slot:"Root",overridesResolver:(e,n)=>ve({[`& .${Rt.avatar}`]:n.avatar},n.root)})(({theme:e,ownerState:n})=>{const s=n.spacing&&xt[n.spacing]!==void 0?xt[n.spacing]:-n.spacing;return{[`& .${mn.root}`]:{border:`2px solid ${(e.vars||e).palette.background.default}`,boxSizing:"content-box",marginLeft:s??-8,"&:last-child":{marginLeft:0}},display:"flex",flexDirection:"row-reverse"}}),as=l.forwardRef(function(n,s){var o;const a=gn({props:n,name:"MuiAvatarGroup"}),{children:r,className:i,component:c="div",componentsProps:h={},max:d=5,renderSurplus:g,slotProps:m={},spacing:v="medium",total:f,variant:x="circular"}=a,p=vn(a,ss);let w=d<2?2:d;const u=ve({},a,{max:d,spacing:v,component:c,variant:x}),M=rs(u),R=l.Children.toArray(r).filter(L=>l.isValidElement(L)),D=f||R.length;D===w&&(w+=1),w=Math.min(D+1,w);const A=Math.min(R.length,w-1),k=Math.max(D-w,D-A,0),U=g?g(k):`+${k}`,C=(o=m.additionalAvatar)!=null?o:h.additionalAvatar;return t.jsxs(os,ve({as:c,ownerState:u,className:_e(M.root,i),ref:s},p,{children:[k?t.jsx(H,ve({variant:x},C,{className:_e(M.avatar,C==null?void 0:C.className),children:U})):null,R.slice(0,A).reverse().map(L=>l.cloneElement(L,{className:_e(L.props.className,M.avatar),variant:L.props.variant||x}))]}))}),is=as;var cs=jn;function ls(e){return e&&e.length?cs(e):[]}var ds=ls;const us=qe(ds);var hs=wn,fs=Cn;function ps(e,n){return e&&hs(e,n,fs)}var xs=ps,ms=En;function gs(e,n){return function(s,o){if(s==null)return s;if(!ms(s))return e(s,o);for(var a=s.length,r=n?a:-1,i=Object(s);(n?r--:++r<a)&&o(i[r],r,i)!==!1;);return s}}var vs=gs,bs=xs,ys=vs,js=ys(bs),ws=js;function Cs(e,n,s,o){for(var a=-1,r=e==null?0:e.length;++a<r;){var i=e[a];n(o,i,s(i),e)}return o}var Es=Cs,Rs=ws;function Ss(e,n,s,o){return Rs(e,function(a,r,i){n(o,a,s(a),i)}),o}var Ts=Ss,As=Es,ks=Ts,_s=Rn,Is=St;function Os(e,n){return function(s,o){var a=Is(s)?As:ks,r=n?n():{};return a(s,e,_s(o),r)}}var Ds=Os,Ls=Sn,Ns=Ds,Ms=Ns(function(e,n,s){Ls(e,s,n)}),Fs=Ms;const Ps=qe(Fs),ee=()=>{},V=ee(),De=Object,b=e=>e===V,K=e=>typeof e=="function",te=(e,n)=>({...e,...n}),Vs=e=>K(e.then),me=new WeakMap;let Us=0;const ue=e=>{const n=typeof e,s=e&&e.constructor,o=s==Date;let a,r;if(De(e)===e&&!o&&s!=RegExp){if(a=me.get(e),a)return a;if(a=++Us+"~",me.set(e,a),s==Array){for(a="@",r=0;r<e.length;r++)a+=ue(e[r])+",";me.set(e,a)}if(s==De){a="#";const i=De.keys(e).sort();for(;!b(r=i.pop());)b(e[r])||(a+=r+":"+ue(e[r])+",");me.set(e,a)}}else a=o?e.toJSON():n=="symbol"?e.toString():n=="string"?JSON.stringify(e):""+e;return a},Z=new WeakMap,Le={},ge={},Ye="undefined",Se=typeof window!=Ye,Ve=typeof document!=Ye,$s=()=>Se&&typeof window.requestAnimationFrame!=Ye,Lt=(e,n)=>{const s=Z.get(e);return[()=>!b(n)&&e.get(n)||Le,o=>{if(!b(n)){const a=e.get(n);n in ge||(ge[n]=a),s[5](n,te(a,o),a||Le)}},s[6],()=>!b(n)&&n in ge?ge[n]:!b(n)&&e.get(n)||Le]};let Ue=!0;const Ws=()=>Ue,[$e,We]=Se&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[ee,ee],zs=()=>{const e=Ve&&document.visibilityState;return b(e)||e!=="hidden"},qs=e=>(Ve&&document.addEventListener("visibilitychange",e),$e("focus",e),()=>{Ve&&document.removeEventListener("visibilitychange",e),We("focus",e)}),Gs=e=>{const n=()=>{Ue=!0,e()},s=()=>{Ue=!1};return $e("online",n),$e("offline",s),()=>{We("online",n),We("offline",s)}},Hs={isOnline:Ws,isVisible:zs},Bs={initFocus:qs,initReconnect:Gs},mt=!Ge.useId,he=!Se||"Deno"in window,Ys=e=>$s()?window.requestAnimationFrame(e):setTimeout(e,1),Ne=he?l.useEffect:l.useLayoutEffect,Me=typeof navigator<"u"&&navigator.connection,gt=!he&&Me&&(["slow-2g","2g"].includes(Me.effectiveType)||Me.saveData),Ke=e=>{if(K(e))try{e=e()}catch{e=""}const n=e;return e=typeof e=="string"?e:(Array.isArray(e)?e.length:e)?ue(e):"",[e,n]};let Ks=0;const ze=()=>++Ks,Nt=0,Mt=1,Ft=2,Js=3;var le={__proto__:null,ERROR_REVALIDATE_EVENT:Js,FOCUS_EVENT:Nt,MUTATE_EVENT:Ft,RECONNECT_EVENT:Mt};async function Pt(...e){const[n,s,o,a]=e,r=te({populateCache:!0,throwOnError:!0},typeof a=="boolean"?{revalidate:a}:a||{});let i=r.populateCache;const c=r.rollbackOnError;let h=r.optimisticData;const d=v=>typeof c=="function"?c(v):c!==!1,g=r.throwOnError;if(K(s)){const v=s,f=[],x=n.keys();for(const p of x)!/^\$(inf|sub)\$/.test(p)&&v(n.get(p)._k)&&f.push(p);return Promise.all(f.map(m))}return m(s);async function m(v){const[f]=Ke(v);if(!f)return;const[x,p]=Lt(n,f),[w,u,M,R]=Z.get(n),D=()=>{const q=w[f];return(K(r.revalidate)?r.revalidate(x().data,v):r.revalidate!==!1)&&(delete M[f],delete R[f],q&&q[0])?q[0](Ft).then(()=>x().data):x().data};if(e.length<3)return D();let A=o,k;const U=ze();u[f]=[U,0];const C=!b(h),L=x(),O=L.data,$=L._c,z=b($)?O:$;if(C&&(h=K(h)?h(z,O):h,p({data:h,_c:z})),K(A))try{A=A(z)}catch(q){k=q}if(A&&Vs(A))if(A=await A.catch(q=>{k=q}),U!==u[f][0]){if(k)throw k;return A}else k&&C&&d(k)&&(i=!0,p({data:z,_c:V}));if(i&&!k)if(K(i)){const q=i(A,z);p({data:q,error:V,_c:V})}else p({data:A,error:V,_c:V});if(u[f][1]=ze(),Promise.resolve(D()).then(()=>{p({_c:V})}),k){if(g)throw k;return}return A}}const vt=(e,n)=>{for(const s in e)e[s][0]&&e[s][0](n)},Xs=(e,n)=>{if(!Z.has(e)){const s=te(Bs,n),o={},a=Pt.bind(V,e);let r=ee;const i={},c=(g,m)=>{const v=i[g]||[];return i[g]=v,v.push(m),()=>v.splice(v.indexOf(m),1)},h=(g,m,v)=>{e.set(g,m);const f=i[g];if(f)for(const x of f)x(m,v)},d=()=>{if(!Z.has(e)&&(Z.set(e,[o,{},{},{},a,h,c]),!he)){const g=s.initFocus(setTimeout.bind(V,vt.bind(V,o,Nt))),m=s.initReconnect(setTimeout.bind(V,vt.bind(V,o,Mt)));r=()=>{g&&g(),m&&m(),Z.delete(e)}}};return d(),[e,a,d,r]}return[e,Z.get(e)[4]]},Qs=(e,n,s,o,a)=>{const r=s.errorRetryCount,i=a.retryCount,c=~~((Math.random()+.5)*(1<<(i<8?i:8)))*s.errorRetryInterval;!b(r)&&i>r||setTimeout(o,c,a)},Zs=(e,n)=>ue(e)==ue(n),[Vt,we]=Xs(new Map),er=te({onLoadingSlow:ee,onSuccess:ee,onError:ee,onErrorRetry:Qs,onDiscarded:ee,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:gt?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:gt?5e3:3e3,compare:Zs,isPaused:()=>!1,cache:Vt,mutate:we,fallback:{}},Hs),tr=(e,n)=>{const s=te(e,n);if(n){const{use:o,fallback:a}=e,{use:r,fallback:i}=n;o&&r&&(s.use=o.concat(r)),a&&i&&(s.fallback=te(a,i))}return s},nr=l.createContext({}),sr="$inf$",Ut=Se&&window.__SWR_DEVTOOLS_USE__,rr=Ut?window.__SWR_DEVTOOLS_USE__:[],or=()=>{Ut&&(window.__SWR_DEVTOOLS_REACT__=Ge)},ar=e=>K(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(e[1]===null?e[2]:e[1])||{}],ir=()=>te(er,l.useContext(nr)),cr=e=>(n,s,o)=>e(n,s&&((...r)=>{const[i]=Ke(n),[,,,c]=Z.get(Vt);if(i.startsWith(sr))return s(...r);const h=c[i];return b(h)?s(...r):(delete c[i],h)}),o),lr=rr.concat(cr),dr=e=>function(...s){const o=ir(),[a,r,i]=ar(s),c=tr(o,i);let h=e;const{use:d}=c,g=(d||[]).concat(lr);for(let m=g.length;m--;)h=g[m](h);return h(a,r||c.fetcher||null,c)},ur=(e,n,s)=>{const o=n[e]||(n[e]=[]);return o.push(s),()=>{const a=o.indexOf(s);a>=0&&(o[a]=o[o.length-1],o.pop())}};or();const bt=Ge.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(e.status="pending",e.then(n=>{e.status="fulfilled",e.value=n},n=>{e.status="rejected",e.reason=n}),e)}),Fe={dedupe:!0},hr=(e,n,s)=>{const{cache:o,compare:a,suspense:r,fallbackData:i,revalidateOnMount:c,revalidateIfStale:h,refreshInterval:d,refreshWhenHidden:g,refreshWhenOffline:m,keepPreviousData:v}=s,[f,x,p,w]=Z.get(o),[u,M]=Ke(e),R=l.useRef(!1),D=l.useRef(!1),A=l.useRef(u),k=l.useRef(n),U=l.useRef(s),C=()=>U.current,L=()=>C().isVisible()&&C().isOnline(),[O,$,z,q]=Lt(o,u),se=l.useRef({}).current,nn=b(i)?s.fallback[u]:i,et=(S,T)=>{for(const F in se){const _=F;if(_==="data"){if(!a(S[_],T[_])&&(!b(S[_])||!a(pe,T[_])))return!1}else if(T[_]!==S[_])return!1}return!0},tt=l.useMemo(()=>{const S=(()=>!u||!n?!1:b(c)?C().isPaused()||r?!1:b(h)?!0:h:c)(),T=P=>{const J=te(P);return delete J._k,S?{isValidating:!0,isLoading:!0,...J}:J},F=O(),_=q(),Y=T(F),ie=F===_?Y:T(_);let N=Y;return[()=>{const P=T(O());return et(P,N)?(N.data=P.data,N.isLoading=P.isLoading,N.isValidating=P.isValidating,N.error=P.error,N):(N=P,P)},()=>ie]},[o,u]),re=Tn.useSyncExternalStore(l.useCallback(S=>z(u,(T,F)=>{et(F,T)||S()}),[o,u]),tt[0],tt[1]),nt=!R.current,sn=f[u]&&f[u].length>0,oe=re.data,ae=b(oe)?nn:oe,fe=re.error,st=l.useRef(ae),pe=v?b(oe)?st.current:oe:ae,rt=(()=>sn&&!b(fe)?!1:nt&&!b(c)?c:C().isPaused()?!1:r?b(ae)?!1:h:b(ae)||h)(),ot=!!(u&&n&&nt&&rt),rn=b(re.isValidating)?ot:re.isValidating,on=b(re.isLoading)?ot:re.isLoading,ce=l.useCallback(async S=>{const T=k.current;if(!u||!T||D.current||C().isPaused())return!1;let F,_,Y=!0;const ie=S||{},N=!p[u]||!ie.dedupe,P=()=>mt?!D.current&&u===A.current&&R.current:u===A.current,J={isValidating:!1,isLoading:!1},it=()=>{$(J)},ct=()=>{const W=p[u];W&&W[1]===_&&delete p[u]},lt={isValidating:!0};b(O().data)&&(lt.isLoading=!0);try{if(N&&($(lt),s.loadingTimeout&&b(O().data)&&setTimeout(()=>{Y&&P()&&C().onLoadingSlow(u,s)},s.loadingTimeout),p[u]=[T(M),ze()]),[F,_]=p[u],F=await F,N&&setTimeout(ct,s.dedupingInterval),!p[u]||p[u][1]!==_)return N&&P()&&C().onDiscarded(u),!1;J.error=V;const W=x[u];if(!b(W)&&(_<=W[0]||_<=W[1]||W[1]===0))return it(),N&&P()&&C().onDiscarded(u),!1;const X=O().data;J.data=a(X,F)?X:F,N&&P()&&C().onSuccess(F,u,s)}catch(W){ct();const X=C(),{shouldRetryOnError:Te}=X;X.isPaused()||(J.error=W,N&&P()&&(X.onError(W,u,X),(Te===!0||K(Te)&&Te(W))&&(!C().revalidateOnFocus||!C().revalidateOnReconnect||L())&&X.onErrorRetry(W,u,X,an=>{const Ae=f[u];Ae&&Ae[0]&&Ae[0](le.ERROR_REVALIDATE_EVENT,an)},{retryCount:(ie.retryCount||0)+1,dedupe:!0})))}return Y=!1,it(),!0},[u,o]),at=l.useCallback((...S)=>Pt(o,A.current,...S),[]);if(Ne(()=>{k.current=n,U.current=s,b(oe)||(st.current=oe)}),Ne(()=>{if(!u)return;const S=ce.bind(V,Fe);let T=0;const _=ur(u,f,(Y,ie={})=>{if(Y==le.FOCUS_EVENT){const N=Date.now();C().revalidateOnFocus&&N>T&&L()&&(T=N+C().focusThrottleInterval,S())}else if(Y==le.RECONNECT_EVENT)C().revalidateOnReconnect&&L()&&S();else{if(Y==le.MUTATE_EVENT)return ce();if(Y==le.ERROR_REVALIDATE_EVENT)return ce(ie)}});return D.current=!1,A.current=u,R.current=!0,$({_k:M}),rt&&(b(ae)||he?S():Ys(S)),()=>{D.current=!0,_()}},[u]),Ne(()=>{let S;function T(){const _=K(d)?d(O().data):d;_&&S!==-1&&(S=setTimeout(F,_))}function F(){!O().error&&(g||C().isVisible())&&(m||C().isOnline())?ce(Fe).then(T):T()}return T(),()=>{S&&(clearTimeout(S),S=-1)}},[d,g,m,u]),l.useDebugValue(pe),r&&b(ae)&&u){if(!mt&&he)throw new Error("Fallback data is required when using suspense in SSR.");k.current=n,U.current=s,D.current=!1;const S=w[u];if(!b(S)){const T=at(S);bt(T)}if(b(fe)){const T=ce(Fe);b(pe)||(T.status="fulfilled",T.value=!0),bt(T)}else throw fe}return{mutate:at,get data(){return se.data=!0,pe},get error(){return se.error=!0,fe},get isValidating(){return se.isValidating=!0,rn},get isLoading(){return se.isLoading=!0,on}}},Je=dr(hr),Xe=An.create({baseURL:kn});Xe.interceptors.response.use(e=>e,e=>Promise.reject(e.response&&e.response.data||"Something went wrong"));const Qe=async e=>{const[n,s]=Array.isArray(e)?e:[e];return(await Xe.get(n,{...s})).data},ne={chat:"/api/chat",kanban:"/api/kanban",calendar:"/api/calendar",auth:{me:"/api/auth/me",login:"/api/auth/login",register:"/api/auth/register"},mail:{list:"/api/mail/list",details:"/api/mail/details",labels:"/api/mail/labels"},post:{list:"/api/post/list",details:"/api/post/details",latest:"/api/post/latest",search:"/api/post/search"},product:{list:"/api/product/list",details:"/api/product/details",search:"/api/product/search"}},Ze={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function fr(){const e=[ne.chat,{params:{endpoint:"contacts"}}],{data:n,isLoading:s,error:o,isValidating:a}=Je(e,Qe,Ze);return l.useMemo(()=>({contacts:(n==null?void 0:n.contacts)||[],contactsLoading:s,contactsError:o,contactsValidating:a,contactsEmpty:!s&&!(n!=null&&n.contacts.length)}),[n==null?void 0:n.contacts,o,s,a])}function pr(){const e=[ne.chat,{params:{endpoint:"conversations"}}],{data:n,isLoading:s,error:o,isValidating:a}=Je(e,Qe,Ze);return l.useMemo(()=>{const i=Ps(n==null?void 0:n.conversations,"id")||{},c=Object.keys(i)||[];return{conversations:{byId:i,allIds:c},conversationsLoading:s,conversationsError:o,conversationsValidating:a,conversationsEmpty:!s&&!c.length}},[n==null?void 0:n.conversations,o,s,a])}function xr(e){const n=e?[ne.chat,{params:{conversationId:e,endpoint:"conversation"}}]:null,{data:s,isLoading:o,error:a,isValidating:r}=Je(n,Qe,Ze);return l.useMemo(()=>({conversation:s==null?void 0:s.conversation,conversationLoading:o,conversationError:a,conversationValidating:r}),[s==null?void 0:s.conversation,a,o,r])}async function mr(e,n){const s=[ne.chat,{params:{endpoint:"conversations"}}],o=[ne.chat,{params:{conversationId:e,endpoint:"conversation"}}];we(o,a=>{const{conversation:r}=a;return{conversation:{...r,messages:[...r.messages,n]}}},!1),we(s,a=>{const{conversations:r}=a;return{conversations:r.map(c=>c.id===e?{...c,messages:[...c.messages,n]}:c)}},!1)}async function gr(e){const n=[ne.chat,{params:{endpoint:"conversations"}}],s={conversationData:e},o=await Xe.post(ne.chat,s);return we(n,a=>{const r=[...a.conversations,e];return{...a,conversations:r}},!1),o.data}function vr({message:e,participants:n,currentUserId:s}){const o=n.find(c=>c.id===e.senderId),a=e.senderId===s?{type:"me"}:{avatarUrl:o==null?void 0:o.avatarUrl,firstName:o==null?void 0:o.name.split(" ")[0]},r=a.type==="me";return{hasImage:e.contentType==="image",me:r,senderDetails:a}}function $t(){const[e,n]=l.useState(!1),[s,o]=l.useState(!1),a=l.useCallback(()=>{o(h=>!h)},[]),r=l.useCallback(()=>{o(!1)},[]),i=l.useCallback(()=>{n(!0)},[]),c=l.useCallback(()=>{n(!1)},[]);return{openMobile:e,collapseDesktop:s,onOpenMobile:i,onCloseMobile:c,onCloseDesktop:r,onCollapseDesktop:a}}function br(e){const n=l.useRef(null),s=l.useCallback(()=>{e&&n.current&&n.current&&(n.current.scrollTop=n.current.scrollHeight)},[e]);return l.useEffect(()=>{s()},[e]),{messagesEndRef:n}}function yr(){const{user:e}=Ee(),n=_n(),[s,o]=l.useState("online"),a=l.useCallback(r=>{o(r.target.value)},[]);return t.jsxs(t.Fragment,{children:[t.jsx(be,{variant:s,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(H,{src:e==null?void 0:e.photoURL,alt:e==null?void 0:e.displayName,onClick:n.onOpen,sx:{cursor:"pointer",width:48,height:48}})}),t.jsxs(In,{open:n.open,onClose:n.onClose,arrow:"top-left",sx:{p:0},children:[t.jsxs(j,{direction:"row",alignItems:"center",spacing:2,sx:{py:2,pr:1,pl:2.5},children:[t.jsx(Ce,{primary:e==null?void 0:e.displayName,secondary:e==null?void 0:e.email,secondaryTypographyProps:{component:"span"}}),t.jsx(On,{title:"Log out",children:t.jsx(I,{color:"error",children:t.jsx(y,{icon:"ic:round-power-settings-new"})})})]}),t.jsx(Dn,{sx:{borderStyle:"dashed"}}),t.jsxs(j,{sx:{p:1},children:[t.jsxs(Ie,{children:[t.jsx(be,{variant:s,sx:{[`& .${Ln.badge}`]:{position:"static",m:.75,width:12,height:12,flexShrink:0}}}),t.jsx(Nn,{native:!0,fullWidth:!0,value:s,onChange:a,input:t.jsx(Tt,{sx:{pl:2}}),inputProps:{sx:{textTransform:"capitalize"}},children:["online","alway","busy","offline"].map(r=>t.jsx("option",{value:r,children:r},r))})]}),t.jsxs(Ie,{children:[t.jsx(y,{icon:"solar:user-id-bold",width:24}),"Profile"]}),t.jsxs(Ie,{children:[t.jsx(y,{icon:"eva:settings-2-fill",width:24}),"Settings"]})]})]})]})}function Wt({sx:e,...n}){return t.jsxs(j,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...e},...n,children:[t.jsx(Oe,{variant:"circular",sx:{width:48,height:48}}),t.jsxs(j,{spacing:1,flexGrow:1,children:[t.jsx(Oe,{sx:{width:.75,height:10}}),t.jsx(Oe,{sx:{width:.5,height:10}})]})]})}Wt.propTypes={sx:E.object};function zt({query:e,results:n,onClickResult:s}){const o=n.length,a=!o&&!!e;return t.jsxs(t.Fragment,{children:[t.jsxs(G,{paragraph:!0,variant:"h6",sx:{px:2.5},children:["Contacts (",o,")"]}),a?t.jsx(At,{query:e,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}):t.jsx(t.Fragment,{children:n.map(r=>t.jsxs(de,{onClick:()=>s(r),sx:{px:2.5,py:1.5,typography:"subtitle2"},children:[t.jsx(H,{alt:r.name,src:r.avatarUrl,sx:{mr:2}}),r.name]},r.id))})]})}zt.propTypes={query:E.string,results:E.array,onClickResult:E.func};const yt=320,jr=96;function qt({loading:e,contacts:n,conversations:s,selectedConversationId:o}){const a=kt(),r=He(),i=_t("up","md"),{collapseDesktop:c,onCloseDesktop:h,onCollapseDesktop:d,openMobile:g,onOpenMobile:m,onCloseMobile:v}=$t(),[f,x]=l.useState({query:"",results:[]});l.useEffect(()=>{i||h()},[h,i]);const p=l.useCallback(()=>{i?d():v()},[i,v,d]),w=l.useCallback(()=>{i||v(),r.push(ye.dashboard.chat)},[i,v,r]),u=l.useCallback(O=>{if(x($=>({...$,query:O})),O){const $=n.filter(z=>z.name.toLowerCase().includes(O));x(z=>({...z,results:$}))}},[n]),M=l.useCallback(()=>{x({query:"",results:[]})},[]),R=l.useCallback(O=>{M(),r.push(`${ye.dashboard.chat}?id=${O.id}`)},[M,r]),D=t.jsx(I,{onClick:m,sx:{left:0,top:84,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",bgcolor:a.palette.primary.main,boxShadow:a.customShadows.primary,color:a.palette.primary.contrastText,"&:hover":{bgcolor:a.palette.primary.darker}},children:t.jsx(y,{width:16,icon:"solar:users-group-rounded-bold"})}),A=t.jsx(t.Fragment,{children:[...Array(12)].map((O,$)=>t.jsx(Wt,{},$))}),k=t.jsx(t.Fragment,{}),U=t.jsx(zt,{query:f.query,results:f.results,onClickResult:R}),C=t.jsx(es,{onClickAway:M,children:t.jsx(It,{fullWidth:!0,value:f.query,onChange:O=>u(O.target.value),placeholder:"Search contacts...",InputProps:{startAdornment:t.jsx(Mn,{position:"start",children:t.jsx(y,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{mt:2.5}})}),L=t.jsxs(t.Fragment,{children:[t.jsxs(j,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,pb:0},children:[!c&&t.jsxs(t.Fragment,{children:[t.jsx(yr,{}),t.jsx(B,{sx:{flexGrow:1}})]}),t.jsx(I,{onClick:p,children:t.jsx(y,{icon:c?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!c&&t.jsx(I,{onClick:w,children:t.jsx(y,{width:24,icon:"solar:user-plus-bold"})})]}),t.jsx(B,{sx:{p:2.5,pt:0},children:!c&&C}),t.jsxs(Re,{sx:{pb:1},children:[f.query&&U,e&&A,!f.query&&!!s.allIds.length&&k]})]});return t.jsxs(t.Fragment,{children:[!i&&D,i?t.jsx(j,{sx:{height:1,flexShrink:0,width:yt,borderRight:`solid 1px ${a.palette.divider}`,transition:a.transitions.create(["width"],{duration:a.transitions.duration.shorter}),...c&&{width:jr}},children:L}):t.jsx(Ot,{open:g,onClose:v,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:yt}},children:L})]})}qt.propTypes={contacts:E.array,conversations:E.object,loading:E.bool,selectedConversationId:E.string};var jt=Fn,wr=Pn,Cr=St,wt=jt?jt.isConcatSpreadable:void 0;function Er(e){return Cr(e)||wr(e)||!!(wt&&e&&e[wt])}var Rr=Er,Sr=Vn,Tr=Rr;function Gt(e,n,s,o,a){var r=-1,i=e.length;for(s||(s=Tr),a||(a=[]);++r<i;){var c=e[r];n>0&&s(c)?n>1?Gt(c,n-1,s,o,a):Sr(a,c):o||(a[a.length]=c)}return a}var Ar=Gt,kr=Ar;function _r(e){var n=e==null?0:e.length;return n?kr(e,1):[]}var Ir=_r;const Or=qe(Ir);function Ht({participant:e,open:n,onClose:s}){return t.jsxs(Un,{fullWidth:!0,maxWidth:"xs",open:n,onClose:s,children:[t.jsx(I,{onClick:s,sx:{position:"absolute",right:8,top:8},children:t.jsx(y,{icon:"mingcute:close-line"})}),t.jsxs(Jn,{sx:{py:5,px:3,display:"flex"},children:[t.jsx(H,{alt:e.name,src:e.avatarUrl,sx:{width:96,height:96,mr:3}}),t.jsxs(j,{spacing:1,children:[t.jsx(G,{variant:"caption",sx:{color:"primary.main"},children:e.role}),t.jsx(G,{variant:"subtitle1",children:e.name}),t.jsxs(j,{direction:"row",sx:{typography:"caption",color:"text.disabled"},children:[t.jsx(y,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),e.address]}),t.jsxs(j,{spacing:1,direction:"row",sx:{pt:1.5},children:[t.jsx(I,{size:"small",color:"error",sx:{borderRadius:1,bgcolor:o=>Q(o.palette.error.main,.08),"&:hover":{bgcolor:o=>Q(o.palette.error.main,.16)}},children:t.jsx(y,{width:18,icon:"solar:phone-bold"})}),t.jsx(I,{size:"small",color:"info",sx:{borderRadius:1,bgcolor:o=>Q(o.palette.info.main,.08),"&:hover":{bgcolor:o=>Q(o.palette.info.main,.16)}},children:t.jsx(y,{width:18,icon:"solar:chat-round-dots-bold"})}),t.jsx(I,{size:"small",color:"primary",sx:{borderRadius:1,bgcolor:o=>Q(o.palette.primary.main,.08),"&:hover":{bgcolor:o=>Q(o.palette.primary.main,.16)}},children:t.jsx(y,{width:18,icon:"fluent:mail-24-filled"})}),t.jsx(I,{size:"small",color:"secondary",sx:{borderRadius:1,bgcolor:o=>Q(o.palette.secondary.main,.08),"&:hover":{bgcolor:o=>Q(o.palette.secondary.main,.16)}},children:t.jsx(y,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}Ht.propTypes={onClose:E.func,open:E.bool,participant:E.object};function Bt({participants:e}){const[n,s]=l.useState(null),o=Be(!0),a=l.useCallback(d=>{s(d)},[]),r=()=>{s(null)},i=e.length,c=t.jsxs(de,{onClick:o.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[t.jsxs(B,{component:"span",sx:{flexGrow:1},children:["In room (",i,")"]}),t.jsx(y,{width:16,icon:o.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),h=t.jsx(Re,{sx:{height:56*4},children:e.map(d=>t.jsxs(de,{onClick:()=>a(d),children:[t.jsx(be,{variant:d.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(H,{alt:d.name,src:d.avatarUrl})}),t.jsx(Ce,{sx:{ml:2},primary:d.name,secondary:d.role,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span",typography:"caption"}})]},d.id))});return t.jsxs(t.Fragment,{children:[c,t.jsx("div",{children:t.jsx(Dt,{in:o.value,children:h})}),n&&t.jsx(Ht,{participant:n,open:!!n,onClose:r})]})}Bt.propTypes={participants:E.array};function Yt({participant:e}){const n=Be(!0),{name:s,avatarUrl:o,role:a,address:r,phoneNumber:i,email:c}=e,h=t.jsxs(j,{alignItems:"center",sx:{py:5},children:[t.jsx(H,{alt:s,src:o,sx:{width:96,height:96,mb:2}}),t.jsx(G,{variant:"subtitle1",children:s}),t.jsx(G,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:a})]}),d=t.jsxs(de,{onClick:n.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[t.jsx(B,{component:"span",sx:{flexGrow:1},children:"Information"}),t.jsx(y,{width:16,icon:n.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),g=t.jsxs(j,{spacing:2,sx:{px:2,py:2.5,"& svg":{mr:1,flexShrink:0,color:"text.disabled"}},children:[t.jsxs(j,{direction:"row",children:[t.jsx(y,{icon:"mingcute:location-fill"}),t.jsx(G,{variant:"body2",children:r})]}),t.jsxs(j,{direction:"row",children:[t.jsx(y,{icon:"solar:phone-bold"}),t.jsx(G,{variant:"body2",children:i})]}),t.jsxs(j,{direction:"row",children:[t.jsx(y,{icon:"fluent:mail-24-filled"}),t.jsx(G,{variant:"body2",noWrap:!0,children:c})]})]});return t.jsxs(t.Fragment,{children:[h,d,t.jsx("div",{children:t.jsx(Dt,{in:n.value,children:g})})]})}Yt.propTypes={participant:E.object};function Kt({attachments:e}){const n=Be(!0),s=e.length,o=t.jsxs(de,{disabled:!e.length,onClick:n.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[t.jsxs(B,{component:"span",sx:{flexGrow:1},children:["Attachments (",s,")"]}),t.jsx(y,{width:16,icon:!n.value&&"eva:arrow-ios-forward-fill"||!e.length&&"eva:arrow-ios-forward-fill"||"eva:arrow-ios-downward-fill"})]}),a=t.jsx(Re,{sx:{px:2,py:2.5},children:e.map((r,i)=>t.jsxs(j,{spacing:1.5,direction:"row",alignItems:"center",sx:{mb:2},children:[t.jsx(j,{alignItems:"center",justifyContent:"center",sx:{width:40,height:40,flexShrink:0,borderRadius:1,overflow:"hidden",position:"relative",backgroundColor:"background.neutral"},children:t.jsx(Xn,{imageView:!0,file:r.preview,onDownload:()=>console.info("DOWNLOAD"),sx:{width:28,height:28}})}),t.jsx(Ce,{primary:r.name,secondary:$n(r.createdAt),primaryTypographyProps:{noWrap:!0,typography:"body2"},secondaryTypographyProps:{mt:.25,noWrap:!0,component:"span",typography:"caption",color:"text.disabled"}})]},r.name+i))});return t.jsxs(t.Fragment,{children:[o,t.jsx(B,{sx:{overflow:"hidden",height:n.value?1:0,transition:r=>r.transitions.create(["height"],{duration:r.transitions.duration.shorter})},children:a})]})}Kt.propTypes={attachments:E.array};const Pe=240;function Jt({participants:e,conversation:n}){const s=kt(),o=_t("up","lg"),{collapseDesktop:a,onCloseDesktop:r,onCollapseDesktop:i,openMobile:c,onOpenMobile:h,onCloseMobile:d}=$t();l.useEffect(()=>{o||r()},[r,o]);const g=l.useCallback(()=>{o?i():h()},[o]),m=e.length>1,v=us(Or(n.messages.map(p=>p.attachments))),f=t.jsxs(t.Fragment,{children:[m?t.jsx(Bt,{participants:e}):t.jsx(Yt,{participant:e[0]}),t.jsx(Kt,{attachments:v})]}),x=t.jsx(I,{onClick:g,sx:{top:12,right:0,zIndex:9,width:32,height:32,borderRight:0,position:"absolute",borderRadius:"12px 0 0 12px",boxShadow:s.customShadows.z8,bgcolor:s.palette.background.paper,border:`solid 1px ${s.palette.divider}`,"&:hover":{bgcolor:s.palette.background.neutral},...o&&{...!a&&{right:Pe}}},children:o?t.jsx(y,{width:16,icon:a?"eva:arrow-ios-back-fill":"eva:arrow-ios-forward-fill"}):t.jsx(y,{width:16,icon:"eva:arrow-ios-back-fill"})});return t.jsxs(B,{sx:{position:"relative"},children:[x,o?t.jsx(j,{sx:{height:1,flexShrink:0,width:Pe,borderLeft:`solid 1px ${s.palette.divider}`,transition:s.transitions.create(["width"],{duration:s.transitions.duration.shorter}),...a&&{width:0}},children:!a&&f}):t.jsx(Ot,{anchor:"right",open:c,onClose:d,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:Pe}},children:f})]})}Jt.propTypes={conversation:E.object,participants:E.array};function Xt({message:e,participants:n,onOpenLightbox:s}){const{user:o}=Ee(),{me:a,senderDetails:r,hasImage:i}=vr({message:e,participants:n,currentUserId:o.id}),{firstName:c,avatarUrl:h}=r,{body:d,createdAt:g}=e,m=t.jsxs(G,{noWrap:!0,variant:"caption",sx:{mb:1,color:"text.disabled",...!a&&{mr:"auto"}},children:[!a&&`${c},`,"  ",ns(new Date(g),{addSuffix:!0})]}),v=t.jsx(j,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...a&&{color:"grey.800",bgcolor:"primary.lighter"},...i&&{p:0,bgcolor:"transparent"}},children:i?t.jsx(B,{component:"img",alt:"attachment",src:d,onClick:()=>s(d),sx:{minHeight:220,borderRadius:1.5,cursor:"pointer","&:hover":{opacity:.9}}}):d}),f=t.jsxs(j,{direction:"row",className:"message-actions",sx:{pt:.5,opacity:0,top:"100%",left:0,position:"absolute",transition:x=>x.transitions.create(["opacity"],{duration:x.transitions.duration.shorter}),...a&&{left:"unset",right:0}},children:[t.jsx(I,{size:"small",children:t.jsx(y,{icon:"solar:reply-bold",width:16})}),t.jsx(I,{size:"small",children:t.jsx(y,{icon:"eva:smiling-face-fill",width:16})}),t.jsx(I,{size:"small",children:t.jsx(y,{icon:"solar:trash-bin-trash-bold",width:16})})]});return t.jsxs(j,{direction:"row",justifyContent:a?"flex-end":"unset",sx:{mb:5},children:[!a&&t.jsx(H,{alt:c,src:h,sx:{width:32,height:32,mr:2}}),t.jsxs(j,{alignItems:"flex-end",children:[m,t.jsxs(j,{direction:"row",alignItems:"center",sx:{position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:[v,f]})]})]})}Xt.propTypes={message:E.object,onOpenLightbox:E.func,participants:E.array};function Qt({messages:e=[],participants:n}){const{messagesEndRef:s}=br(e),o=e.filter(r=>r.contentType==="image").map(r=>({src:r.body})),a=Yn(o);return t.jsxs(t.Fragment,{children:[t.jsx(Re,{ref:s,sx:{px:3,py:5,height:1},children:t.jsx(B,{children:e.map(r=>t.jsx(Xt,{message:r,participants:n,onOpenLightbox:()=>a.onOpen(r.body)},r.id))})}),t.jsx(Kn,{index:a.selected,slides:o,open:a.open,close:a.onClose})]})}Qt.propTypes={messages:E.array,participants:E.array};function Ct(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const n=Math.random()*16|0;return(e==="x"?n:n&3|8).toString(16)})}function Zt({recipients:e,onAddRecipients:n,disabled:s,selectedConversationId:o}){const a=He(),{user:r}=Ee(),i=l.useRef(null),[c,h]=l.useState(""),d=l.useMemo(()=>({id:r.id,role:r.role,email:r.email,address:r.address,name:r.displayName,lastActivity:new Date,avatarUrl:r.photoURL,phoneNumber:r.phoneNumber,status:"online"}),[r]),g=l.useMemo(()=>({id:Ct(),attachments:[],body:c,contentType:"text",createdAt:Wn(new Date,{minutes:1}),senderId:d.id}),[c,d.id]),m=l.useMemo(()=>({id:Ct(),messages:[g],participants:[...e,d],type:e.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[g,d,e]),v=l.useCallback(()=>{i.current&&i.current.click()},[]),f=l.useCallback(p=>{h(p.target.value)},[]),x=l.useCallback(async p=>{try{if(p.key==="Enter"){if(c)if(o)await mr(o,g);else{const w=await gr(m);a.push(`${ye.dashboard.chat}?id=${w.conversation.id}`),n([])}h("")}}catch(w){console.error(w)}},[m,c,g,n,a,o]);return t.jsxs(t.Fragment,{children:[t.jsx(Tt,{value:c,onKeyUp:x,onChange:f,placeholder:"Type a message",disabled:s,startAdornment:t.jsx(I,{children:t.jsx(y,{icon:"eva:smiling-face-fill"})}),endAdornment:t.jsxs(j,{direction:"row",sx:{flexShrink:0},children:[t.jsx(I,{onClick:v,children:t.jsx(y,{icon:"solar:gallery-add-bold"})}),t.jsx(I,{onClick:v,children:t.jsx(y,{icon:"eva:attach-2-fill"})}),t.jsx(I,{children:t.jsx(y,{icon:"solar:microphone-bold"})})]}),sx:{px:1,height:56,flexShrink:0,borderTop:p=>`solid 1px ${p.palette.divider}`}}),t.jsx("input",{type:"file",ref:i,style:{display:"none"}})]})}Zt.propTypes={disabled:E.bool,onAddRecipients:E.func,recipients:E.array,selectedConversationId:E.string};function en({participants:e}){const n=e.length>1,s=e[0],o=t.jsx(is,{max:3,sx:{[`& .${Rt.avatar}`]:{width:32,height:32}},children:e.map(r=>t.jsx(H,{alt:r.name,src:r.avatarUrl},r.id))}),a=t.jsxs(j,{flexGrow:1,direction:"row",alignItems:"center",spacing:2,children:[t.jsx(be,{variant:s.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:t.jsx(H,{src:s.avatarUrl,alt:s.name})}),t.jsx(Ce,{primary:s.name,secondary:s.status==="offline"?zn(s.lastActivity):s.status,secondaryTypographyProps:{component:"span",...s.status!=="offline"&&{textTransform:"capitalize"}}})]});return t.jsxs(t.Fragment,{children:[n?o:a,t.jsx(j,{flexGrow:1}),t.jsx(I,{children:t.jsx(y,{icon:"solar:phone-bold"})}),t.jsx(I,{children:t.jsx(y,{icon:"solar:videocamera-record-bold"})}),t.jsx(I,{children:t.jsx(y,{icon:"eva:more-vertical-fill"})})]})}en.propTypes={participants:E.array};function tn({contacts:e,onAddRecipients:n}){const[s,o]=l.useState(""),a=l.useCallback(r=>{o(""),n(r)},[n]);return t.jsxs(t.Fragment,{children:[t.jsx(G,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),t.jsx(qn,{sx:{minWidth:320},multiple:!0,limitTags:3,popupIcon:null,disableCloseOnSelect:!0,noOptionsText:t.jsx(At,{query:s}),onChange:(r,i)=>a(i),onInputChange:(r,i)=>o(i),options:e,getOptionLabel:r=>r.name,isOptionEqualToValue:(r,i)=>r.id===i.id,renderInput:r=>t.jsx(It,{...r,placeholder:"+ Recipients"}),renderOption:(r,i,{selected:c})=>l.createElement("li",{...r,key:i.id},t.jsxs(B,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[t.jsx(H,{alt:i.name,src:i.avatarUrl,sx:{width:1,height:1}}),t.jsx(j,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:h=>Q(h.palette.grey[900],.8),transition:h=>h.transitions.create(["opacity"],{easing:h.transitions.easing.easeInOut,duration:h.transitions.duration.shorter}),...c&&{opacity:1,color:"primary.main"}},children:t.jsx(y,{icon:"eva:checkmark-fill"})})]},i.id),i.name),renderTags:(r,i)=>r.map((c,h)=>l.createElement(Gn,{...i({index:h}),key:c.id,label:c.name,avatar:t.jsx(H,{alt:c.name,src:c.avatarUrl}),size:"small",variant:"soft"}))})]})}tn.propTypes={contacts:E.array,onAddRecipients:E.func};function Dr(){const e=He(),{user:n}=Ee(),o=Bn().get("id")||"",[a,r]=l.useState([]),{contacts:i}=fr(),{conversations:c,conversationsLoading:h}=pr(),{conversation:d,conversationError:g}=xr(`${o}`),m=d?d.participants.filter(u=>u.id!==n.id):[];l.useEffect(()=>{(g||!o)&&e.push(ye.dashboard.chat)},[g,e,o]);const v=l.useCallback(u=>{r(u)},[]),f=!!d,x=t.jsx(j,{direction:"row",alignItems:"center",flexShrink:0,sx:{pr:1,pl:2.5,py:1,minHeight:72},children:o?t.jsx(t.Fragment,{children:f&&t.jsx(en,{participants:m})}):t.jsx(tn,{contacts:i,onAddRecipients:v})}),p=t.jsx(qt,{contacts:i,conversations:c,loading:h,selectedConversationId:o}),w=t.jsxs(j,{sx:{width:1,height:1,overflow:"hidden"},children:[t.jsx(Qt,{messages:d==null?void 0:d.messages,participants:m}),t.jsx(Zt,{recipients:a,onAddRecipients:v,selectedConversationId:o,disabled:!a.length&&!o})]});return t.jsxs(B,{px:5,children:[t.jsx(G,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Support"}),t.jsxs(j,{component:Qn,direction:"row",sx:{height:"72vh"},children:[p,t.jsxs(j,{sx:{width:1,height:1,overflow:"hidden"},children:[x,t.jsxs(j,{direction:"row",sx:{width:1,height:1,overflow:"hidden",borderTop:u=>`solid 1px ${u.palette.divider}`},children:[w,f&&t.jsx(Jt,{conversation:d,participants:m})]})]})]})]})}function Ur(){return t.jsxs(t.Fragment,{children:[t.jsx(Hn,{children:t.jsx("title",{children:" Dashboard: Chat"})}),t.jsx(Dr,{})]})}export{Ur as default};
