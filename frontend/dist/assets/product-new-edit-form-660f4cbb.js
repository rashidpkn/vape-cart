import{j as e,aE as ne,T as D,d as C,r as c,ao as be,k as U,u as me,s as w,C as L,x as N,aF as M,aG as ge,aH as ue,aI as je,_ as fe,aJ as le,ai as B,aK as T,c as J,aL as ye,B as E,aM as ve,aN as ke,F as Se,aO as he,aP as W,aj as re,aQ as we,aR as O,aa as Ce,aS as Ae,aT as Ie,ab as oe,ac as y,aU as I,aV as qe,aW as se,ad as Fe,p as Te,al as de,af as Re,aX as Ue,aY as ie,am as De}from"./index-5f38f145.js";import{G as k}from"./Grid-f14d8e39.js";import{b as pe,c as g,a as Oe,T as Ee,d as Ne}from"./TableRow-c5b3577e.js";import{C as ce}from"./CardHeader-dcdb4db2.js";import{A as Q}from"./Alert-95d71816.js";function ze({values:a,products:l,setValue:p}){return e.jsx(ne,{value:a.name,onChange:(i,t)=>{if(t){const d=l.find(r=>r.name===t);d&&(p("images",d.images),p("name",d.name),p("category",d.category),p("brand",d.brand),p("type",d.type))}else p("images",null)},name:"name",label:"Product Name",options:l.map(i=>i.name),getOptionLabel:i=>i,isOptionEqualToValue:(i,t)=>i===t.value,renderInput:i=>e.jsx(D,{...i,label:"Product Name",value:a.name,onChange:t=>p("name",t.target.value)}),renderOption:(i,t)=>e.jsxs(C,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...i,children:[e.jsx("img",{loading:"lazy",width:"20",src:l.find(d=>d.name===t).images[0],alt:""}),t]}),freeSolo:!0})}function Ke({setValue:a,values:l}){const p=c.useCallback(d=>{const r=l.images||[],s=d.map(n=>Object.assign(n,{preview:URL.createObjectURL(n)}));a("images",[...r,...s],{shouldValidate:!0})},[a,l.images]),i=c.useCallback(d=>{var s;const r=l.images&&((s=l.images)==null?void 0:s.filter(n=>n!==d));a("images",r)},[a,l.images]),t=c.useCallback(()=>{a("images",[])},[a]);return e.jsx(be,{multiple:!0,name:"images",maxSize:3145728,onDrop:p,onRemove:i,onRemoveAll:t,onUpload:async d=>{try{const r=new FormData;l.images.forEach(n=>{r.append("images",n)});const{data:s}=await U.post("upload",r);a("images",s),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})}function Le({values:a,setValue:l}){const{user:p}=me(),[i,t]=c.useState({name:"",show:!1}),[d,r]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{md:12,width:"100%",item:!0,children:[e.jsx(w,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(w,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(k,{xs:12,md:12,width:"100%",item:!0,children:e.jsx(L,{children:e.jsx(N,{spacing:3,sx:{p:3},children:e.jsxs(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(M,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:ge.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(M,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:ue.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(je,{name:"tags",label:"Tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:fe.map(s=>s),getOptionLabel:s=>s,renderOption:(s,n)=>c.createElement("li",{...s,key:n},n),renderTags:(s,n)=>s.map((m,h)=>c.createElement(le,{...n({index:h}),key:m,label:m,size:"small",color:"info",variant:"soft"}))}),e.jsxs(C,{children:[e.jsx(B,{name:"SKU",label:"Product SKU"}),e.jsx(T,{label:"Automatically generate SKUs",control:e.jsx(J,{checked:d,onChange:s=>{s.target.checked?a.name.replaceAll(" ","").trim().length>=8?(l("SKU",`${a.name.replaceAll(" ","").trim().slice(0,8)}-1`),r(!0)):(r(!1),alert("To automatically generate SKUs, ensure that the product name has at least 8 characters.")):(l("SKU",""),r(!1))}})})]}),!i.show&&e.jsx(M,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:ye.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(C,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(T,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(J,{checked:i.show,onChange:s=>t(n=>({...n,show:s.target.checked}))})}),i.show&&e.jsxs(e.Fragment,{children:[e.jsx(D,{label:"Brand Name",style:{width:300},onChange:s=>t(n=>({...n,name:s.target.value})),value:i.name}),e.jsx(E,{variant:"contained",color:"success",onClick:async()=>{try{i.name?(await U.post("/notifications",{userId:p.id,role:"admin",title:"🚀 New Brand Approval Request! 🚀",message:`Exciting news! A new brand has been submitted for approval. Brand Name: ${i.name}. 🛍️`,type:"product"}),l("brand",i.name),l("status","In Revision"),alert("Your request to create a new brand is being processed. Please wait while we verify the brand. You can add products, but their status will be 'In Revision.' After reviewing, the products will go live.")):alert("Please enter brand name")}catch(s){console.log(s),alert("An error occurred while adding this brand.")}},children:"Add Brand"})]})]}),a.status!=="In Revision"&&e.jsx(M,{native:!0,name:"status",label:"status",InputLabelProps:{shrink:!0},children:ve.map(s=>e.jsx("option",{value:s,children:s},s))})]})})})})]})}function Be({values:a}){return e.jsxs(e.Fragment,{children:[e.jsxs(k,{md:4,width:"100%",item:!0,children:[e.jsx(w,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(w,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(k,{xs:12,md:12,width:"100%",item:!0,children:e.jsx(L,{children:e.jsxs(N,{spacing:3,sx:{p:3},children:[e.jsx(ke,{name:"track",label:"Track"}),a.track&&e.jsx(B,{name:"quantity",label:"Quantity",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0}}),!a.track&&e.jsx(Se,{children:e.jsxs(he,{defaultValue:"Instock",row:!0,children:[e.jsx(T,{d:!0,value:"Instock",control:e.jsx(W,{defaultChecked:!0}),label:"Instock"}),e.jsx(T,{value:"Outstock",control:e.jsx(W,{}),label:"Outstock"})]})}),e.jsx(B,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(re,{position:"start",children:e.jsx(C,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx(B,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(re,{position:"start",children:e.jsx(C,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})})})]})}function Ge({selectedAttributes:a=[],counter:l,skuAlpha:p,attributes:i,values:t,setProductAdded:d,currentProduct:r,setValue:s}){const n=p[l]?`${t.SKU}-${p[l]}`:t.SKU,m=!!i&&Object.keys(i).map(u=>i[u]).join("-"),[h,v]=c.useState({track:!0,quantity:null,regularPrice:null,salePrice:null,image:null,attributes:{}});c.useEffect(()=>{const u=t.variations.findIndex(b=>!!i&&Object.keys(i).every(j=>i[j]===b.attributes[j]));if(Object.keys(h.attributes).length<a.length){const b=t.variations[u];v(j=>({...j,...b,attributes:i}))}},[i]);const[S,X]=c.useState("instock"),[z,G]=c.useState("pending"),x=u=>b=>{const j=b.target.type==="checkbox"?b.target.checked:b.target.value;v(q=>({...q,[u]:j}))},Z=async u=>{try{const b=new FormData;b.append("images",u.target.files[0]);const{data:j}=await U.post("upload",b);v(q=>({...q,image:[j[0],...t.images]}))}catch(b){console.error("Image upload failed:",b)}},V=async()=>{const{track:u,quantity:b,regularPrice:j,salePrice:q}=h;if(u&&!b)return alert("Quantity is required.");if(!j)return alert("Regular price is required.");if(q){const A=parseFloat(j),$=parseFloat(q);if(A<=$)return alert("Sale price must be less than the regular price")}if(z==="pending"){G("loading");try{if(!r)s("variations",[...t.variations,h]);else{const{attributes:A}=h;if(t.variations.some(F=>Object.keys(A).every(R=>F.attributes[R]===A[R]))){const F=[...t.variations],R=t.variations.findIndex(o=>Object.keys(A).every(f=>A[f]===o.attributes[f]));F[R]={...F[R],...h},s("variations",F)}else s("variations",[...t.variations,h])}G("success"),d(!0)}catch(A){console.error("Product creation failed:",A),G("failed")}}},P=()=>{switch(z){case"loading":return e.jsx(E,{color:"success",variant:"contained",size:"small",children:"Loading"});case"success":return r?e.jsx(E,{color:"success",variant:"contained",size:"small",children:"Product Updated"}):e.jsx(E,{color:"success",variant:"contained",size:"small",children:"Product Created"});case"failed":return e.jsx(E,{color:"error",variant:"contained",size:"small",children:"Product creation failed"});default:return e.jsx(E,{color:"success",variant:"contained",size:"small",onClick:V,children:r?"Save Changes":"Add Product"})}},{track:H,quantity:ee,regularPrice:ae,salePrice:te,image:K}=h;return e.jsxs(pe,{children:[e.jsx(g,{children:l}),e.jsx(g,{children:n}),e.jsx(g,{children:m}),e.jsx(g,{children:e.jsx(T,{control:e.jsx(J,{checked:H,onChange:x("track")})})}),e.jsx(g,{width:150,children:H?e.jsx(D,{size:"small",label:"Quantity",type:"number",inputProps:{min:0},onChange:x("quantity"),value:ee||""}):e.jsxs(he,{"aria-label":"Stock",name:"Stock",value:S,onChange:u=>X(u.target.value),children:[e.jsx(T,{value:"instock",control:e.jsx(W,{}),label:"Instock"}),e.jsx(T,{value:"outstock",control:e.jsx(W,{}),label:"Outstock"})]})}),e.jsx(g,{width:150,children:e.jsx(D,{size:"small",label:"Price",type:"number",inputProps:{min:0},onChange:x("regularPrice"),value:ae||""})}),e.jsx(g,{width:150,children:e.jsx(D,{size:"small",label:"Sale Price",type:"number",inputProps:{min:0},onChange:x("salePrice"),value:te||""})}),e.jsx(g,{width:150,children:e.jsx("input",{type:"file",onChange:Z,style:{width:"150px"}})}),e.jsx(g,{children:P()})]})}function He(){return e.jsx(Oe,{children:e.jsxs(pe,{children:[e.jsx(g,{children:"ID"}),e.jsx(g,{width:150,children:"SKU"}),e.jsx(g,{width:250,children:"Attributes"}),e.jsx(g,{width:150,children:"Track Stock"}),e.jsx(g,{children:"Stock"}),e.jsx(g,{children:"Regular Price"}),e.jsx(g,{children:"Sales Price"}),e.jsx(g,{children:"Image"}),e.jsx(g,{width:200,children:"Add Product"})]})})}function $e({setSelectedAttributes:a,selectedAttributes:l,values:p,setValue:i}){return e.jsx(ne,{onChange:(t,d)=>{a(d)},value:l,name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:we,getOptionLabel:t=>t,renderOption:(t,d)=>c.createElement("li",{...t,key:d},d),renderTags:(t,d)=>t.map((r,s)=>c.createElement(le,{...d({index:s}),key:r,label:r,size:"small",color:"info",variant:"soft"})),renderInput:t=>e.jsx(D,{...t,label:"Attributes",placeholder:"+ Attributes"})})}function _e({currentProduct:a,values:l,setValue:p,setVariation:i,e:t,savedAttibutes:d,variation:r=[]}){var s;return e.jsxs(C,{sx:{gridColumn:"span 1 "},children:[e.jsx(ne,{multiple:!0,freeSolo:!0,options:[...t==="bottleSize"?O.bottleSize:[],...t==="puffs"?O.puffs:[],...t==="flavour"?O.flavour:[],...t==="nicotineStrength"?O.nicotineStrength:[],...t==="color"?O.color:[],...t==="batteries"?O.batteries:[],...d.filter(n=>n.attribute===t).map(n=>n.value)],value:l.attributes[t]||[],onChange:(n,m)=>{let h={...l.attributes};if(l.type==="Simple"&&t!=="flavour"){if(m.length>1){const v=[m[m.length-1]];h={...l.attributes,[t]:v}}else h={...l.attributes,[t]:m};m.length===0&&delete h[t],p("attributes",h)}else{if(r.find(S=>S===t)&&m.length===1)return alert('Please uncheck "Use this attribute to create Variations" before deleting this attribute.');const v={...l.attributes,[t]:m};m.length===0&&delete v[t],p("attributes",v)}},renderInput:n=>e.jsx(D,{...n,label:t,placeholder:t}),renderTags:(n,m)=>n.map((h,v)=>c.createElement(le,{...m({index:v}),key:h,label:h,size:"small",color:"info",variant:"soft"}))}),l.type==="Variable"&&((s=l.attributes[t])==null?void 0:s.length)>1&&e.jsx(T,{label:"Use this attribute to create Variations",control:e.jsx(J,{defaultChecked:r.find(n=>n===t),onChange:n=>{if(a)if(confirm("Changing the variation of this product will reset all current variations, and you'll have to start over from the beginning. Do you wish to proceed?"))p("variations",[]);else return;n.target.checked?i(m=>[...new Set([...m,t])]):i(m=>[...new Set(m.filter(h=>h!==t))])}})})]},t)}function Xe({currentProduct:a}){const[l,p]=c.useState(!1),i=Ce(),t=Ae("up","md"),{enqueueSnackbar:d}=Ie(),{user:r}=me(),s=oe().shape({name:y().required("Name is required"),subDescription:y().required("Short description is required").test("not-four-digits","Your content contain continues 7 digit number, Please remove",o=>!/\d{7,}/.test(o)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',o=>!/@/.test(o)),content:y().test("not-four-digits","Your content contain continues 7 digit number, Please remove",o=>!/\d{7,}/.test(o)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',o=>!/@/.test(o)),images:I().min(1,"Image is required"),type:y(),category:y().required("Category is required"),tags:I(),SKU:y().required("SKU is required"),brand:y().required("brand is required"),status:y().required("brand is required"),attributes:oe().shape({bottleSize:I().of(y()).optional(),puffs:I().of(y()).optional(),flavour:I().of(y()).optional(),nicotineStrength:I().of(y()).optional(),color:I().of(y()).optional(),batteries:I().of(y()).optional()}),track:qe(),quantity:se(),regularPrice:se(),salePrice:se(),variations:I()}),n=c.useMemo(()=>({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",subDescription:(a==null?void 0:a.subDescription)||"",content:(a==null?void 0:a.content)||"",images:(a==null?void 0:a.images)||[],type:(a==null?void 0:a.type)||"Simple",category:(a==null?void 0:a.category)||"Disposables",tags:(a==null?void 0:a.tags)||[],SKU:(a==null?void 0:a.SKU)||"",brand:(a==null?void 0:a.brand)||"SMOK",status:(a==null?void 0:a.status)||"Published",attributes:(a==null?void 0:a.attributes)||{},track:(a==null?void 0:a.track)||!0,quantity:(a==null?void 0:a.quantity)||0,regularPrice:(a==null?void 0:a.regularPrice)||100,salePrice:(a==null?void 0:a.salePrice)||0,variations:(a==null?void 0:a.variations)||[]}),[a]),m=Fe({resolver:De(s),defaultValues:n}),{reset:h,watch:v,setValue:S,handleSubmit:X,formState:{isSubmitting:z,isValid:G}}=m,x=v(),[Z,V]=c.useState([]);c.useEffect(()=>{U.get("/attributes").then(o=>{V(o.data)})},[]);const[P,H]=c.useState([]),ee=c.useCallback(async()=>{const{data:o}=await U.get("/products",{params:{name:x.name}});H(o.products.filter(f=>!f.name.includes("-")))},[x.name]);c.useEffect(()=>{ee()},[x.name]),c.useEffect(()=>{a&&h(n)},[a,n,h]);const ae=X(async o=>{try{console.log(`DATA : ${o}`),a?await U.patch("products",{...o,username:r.displayName,userId:r.id,storeName:r.storeName}):await U.post("products",{...o,username:r.displayName,userId:r.id,storeName:r.storeName}),h(),d(a?"Update success!":"Create success!"),i.push(Te.dashboard.product.root)}catch(f){console.log(f)}}),te=e.jsxs(e.Fragment,{children:[t&&e.jsxs(k,{md:4,item:!0,children:[e.jsx(w,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(w,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(k,{xs:12,md:12,item:!0,children:e.jsxs(L,{children:[!t&&e.jsx(ce,{title:"Details"}),e.jsxs(N,{spacing:3,sx:{p:3},children:[e.jsx(ze,{products:P,setValue:S,values:x}),e.jsx(Q,{severity:"info",children:"Please do not include emails, phone numbers, or emojis in the sub-description and content. Products containing these will not be accepted."}),e.jsx(B,{name:"subDescription",label:"Sub Description",multiline:!0,rows:4}),e.jsxs(N,{spacing:1.5,children:[e.jsx(w,{variant:"subtitle2",children:"Content"}),e.jsx(Ue,{simple:!0,name:"content"})]}),e.jsx(Q,{severity:"info",children:"Uploading at least one image is required."}),e.jsxs(N,{spacing:1.5,children:[e.jsx(w,{variant:"subtitle2",children:"Images"}),e.jsx(Ke,{values:x,setValue:S})]})]})]})})]}),[K,u]=c.useState([]),[b,j]=c.useState([]);c.useEffect(()=>{var o;if(a){const{attributes:f,variations:_,type:Y}=a;f&&u(Object.keys(f)),Y==="Variable"&&_.length&&j(Object.keys((o=_[0])==null?void 0:o.attributes))}},[a]);const q=e.jsxs(e.Fragment,{children:[t&&e.jsxs(k,{md:4,item:!0,children:[e.jsx(w,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(w,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(k,{xs:12,md:12,item:!0,children:e.jsxs(L,{children:[!t&&e.jsx(ce,{title:"Attributes"}),e.jsx(N,{spacing:3,sx:{p:3},children:e.jsxs(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(C,{sx:{gridColumn:"span 2 "},children:x.type==="Variable"&&e.jsx(Q,{severity:"info",children:"Please choose at least one attribute."})}),e.jsx(C,{sx:{gridColumn:"span 2 "},children:e.jsx($e,{selectedAttributes:K,setSelectedAttributes:u,setValue:S,values:x})}),x.type==="Variable"&&!!K.length&&e.jsx(C,{sx:{gridColumn:"span 2 "},children:e.jsx(Q,{severity:"info",children:"Please select at least two variations from the list below to enable the 'Create Variations' option."})}),K.map(o=>e.jsx(_e,{currentProduct:a,setValue:S,setVariation:j,variation:b,values:x,e:o,savedAttibutes:Z},o))]})})]})})]}),A=e.jsxs(k,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},gap:2.5,item:!0,children:[e.jsx(de,{type:"submit",variant:"contained",size:"large",loading:z,children:a?"Save Changes":"Create Product"}),x.status!=="In Revision"&&e.jsx(de,{onClick:()=>{S("status","Draft")},type:"submit",variant:"contained",size:"large",loading:z,children:"Save as Draft"})]}),$=[...ie,...ie.slice(1).flatMap(o=>ie.slice(1).map(f=>o+f))];let F=1;const R=e.jsxs(e.Fragment,{children:[t&&e.jsx(k,{md:4,item:!0,children:e.jsx(w,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(k,{xs:12,md:12,item:!0,children:e.jsx(L,{children:e.jsxs(Ee,{children:[e.jsx(He,{}),e.jsx(Ne,{children:b==null?void 0:b.reduce((o,f)=>o.flatMap(_=>{var Y;return(Y=x.attributes[f])==null?void 0:Y.map(xe=>({..._,[f]:xe}))}),[{}]).map(o=>e.jsx(Ge,{selectedAttributes:K,counter:F++,skuAlpha:$,attributes:o,values:x,setProductAdded:p,currentProduct:a,setValue:S},F))})]})})})]});return e.jsx(Re,{methods:m,onSubmit:ae,children:e.jsxs(k,{container:!0,spacing:3,children:[te,e.jsx(Le,{values:x,setValue:S}),q,x.type==="Simple"&&e.jsx(Be,{values:x}),x.type==="Variable"&&R,A]})})}export{Xe as P};
