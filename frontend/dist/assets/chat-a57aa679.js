import{H as c,bA as Pe,bB as Ue,bC as Y,j as e,bD as pe,bE as $e,bF as ze,bG as Be,bH as Ve,bI as _,bJ as oe,bK as We,bL as Q,bM as Ge,bN as qe,bO as He,bP as Ye,bQ as Xe,bR as ge,bS as Ke,aq as Ze,bT as F,bd as R,ax as Je,S as p,be as $,aM as Qe,aN as y,ap as x,am as en,ay as X,bU as nn,bV as sn,bW as me,bX as z,ag as f,T as S,bY as fe,bZ as O,ad as ve,aS as ee,aZ as be,ao as P,a$ as je,ba as tn,B as T,ai as B,b_ as ye,b$ as rn,c0 as on,c1 as an,c2 as ln,af as I,aT as ne,bg as we,bl as cn,c3 as dn,c4 as hn,c5 as un,aX as xn,b3 as pn,ah as gn,W as mn}from"./index-d26ef6f4.js";import{u as fn}from"./use-search-params-aa102681.js";import{u as se,f as te,m as J,a as vn,e as M,S as K,b as bn,L as jn}from"./lightbox-417272f4.js";import{D as yn}from"./DialogContent-f6919e4f.js";import{F as wn}from"./file-thumbnail-6778dc21.js";import{A as Cn}from"./AvatarGroup-95983fcb.js";function ae(n){return n.substring(2).toLowerCase()}function kn(n,s){return s.documentElement.clientWidth<n.clientX||s.documentElement.clientHeight<n.clientY}function Sn(n){const{children:s,disableReactTree:r=!1,mouseEvent:o="onClick",onClickAway:a,touchEvent:t="onTouchEnd"}=n,i=c.useRef(!1),l=c.useRef(null),h=c.useRef(!1),d=c.useRef(!1);c.useEffect(()=>(setTimeout(()=>{h.current=!0},0),()=>{h.current=!1}),[]);const b=Pe(s.ref,l),v=Ue(u=>{const m=d.current;d.current=!1;const w=Y(l.current);if(!h.current||!l.current||"clientX"in u&&kn(u,w))return;if(i.current){i.current=!1;return}let C;u.composedPath?C=u.composedPath().indexOf(l.current)>-1:C=!w.documentElement.contains(u.target)||l.current.contains(u.target),!C&&(r||!m)&&a(u)}),j=u=>m=>{d.current=!0;const w=s.props[u];w&&w(m)},g={ref:b};return t!==!1&&(g[t]=j(t)),c.useEffect(()=>{if(t!==!1){const u=ae(t),m=Y(l.current),w=()=>{i.current=!0};return m.addEventListener(u,v),m.addEventListener("touchmove",w),()=>{m.removeEventListener(u,v),m.removeEventListener("touchmove",w)}}},[v,t]),o!==!1&&(g[o]=j(o)),c.useEffect(()=>{if(o!==!1){const u=ae(o),m=Y(l.current);return m.addEventListener(u,v),()=>{m.removeEventListener(u,v)}}},[v,o]),e.jsx(c.Fragment,{children:c.cloneElement(s,g)})}var ie=1e3*60,U=60*24,le=U*30,ce=U*365;function Tn(n,s,r){var o,a,t;pe(2,arguments);var i=We(),l=(o=(a=r==null?void 0:r.locale)!==null&&a!==void 0?a:i.locale)!==null&&o!==void 0?o:$e;if(!l.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var h=ze(n,s);if(isNaN(h))throw new RangeError("Invalid time value");var d=Be(Ve(r),{addSuffix:!!(r!=null&&r.addSuffix),comparison:h}),b,v;h>0?(b=_(s),v=_(n)):(b=_(n),v=_(s));var j=String((t=r==null?void 0:r.roundingMethod)!==null&&t!==void 0?t:"round"),g;if(j==="floor")g=Math.floor;else if(j==="ceil")g=Math.ceil;else if(j==="round")g=Math.round;else throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");var u=v.getTime()-b.getTime(),m=u/ie,w=oe(v)-oe(b),C=(u-w)/ie,A=r==null?void 0:r.unit,k;if(A?k=String(A):m<1?k="second":m<60?k="minute":m<U?k="hour":C<le?k="day":C<ce?k="month":k="year",k==="second"){var V=g(u/1e3);return l.formatDistance("xSeconds",V,d)}else if(k==="minute"){var W=g(m);return l.formatDistance("xMinutes",W,d)}else if(k==="hour"){var G=g(m/60);return l.formatDistance("xHours",G,d)}else if(k==="day"){var q=g(C/U);return l.formatDistance("xDays",q,d)}else if(k==="month"){var D=g(C/le);return D===12&&A!=="month"?l.formatDistance("xYears",1,d):l.formatDistance("xMonths",D,d)}else if(k==="year"){var N=g(C/ce);return l.formatDistance("xYears",N,d)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function Rn(n,s){return pe(1,arguments),Tn(n,Date.now(),s)}var In=Ge;function En(n){return n&&n.length?In(n):[]}var An=En;const Mn=Q(An);var Ln=qe,On=He;function Dn(n,s){return n&&Ln(n,s,On)}var Nn=Dn,_n=Ye;function Fn(n,s){return function(r,o){if(r==null)return r;if(!_n(r))return n(r,o);for(var a=r.length,t=s?a:-1,i=Object(r);(s?t--:++t<a)&&o(i[t],t,i)!==!1;);return r}}var Pn=Fn,Un=Nn,$n=Pn,zn=$n(Un),Bn=zn;function Vn(n,s,r,o){for(var a=-1,t=n==null?0:n.length;++a<t;){var i=n[a];s(o,i,r(i),n)}return o}var Wn=Vn,Gn=Bn;function qn(n,s,r,o){return Gn(n,function(a,t,i){s(o,a,r(a),i)}),o}var Hn=qn,Yn=Wn,Xn=Hn,Kn=Xe,Zn=ge;function Jn(n,s){return function(r,o){var a=Zn(r)?Yn:Xn,t=s?s():{};return a(r,n,Kn(o),t)}}var Qn=Jn,es=Ke,ns=Qn,ss=ns(function(n,s,r){es(n,r,s)}),ts=ss;const rs=Q(ts),re={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function os(){const n=[M.chat,{params:{endpoint:"contacts"}}],{data:s,isLoading:r,error:o,isValidating:a}=se(n,te,re);return c.useMemo(()=>({contacts:(s==null?void 0:s.contacts)||[],contactsLoading:r,contactsError:o,contactsValidating:a,contactsEmpty:!r&&!(s!=null&&s.contacts.length)}),[s==null?void 0:s.contacts,o,r,a])}function as(){const n=[M.chat,{params:{endpoint:"conversations"}}],{data:s,isLoading:r,error:o,isValidating:a}=se(n,te,re);return c.useMemo(()=>{const i=rs(s==null?void 0:s.conversations,"id")||{},l=Object.keys(i)||[];return{conversations:{byId:i,allIds:l},conversationsLoading:r,conversationsError:o,conversationsValidating:a,conversationsEmpty:!r&&!l.length}},[s==null?void 0:s.conversations,o,r,a])}function is(n){const s=n?[M.chat,{params:{conversationId:n,endpoint:"conversation"}}]:null,{data:r,isLoading:o,error:a,isValidating:t}=se(s,te,re);return c.useMemo(()=>({conversation:r==null?void 0:r.conversation,conversationLoading:o,conversationError:a,conversationValidating:t}),[r==null?void 0:r.conversation,a,o,t])}async function ls(n,s){const r=[M.chat,{params:{endpoint:"conversations"}}],o=[M.chat,{params:{conversationId:n,endpoint:"conversation"}}];J(o,a=>{const{conversation:t}=a;return{conversation:{...t,messages:[...t.messages,s]}}},!1),J(r,a=>{const{conversations:t}=a;return{conversations:t.map(l=>l.id===n?{...l,messages:[...l.messages,s]}:l)}},!1)}async function cs(n){const s=[M.chat,{params:{endpoint:"conversations"}}],r={conversationData:n},o=await vn.post(M.chat,r);return J(s,a=>{const t=[...a.conversations,n];return{...a,conversations:t}},!1),o.data}function ds({message:n,participants:s,currentUserId:r}){const o=s.find(l=>l.id===n.senderId),a=n.senderId===r?{type:"me"}:{avatarUrl:o==null?void 0:o.avatarUrl,firstName:o==null?void 0:o.name.split(" ")[0]},t=a.type==="me";return{hasImage:n.contentType==="image",me:t,senderDetails:a}}function Ce(){const[n,s]=c.useState(!1),[r,o]=c.useState(!1),a=c.useCallback(()=>{o(h=>!h)},[]),t=c.useCallback(()=>{o(!1)},[]),i=c.useCallback(()=>{s(!0)},[]),l=c.useCallback(()=>{s(!1)},[]);return{openMobile:n,collapseDesktop:r,onOpenMobile:i,onCloseMobile:l,onCloseDesktop:t,onCollapseDesktop:a}}function hs(n){const s=c.useRef(null),r=c.useCallback(()=>{n&&s.current&&s.current&&(s.current.scrollTop=s.current.scrollHeight)},[n]);return c.useEffect(()=>{r()},[n]),{messagesEndRef:s}}function us(){const{user:n}=z(),s=Ze(),[r,o]=c.useState("online"),a=c.useCallback(t=>{o(t.target.value)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:r,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(R,{src:n==null?void 0:n.photoURL,alt:n==null?void 0:n.displayName,onClick:s.onOpen,sx:{cursor:"pointer",width:48,height:48}})}),e.jsxs(Je,{open:s.open,onClose:s.onClose,arrow:"top-left",sx:{p:0},children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:2,sx:{py:2,pr:1,pl:2.5},children:[e.jsx($,{primary:n==null?void 0:n.displayName,secondary:n==null?void 0:n.email,secondaryTypographyProps:{component:"span"}}),e.jsx(Qe,{title:"Log out",children:e.jsx(y,{color:"error",children:e.jsx(x,{icon:"ic:round-power-settings-new"})})})]}),e.jsx(en,{sx:{borderStyle:"dashed"}}),e.jsxs(p,{sx:{p:1},children:[e.jsxs(X,{children:[e.jsx(F,{variant:r,sx:{[`& .${nn.badge}`]:{position:"static",m:.75,width:12,height:12,flexShrink:0}}}),e.jsx(sn,{native:!0,fullWidth:!0,value:r,onChange:a,input:e.jsx(me,{sx:{pl:2}}),inputProps:{sx:{textTransform:"capitalize"}},children:["online","alway","busy","offline"].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs(X,{children:[e.jsx(x,{icon:"solar:user-id-bold",width:24}),"Profile"]}),e.jsxs(X,{children:[e.jsx(x,{icon:"eva:settings-2-fill",width:24}),"Settings"]})]})]})]})}function ke({sx:n,...s}){return e.jsxs(p,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...n},...s,children:[e.jsx(K,{variant:"circular",sx:{width:48,height:48}}),e.jsxs(p,{spacing:1,flexGrow:1,children:[e.jsx(K,{sx:{width:.75,height:10}}),e.jsx(K,{sx:{width:.5,height:10}})]})]})}ke.propTypes={sx:f.object};function Se({query:n,results:s,onClickResult:r}){const o=s.length,a=!o&&!!n;return e.jsxs(e.Fragment,{children:[e.jsxs(S,{paragraph:!0,variant:"h6",sx:{px:2.5},children:["Contacts (",o,")"]}),a?e.jsx(fe,{query:n,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}):e.jsx(e.Fragment,{children:s.map(t=>e.jsxs(O,{onClick:()=>r(t),sx:{px:2.5,py:1.5,typography:"subtitle2"},children:[e.jsx(R,{alt:t.name,src:t.avatarUrl,sx:{mr:2}}),t.name]},t.id))})]})}Se.propTypes={query:f.string,results:f.array,onClickResult:f.func};const de=320,xs=96;function Te({loading:n,contacts:s,conversations:r,selectedConversationId:o}){const a=ve(),t=ee(),i=be("up","md"),{collapseDesktop:l,onCloseDesktop:h,onCollapseDesktop:d,openMobile:b,onOpenMobile:v,onCloseMobile:j}=Ce(),[g,u]=c.useState({query:"",results:[]});c.useEffect(()=>{i||h()},[h,i]);const m=c.useCallback(()=>{i?d():j()},[i,j,d]),w=c.useCallback(()=>{i||j(),t.push(P.dashboard.chat)},[i,j,t]),C=c.useCallback(E=>{if(u(L=>({...L,query:E})),E){const L=s.filter(H=>H.name.toLowerCase().includes(E));u(H=>({...H,results:L}))}},[s]),A=c.useCallback(()=>{u({query:"",results:[]})},[]),k=c.useCallback(E=>{A(),t.push(`${P.dashboard.chat}?id=${E.id}`)},[A,t]),V=e.jsx(y,{onClick:v,sx:{left:0,top:84,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",bgcolor:a.palette.primary.main,boxShadow:a.customShadows.primary,color:a.palette.primary.contrastText,"&:hover":{bgcolor:a.palette.primary.darker}},children:e.jsx(x,{width:16,icon:"solar:users-group-rounded-bold"})}),W=e.jsx(e.Fragment,{children:[...Array(12)].map((E,L)=>e.jsx(ke,{},L))}),G=e.jsx(e.Fragment,{}),q=e.jsx(Se,{query:g.query,results:g.results,onClickResult:k}),D=e.jsx(Sn,{onClickAway:A,children:e.jsx(je,{fullWidth:!0,value:g.query,onChange:E=>C(E.target.value),placeholder:"Search contacts...",InputProps:{startAdornment:e.jsx(tn,{position:"start",children:e.jsx(x,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{mt:2.5}})}),N=e.jsxs(e.Fragment,{children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,pb:0},children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(us,{}),e.jsx(T,{sx:{flexGrow:1}})]}),e.jsx(y,{onClick:m,children:e.jsx(x,{icon:l?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!l&&e.jsx(y,{onClick:w,children:e.jsx(x,{width:24,icon:"solar:user-plus-bold"})})]}),e.jsx(T,{sx:{p:2.5,pt:0},children:!l&&D}),e.jsxs(B,{sx:{pb:1},children:[g.query&&q,n&&W,!g.query&&!!r.allIds.length&&G]})]});return e.jsxs(e.Fragment,{children:[!i&&V,i?e.jsx(p,{sx:{height:1,flexShrink:0,width:de,borderRight:`solid 1px ${a.palette.divider}`,transition:a.transitions.create(["width"],{duration:a.transitions.duration.shorter}),...l&&{width:xs}},children:N}):e.jsx(ye,{open:b,onClose:j,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:de}},children:N})]})}Te.propTypes={contacts:f.array,conversations:f.object,loading:f.bool,selectedConversationId:f.string};var he=rn,ps=on,gs=ge,ue=he?he.isConcatSpreadable:void 0;function ms(n){return gs(n)||ps(n)||!!(ue&&n&&n[ue])}var fs=ms,vs=an,bs=fs;function Re(n,s,r,o,a){var t=-1,i=n.length;for(r||(r=bs),a||(a=[]);++t<i;){var l=n[t];s>0&&r(l)?s>1?Re(l,s-1,r,o,a):vs(a,l):o||(a[a.length]=l)}return a}var js=Re,ys=js;function ws(n){var s=n==null?0:n.length;return s?ys(n,1):[]}var Cs=ws;const ks=Q(Cs);function Ie({participant:n,open:s,onClose:r}){return e.jsxs(ln,{fullWidth:!0,maxWidth:"xs",open:s,onClose:r,children:[e.jsx(y,{onClick:r,sx:{position:"absolute",right:8,top:8},children:e.jsx(x,{icon:"mingcute:close-line"})}),e.jsxs(yn,{sx:{py:5,px:3,display:"flex"},children:[e.jsx(R,{alt:n.name,src:n.avatarUrl,sx:{width:96,height:96,mr:3}}),e.jsxs(p,{spacing:1,children:[e.jsx(S,{variant:"caption",sx:{color:"primary.main"},children:n.role}),e.jsx(S,{variant:"subtitle1",children:n.name}),e.jsxs(p,{direction:"row",sx:{typography:"caption",color:"text.disabled"},children:[e.jsx(x,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),n.address]}),e.jsxs(p,{spacing:1,direction:"row",sx:{pt:1.5},children:[e.jsx(y,{size:"small",color:"error",sx:{borderRadius:1,bgcolor:o=>I(o.palette.error.main,.08),"&:hover":{bgcolor:o=>I(o.palette.error.main,.16)}},children:e.jsx(x,{width:18,icon:"solar:phone-bold"})}),e.jsx(y,{size:"small",color:"info",sx:{borderRadius:1,bgcolor:o=>I(o.palette.info.main,.08),"&:hover":{bgcolor:o=>I(o.palette.info.main,.16)}},children:e.jsx(x,{width:18,icon:"solar:chat-round-dots-bold"})}),e.jsx(y,{size:"small",color:"primary",sx:{borderRadius:1,bgcolor:o=>I(o.palette.primary.main,.08),"&:hover":{bgcolor:o=>I(o.palette.primary.main,.16)}},children:e.jsx(x,{width:18,icon:"fluent:mail-24-filled"})}),e.jsx(y,{size:"small",color:"secondary",sx:{borderRadius:1,bgcolor:o=>I(o.palette.secondary.main,.08),"&:hover":{bgcolor:o=>I(o.palette.secondary.main,.16)}},children:e.jsx(x,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}Ie.propTypes={onClose:f.func,open:f.bool,participant:f.object};function Ee({participants:n}){const[s,r]=c.useState(null),o=ne(!0),a=c.useCallback(d=>{r(d)},[]),t=()=>{r(null)},i=n.length,l=e.jsxs(O,{onClick:o.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(T,{component:"span",sx:{flexGrow:1},children:["In room (",i,")"]}),e.jsx(x,{width:16,icon:o.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),h=e.jsx(B,{sx:{height:56*4},children:n.map(d=>e.jsxs(O,{onClick:()=>a(d),children:[e.jsx(F,{variant:d.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(R,{alt:d.name,src:d.avatarUrl})}),e.jsx($,{sx:{ml:2},primary:d.name,secondary:d.role,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span",typography:"caption"}})]},d.id))});return e.jsxs(e.Fragment,{children:[l,e.jsx("div",{children:e.jsx(we,{in:o.value,children:h})}),s&&e.jsx(Ie,{participant:s,open:!!s,onClose:t})]})}Ee.propTypes={participants:f.array};function Ae({participant:n}){const s=ne(!0),{name:r,avatarUrl:o,role:a,address:t,phoneNumber:i,email:l}=n,h=e.jsxs(p,{alignItems:"center",sx:{py:5},children:[e.jsx(R,{alt:r,src:o,sx:{width:96,height:96,mb:2}}),e.jsx(S,{variant:"subtitle1",children:r}),e.jsx(S,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:a})]}),d=e.jsxs(O,{onClick:s.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsx(T,{component:"span",sx:{flexGrow:1},children:"Information"}),e.jsx(x,{width:16,icon:s.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),b=e.jsxs(p,{spacing:2,sx:{px:2,py:2.5,"& svg":{mr:1,flexShrink:0,color:"text.disabled"}},children:[e.jsxs(p,{direction:"row",children:[e.jsx(x,{icon:"mingcute:location-fill"}),e.jsx(S,{variant:"body2",children:t})]}),e.jsxs(p,{direction:"row",children:[e.jsx(x,{icon:"solar:phone-bold"}),e.jsx(S,{variant:"body2",children:i})]}),e.jsxs(p,{direction:"row",children:[e.jsx(x,{icon:"fluent:mail-24-filled"}),e.jsx(S,{variant:"body2",noWrap:!0,children:l})]})]});return e.jsxs(e.Fragment,{children:[h,d,e.jsx("div",{children:e.jsx(we,{in:s.value,children:b})})]})}Ae.propTypes={participant:f.object};function Me({attachments:n}){const s=ne(!0),r=n.length,o=e.jsxs(O,{disabled:!n.length,onClick:s.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(T,{component:"span",sx:{flexGrow:1},children:["Attachments (",r,")"]}),e.jsx(x,{width:16,icon:!s.value&&"eva:arrow-ios-forward-fill"||!n.length&&"eva:arrow-ios-forward-fill"||"eva:arrow-ios-downward-fill"})]}),a=e.jsx(B,{sx:{px:2,py:2.5},children:n.map((t,i)=>e.jsxs(p,{spacing:1.5,direction:"row",alignItems:"center",sx:{mb:2},children:[e.jsx(p,{alignItems:"center",justifyContent:"center",sx:{width:40,height:40,flexShrink:0,borderRadius:1,overflow:"hidden",position:"relative",backgroundColor:"background.neutral"},children:e.jsx(wn,{imageView:!0,file:t.preview,onDownload:()=>console.info("DOWNLOAD"),sx:{width:28,height:28}})}),e.jsx($,{primary:t.name,secondary:cn(t.createdAt),primaryTypographyProps:{noWrap:!0,typography:"body2"},secondaryTypographyProps:{mt:.25,noWrap:!0,component:"span",typography:"caption",color:"text.disabled"}})]},t.name+i))});return e.jsxs(e.Fragment,{children:[o,e.jsx(T,{sx:{overflow:"hidden",height:s.value?1:0,transition:t=>t.transitions.create(["height"],{duration:t.transitions.duration.shorter})},children:a})]})}Me.propTypes={attachments:f.array};const Z=240;function Le({participants:n,conversation:s}){const r=ve(),o=be("up","lg"),{collapseDesktop:a,onCloseDesktop:t,onCollapseDesktop:i,openMobile:l,onOpenMobile:h,onCloseMobile:d}=Ce();c.useEffect(()=>{o||t()},[t,o]);const b=c.useCallback(()=>{o?i():h()},[o]),v=n.length>1,j=Mn(ks(s.messages.map(m=>m.attachments))),g=e.jsxs(e.Fragment,{children:[v?e.jsx(Ee,{participants:n}):e.jsx(Ae,{participant:n[0]}),e.jsx(Me,{attachments:j})]}),u=e.jsx(y,{onClick:b,sx:{top:12,right:0,zIndex:9,width:32,height:32,borderRight:0,position:"absolute",borderRadius:"12px 0 0 12px",boxShadow:r.customShadows.z8,bgcolor:r.palette.background.paper,border:`solid 1px ${r.palette.divider}`,"&:hover":{bgcolor:r.palette.background.neutral},...o&&{...!a&&{right:Z}}},children:o?e.jsx(x,{width:16,icon:a?"eva:arrow-ios-back-fill":"eva:arrow-ios-forward-fill"}):e.jsx(x,{width:16,icon:"eva:arrow-ios-back-fill"})});return e.jsxs(T,{sx:{position:"relative"},children:[u,o?e.jsx(p,{sx:{height:1,flexShrink:0,width:Z,borderLeft:`solid 1px ${r.palette.divider}`,transition:r.transitions.create(["width"],{duration:r.transitions.duration.shorter}),...a&&{width:0}},children:!a&&g}):e.jsx(ye,{anchor:"right",open:l,onClose:d,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:Z}},children:g})]})}Le.propTypes={conversation:f.object,participants:f.array};function Oe({message:n,participants:s,onOpenLightbox:r}){const{user:o}=z(),{me:a,senderDetails:t,hasImage:i}=ds({message:n,participants:s,currentUserId:o.id}),{firstName:l,avatarUrl:h}=t,{body:d,createdAt:b}=n,v=e.jsxs(S,{noWrap:!0,variant:"caption",sx:{mb:1,color:"text.disabled",...!a&&{mr:"auto"}},children:[!a&&`${l},`,"  ",Rn(new Date(b),{addSuffix:!0})]}),j=e.jsx(p,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...a&&{color:"grey.800",bgcolor:"primary.lighter"},...i&&{p:0,bgcolor:"transparent"}},children:i?e.jsx(T,{component:"img",alt:"attachment",src:d,onClick:()=>r(d),sx:{minHeight:220,borderRadius:1.5,cursor:"pointer","&:hover":{opacity:.9}}}):d}),g=e.jsxs(p,{direction:"row",className:"message-actions",sx:{pt:.5,opacity:0,top:"100%",left:0,position:"absolute",transition:u=>u.transitions.create(["opacity"],{duration:u.transitions.duration.shorter}),...a&&{left:"unset",right:0}},children:[e.jsx(y,{size:"small",children:e.jsx(x,{icon:"solar:reply-bold",width:16})}),e.jsx(y,{size:"small",children:e.jsx(x,{icon:"eva:smiling-face-fill",width:16})}),e.jsx(y,{size:"small",children:e.jsx(x,{icon:"solar:trash-bin-trash-bold",width:16})})]});return e.jsxs(p,{direction:"row",justifyContent:a?"flex-end":"unset",sx:{mb:5},children:[!a&&e.jsx(R,{alt:l,src:h,sx:{width:32,height:32,mr:2}}),e.jsxs(p,{alignItems:"flex-end",children:[v,e.jsxs(p,{direction:"row",alignItems:"center",sx:{position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:[j,g]})]})]})}Oe.propTypes={message:f.object,onOpenLightbox:f.func,participants:f.array};function De({messages:n=[],participants:s}){const{messagesEndRef:r}=hs(n),o=n.filter(t=>t.contentType==="image").map(t=>({src:t.body})),a=bn(o);return e.jsxs(e.Fragment,{children:[e.jsx(B,{ref:r,sx:{px:3,py:5,height:1},children:e.jsx(T,{children:n.map(t=>e.jsx(Oe,{message:t,participants:s,onOpenLightbox:()=>a.onOpen(t.body)},t.id))})}),e.jsx(jn,{index:a.selected,slides:o,open:a.open,close:a.onClose})]})}De.propTypes={messages:f.array,participants:f.array};function xe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const s=Math.random()*16|0;return(n==="x"?s:s&3|8).toString(16)})}function Ne({recipients:n,onAddRecipients:s,disabled:r,selectedConversationId:o}){const a=ee(),{user:t}=z(),i=c.useRef(null),[l,h]=c.useState(""),d=c.useMemo(()=>({id:t.id,role:t.role,email:t.email,address:t.address,name:t.displayName,lastActivity:new Date,avatarUrl:t.photoURL,phoneNumber:t.phoneNumber,status:"online"}),[t]),b=c.useMemo(()=>({id:xe(),attachments:[],body:l,contentType:"text",createdAt:dn(new Date,{minutes:1}),senderId:d.id}),[l,d.id]),v=c.useMemo(()=>({id:xe(),messages:[b],participants:[...n,d],type:n.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[b,d,n]),j=c.useCallback(()=>{i.current&&i.current.click()},[]),g=c.useCallback(m=>{h(m.target.value)},[]),u=c.useCallback(async m=>{try{if(m.key==="Enter"){if(l)if(o)await ls(o,b);else{const w=await cs(v);a.push(`${P.dashboard.chat}?id=${w.conversation.id}`),s([])}h("")}}catch(w){console.error(w)}},[v,l,b,s,a,o]);return e.jsxs(e.Fragment,{children:[e.jsx(me,{value:l,onKeyUp:u,onChange:g,placeholder:"Type a message",disabled:r,startAdornment:e.jsx(y,{children:e.jsx(x,{icon:"eva:smiling-face-fill"})}),endAdornment:e.jsxs(p,{direction:"row",sx:{flexShrink:0},children:[e.jsx(y,{onClick:j,children:e.jsx(x,{icon:"solar:gallery-add-bold"})}),e.jsx(y,{onClick:j,children:e.jsx(x,{icon:"eva:attach-2-fill"})}),e.jsx(y,{children:e.jsx(x,{icon:"solar:microphone-bold"})})]}),sx:{px:1,height:56,flexShrink:0,borderTop:m=>`solid 1px ${m.palette.divider}`}}),e.jsx("input",{type:"file",ref:i,style:{display:"none"}})]})}Ne.propTypes={disabled:f.bool,onAddRecipients:f.func,recipients:f.array,selectedConversationId:f.string};function _e({participants:n}){const s=n.length>1,r=n[0],o=e.jsx(Cn,{max:3,sx:{[`& .${hn.avatar}`]:{width:32,height:32}},children:n.map(t=>e.jsx(R,{alt:t.name,src:t.avatarUrl},t.id))}),a=e.jsxs(p,{flexGrow:1,direction:"row",alignItems:"center",spacing:2,children:[e.jsx(F,{variant:r.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(R,{src:r.avatarUrl,alt:r.name})}),e.jsx($,{primary:r.name,secondary:r.status==="offline"?un(r.lastActivity):r.status,secondaryTypographyProps:{component:"span",...r.status!=="offline"&&{textTransform:"capitalize"}}})]});return e.jsxs(e.Fragment,{children:[s?o:a,e.jsx(p,{flexGrow:1}),e.jsx(y,{children:e.jsx(x,{icon:"solar:phone-bold"})}),e.jsx(y,{children:e.jsx(x,{icon:"solar:videocamera-record-bold"})}),e.jsx(y,{children:e.jsx(x,{icon:"eva:more-vertical-fill"})})]})}_e.propTypes={participants:f.array};function Fe({contacts:n,onAddRecipients:s}){const[r,o]=c.useState(""),a=c.useCallback(t=>{o(""),s(t)},[s]);return e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),e.jsx(xn,{sx:{minWidth:320},multiple:!0,limitTags:3,popupIcon:null,disableCloseOnSelect:!0,noOptionsText:e.jsx(fe,{query:r}),onChange:(t,i)=>a(i),onInputChange:(t,i)=>o(i),options:n,getOptionLabel:t=>t.name,isOptionEqualToValue:(t,i)=>t.id===i.id,renderInput:t=>e.jsx(je,{...t,placeholder:"+ Recipients"}),renderOption:(t,i,{selected:l})=>c.createElement("li",{...t,key:i.id},e.jsxs(T,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(R,{alt:i.name,src:i.avatarUrl,sx:{width:1,height:1}}),e.jsx(p,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:h=>I(h.palette.grey[900],.8),transition:h=>h.transitions.create(["opacity"],{easing:h.transitions.easing.easeInOut,duration:h.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}},children:e.jsx(x,{icon:"eva:checkmark-fill"})})]},i.id),i.name),renderTags:(t,i)=>t.map((l,h)=>c.createElement(pn,{...i({index:h}),key:l.id,label:l.name,avatar:e.jsx(R,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}Fe.propTypes={contacts:f.array,onAddRecipients:f.func};function Ss(){const n=ee(),{user:s}=z(),o=fn().get("id")||"",[a,t]=c.useState([]),{contacts:i}=os(),{conversations:l,conversationsLoading:h}=as(),{conversation:d,conversationError:b}=is(`${o}`),v=d?d.participants.filter(C=>C.id!==s.id):[];c.useEffect(()=>{(b||!o)&&n.push(P.dashboard.chat)},[b,n,o]);const j=c.useCallback(C=>{t(C)},[]),g=!!d,u=e.jsx(p,{direction:"row",alignItems:"center",flexShrink:0,sx:{pr:1,pl:2.5,py:1,minHeight:72},children:o?e.jsx(e.Fragment,{children:g&&e.jsx(_e,{participants:v})}):e.jsx(Fe,{contacts:i,onAddRecipients:j})}),m=e.jsx(Te,{contacts:i,conversations:l,loading:h,selectedConversationId:o}),w=e.jsxs(p,{sx:{width:1,height:1,overflow:"hidden"},children:[e.jsx(De,{messages:d==null?void 0:d.messages,participants:v}),e.jsx(Ne,{recipients:a,onAddRecipients:j,selectedConversationId:o,disabled:!a.length&&!o})]});return e.jsxs(T,{px:5,children:[e.jsx(S,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Support"}),e.jsxs(p,{component:gn,direction:"row",sx:{height:"72vh"},children:[m,e.jsxs(p,{sx:{width:1,height:1,overflow:"hidden"},children:[u,e.jsxs(p,{direction:"row",sx:{width:1,height:1,overflow:"hidden",borderTop:C=>`solid 1px ${C.palette.divider}`},children:[w,g&&e.jsx(Le,{conversation:d,participants:v})]})]})]})]})}function Ls(){return e.jsxs(e.Fragment,{children:[e.jsx(mn,{children:e.jsx("title",{children:" Dashboard: Chat"})}),e.jsx(Ss,{})]})}export{Ls as default};
