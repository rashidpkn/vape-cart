import{t as L,ad as U,j as e,c as p,A as F,v as A,aF as N,L as E,a9 as k,w as D,C as se,q as x,P as oe,ae as $,o as H,B as V,x as c,u as ae,r as T,a4 as ne,d as R,p as B,ac as le,aj as ie,S as _,aK as de,aL as O,a7 as ce,l as q,aM as he}from"./index-6b2a15ec.js";import{C as W}from"./confirm-dialog-f9839b95.js";import{u as pe,g as xe,e as ue}from"./use-table-41709a14.js";import{b as me,T as ge,d as ye,a as je,c as we}from"./table-pagination-custom-822c63ba.js";import{C as fe}from"./custom-breadcrumbs-c17d7e8b.js";import{f as v}from"./format-number-00dffec8.js";import{a as M,b}from"./TableRow-150cbd53.js";import{C as be}from"./Checkbox-aed2f8e9.js";import{C as z}from"./Card-1154fd03.js";import{T as Ce,a as Te}from"./Tabs-603b428e.js";import{T as ve}from"./TableContainer-a5f4dc5b.js";import{T as Pe,a as Se}from"./TableBody-ea94779e.js";import{C as De}from"./CardHeader-e43f2a04.js";function K({row:a,selected:u,onViewRow:y,onSelectRow:j,onDeleteRow:w}){const{id:s,items:n,status:i,createdAt:C,customer:o}=a,t=L(),m=L(),f=U();console.log(n);const g=e.jsxs(M,{hover:!0,selected:u,children:[e.jsx(b,{padding:"checkbox",children:e.jsx(be,{checked:u,onClick:j})}),e.jsx(b,{children:e.jsxs(p,{onClick:y,sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},children:["#",s.toString().padStart(3,"0")]})}),e.jsxs(b,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(F,{alt:o==null?void 0:o.name,src:o==null?void 0:o.avatarUrl,sx:{mr:2}}),e.jsx(A,{primary:o==null?void 0:o.name,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled"}})]}),e.jsx(b,{children:e.jsx(A,{primary:N(new Date(C),"dd MMM yyyy"),secondary:N(new Date(C),"p"),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsxs(b,{align:"center",children:[" ",n==null?void 0:n.reduce((d,h)=>d+h.quantity,0)," "]}),e.jsxs(b,{children:[" ",v(n==null?void 0:n.reduce((d,h)=>d+h.quantity*h.price,0))," "]}),e.jsxs(b,{children:[" ",v((n==null?void 0:n.reduce((d,h)=>d+h.quantity*h.price,0))*.2)," "]}),e.jsx(b,{children:e.jsx(E,{variant:"soft",color:i==="completed"&&"success"||i==="pending"&&"warning"||i==="cancelled"&&"error"||"default",children:i})}),e.jsxs(b,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(k,{color:m.value?"inherit":"default",onClick:m.onToggle,sx:{...m.value&&{bgcolor:"action.hover"}},children:e.jsx(D,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(k,{color:f.open?"inherit":"default",onClick:f.onOpen,children:e.jsx(D,{icon:"eva:more-vertical-fill"})})]})]}),I=e.jsx(M,{children:e.jsx(b,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(se,{in:m.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(x,{component:oe,sx:{m:1.5},children:n.map(d=>e.jsxs(x,{direction:"row",alignItems:"center",sx:{p:h=>h.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:h=>`solid 2px ${h.palette.background.neutral}`}},children:[e.jsx(F,{src:d.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(A,{primary:d.name,secondary:d.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs(p,{children:["x",d.quantity]}),e.jsx(p,{sx:{width:110,textAlign:"right"},children:v(d.price)})]},d.id))})})})});return e.jsxs(e.Fragment,{children:[g,I,e.jsx($,{open:f.open,onClose:f.onClose,arrow:"right-top",sx:{width:140},children:e.jsxs(H,{onClick:()=>{t.onTrue(),f.onClose()},sx:{color:"error.main"},children:[e.jsx(D,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})}),e.jsx(W,{open:t.value,onClose:t.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(V,{variant:"contained",color:"error",onClick:w,children:"Delete"})})]})}K.propTypes={onDeleteRow:c.func,onSelectRow:c.func,onViewRow:c.func,row:c.object,selected:c.bool};const Re=[{value:"all",label:"All"},...de],Oe=[{id:"orderNumber",label:"Order",width:116},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Price",width:140},{id:"commission",label:"Commission",width:140},{id:"status",label:"Status",width:110},{id:"",width:88}],Ae={name:"",status:"all",startDate:null,endDate:null};function Ke(){const{user:{id:a}}=ae(),[u,y]=T.useState([]),[j,w]=T.useState([]),[s,n]=T.useState([]),i=async()=>{try{const{data:{products:r}}=await R.get("products",{params:{userId:a,perPage:100}});w(r.map(l=>l.id))}catch{alert("Error occurred while fetching products.")}},C=async()=>{try{const{data:r}=await R.get("/orders");y(r)}catch(r){console.log(r.message)}};T.useEffect(()=>{i(),C()},[]);function o(r,l){return r.map(S=>{const re=S.items.filter(te=>te.userId===l);return{...S,items:re}})}T.useEffect(()=>{const r=u.filter(l=>l.items.some(S=>j.includes(S.id))).reverse();n(o(r,a))},[u,j]);const t=pe({defaultOrderBy:"orderNumber"}),m=ne(),f=L(),g=Ae,I=g.startDate&&g.endDate?g.startDate.getTime()>g.endDate.getTime():!1,d=ke({inputData:s,comparator:xe(t.order,t.orderBy),filters:g,dateError:I}),h=d.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),Q=t.dense?52:72,G=!!g.name||g.status!=="all"||!!g.startDate&&!!g.endDate,J=!d.length&&G||!d.length,X=T.useCallback(r=>{R.delete("orders",{data:{id:r}});const l=s.filter(S=>S.id!==r);n(l),t.onUpdatePageDeleteRow(h.length)},[h.length,t,s]),Y=T.useCallback(()=>{R.delete("orders",{data:{id:t.selected}});const r=s.filter(l=>!t.selected.includes(l.id));n(r),t.onUpdatePageDeleteRows({totalRows:s.length,totalRowsInPage:h.length,totalRowsFiltered:d.length})},[d.length,h.length,t,s]),Z=T.useCallback(r=>{m.push(B.dashboard.order.details(r))},[m]),[P,ee]=T.useState("all");return e.jsxs(e.Fragment,{children:[e.jsxs(p,{px:5,children:[e.jsx(fe,{heading:"Orders",links:[{name:"Dashboard",href:B.dashboard.root},{name:"Orders",href:B.dashboard.order.root}],sx:{mb:{xs:3,md:5}}}),e.jsxs(z,{children:[e.jsx(Ce,{value:P,onChange:(r,l)=>ee(l),sx:{px:2.5,boxShadow:r=>`inset 0 -2px 0 0 ${le(r.palette.grey[500],.08)}`},children:Re.map(r=>e.jsx(Te,{iconPosition:"end",value:r.value,label:r.label,icon:e.jsxs(E,{variant:(r.value==="all"||r.value===g.status)&&"filled"||"soft",color:r.value==="completed"&&"success"||r.value==="pending"&&"warning"||r.value==="cancelled"&&"error"||"default",children:[r.value==="all"&&s.length,r.value==="pending"&&s.filter(l=>l.status==="Order received"||l.status==="pending").length,r.value==="completed"&&s.filter(l=>l.status==="completed").length,r.value==="cancelled"&&s.filter(l=>l.status==="cancelled").length,r.value==="refunded"&&s.filter(l=>l.status==="refunded").length]})},r.value))}),e.jsxs(ve,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(me,{dense:t.dense,numSelected:t.selected.length,rowCount:s.length,onSelectAllRows:r=>t.onSelectAllRows(r,s.map(l=>l.id)),action:e.jsx(ie,{title:"Delete",children:e.jsx(k,{color:"primary",onClick:f.onTrue,children:e.jsx(D,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(_,{children:e.jsxs(Pe,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ge,{order:t.order,orderBy:t.orderBy,headLabel:Oe,rowCount:s.length,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:r=>t.onSelectAllRows(r,s.map(l=>l.id))}),e.jsxs(Se,{children:[d.filter(r=>P==="all"||P==="pending"&&(r.status==="pending"||r.status==="Order received")||P==="completed"&&r.status==="completed"||P==="cancelled"&&r.status==="cancelled"||P==="refunded"&&r.status==="refunded").map(r=>e.jsx(K,{row:r,selected:t.selected.includes(r.id),onSelectRow:()=>t.onSelectRow(r.id),onDeleteRow:()=>X(r.id),onViewRow:()=>Z(r.id)},r.id)),e.jsx(ye,{height:Q,emptyRows:ue(t.page,t.rowsPerPage,s.length)}),e.jsx(je,{notFound:J})]})]})})]}),e.jsx(we,{count:d.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,onChangeDense:t.onChangeDense})]})]}),e.jsx(W,{open:f.value,onClose:f.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",t.selected.length," "]})," items?"]}),action:e.jsx(V,{variant:"contained",color:"error",onClick:()=>{Y(),f.onFalse()},children:"Delete"})})]})}function ke({inputData:a,comparator:u,filters:y,dateError:j}){const{status:w,name:s,startDate:n,endDate:i}=y,C=a.map((o,t)=>[o,t]);return C.sort((o,t)=>{const m=u(o[0],t[0]);return m!==0?m:o[1]-t[1]}),a=C.map(o=>o[0]),s&&(a=a.filter(o=>{var t,m;return o.orderNumber.toLowerCase().indexOf(s.toLowerCase())!==-1||((t=o.customer)==null?void 0:t.name.toLowerCase().indexOf(s.toLowerCase()))!==-1||((m=o.customer)==null?void 0:m.email.toLowerCase().indexOf(s.toLowerCase()))!==-1})),w!=="all"&&(a=a.filter(o=>o.status===w)),j||n&&i&&(a=a.filter(o=>O(o.createdAt)>=O(n)&&O(o.createdAt)<=O(i))),a}function Ie({items:a=[],shipping:u,discount:y,taxes:j,subTotal:w,totalAmount:s}){const n=e.jsxs(x,{spacing:2,alignItems:"flex-end",sx:{my:3,textAlign:"right",typography:"body2"},children:[e.jsxs(x,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(p,{sx:{width:160,typography:"subtitle2"},children:v(w)||"-"})]}),e.jsxs(x,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Shipping"}),e.jsx(p,{sx:{width:160,...u&&{color:"error.main"}},children:u?`- ${v(u)}`:"-"})]}),e.jsxs(x,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(p,{sx:{width:160,...y&&{color:"error.main"}},children:y?`- ${v(y)}`:"-"})]}),e.jsxs(x,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Taxes"}),e.jsx(p,{sx:{width:160},children:j?v(j):"-"})]}),e.jsxs(x,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx(p,{children:"Total"}),e.jsx(p,{sx:{width:160},children:v(s)||"-"})]})]});return e.jsxs(z,{children:[e.jsx(De,{title:"Details"}),e.jsxs(x,{sx:{px:3},children:[e.jsx(_,{children:a==null?void 0:a.map(i=>e.jsxs(x,{direction:"row",alignItems:"center",sx:{py:3,minWidth:640,borderBottom:C=>`dashed 2px ${C.palette.background.neutral}`},children:[e.jsx(F,{src:i.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(A,{primary:i.name,secondary:i.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs(p,{sx:{typography:"body2"},children:["x",i.quantity]}),e.jsx(p,{sx:{width:110,textAlign:"right",typography:"subtitle2"},children:v(i.salePrice)})]},i.id))}),n]})]})}Ie.propTypes={discount:c.number,items:c.array,shipping:c.number,subTotal:c.number,taxes:c.number,totalAmount:c.number};function Be({status:a,backLink:u,createdAt:y,orderNumber:j,statusOptions:w,onChangeStatus:s}){const n=U();return e.jsxs(e.Fragment,{children:[e.jsx(x,{spacing:3,direction:{xs:"column",md:"row"},sx:{mb:{xs:3,md:5}},children:e.jsxs(x,{spacing:1,direction:"row",alignItems:"flex-start",children:[e.jsx(k,{component:ce,href:u,children:e.jsx(D,{icon:"eva:arrow-ios-back-fill"})}),e.jsxs(x,{spacing:.5,children:[e.jsxs(x,{spacing:1,direction:"row",alignItems:"center",children:[e.jsxs(q,{variant:"h4",children:[" Order ",j," "]}),e.jsx(E,{variant:"soft",color:a==="completed"&&"success"||a==="pending"&&"warning"||a==="cancelled"&&"error"||"default",children:a})]}),e.jsx(q,{variant:"body2",sx:{color:"text.disabled"},children:he(y)})]})]})}),e.jsx($,{open:n.open,onClose:n.onClose,arrow:"top-right",sx:{width:140},children:w.map(i=>e.jsx(H,{selected:i.value===a,onClick:()=>{n.onClose(),s(i.value)},children:i.label},i.value))})]})}Be.propTypes={backLink:c.string,createdAt:c.instanceOf(Date),onChangeStatus:c.func,orderNumber:c.string,status:c.string,statusOptions:c.array};export{Ke as O,Be as a,Ie as b};
