import{x as B,at as U,j as e,b as p,A as L,y as R,b5 as $,d as b,e as F,al as E,z as O,h as te,v as g,P as se,B as A,i as S,au as M,q as H,E as h,u as re,r as P,c as ae,ai as q,C as V,b9 as oe,as as ne,ba as le,aC as ie,S as z,b8 as de,bb as I,ah as ce,o as N,bc as he}from"./index-fff84831.js";import{C as W}from"./confirm-dialog-49be9478.js";import{u as pe,g as ue,e as xe}from"./use-table-936f7e6e.js";import{b as ge,T as me,d as ye,a as je,c as we}from"./table-pagination-custom-2a5f1165.js";import{b as _,c as w,T as fe,d as be}from"./TableRow-40705e7a.js";import{C as Te}from"./Checkbox-adca0561.js";import{T as ve}from"./TableContainer-8d4161d2.js";import{C as Ce}from"./CardHeader-35e761bb.js";function Q({row:i,selected:m,onViewRow:y,onSelectRow:j,onDeleteRow:f}){const{id:r,items:n,status:d,createdAt:T,customer:a}=i,s=B(),x=B(),u=U();console.log(n);const k=e.jsxs(_,{hover:!0,selected:m,children:[e.jsx(w,{padding:"checkbox",children:e.jsx(Te,{checked:m,onClick:j})}),e.jsx(w,{children:e.jsxs(p,{onClick:y,sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},children:["#",r.toString().padStart(3,"0")]})}),e.jsxs(w,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(L,{alt:a==null?void 0:a.first_name,src:a==null?void 0:a.avatarUrl,sx:{mr:2}}),e.jsx(R,{primary:(a==null?void 0:a.first_name)+(a==null?void 0:a.last_name),primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled"}})]}),e.jsx(w,{children:e.jsx(R,{primary:$(new Date(T),"dd MMM yyyy"),secondary:$(new Date(T),"p"),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsxs(w,{align:"center",children:[" ",n==null?void 0:n.reduce((l,c)=>l+c.quantity,0)," "]}),e.jsxs(w,{children:[" ",b(n==null?void 0:n.reduce((l,c)=>l+c.quantity*c.price,0))," "]}),e.jsxs(w,{children:[" ",b((n==null?void 0:n.reduce((l,c)=>l+c.quantity*c.price,0))*.3)," "]}),e.jsx(w,{children:b((n==null?void 0:n.reduce((l,c)=>l+c.quantity*c.price,0))*.7)}),e.jsx(w,{children:e.jsx(F,{variant:"soft",color:d==="completed"&&"success"||d==="pending"&&"warning"||d==="cancelled"&&"error"||"default",children:d})}),e.jsxs(w,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(E,{color:x.value?"inherit":"default",onClick:x.onToggle,sx:{...x.value&&{bgcolor:"action.hover"}},children:e.jsx(O,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(E,{color:u.open?"inherit":"default",children:e.jsx(O,{icon:"eva:more-vertical-fill"})})]})]}),v=e.jsx(_,{children:e.jsx(w,{sx:{p:0,border:"none"},colSpan:10,children:e.jsx(te,{in:x.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(g,{component:se,sx:{m:1.5},children:n.map(l=>e.jsxs(g,{direction:"row",alignItems:"center",sx:{p:c=>c.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:c=>`solid 2px ${c.palette.background.neutral}`}},children:[e.jsx(L,{src:l.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(R,{primary:l.name,secondary:l.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5},sx:{width:"50%"}}),e.jsxs(p,{children:["x",l.quantity]}),e.jsx(p,{sx:{width:110,textAlign:"right"},children:b(l.price)}),e.jsx(A,{variant:"contained",color:"success",sx:{mx:5},onClick:async()=>{try{await S.patch(`/orders/change-item-status/${r}`,{itemId:l.id,status:"Product Is ready"}),await S.post("/notifications",{userId:l.userId,role:"admin",title:`ğŸš€ ${l.name} Product Is ready ğŸš€`,message:`${l.name} is ready for shipping`,type:"product"}),alert("Product Status is update to admin,they will pick the order")}catch{console.log()}},children:"Product is Ready"}),e.jsx(A,{variant:"contained",color:"warning",sx:{mx:5},onClick:async()=>{try{const c=window.prompt("Issues?");await S.patch(`/orders/change-item-status/${r}`,{itemId:l.id,status:"Product has some issue"}),await S.post("/notifications",{userId:l.userId,role:"admin",title:`ğŸš€ ${l.name} Product has some issue ğŸš€`,message:c,type:"product"}),alert("Product Status is update to admin,they will resolve the issue")}catch(c){console.log(c)}},children:"Product has some issue"})]},l.id))})})})});return e.jsxs(e.Fragment,{children:[k,v,e.jsx(M,{open:u.open,onClose:u.onClose,arrow:"right-top",sx:{width:140},children:e.jsxs(H,{onClick:()=>{s.onTrue(),u.onClose()},sx:{color:"error.main"},children:[e.jsx(O,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})}),e.jsx(W,{open:s.value,onClose:s.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(A,{variant:"contained",color:"error",onClick:f,children:"Delete"})})]})}Q.propTypes={onDeleteRow:h.func,onSelectRow:h.func,onViewRow:h.func,row:h.object,selected:h.bool};const Pe=[{value:"all",label:"All"},...de],Se=[{id:"id",label:"Order",width:116},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Total Value",width:140},{id:"commission",label:"Commission",width:140},{id:"Net",label:"Net",width:140},{id:"status",label:"Status",width:110},{id:"",width:88}],De={name:"",status:"all",startDate:null,endDate:null};function Ne(){const{user:{id:i}}=re(),[m,y]=P.useState([]),[j,f]=P.useState([]),[r,n]=P.useState([]),d=async()=>{try{const{data:{products:t}}=await S.get("products",{params:{userId:i,perPage:100}});f(t.map(o=>o.id))}catch{alert("Error occurred while fetching products.")}},T=async()=>{try{const{data:t}=await S.get("/orders");y(t)}catch(t){console.log(t.message)}};P.useEffect(()=>{d(),T()},[]);function a(t,o){return t.map(D=>{const Z=D.items.filter(ee=>ee.userId===o);return{...D,items:Z}})}P.useEffect(()=>{const t=m.filter(o=>o.items.some(D=>j.includes(D.id))).reverse();n(a(t,i))},[m,j]);const s=pe({defaultOrderBy:"id"}),x=B(),u=De,k=u.startDate&&u.endDate?u.startDate.getTime()>u.endDate.getTime():!1,v=Ie({inputData:r,comparator:ue(s.order,s.orderBy),filters:u,dateError:k}),l=v.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage),c=s.dense?52:72,G=!!u.name||u.status!=="all"||!!u.startDate&&!!u.endDate,J=!v.length&&G||!v.length,K=P.useCallback(t=>{S.delete("orders",{data:{id:t}});const o=r.filter(D=>D.id!==t);n(o),s.onUpdatePageDeleteRow(l.length)},[l.length,s,r]),X=P.useCallback(()=>{S.delete("orders",{data:{id:s.selected}});const t=r.filter(o=>!s.selected.includes(o.id));n(t),s.onUpdatePageDeleteRows({totalRows:r.length,totalRowsInPage:l.length,totalRowsFiltered:v.length})},[v.length,l.length,s,r]),[C,Y]=P.useState("all");return e.jsxs(e.Fragment,{children:[e.jsxs(p,{px:5,children:[e.jsx(ae,{heading:"Orders",links:[{name:"Dashboard",href:q.dashboard.root},{name:"Orders",href:q.dashboard.order.root}],sx:{mb:{xs:3,md:5}}}),e.jsxs(V,{children:[e.jsx(oe,{value:C,onChange:(t,o)=>Y(o),sx:{px:2.5,boxShadow:t=>`inset 0 -2px 0 0 ${ne(t.palette.grey[500],.08)}`},children:Pe.map(t=>e.jsx(le,{iconPosition:"end",value:t.value,label:t.label,icon:e.jsxs(F,{variant:(t.value==="all"||t.value===u.status)&&"filled"||"soft",color:t.value==="processing"&&"info"||t.value==="completed"&&"success"||t.value==="In Transit"&&"info"||t.value==="pending"&&"warning"||t.value==="cancelled"&&"error"||"default",children:[t.value==="all"&&r.length,t.value==="processing"&&r.filter(o=>o.status==="processing").length,t.value==="pending"&&r.filter(o=>o.status==="Order received"||o.status==="pending").length,t.value==="completed"&&r.filter(o=>o.status==="completed").length,t.value==="cancelled"&&r.filter(o=>o.status==="cancelled").length,t.value==="refunded"&&r.filter(o=>o.status==="refunded").length,t.value==="In Transit"&&r.filter(o=>o.status==="In Transit").length]})},t.value))}),e.jsxs(ve,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(ge,{dense:s.dense,numSelected:s.selected.length,rowCount:r.length,onSelectAllRows:t=>s.onSelectAllRows(t,r.map(o=>o.id)),action:e.jsx(ie,{title:"Delete"})}),e.jsx(z,{children:e.jsxs(fe,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(me,{order:s.order,orderBy:s.orderBy,headLabel:Se,rowCount:r.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:t=>s.onSelectAllRows(t,r.map(o=>o.id))}),e.jsxs(be,{children:[v.filter(t=>C==="all"||C==="processing"&&t.status==="processing"||C==="pending"&&(t.status==="pending"||t.status==="Order received")||C==="completed"&&t.status==="completed"||C==="cancelled"&&t.status==="cancelled"||C==="refunded"&&t.status==="refunded"||C==="In Transit"&&t.status==="In Transit").map(t=>e.jsx(Q,{row:t,selected:s.selected.includes(t.id),onSelectRow:()=>s.onSelectRow(t.id),onDeleteRow:()=>K(t.id),onViewRow:()=>{}},t.id)),e.jsx(ye,{height:c,emptyRows:xe(s.page,s.rowsPerPage,r.length)}),e.jsx(je,{notFound:J})]})]})})]}),e.jsx(we,{count:v.length,page:s.page,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onRowsPerPageChange:s.onChangeRowsPerPage,onChangeDense:s.onChangeDense})]})]}),e.jsx(W,{open:x.value,onClose:x.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," items?"]}),action:e.jsx(A,{variant:"contained",color:"error",onClick:()=>{X(),x.onFalse()},children:"Delete"})})]})}function Ie({inputData:i,comparator:m,filters:y,dateError:j}){const{status:f,name:r,startDate:n,endDate:d}=y,T=i.map((a,s)=>[a,s]);return T.sort((a,s)=>{const x=m(a[0],s[0]);return x!==0?x:a[1]-s[1]}),i=T.map(a=>a[0]),r&&(i=i.filter(a=>{var s,x;return a.orderNumber.toLowerCase().indexOf(r.toLowerCase())!==-1||((s=a.customer)==null?void 0:s.name.toLowerCase().indexOf(r.toLowerCase()))!==-1||((x=a.customer)==null?void 0:x.email.toLowerCase().indexOf(r.toLowerCase()))!==-1})),f!=="all"&&(i=i.filter(a=>a.status===f)),j||n&&d&&(i=i.filter(a=>I(a.createdAt)>=I(n)&&I(a.createdAt)<=I(d))),i}function Re({items:i=[],shipping:m,discount:y,taxes:j,subTotal:f,totalAmount:r}){const n=e.jsxs(g,{spacing:2,alignItems:"flex-end",sx:{my:3,textAlign:"right",typography:"body2"},children:[e.jsxs(g,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(p,{sx:{width:160,typography:"subtitle2"},children:b(f)||"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Shipping"}),e.jsx(p,{sx:{width:160,...m&&{color:"error.main"}},children:m?`- ${b(m)}`:"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(p,{sx:{width:160,...y&&{color:"error.main"}},children:y?`- ${b(y)}`:"-"})]}),e.jsxs(g,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Taxes"}),e.jsx(p,{sx:{width:160},children:j?b(j):"-"})]}),e.jsxs(g,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx(p,{children:"Total"}),e.jsx(p,{sx:{width:160},children:b(r)||"-"})]})]});return e.jsxs(V,{children:[e.jsx(Ce,{title:"Details"}),e.jsxs(g,{sx:{px:3},children:[e.jsx(z,{children:i==null?void 0:i.map(d=>e.jsxs(g,{direction:"row",alignItems:"center",sx:{py:3,minWidth:640,borderBottom:T=>`dashed 2px ${T.palette.background.neutral}`},children:[e.jsx(L,{src:d.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(R,{primary:d.name,secondary:d.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs(p,{sx:{typography:"body2"},children:["x",d.quantity]}),e.jsx(p,{sx:{width:110,textAlign:"right",typography:"subtitle2"},children:b(d.salePrice)})]},d.id))}),n]})]})}Re.propTypes={discount:h.number,items:h.array,shipping:h.number,subTotal:h.number,taxes:h.number,totalAmount:h.number};function Oe({status:i,backLink:m,createdAt:y,orderNumber:j,statusOptions:f,onChangeStatus:r}){const n=U();return e.jsxs(e.Fragment,{children:[e.jsx(g,{spacing:3,direction:{xs:"column",md:"row"},sx:{mb:{xs:3,md:5}},children:e.jsxs(g,{spacing:1,direction:"row",alignItems:"flex-start",children:[e.jsx(E,{component:ce,href:m,children:e.jsx(O,{icon:"eva:arrow-ios-back-fill"})}),e.jsxs(g,{spacing:.5,children:[e.jsxs(g,{spacing:1,direction:"row",alignItems:"center",children:[e.jsxs(N,{variant:"h4",children:[" Order ",j," "]}),e.jsx(F,{variant:"soft",color:i==="completed"&&"success"||i==="pending"&&"warning"||i==="cancelled"&&"error"||"default",children:i})]}),e.jsx(N,{variant:"body2",sx:{color:"text.disabled"},children:he(y)})]})]})}),e.jsx(M,{open:n.open,onClose:n.onClose,arrow:"top-right",sx:{width:140},children:f.map(d=>e.jsx(H,{selected:d.value===i,onClick:()=>{n.onClose(),r(d.value)},children:d.label},d.value))})]})}Oe.propTypes={backLink:h.string,createdAt:h.instanceOf(Date),onChangeStatus:h.func,orderNumber:h.string,status:h.string,statusOptions:h.array};export{Ne as O,Oe as a,Re as b};
