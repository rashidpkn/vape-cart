import{F as n,j as e,b9 as ke,aO as we,aC as Be,aA as F,b5 as Ie,ba as Te,bb as De,aw as ge,b2 as Re,ax as p,T as h,af as q,S as D,bc as z,B as y,bd as ae,be,al as R,ah as ze,bf as Ee,ao as je,ap as d,aj as Ne,bg as ce}from"./index-740d5a2d.js";import{c as qe,a as C,b as te,d as ie,u as Ue,R as G,e as Oe,f as Le,g as ne,h as me,F as Ke,i as $e}from"./form-provider-9164a776.js";import{o as _e,L as Ve}from"./yup-c1b517a4.js";import{_ as Ge,a as He,b as Ye,c as Me,d as Qe,e as u}from"./createProducts-6b8714cd.js";import{C as H}from"./CardHeader-39ee7db3.js";import{F as Y,R as pe}from"./image-70537bcc.js";let ue=!1;const he=n.forwardRef(function(r,A){return ue||(console.warn(["MUI: The Autocomplete component was moved from the lab to the core.","","You should use `import { Autocomplete } from '@mui/material'`","or `import Autocomplete from '@mui/material/Autocomplete'`"].join(`
`)),ue=!0),e.jsx(ke,we({ref:A},r))});function ss({currentProduct:a}){const r=Be(),[A,U]=n.useState(!1),[k,M]=n.useState([]);n.useEffect(()=>{F.get("/attributes").then(s=>{M(s.data)})},[]);const j=Ie(),x=Te("up","md"),{enqueueSnackbar:le}=De(),{user:b}=ge(),E=qe().shape({name:C().required("Name is required"),subDescription:C().required("Short description is required").test("not-four-digits","Your content contain continues 4 digit number, Please remove",s=>!/\d{4,}/.test(s)),content:C().test("not-four-digits","Your content contain continues 4 digit number, Please remove",s=>!/\d{4,}/.test(s)),images:te().min(1,"Image is required"),type:C(),category:C().required("Category is required"),tags:te(),SKU:C().required("SKU is required"),brand:C().required("brand is required"),attributes:te(),quantity:ie(),regularPrice:ie(),salePrice:ie().moreThan(0,"Price should not be AED 0.00")}),w=n.useMemo(()=>({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",subDescription:(a==null?void 0:a.subDescription)||"",content:(a==null?void 0:a.content)||"",images:(a==null?void 0:a.images)||[],type:(a==null?void 0:a.type)||"Simple",category:(a==null?void 0:a.category)||"Disposables",tags:(a==null?void 0:a.tags)||[],SKU:(a==null?void 0:a.SKU)||"",brand:(a==null?void 0:a.brand)||"SMOK",attributes:(a==null?void 0:a.attributes)||[],quantity:(a==null?void 0:a.quantity)||0,regularPrice:(a==null?void 0:a.regularPrice)||0,salePrice:(a==null?void 0:a.salePrice)||0}),[a]),[g,B]=n.useState({}),[Q,O]=n.useState([]),L=Ue({resolver:_e(E),defaultValues:w}),{reset:I,watch:J,setValue:m,handleSubmit:W,formState:{isSubmitting:T,isValid:K}}=L,o=J(),[S,X]=n.useState([]),Z=n.useCallback(async()=>{const{data:s}=await F.get("/products",{params:{name:o.name}});X(s.products)},[o.name]);n.useEffect(()=>{Z()},[o.name]),n.useEffect(()=>{a&&I(w)},[a,w,I]);const P=W(async s=>{console.log(s);try{a?await F.patch("products",{...s,username:b.displayName,userId:b.id,storeName:b.storeName}):await F.post("products",{...s,username:b.displayName,userId:b.id,storeName:b.storeName}),I(),le(a?"Update success!":"Create success!"),j.push(Re.dashboard.product.root)}catch(t){console.log(t)}}),ee=n.useCallback(s=>{const t=o.images||[],i=s.map(l=>Object.assign(l,{preview:URL.createObjectURL(l)}));m("images",[...t,...i],{shouldValidate:!0})},[m,o.images]),c=n.useCallback(s=>{var i;const t=o.images&&((i=o.images)==null?void 0:i.filter(l=>l!==s));m("images",t)},[m,o.images]),f=n.useCallback(()=>{m("images",[])},[m]),N=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(q,{children:[!x&&e.jsx(H,{title:"Details"}),e.jsxs(D,{spacing:3,sx:{p:3},children:[e.jsx(he,{onChange:(s,t)=>{if(t){const i=S.find(l=>l.name===t);m("images",i.images),m("name",i.name)}else m("images",null)},name:"name",label:"Product Name",options:S.map(s=>s.name),getOptionLabel:s=>s,isOptionEqualToValue:(s,t)=>s===t.value,renderInput:s=>e.jsx(z,{...s,label:"Product Name",value:o.name,onChange:t=>m("name",t.target.value)}),renderOption:(s,t)=>e.jsxs(y,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...s,children:[e.jsx("img",{loading:"lazy",width:"20",src:S.find(i=>i.name===t).images[0],alt:""}),t]}),freeSolo:!0}),e.jsx(G,{name:"subDescription",label:"Sub Description",multiline:!0,rows:4}),e.jsxs(D,{spacing:1.5,children:[e.jsx(h,{variant:"subtitle2",children:"Content"}),e.jsx(Oe,{simple:!0,name:"content"})]}),e.jsxs(D,{spacing:1.5,children:[e.jsx(h,{variant:"subtitle2",children:"Images"}),e.jsx(Le,{multiple:!0,name:"images",maxSize:3145728,onDrop:ee,onRemove:c,onRemoveAll:f,onUpload:async s=>{try{const t=new FormData;o.images.forEach(l=>{t.append("images",l)});const{data:i}=await F.post("upload",t);m("images",i),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})]})]})]})})]}),[$,oe]=n.useState({name:"",show:!1}),fe=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(q,{children:[!x&&e.jsx(H,{title:"Properties"}),e.jsx(D,{spacing:3,sx:{p:3},children:e.jsxs(y,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(ne,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:Ge.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(ne,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:He.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(me,{name:"tags",label:"Tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:Ye.map(s=>s),getOptionLabel:s=>s,renderOption:(s,t)=>n.createElement("li",{...s,key:t},t),renderTags:(s,t)=>s.map((i,l)=>n.createElement(ae,{...t({index:l}),key:i,label:i,size:"small",color:"info",variant:"soft"}))}),e.jsx(G,{name:"SKU",label:"Product SKU"}),e.jsx(ne,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:Me.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(y,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Y,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(be,{checked:$.show,onChange:s=>oe(t=>({...t,show:s.target.checked}))})}),$.show&&e.jsxs(e.Fragment,{children:[e.jsx(z,{label:"Brand Name",style:{width:300},onChange:s=>oe(t=>({...t,name:s.target.value})),value:$.name}),e.jsx(R,{variant:"contained",color:"success",onClick:()=>{$.name?alert("Your request to create a new brand is being processed. Please wait while we verify the brand."):alert("Please enter brand name")},children:"Add Brand"})]})]})]})})]})})]}),ye=(s,t,i)=>{B(V=>({...V,[i]:t}));const l=i==="Bottle Size"&&u.bottleSize||i==="Puffs"&&u.puffs||i==="Flavour"&&u.flavour||i==="Nicotine Strength"&&u.nicotineStrength||i==="Color"&&u.color||i==="Batteries"&&u.batteries||[],v=t[t.length-1];v&&(l.find(V=>V===v)||(console.log("upload"),F.post("/attributes",{username:b.displayName,attribute:i,value:v}).then(V=>{console.log("updated")})))},Fe=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(q,{children:[!x&&e.jsx(H,{title:"Attributes"}),e.jsx(D,{spacing:3,sx:{p:3},children:e.jsxs(y,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(y,{sx:{gridColumn:"span 2 "},children:e.jsx(me,{name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:Qe.map(s=>s),getOptionLabel:s=>s,renderOption:(s,t)=>n.createElement("li",{...s,key:t},t),renderTags:(s,t)=>s.map((i,l)=>n.createElement(ae,{...t({index:l}),key:i,label:i,size:"small",color:"info",variant:"soft"}))})}),o.attributes.map(s=>e.jsx(y,{sx:{gridColumn:"span 1 "},children:e.jsx(he,{multiple:!0,freeSolo:!0,options:[...s==="Bottle Size"?u.bottleSize:[],...s==="Puffs"?u.puffs:[],...s==="Flavour"?u.flavour:[],...s==="Nicotine Strength"?u.nicotineStrength:[],...s==="Color"?u.color:[],...s==="Batteries"?u.batteries:[],...k.filter(t=>t.attribute===s).map(t=>t.value)],value:g[s],onChange:(t,i)=>{ye(t,i,s),i.length>=2?Q.find(l=>l===s)||O(l=>[...l,s]):O(l=>l.filter(v=>v!==s))},renderInput:t=>e.jsx(z,{...t,label:s,placeholder:s}),renderTags:(t,i)=>t.map((l,v)=>n.createElement(ae,{...i({index:v}),key:l,label:l,size:"small",color:"info",variant:"soft"}))})},s))]})})]})})]}),Se=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(q,{children:[!x&&e.jsx(H,{title:"Pricing"}),e.jsxs(D,{spacing:3,sx:{p:3},children:[e.jsx(G,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ce,{position:"start",children:e.jsx(y,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx(G,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ce,{position:"start",children:e.jsx(y,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})]})})]}),ve=e.jsx(e.Fragment,{children:e.jsx(p,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:e.jsx(Ve,{type:"submit",variant:"contained",size:"large",loading:T,children:a?"Save Changes":"Create Product"})})}),Ce=e.jsx(e.Fragment,{children:e.jsx(p,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:e.jsx(R,{variant:"contained",size:"large",color:"success",onClick:()=>{r("/dashboard/product")},children:"Save Product"})})}),se=["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],re=[...se,...se.slice(1).flatMap(s=>se.slice(1).map(t=>s+t))];let _=1,de=0;const Ae=e.jsxs(e.Fragment,{children:[x&&e.jsx(p,{md:4,children:e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(p,{xs:12,md:12,children:e.jsx(q,{children:e.jsxs(ze,{children:[e.jsx(Ee,{children:e.jsxs(je,{children:[e.jsx(d,{children:"ID"}),e.jsx(d,{width:150,children:"SKU"}),e.jsx(d,{width:250,children:"Attributes"}),e.jsx(d,{width:150,children:"Track Order"}),e.jsx(d,{children:"Stock"}),e.jsx(d,{children:"Regular Price"}),e.jsx(d,{children:"Sales Price"}),e.jsx(d,{children:"Image"}),e.jsx(d,{width:200,children:"Add Product"})]})}),e.jsxs(Ne,{children:[e.jsx(xe,{counter:_++,counter2:de++,skuAlpha:re,va:"Parent",values:o,variables:g,disabled:!0,isSubmitting:T,isValid:K,setProductAdded:()=>{}},_),Object.keys(g).reduce((s,t)=>s.flatMap(i=>g[t].map(l=>`${i} - ${l}`)),[""]).map(s=>e.jsx(xe,{counter:_++,counter2:de++,skuAlpha:re,va:s.slice(3),values:o,variables:g,disabled:!1,isSubmitting:T,isValid:K,setProductAdded:U},_))]})]})})})]});return e.jsx(Ke,{methods:L,onSubmit:P,children:e.jsxs(p,{container:!0,spacing:3,children:[N,fe,o.type==="Variable"&&Fe,o.type==="Simple"&&Se,o.type==="Variable"&&Ae,o.type==="Simple"&&ve,o.type==="Variable"&&A&&Ce]})})}function xe({counter:a,values:r,skuAlpha:A,counter2:U,va:k,variables:M,disabled:j,isSubmitting:x,isValid:le,setProductAdded:b}){const{user:E}=ge(),w=A[U]?`${r.SKU}-${A[U]}`:r.SKU;let g=r.name;k!=="Parent"&&(g=`${r.name} - ${k}`);const[B,Q]=n.useState(!0),[O,L]=n.useState("instock"),[I,J]=n.useState(null),[m,W]=n.useState(null),[T,K]=n.useState(null),[o,S]=n.useState("pending"),[X,Z]=n.useState(null),P=async c=>{try{const f=new FormData;f.append("images",c.target.files[0]);const{data:N}=await F.post("upload",f);Z([N[0],...r.images])}catch{}},ee=async()=>{const c=/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{2B50}\u{2B55}\u{231A}-\u{231B}\u{23E9}-\u{23EC}\u{23F0}\u{23F3}\u{25AA}-\u{25AB}\u{25B6}\u{25C0}\u{25FB}-\u{25FE}\u{2B1B}-\u{2B1C}\u{2934}-\u{2935}\u{2B05}-\u{2B07}\u{2194}-\u{2199}\u{21A9}-\u{21AA}\u{2B06}\u{2B07}\u{2B1B}\u{2B1C}]/u,f=/\d{4,}/;if(c.test(r.subDescription)||c.test(r.content)){alert("Your content contain emojis, Please remove emojis");return}if(f.test(r.subDescription)||f.test(r.content)){alert("Your content contain continues 4 digit number, Please remove");return}if(o==="pending"){S("loading");try{await F.post("/products",{username:E.displayName,userId:E.id,storeName:E.storeName,name:g,subDescription:r.subDescription,content:r.content,images:X??r.images,type:r.type,category:r.category,tags:r.tags,parentSku:r.SKU,brand:r.brand,attributes:r.attributes,variables:M,SKU:w,track:B,quantity:T,regularPrice:I,salePrice:m,productGroup:k==="Parent"?"parent":"child"}),S("success"),b(!0)}catch(N){console.log(`Product Creation failed :${N}`),S("failed")}}};return e.jsxs(je,{style:{backgroundColor:j&&"rgba(0,0,0,0.1)"},children:[e.jsx(d,{children:a}),e.jsx(d,{children:w}),e.jsx(d,{children:k==="Parent"?g+" - Parent":g}),e.jsx(d,{children:e.jsx(Y,{label:"",control:e.jsx(be,{checked:B,onChange:c=>Q(c.target.checked),disabled:j})})}),e.jsxs(d,{children:[B&&e.jsx(z,{disabled:j,size:"small",label:"Quantity",type:"number",onChange:c=>K(+c.target.value||null),value:T}),!B&&e.jsxs($e,{"aria-label":"Stock",name:"Stock",value:O,onChange:c=>L(c.target.value),children:[e.jsx(Y,{value:"instock",control:e.jsx(pe,{}),label:"Instock"}),e.jsx(Y,{value:"outstock",control:e.jsx(pe,{}),label:"Outstock"})]})]}),e.jsx(d,{children:e.jsx(z,{disabled:j,size:"small",label:"Price",type:"number",onChange:c=>J(+c.target.value||null),value:I})}),e.jsx(d,{children:e.jsx(z,{disabled:j,size:"small",label:"Price",type:"number",onChange:c=>W(+c.target.value||null),value:m})}),e.jsx(d,{children:e.jsx("input",{size:"small",label:"Image",type:"file",onChange:P,disabled:j})}),e.jsxs(d,{children:[o==="pending"&&!0&&e.jsx(R,{color:"success",variant:"contained",size:"small",onClick:ee,type:"submit",children:"Add Product"}),o==="loading"&&e.jsx(R,{color:"success",variant:"contained",size:"small",children:"Loading"}),o==="success"&&e.jsx(R,{color:"success",variant:"contained",size:"small",children:"Product Created"}),o==="failed"&&e.jsx(R,{color:"success",variant:"contained",size:"small",children:"Product creation failed"})]})]})}export{ss as P};
