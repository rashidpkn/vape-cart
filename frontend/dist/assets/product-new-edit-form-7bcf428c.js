import{j as e,aF as te,T,c as A,r as p,ap as ge,k as F,aG as le,u as se,G as k,p as C,C as L,v as K,aH as Q,aI as je,aJ as ue,aj as ae,B as z,aK as fe,F as ye,ak as re,aL as ve,aM as he,aN as E,aa as Se,aO as ke,aP as Ce,ab as oe,ac as v,aQ as q,aR as we,aS as P,ad as Ie,ai as Ae,L as ce,af as qe,aT as de,aU as ee,am as Fe}from"./index-0e7d7f47.js";import{F as U,R as pe,b as W}from"./product-table-toolbar-2e068530.js";import{C as G}from"./Checkbox-c69a5a73.js";import{b as xe,c as g,a as Ue,T as De,d as Re}from"./TableRow-8d4124b7.js";import{C as me}from"./CardHeader-e89eb87b.js";import{A as J}from"./Alert-81c8ce3f.js";function Te({values:a,products:i,setValue:l}){return e.jsx(te,{value:a.name,onChange:(o,t)=>{if(t){const n=i.find(d=>d.name===t);n&&(l("images",n.images),l("name",n.name),l("category",n.category),l("brand",n.brand),l("type",n.type))}},name:"name",label:"Product Name",options:i.map(o=>o.name),getOptionLabel:o=>o,isOptionEqualToValue:(o,t)=>o===t.value,renderInput:o=>e.jsx(T,{...o,label:"Product Name",value:a.name,onChange:t=>l("name",t.target.value)}),renderOption:(o,t)=>e.jsxs(A,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...o,children:[e.jsx("img",{loading:"lazy",width:"20",src:i.find(n=>n.name===t).images[0],alt:""}),t]}),freeSolo:!0})}function Ne({setValue:a,values:i}){const l=p.useCallback(n=>{const d=i.images||[],j=n.map(u=>Object.assign(u,{preview:URL.createObjectURL(u)}));a("images",[...d,...j],{shouldValidate:!0})},[a,i.images]),o=p.useCallback(n=>{var j;const d=i.images&&((j=i.images)==null?void 0:j.filter(u=>u!==n));a("images",d)},[a,i.images]),t=p.useCallback(()=>{a("images",[])},[a]);return e.jsx(ge,{multiple:!0,name:"images",maxSize:3145728,onDrop:l,onRemove:o,onRemoveAll:t,onUpload:async n=>{try{const d=new FormData;i.images.forEach(u=>{d.append("images",u)});const{data:j}=await F.post("upload",d);a("images",j),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})}function Oe({values:a,setValue:i}){const[l,o]=p.useState(le);p.useEffect(()=>(F.get("/brands").then(s=>{o(f=>[...le,s.data.data.map(y=>y.name)])}),()=>{}),[]);const{user:t}=se(),[n,d]=p.useState({name:"",show:!1}),[j,u]=p.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{md:12,width:"100%",item:!0,children:[e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(C,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(k,{xs:12,md:12,width:"100%",item:!0,children:e.jsx(L,{children:e.jsx(K,{spacing:3,sx:{p:3},children:e.jsxs(A,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(Q,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:je.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(Q,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:ue.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(A,{children:[e.jsx(ae,{name:"SKU",label:"Product SKU"}),e.jsx(U,{label:"Automatically generate SKUs",control:e.jsx(G,{checked:j,onChange:s=>{s.target.checked?a.name.replaceAll(" ","").trim().length>=15?(i("SKU",`${a.name.replaceAll(" ","").trim().slice(0,15)}-1`.toUpperCase()),u(!0)):(u(!1),alert("To automatically generate SKUs, ensure that the product name has at least 15 characters.")):(i("SKU",""),u(!1))}})})]}),!n.show&&e.jsx(Q,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:l.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(A,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(U,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(G,{checked:n.show,onChange:s=>d(f=>({...f,show:s.target.checked}))})}),n.show&&e.jsxs(e.Fragment,{children:[e.jsx(T,{label:"Brand Name",style:{width:300},onChange:s=>d(f=>({...f,name:s.target.value})),value:n.name}),e.jsx(z,{variant:"contained",color:"success",onClick:async()=>{try{n.name?(await F.post("/notifications",{userId:t.id,role:"admin",title:"ðŸš€ New Brand Approval Request! ðŸš€",message:`Exciting news! A new brand has been submitted for approval. Brand Name: ${n.name}. ðŸ›ï¸`,type:"product"}),i("brand",n.name),i("status","In Revision"),alert("Your request to create a new brand is being processed. Please wait while we verify the brand. You can add products, but their status will be 'In Revision.' After reviewing, the products will go live.")):alert("Please enter brand name")}catch(s){console.log(s),alert("An error occurred while adding this brand.")}},children:"Add Brand"})]})]}),a.status!=="In Revision"&&e.jsx(Q,{native:!0,name:"status",label:"status",InputLabelProps:{shrink:!0},children:fe.map(s=>e.jsx("option",{value:s,children:s},s))})]})})})})]})}function Ee({values:a,setValue:i}){return console.log(a),e.jsxs(e.Fragment,{children:[e.jsxs(k,{md:4,width:"100%",item:!0,children:[e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(C,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(k,{xs:12,md:12,width:"100%",item:!0,children:e.jsx(L,{children:e.jsxs(K,{spacing:3,sx:{p:3},children:[e.jsx(U,{label:"Track Stock",control:e.jsx(G,{defaultChecked:a.track,checked:a.track,onChange:l=>{i("track",l.target.checked),l.target.checked&&i("availability","In Stock")}})}),a.track&&e.jsx(T,{value:a.quantity,onChange:l=>{const o=Math.max(0,Number(l.target.value));i("quantity",o),i("availability","In Stock")},label:"Quantity",placeholder:"0.00",type:"number",inputProps:{min:0}}),!a.track&&e.jsx(ye,{children:e.jsxs(pe,{value:a.availability,row:!0,onChange:l=>{i("availability",l.target.value),l.target.value==="In Stock"?i("quantity",100):i("quantity",0)},children:[e.jsx(U,{value:"In Stock",control:e.jsx(W,{}),label:"In Stock"}),e.jsx(U,{value:"Out Stock",control:e.jsx(W,{}),label:"Out Stock"})]})}),e.jsx(ae,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(re,{position:"start",children:e.jsx(A,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx(ae,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(re,{position:"start",children:e.jsx(A,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})})})]})}function Ke({selectedAttributes:a=[],counter:i,skuAlpha:l,attributes:o,values:t,currentProduct:n,setValue:d}){const j=l[i]?`${t.SKU}-${l[i]}`:t.SKU,u=!!o&&Object.keys(o).map(x=>o[x]).join("-"),[s,f]=p.useState({track:!0,availability:"In Stock",quantity:null,regularPrice:null,salePrice:null,image:null,attributes:{}});p.useEffect(()=>{const x=t.variations.findIndex(h=>!!o&&Object.keys(o).every(b=>o[b]===h.attributes[b]));if(Object.keys(s.attributes).length<a.length){const h=t.variations[x];f(b=>({...b,...h,attributes:o}))}},[o]),p.useState("instock");const[y,D]=p.useState("pending"),c=x=>h=>{const b=h.target.type==="checkbox"?h.target.checked:h.target.value;f(w=>({...w,[x]:b}))},S=async x=>{try{const h=new FormData;h.append("images",x.target.files[0]);const{data:b}=await F.post("upload",h);f(w=>({...w,image:[b[0],...t.images]}))}catch(h){console.error("Image upload failed:",h)}},m=async()=>{let{track:x,quantity:h,regularPrice:b,salePrice:w}=s;if(w=Number(w),b=Number(b),h=Number(h),x&&!h)return alert("Quantity is required.");if(!b||!w)return alert("Sale Price and regular price are mandatory.");if(w>b)return alert("Sale price must be less than the regular price");if(y==="pending"){D("loading");try{if(!n)d("variations",[...t.variations,s]);else{const{attributes:R}=s;if(t.variations.some(N=>Object.keys(R).every(O=>N.attributes[O]===R[O]))){const N=[...t.variations],O=t.variations.findIndex(H=>Object.keys(R).every(M=>R[M]===H.attributes[M]));N[O]={...N[O],...s},d("variations",N)}else d("variations",[...t.variations,s])}D("success")}catch(R){console.error("Product creation failed:",R),D("failed")}}},B=()=>{switch(y){case"loading":return e.jsx(z,{color:"success",variant:"contained",size:"small",children:"Loading"});case"success":return n?e.jsx(z,{color:"success",variant:"contained",size:"small",children:"Product Updated"}):e.jsx(z,{color:"success",variant:"contained",size:"small",children:"Product Created"});case"failed":return e.jsx(z,{color:"error",variant:"contained",size:"small",children:"Product creation failed"});default:return e.jsx(z,{color:"success",variant:"contained",size:"small",onClick:m,children:n?"Save Changes":"Add Product"})}},{track:$,quantity:X,regularPrice:Z,salePrice:V,image:ie}=s;return e.jsxs(xe,{children:[e.jsx(g,{children:i}),e.jsx(g,{children:j}),e.jsx(g,{children:u}),e.jsx(g,{children:e.jsx(U,{control:e.jsx(G,{checked:$,onChange:x=>f(h=>({...h,track:x.target.checked,availability:"In Stock"}))})})}),e.jsx(g,{width:150,children:$?e.jsx(T,{size:"small",label:"Quantity",type:"number",inputProps:{min:0},onChange:x=>f(h=>({...h,quantity:+x.target.value})),value:X??""}):e.jsxs(pe,{"aria-label":"Stock",name:"Stock",value:s.availability,onChange:x=>f(h=>({...h,availability:x.target.value,quantity:x.target.value==="In Stock"?100:0})),children:[e.jsx(U,{value:"In Stock",control:e.jsx(W,{}),label:"In Stock"}),e.jsx(U,{value:"Out Stock",control:e.jsx(W,{}),label:"Out Stock"})]})}),e.jsx(g,{width:150,children:e.jsx(T,{size:"small",label:"Price",type:"number",inputProps:{min:0},onChange:c("regularPrice"),value:Z||""})}),e.jsx(g,{width:150,children:e.jsx(T,{size:"small",label:"Sale Price",type:"number",inputProps:{min:0},onChange:c("salePrice"),value:V||""})}),e.jsx(g,{width:150,children:e.jsx("input",{type:"file",onChange:S,style:{width:"150px"}})}),e.jsx(g,{children:B()})]})}function ze(){return e.jsx(Ue,{children:e.jsxs(xe,{children:[e.jsx(g,{children:"ID"}),e.jsx(g,{width:150,children:"SKU"}),e.jsx(g,{width:250,children:"Attributes"}),e.jsx(g,{width:150,children:"Track Stock"}),e.jsx(g,{children:"Stock"}),e.jsx(g,{children:"Regular Price"}),e.jsx(g,{children:"Sales Price"}),e.jsx(g,{children:"Image"}),e.jsx(g,{width:200,children:"Add Product"})]})})}function Be({setSelectedAttributes:a,selectedAttributes:i,values:l,setValue:o}){return e.jsx(te,{onChange:(t,n)=>{a(n)},value:i,name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:ve,getOptionLabel:t=>t,renderOption:(t,n)=>p.createElement("li",{...t,key:n},n),renderTags:(t,n)=>t.map((d,j)=>p.createElement(he,{...n({index:j}),key:d,label:d,size:"small",color:"info",variant:"soft"})),renderInput:t=>e.jsx(T,{...t,label:"Attributes",placeholder:"+ Attributes"})})}function Le({currentProduct:a,values:i,setValue:l,setVariation:o,e:t,savedAttibutes:n,variation:d=[]}){var D;const{user:j}=se(),s=[...{"Bottle Size":E.bottleSize,Puffs:E.puffs,Flavour:E.flavour,"Nicotine Strength":E["Nicotine Strength"],Color:E.color,Batteries:E.batteries,Packaging:E.Packaging}[t]||[],...n.filter(c=>c.attribute===t).map(c=>c.value)],f=c=>{let S={...i.attributes};i.type==="Simple"&&t!=="Flavour"?S[t]=c.length>1?[c[c.length-1]]:c:S[t]=c.length===0?void 0:c,l("attributes",S);const m=c[c.length-1];c.length&&(s.includes(m)?console.log("Already Included"):F.post("/attributes",{attribute:t,value:m,username:j.displayName}))},y=c=>{if(a&&c&&!window.confirm("Changing the variation of this product will reset all current variations. Do you wish to proceed?"))return;const S=c?[...new Set([...d,t])]:d.filter(m=>m!==t);o(S),c&&l("variations",[])};return e.jsxs(A,{sx:{gridColumn:"span 1"},children:[e.jsx(te,{multiple:!0,freeSolo:!0,options:s,value:i.attributes[t]||[],onChange:(c,S)=>f(S),renderInput:c=>e.jsx(T,{...c,label:t,placeholder:t}),renderTags:(c,S)=>c.map((m,B)=>p.createElement(he,{...S({index:B}),key:m,label:m,size:"small",color:"info",variant:"soft"}))}),i.type==="Variable"&&((D=i.attributes[t])==null?void 0:D.length)>1&&e.jsx(U,{label:"Use this attribute to create Variations",control:e.jsx(G,{checked:d.includes(t),onChange:c=>y(c.target.checked)})})]},t)}function Qe({currentProduct:a}){const i=Se(),l=ke("up","md"),{enqueueSnackbar:o}=Ce(),{user:t}=se(),n=oe().shape({name:v().required("Name is required"),subDescription:v().required("Short description is required").test("not-four-digits","Your content contain continues 7 digit number, Please remove",r=>!/\d{7,}/.test(r)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',r=>!/@/.test(r)),content:v().test("not-four-digits","Your content contain continues 7 digit number, Please remove",r=>!/\d{7,}/.test(r)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',r=>!/@/.test(r)),images:q().min(1,"Image is required"),type:v(),category:v().required("Category is required"),tags:q(),SKU:v().required("SKU is required"),brand:v().required("brand is required"),status:v().required("brand is required"),attributes:oe().shape({bottleSize:q().of(v()).optional(),puffs:q().of(v()).optional(),flavour:q().of(v()).optional(),nicotineStrength:q().of(v()).optional(),color:q().of(v()).optional(),batteries:q().of(v()).optional()}),track:we(),availability:v(),quantity:P(),regularPrice:P(),salePrice:P(),variations:q()}),[d,j]=p.useState({id:"",name:"",subDescription:"",content:"",images:[],type:"Simple",category:"Disposables",tags:[],SKU:"",brand:"SMOK",status:"Published",attributes:{},track:!0,availability:"In Stock",quantity:0,regularPrice:100,salePrice:0,variations:[]});p.useEffect(()=>{j({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",subDescription:(a==null?void 0:a.subDescription)||"",content:(a==null?void 0:a.content)||"",images:(a==null?void 0:a.images)||[],type:(a==null?void 0:a.type)||"Simple",category:(a==null?void 0:a.category)||"Disposables",tags:(a==null?void 0:a.tags)||[],SKU:(a==null?void 0:a.SKU)||"",brand:(a==null?void 0:a.brand)||"SMOK",status:(a==null?void 0:a.status)||"Published",attributes:(a==null?void 0:a.attributes)||{},track:a==null?void 0:a.track,availability:(a==null?void 0:a.availability)||"In Stock",quantity:(a==null?void 0:a.quantity)||0,regularPrice:(a==null?void 0:a.regularPrice)||100,salePrice:(a==null?void 0:a.salePrice)||0,variations:(a==null?void 0:a.variations)||[]})},[a]);const u=Ie({resolver:Fe(n),defaultValues:d}),{reset:s,watch:f,setValue:y,handleSubmit:D,formState:{isSubmitting:c,isValid:S}}=u,m=f(),[B,$]=p.useState([]);p.useEffect(()=>{F.get("/attributes").then(r=>{$(r.data)})},[]);const[X,Z]=p.useState([]),V=p.useCallback(async()=>{const{data:r}=await F.get("/products",{params:{name:m.name}});Z(r.products.filter(I=>!I.name.includes("-")))},[m.name]);p.useEffect(()=>{V()},[m.name]),p.useEffect(()=>{a&&s(d)},[a,d,s]);const ie=D(async r=>{try{if(r.type==="Simple"){if(!r.salePrice||!r.regularPrice){alert("Sale Price and regular price are mandatory");return}else if(r.salePrice>r.regularPrice){alert("Sale price must be less than the regular price");return}}a?await F.patch("products",{...r,username:t.displayName,userId:t.id,storeName:t.storeName}):await F.post("products",{...r,username:t.displayName,userId:t.id,storeName:t.storeName}),s(),o(a?"Update success!":"Create success!"),i.push(Ae.dashboard.product.root)}catch(I){console.log(I)}}),[x,h]=p.useState([]),[b,w]=p.useState([]);p.useEffect(()=>{var r;if(a){const{attributes:I,variations:Y,type:_}=a;I&&h(Object.keys(I)),_==="Variable"&&Y.length&&w(Object.keys((r=Y[0])==null?void 0:r.attributes))}},[a]);const R=e.jsxs(e.Fragment,{children:[l&&e.jsxs(k,{md:4,item:!0,children:[e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(C,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(k,{xs:12,md:12,item:!0,children:e.jsxs(L,{children:[!l&&e.jsx(me,{title:"Details"}),e.jsxs(K,{spacing:3,sx:{p:3},children:[e.jsx(Te,{products:X,setValue:y,values:m}),e.jsx(J,{severity:"info",children:"Please do not include emails, phone numbers, or emojis in the sub-description and content. Products containing these will not be accepted."}),e.jsxs(K,{spacing:1.5,children:[e.jsx(C,{variant:"subtitle2",children:"Sub Description"}),e.jsx(de,{simple:!0,name:"subDescription"})]}),e.jsxs(K,{spacing:1.5,children:[e.jsx(C,{variant:"subtitle2",children:"Content"}),e.jsx(de,{simple:!0,name:"content"})]}),e.jsx(J,{severity:"info",children:"Uploading at least one image is required."}),e.jsxs(K,{spacing:1.5,children:[e.jsx(C,{variant:"subtitle2",children:"Images"}),e.jsx(Ne,{values:m,setValue:y})]})]})]})})]}),ne=e.jsxs(e.Fragment,{children:[l&&e.jsxs(k,{md:4,item:!0,children:[e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(C,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(k,{xs:12,md:12,item:!0,children:e.jsxs(L,{children:[!l&&e.jsx(me,{title:"Attributes"}),e.jsx(K,{spacing:3,sx:{p:3},children:e.jsxs(A,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(A,{sx:{gridColumn:"span 2 "},children:m.type==="Variable"&&e.jsx(J,{severity:"info",children:"Please choose at least one attribute."})}),e.jsx(A,{sx:{gridColumn:"span 2 "},children:e.jsx(Be,{selectedAttributes:x,setSelectedAttributes:h,setValue:y,values:m})}),m.type==="Variable"&&!!x.length&&e.jsx(A,{sx:{gridColumn:"span 2 "},children:e.jsx(J,{severity:"info",children:"Please select at least two variations from the list below to enable the 'Create Variations' option."})}),x.map(r=>e.jsx(Le,{currentProduct:a,setValue:y,setVariation:w,variation:b,values:m,e:r,savedAttibutes:B},r))]})})]})})]}),N=e.jsxs(k,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},gap:2.5,item:!0,children:[e.jsx(ce,{type:"submit",variant:"contained",size:"large",loading:c,children:a?"Save Changes":"Create Product"}),m.status!=="In Revision"&&e.jsx(ce,{onClick:()=>{y("status","Draft")},type:"submit",variant:"contained",size:"large",loading:c,children:"Save as Draft"})]}),O=[...ee,...ee.slice(1).flatMap(r=>ee.slice(1).map(I=>r+I))];let H=1;const M=e.jsxs(e.Fragment,{children:[l&&e.jsx(k,{md:4,item:!0,children:e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(k,{xs:12,md:12,item:!0,children:e.jsx(L,{children:e.jsxs(De,{children:[e.jsx(ze,{}),e.jsx(Re,{children:b==null?void 0:b.reduce((r,I)=>r.flatMap(Y=>{var _;return(_=m.attributes[I])==null?void 0:_.map(be=>({...Y,[I]:be}))}),[{}]).map(r=>e.jsx(Ke,{selectedAttributes:x,counter:H++,skuAlpha:O,attributes:r,values:m,currentProduct:a,setValue:y},H))})]})})})]});return e.jsx(qe,{methods:u,onSubmit:ie,children:e.jsxs(k,{container:!0,spacing:3,children:[R,e.jsx(Oe,{values:m,setValue:y}),ne,m.type==="Simple"&&e.jsx(Ee,{values:m,setValue:y}),m.type==="Variable"&&M,N]})})}export{Qe as P};
