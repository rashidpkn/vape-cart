import{eJ as pe,eK as Fe,eL as ze,eM as $e,eN as Ge,eO as $,eP as re,eQ as We,c2 as Ve,dC as xe,c1 as ue,eR as Be,D as c,aw as m,a5 as X,be as V,ag as E,a8 as e,aD as O,aB as I,aT as L,aZ as P,a9 as u,ac as T,ad as A,bu as _,bg as qe,bh as He,bz as Ye,aF as v,ah as x,av as Ke,aG as Z,eS as Ze,bT as me,bP as ge,a6 as fe,aM as Je,b8 as B,aS as je,eT as Qe,eU as Xe,eV as es,ba as ss,ao as N,aP as ee,bZ as ve,dL as ts,bw as ns,eW as rs,eX as os,cF as as,bv as is,ax as ls,aj as cs,aH as ds}from"./index-bf334511.js";import{u as hs}from"./use-search-params-e8340e98.js";import{_ as ps}from"./_baseEach-b35996e5.js";import{u as se}from"./index-e7fa282c.js";import{f as te,l as G,n as xs,e as D}from"./axios-836cbfd4.js";import{A as be}from"./AvatarGroup-a65ee4da.js";import{S as us}from"./Select-1c3a8fd5.js";import{S as J}from"./Skeleton-68e38d46.js";import{C as ms}from"./ClickAwayListener-c1907ab4.js";import{T as ye}from"./TextField-e6e01232.js";import{D as gs}from"./DialogContent-30366fda.js";import{u as fs,L as js}from"./lightbox-46207e3d.js";import{A as vs}from"./Autocomplete-7badf00e.js";import{M as bs}from"./Chip-d1d4c445.js";import{C as ys}from"./Card-6dc62dad.js";import"./Menu-3b093474.js";import"./FormControl-96833b24.js";import"./FormLabel-8a3d5af0.js";import"./Close-06645920.js";var oe=1e3*60,W=60*24,ae=W*30,ie=W*365;function ws(s,r,t){var a,o,n;pe(2,arguments);var i=We(),l=(a=(o=t==null?void 0:t.locale)!==null&&o!==void 0?o:i.locale)!==null&&a!==void 0?a:Fe;if(!l.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var p=ze(s,r);if(isNaN(p))throw new RangeError("Invalid time value");var d=$e(Ge(t),{addSuffix:!!(t!=null&&t.addSuffix),comparison:p}),h,j;p>0?(h=$(r),j=$(s)):(h=$(s),j=$(r));var f=String((n=t==null?void 0:t.roundingMethod)!==null&&n!==void 0?n:"round"),g;if(f==="floor")g=Math.floor;else if(f==="ceil")g=Math.ceil;else if(f==="round")g=Math.round;else throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");var b=j.getTime()-h.getTime(),y=b/oe,k=re(j)-re(h),R=(b-k)/oe,C=t==null?void 0:t.unit,w;if(C?w=String(C):y<1?w="second":y<60?w="minute":y<W?w="hour":R<ae?w="day":R<ie?w="month":w="year",w==="second"){var M=g(b/1e3);return l.formatDistance("xSeconds",M,d)}else if(w==="minute"){var q=g(y);return l.formatDistance("xMinutes",q,d)}else if(w==="hour"){var H=g(y/60);return l.formatDistance("xHours",H,d)}else if(w==="day"){var Y=g(R/W);return l.formatDistance("xDays",Y,d)}else if(w==="month"){var F=g(R/ae);return F===12&&C!=="month"?l.formatDistance("xYears",1,d):l.formatDistance("xMonths",F,d)}else if(w==="year"){var z=g(R/ie);return l.formatDistance("xYears",z,d)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function we(s,r){return pe(1,arguments),ws(s,Date.now(),r)}function Cs(s,r,t,a){for(var o=-1,n=s==null?0:s.length;++o<n;){var i=s[o];r(a,i,t(i),s)}return a}var ks=Cs,Ss=ps;function Ts(s,r,t,a){return Ss(s,function(o,n,i){r(a,o,t(o),i)}),a}var Is=Ts,Rs=ks,As=Is,Ms=Ve,Ns=xe;function Ds(s,r){return function(t,a){var o=Ns(t)?Rs:As,n=r?r():{};return o(t,s,Ms(a),n)}}var Os=Ds,Ls=Be,Us=Os,Es=Us(function(s,r,t){Ls(s,t,r)}),Ps=Es;const _s=ue(Ps),ne={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function Fs(){const s=[D.chat,{params:{endpoint:"contacts"}}],{data:r,isLoading:t,error:a,isValidating:o}=se(s,te,ne);return c.useMemo(()=>({contacts:(r==null?void 0:r.contacts)||[],contactsLoading:t,contactsError:a,contactsValidating:o,contactsEmpty:!t&&!(r!=null&&r.contacts.length)}),[r==null?void 0:r.contacts,a,t,o])}function zs(){const s=[D.chat,{params:{endpoint:"conversations"}}],{data:r,isLoading:t,error:a,isValidating:o}=se(s,te,ne);return c.useMemo(()=>{const i=_s(r==null?void 0:r.conversations,"id")||{},l=Object.keys(i)||[];return{conversations:{byId:i,allIds:l},conversationsLoading:t,conversationsError:a,conversationsValidating:o,conversationsEmpty:!t&&!l.length}},[r==null?void 0:r.conversations,a,t,o])}function $s(s){const r=s?[D.chat,{params:{conversationId:s,endpoint:"conversation"}}]:null,{data:t,isLoading:a,error:o,isValidating:n}=se(r,te,ne);return c.useMemo(()=>({conversation:t==null?void 0:t.conversation,conversationLoading:a,conversationError:o,conversationValidating:n}),[t==null?void 0:t.conversation,o,a,n])}async function Gs(s,r){const t=[D.chat,{params:{endpoint:"conversations"}}],a=[D.chat,{params:{conversationId:s,endpoint:"conversation"}}];G(a,o=>{const{conversation:n}=o;return{conversation:{...n,messages:[...n.messages,r]}}},!1),G(t,o=>{const{conversations:n}=o;return{conversations:n.map(l=>l.id===s?{...l,messages:[...l.messages,r]}:l)}},!1)}async function Ws(s){const r=[D.chat,{params:{endpoint:"conversations"}}],t={conversationData:s},a=await xs.post(D.chat,t);return G(r,o=>{const n=[...o.conversations,s];return{...o,conversations:n}},!1),a.data}async function Vs(s){const r=D.chat;G([r,{params:{endpoint:"conversations"}}],t=>{const a=t.conversations.map(o=>o.id===s?{...o,unreadCount:0}:o);return{...t,conversations:a}},!1)}function Bs({message:s,participants:r,currentUserId:t}){const a=r.find(l=>l.id===s.senderId),o=s.senderId===t?{type:"me"}:{avatarUrl:a==null?void 0:a.avatarUrl,firstName:a==null?void 0:a.name.split(" ")[0]},n=o.type==="me";return{hasImage:s.contentType==="image",me:n,senderDetails:o}}function qs({currentUserId:s,conversation:r}){const{messages:t,participants:a}=r,o=a.filter(h=>h.id!==s),n=t[t.length-1],i=o.length>1,l=o.map(h=>h.name).join(", "),p=i?o.map(h=>h.status).includes("online"):!1;let d="";if(n){const h=n.senderId===s?"You: ":"",j=n.contentType==="image"?"Sent a photo":n.body;d=`${h}${j}`}return{group:i,displayName:l,displayText:d,participants:o,lastActivity:n.createdAt,hasOnlineInGroup:p}}function Ce(){const[s,r]=c.useState(!1),[t,a]=c.useState(!1),o=c.useCallback(()=>{a(p=>!p)},[]),n=c.useCallback(()=>{a(!1)},[]),i=c.useCallback(()=>{r(!0)},[]),l=c.useCallback(()=>{r(!1)},[]);return{openMobile:s,collapseDesktop:t,onOpenMobile:i,onCloseMobile:l,onCloseDesktop:n,onCollapseDesktop:o}}function Hs(s){const r=c.useRef(null),t=c.useCallback(()=>{s&&r.current&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[s]);return c.useEffect(()=>{t()},[s]),{messagesEndRef:r}}function ke({selected:s,collapse:r,conversation:t,onCloseMobile:a}){const{user:o}=_(),n=X("up","md"),i=V(),{group:l,displayName:p,displayText:d,participants:h,lastActivity:j,hasOnlineInGroup:f}=qs({conversation:t,currentUserId:o.id}),g=h[0],{name:b,avatarUrl:y,status:k}=g,R=c.useCallback(async()=>{try{n||a(),await Vs(t.id),i.push(`${E.dashboard.chat}?id=${t.id}`)}catch(M){console.error(M)}},[t.id,n,a,i]),C=e.jsx(O,{variant:f?"online":"invisible",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(be,{variant:"compact",sx:{width:48,height:48},children:h.slice(0,2).map(M=>e.jsx(I,{alt:M.name,src:M.avatarUrl},M.id))})}),w=e.jsx(O,{variant:k,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(I,{alt:b,src:y,sx:{width:48,height:48}})},k);return e.jsxs(L,{disableGutters:!0,onClick:R,sx:{py:1.5,px:2.5,...s&&{bgcolor:"action.selected"}},children:[e.jsx(O,{color:"error",overlap:"circular",badgeContent:r?t.unreadCount:0,children:l?C:w}),!r&&e.jsxs(e.Fragment,{children:[e.jsx(P,{sx:{ml:2},primary:p,primaryTypographyProps:{noWrap:!0,variant:"subtitle2"},secondary:d,secondaryTypographyProps:{noWrap:!0,component:"span",variant:t.unreadCount?"subtitle2":"body2",color:t.unreadCount?"text.primary":"text.secondary"}}),e.jsxs(u,{alignItems:"flex-end",sx:{ml:2,height:44},children:[e.jsx(T,{noWrap:!0,variant:"body2",component:"span",sx:{mb:1.5,fontSize:12,color:"text.disabled"},children:we(new Date(j),{addSuffix:!1})}),!!t.unreadCount&&e.jsx(A,{sx:{width:8,height:8,bgcolor:"info.main",borderRadius:"50%"}})]})]})]})}ke.propTypes={collapse:m.bool,conversation:m.object,onCloseMobile:m.func,selected:m.bool};function Ys(){const{user:s}=_(),r=qe(),[t,a]=c.useState("online"),o=c.useCallback(n=>{a(n.target.value)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(O,{variant:t,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(I,{src:s==null?void 0:s.photoURL,alt:s==null?void 0:s.displayName,onClick:r.onOpen,sx:{cursor:"pointer",width:48,height:48}})}),e.jsxs(He,{open:r.open,onClose:r.onClose,arrow:"top-left",sx:{p:0},children:[e.jsxs(u,{direction:"row",alignItems:"center",spacing:2,sx:{py:2,pr:1,pl:2.5},children:[e.jsx(P,{primary:s==null?void 0:s.displayName,secondary:s==null?void 0:s.email,secondaryTypographyProps:{component:"span"}}),e.jsx(Ye,{title:"Log out",children:e.jsx(v,{color:"error",children:e.jsx(x,{icon:"ic:round-power-settings-new"})})})]}),e.jsx(Ke,{sx:{borderStyle:"dashed"}}),e.jsxs(u,{sx:{p:1},children:[e.jsxs(Z,{children:[e.jsx(O,{variant:t,sx:{[`& .${Ze.badge}`]:{position:"static",m:.75,width:12,height:12,flexShrink:0}}}),e.jsx(us,{native:!0,fullWidth:!0,value:t,onChange:o,input:e.jsx(me,{sx:{pl:2}}),inputProps:{sx:{textTransform:"capitalize"}},children:["online","alway","busy","offline"].map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs(Z,{children:[e.jsx(x,{icon:"solar:user-id-bold",width:24}),"Profile"]}),e.jsxs(Z,{children:[e.jsx(x,{icon:"eva:settings-2-fill",width:24}),"Settings"]})]})]})]})}function Se({sx:s,...r}){return e.jsxs(u,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...s},...r,children:[e.jsx(J,{variant:"circular",sx:{width:48,height:48}}),e.jsxs(u,{spacing:1,flexGrow:1,children:[e.jsx(J,{sx:{width:.75,height:10}}),e.jsx(J,{sx:{width:.5,height:10}})]})]})}Se.propTypes={sx:m.object};function Te({query:s,results:r,onClickResult:t}){const a=r.length,o=!a&&!!s;return e.jsxs(e.Fragment,{children:[e.jsxs(T,{paragraph:!0,variant:"h6",sx:{px:2.5},children:["Contacts (",a,")"]}),o?e.jsx(ge,{query:s,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}):e.jsx(e.Fragment,{children:r.map(n=>e.jsxs(L,{onClick:()=>t(n),sx:{px:2.5,py:1.5,typography:"subtitle2"},children:[e.jsx(I,{alt:n.name,src:n.avatarUrl,sx:{mr:2}}),n.name]},n.id))})]})}Te.propTypes={query:m.string,results:m.array,onClickResult:m.func};const le=320,Ks=96;function Ie({loading:s,contacts:r,conversations:t,selectedConversationId:a}){const o=fe(),n=V(),i=X("up","md"),{collapseDesktop:l,onCloseDesktop:p,onCollapseDesktop:d,openMobile:h,onOpenMobile:j,onCloseMobile:f}=Ce(),[g,b]=c.useState({query:"",results:[]});c.useEffect(()=>{i||p()},[p,i]);const y=c.useCallback(()=>{i?d():f()},[i,f,d]),k=c.useCallback(()=>{i||f(),n.push(E.dashboard.chat)},[i,f,n]),R=c.useCallback(S=>{if(b(U=>({...U,query:S})),S){const U=r.filter(K=>K.name.toLowerCase().includes(S));b(K=>({...K,results:U}))}},[r]),C=c.useCallback(()=>{b({query:"",results:[]})},[]),w=c.useCallback(S=>{C(),n.push(`${E.dashboard.chat}?id=${S.id}`)},[C,n]),M=e.jsx(v,{onClick:j,sx:{left:0,top:84,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",bgcolor:o.palette.primary.main,boxShadow:o.customShadows.primary,color:o.palette.primary.contrastText,"&:hover":{bgcolor:o.palette.primary.darker}},children:e.jsx(x,{width:16,icon:"solar:users-group-rounded-bold"})}),q=e.jsx(e.Fragment,{children:[...Array(12)].map((S,U)=>e.jsx(Se,{},U))}),H=e.jsx(e.Fragment,{children:t.allIds.map(S=>e.jsx(ke,{collapse:l,conversation:t.byId[S],selected:S===a,onCloseMobile:f},S))}),Y=e.jsx(Te,{query:g.query,results:g.results,onClickResult:w}),F=e.jsx(ms,{onClickAway:C,children:e.jsx(ye,{fullWidth:!0,value:g.query,onChange:S=>R(S.target.value),placeholder:"Search contacts...",InputProps:{startAdornment:e.jsx(Je,{position:"start",children:e.jsx(x,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{mt:2.5}})}),z=e.jsxs(e.Fragment,{children:[e.jsxs(u,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,pb:0},children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(Ys,{}),e.jsx(A,{sx:{flexGrow:1}})]}),e.jsx(v,{onClick:y,children:e.jsx(x,{icon:l?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!l&&e.jsx(v,{onClick:k,children:e.jsx(x,{width:24,icon:"solar:user-plus-bold"})})]}),e.jsx(A,{sx:{p:2.5,pt:0},children:!l&&F}),e.jsxs(B,{sx:{pb:1},children:[g.query&&Y,s&&q,!g.query&&!!t.allIds.length&&H]})]});return e.jsxs(e.Fragment,{children:[!i&&M,i?e.jsx(u,{sx:{height:1,flexShrink:0,width:le,borderRight:`solid 1px ${o.palette.divider}`,transition:o.transitions.create(["width"],{duration:o.transitions.duration.shorter}),...l&&{width:Ks}},children:z}):e.jsx(je,{open:h,onClose:f,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:le}},children:z})]})}Ie.propTypes={contacts:m.array,conversations:m.object,loading:m.bool,selectedConversationId:m.string};var ce=Qe,Zs=Xe,Js=xe,de=ce?ce.isConcatSpreadable:void 0;function Qs(s){return Js(s)||Zs(s)||!!(de&&s&&s[de])}var Xs=Qs,et=es,st=Xs;function Re(s,r,t,a,o){var n=-1,i=s.length;for(t||(t=st),o||(o=[]);++n<i;){var l=s[n];r>0&&t(l)?r>1?Re(l,r-1,t,a,o):et(o,l):a||(o[o.length]=l)}return o}var tt=Re,nt=tt;function rt(s){var r=s==null?0:s.length;return r?nt(s,1):[]}var ot=rt;const at=ue(ot);function Ae({participant:s,open:r,onClose:t}){return e.jsxs(ss,{fullWidth:!0,maxWidth:"xs",open:r,onClose:t,children:[e.jsx(v,{onClick:t,sx:{position:"absolute",right:8,top:8},children:e.jsx(x,{icon:"mingcute:close-line"})}),e.jsxs(gs,{sx:{py:5,px:3,display:"flex"},children:[e.jsx(I,{alt:s.name,src:s.avatarUrl,sx:{width:96,height:96,mr:3}}),e.jsxs(u,{spacing:1,children:[e.jsx(T,{variant:"caption",sx:{color:"primary.main"},children:s.role}),e.jsx(T,{variant:"subtitle1",children:s.name}),e.jsxs(u,{direction:"row",sx:{typography:"caption",color:"text.disabled"},children:[e.jsx(x,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),s.address]}),e.jsxs(u,{spacing:1,direction:"row",sx:{pt:1.5},children:[e.jsx(v,{size:"small",color:"error",sx:{borderRadius:1,bgcolor:a=>N(a.palette.error.main,.08),"&:hover":{bgcolor:a=>N(a.palette.error.main,.16)}},children:e.jsx(x,{width:18,icon:"solar:phone-bold"})}),e.jsx(v,{size:"small",color:"info",sx:{borderRadius:1,bgcolor:a=>N(a.palette.info.main,.08),"&:hover":{bgcolor:a=>N(a.palette.info.main,.16)}},children:e.jsx(x,{width:18,icon:"solar:chat-round-dots-bold"})}),e.jsx(v,{size:"small",color:"primary",sx:{borderRadius:1,bgcolor:a=>N(a.palette.primary.main,.08),"&:hover":{bgcolor:a=>N(a.palette.primary.main,.16)}},children:e.jsx(x,{width:18,icon:"fluent:mail-24-filled"})}),e.jsx(v,{size:"small",color:"secondary",sx:{borderRadius:1,bgcolor:a=>N(a.palette.secondary.main,.08),"&:hover":{bgcolor:a=>N(a.palette.secondary.main,.16)}},children:e.jsx(x,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}Ae.propTypes={onClose:m.func,open:m.bool,participant:m.object};function Me({participants:s}){const[r,t]=c.useState(null),a=ee(!0),o=c.useCallback(d=>{t(d)},[]),n=()=>{t(null)},i=s.length,l=e.jsxs(L,{onClick:a.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(A,{component:"span",sx:{flexGrow:1},children:["In room (",i,")"]}),e.jsx(x,{width:16,icon:a.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),p=e.jsx(B,{sx:{height:56*4},children:s.map(d=>e.jsxs(L,{onClick:()=>o(d),children:[e.jsx(O,{variant:d.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(I,{alt:d.name,src:d.avatarUrl})}),e.jsx(P,{sx:{ml:2},primary:d.name,secondary:d.role,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span",typography:"caption"}})]},d.id))});return e.jsxs(e.Fragment,{children:[l,e.jsx("div",{children:e.jsx(ve,{in:a.value,children:p})}),r&&e.jsx(Ae,{participant:r,open:!!r,onClose:n})]})}Me.propTypes={participants:m.array};function Ne({participant:s}){const r=ee(!0),{name:t,avatarUrl:a,role:o,address:n,phoneNumber:i,email:l}=s,p=e.jsxs(u,{alignItems:"center",sx:{py:5},children:[e.jsx(I,{alt:t,src:a,sx:{width:96,height:96,mb:2}}),e.jsx(T,{variant:"subtitle1",children:t}),e.jsx(T,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:o})]}),d=e.jsxs(L,{onClick:r.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsx(A,{component:"span",sx:{flexGrow:1},children:"Information"}),e.jsx(x,{width:16,icon:r.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),h=e.jsxs(u,{spacing:2,sx:{px:2,py:2.5,"& svg":{mr:1,flexShrink:0,color:"text.disabled"}},children:[e.jsxs(u,{direction:"row",children:[e.jsx(x,{icon:"mingcute:location-fill"}),e.jsx(T,{variant:"body2",children:n})]}),e.jsxs(u,{direction:"row",children:[e.jsx(x,{icon:"solar:phone-bold"}),e.jsx(T,{variant:"body2",children:i})]}),e.jsxs(u,{direction:"row",children:[e.jsx(x,{icon:"fluent:mail-24-filled"}),e.jsx(T,{variant:"body2",noWrap:!0,children:l})]})]});return e.jsxs(e.Fragment,{children:[p,d,e.jsx("div",{children:e.jsx(ve,{in:r.value,children:h})})]})}Ne.propTypes={participant:m.object};function De({attachments:s}){const r=ee(!0),t=s.length,a=e.jsxs(L,{disabled:!s.length,onClick:r.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(A,{component:"span",sx:{flexGrow:1},children:["Attachments (",t,")"]}),e.jsx(x,{width:16,icon:!r.value&&"eva:arrow-ios-forward-fill"||!s.length&&"eva:arrow-ios-forward-fill"||"eva:arrow-ios-downward-fill"})]}),o=e.jsx(B,{sx:{px:2,py:2.5},children:s.map((n,i)=>e.jsxs(u,{spacing:1.5,direction:"row",alignItems:"center",sx:{mb:2},children:[e.jsx(u,{alignItems:"center",justifyContent:"center",sx:{width:40,height:40,flexShrink:0,borderRadius:1,overflow:"hidden",position:"relative",backgroundColor:"background.neutral"},children:e.jsx(ts,{imageView:!0,file:n.preview,onDownload:()=>console.info("DOWNLOAD"),sx:{width:28,height:28}})}),e.jsx(P,{primary:n.name,secondary:ns(n.createdAt),primaryTypographyProps:{noWrap:!0,typography:"body2"},secondaryTypographyProps:{mt:.25,noWrap:!0,component:"span",typography:"caption",color:"text.disabled"}})]},n.name+i))});return e.jsxs(e.Fragment,{children:[a,e.jsx(A,{sx:{overflow:"hidden",height:r.value?1:0,transition:n=>n.transitions.create(["height"],{duration:n.transitions.duration.shorter})},children:o})]})}De.propTypes={attachments:m.array};const Q=240;function Oe({participants:s,conversation:r}){const t=fe(),a=X("up","lg"),{collapseDesktop:o,onCloseDesktop:n,onCollapseDesktop:i,openMobile:l,onOpenMobile:p,onCloseMobile:d}=Ce();c.useEffect(()=>{a||n()},[n,a]);const h=c.useCallback(()=>{a?i():p()},[a]),j=s.length>1,f=rs(at(r.messages.map(y=>y.attachments))),g=e.jsxs(e.Fragment,{children:[j?e.jsx(Me,{participants:s}):e.jsx(Ne,{participant:s[0]}),e.jsx(De,{attachments:f})]}),b=e.jsx(v,{onClick:h,sx:{top:12,right:0,zIndex:9,width:32,height:32,borderRight:0,position:"absolute",borderRadius:"12px 0 0 12px",boxShadow:t.customShadows.z8,bgcolor:t.palette.background.paper,border:`solid 1px ${t.palette.divider}`,"&:hover":{bgcolor:t.palette.background.neutral},...a&&{...!o&&{right:Q}}},children:a?e.jsx(x,{width:16,icon:o?"eva:arrow-ios-back-fill":"eva:arrow-ios-forward-fill"}):e.jsx(x,{width:16,icon:"eva:arrow-ios-back-fill"})});return e.jsxs(A,{sx:{position:"relative"},children:[b,a?e.jsx(u,{sx:{height:1,flexShrink:0,width:Q,borderLeft:`solid 1px ${t.palette.divider}`,transition:t.transitions.create(["width"],{duration:t.transitions.duration.shorter}),...o&&{width:0}},children:!o&&g}):e.jsx(je,{anchor:"right",open:l,onClose:d,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:Q}},children:g})]})}Oe.propTypes={conversation:m.object,participants:m.array};function Le({message:s,participants:r,onOpenLightbox:t}){const{user:a}=_(),{me:o,senderDetails:n,hasImage:i}=Bs({message:s,participants:r,currentUserId:a.id}),{firstName:l,avatarUrl:p}=n,{body:d,createdAt:h}=s,j=e.jsxs(T,{noWrap:!0,variant:"caption",sx:{mb:1,color:"text.disabled",...!o&&{mr:"auto"}},children:[!o&&`${l},`,"  ",we(new Date(h),{addSuffix:!0})]}),f=e.jsx(u,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...o&&{color:"grey.800",bgcolor:"primary.lighter"},...i&&{p:0,bgcolor:"transparent"}},children:i?e.jsx(A,{component:"img",alt:"attachment",src:d,onClick:()=>t(d),sx:{minHeight:220,borderRadius:1.5,cursor:"pointer","&:hover":{opacity:.9}}}):d}),g=e.jsxs(u,{direction:"row",className:"message-actions",sx:{pt:.5,opacity:0,top:"100%",left:0,position:"absolute",transition:b=>b.transitions.create(["opacity"],{duration:b.transitions.duration.shorter}),...o&&{left:"unset",right:0}},children:[e.jsx(v,{size:"small",children:e.jsx(x,{icon:"solar:reply-bold",width:16})}),e.jsx(v,{size:"small",children:e.jsx(x,{icon:"eva:smiling-face-fill",width:16})}),e.jsx(v,{size:"small",children:e.jsx(x,{icon:"solar:trash-bin-trash-bold",width:16})})]});return e.jsxs(u,{direction:"row",justifyContent:o?"flex-end":"unset",sx:{mb:5},children:[!o&&e.jsx(I,{alt:l,src:p,sx:{width:32,height:32,mr:2}}),e.jsxs(u,{alignItems:"flex-end",children:[j,e.jsxs(u,{direction:"row",alignItems:"center",sx:{position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:[f,g]})]})]})}Le.propTypes={message:m.object,onOpenLightbox:m.func,participants:m.array};function Ue({messages:s=[],participants:r}){const{messagesEndRef:t}=Hs(s),a=s.filter(n=>n.contentType==="image").map(n=>({src:n.body})),o=fs(a);return e.jsxs(e.Fragment,{children:[e.jsx(B,{ref:t,sx:{px:3,py:5,height:1},children:e.jsx(A,{children:s.map(n=>e.jsx(Le,{message:n,participants:r,onOpenLightbox:()=>o.onOpen(n.body)},n.id))})}),e.jsx(js,{index:o.selected,slides:a,open:o.open,close:o.onClose})]})}Ue.propTypes={messages:m.array,participants:m.array};function he(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const r=Math.random()*16|0;return(s==="x"?r:r&3|8).toString(16)})}function Ee({recipients:s,onAddRecipients:r,disabled:t,selectedConversationId:a}){const o=V(),{user:n}=_(),i=c.useRef(null),[l,p]=c.useState(""),d=c.useMemo(()=>({id:n.id,role:n.role,email:n.email,address:n.address,name:n.displayName,lastActivity:new Date,avatarUrl:n.photoURL,phoneNumber:n.phoneNumber,status:"online"}),[n]),h=c.useMemo(()=>({id:he(),attachments:[],body:l,contentType:"text",createdAt:os(new Date,{minutes:1}),senderId:d.id}),[l,d.id]),j=c.useMemo(()=>({id:he(),messages:[h],participants:[...s,d],type:s.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[h,d,s]),f=c.useCallback(()=>{i.current&&i.current.click()},[]),g=c.useCallback(y=>{p(y.target.value)},[]),b=c.useCallback(async y=>{try{if(y.key==="Enter"){if(l)if(a)await Gs(a,h);else{const k=await Ws(j);o.push(`${E.dashboard.chat}?id=${k.conversation.id}`),r([])}p("")}}catch(k){console.error(k)}},[j,l,h,r,o,a]);return e.jsxs(e.Fragment,{children:[e.jsx(me,{value:l,onKeyUp:b,onChange:g,placeholder:"Type a message",disabled:t,startAdornment:e.jsx(v,{children:e.jsx(x,{icon:"eva:smiling-face-fill"})}),endAdornment:e.jsxs(u,{direction:"row",sx:{flexShrink:0},children:[e.jsx(v,{onClick:f,children:e.jsx(x,{icon:"solar:gallery-add-bold"})}),e.jsx(v,{onClick:f,children:e.jsx(x,{icon:"eva:attach-2-fill"})}),e.jsx(v,{children:e.jsx(x,{icon:"solar:microphone-bold"})})]}),sx:{px:1,height:56,flexShrink:0,borderTop:y=>`solid 1px ${y.palette.divider}`}}),e.jsx("input",{type:"file",ref:i,style:{display:"none"}})]})}Ee.propTypes={disabled:m.bool,onAddRecipients:m.func,recipients:m.array,selectedConversationId:m.string};function Pe({participants:s}){const r=s.length>1,t=s[0],a=e.jsx(be,{max:3,sx:{[`& .${as.avatar}`]:{width:32,height:32}},children:s.map(n=>e.jsx(I,{alt:n.name,src:n.avatarUrl},n.id))}),o=e.jsxs(u,{flexGrow:1,direction:"row",alignItems:"center",spacing:2,children:[e.jsx(O,{variant:t.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(I,{src:t.avatarUrl,alt:t.name})}),e.jsx(P,{primary:t.name,secondary:t.status==="offline"?is(t.lastActivity):t.status,secondaryTypographyProps:{component:"span",...t.status!=="offline"&&{textTransform:"capitalize"}}})]});return e.jsxs(e.Fragment,{children:[r?a:o,e.jsx(u,{flexGrow:1}),e.jsx(v,{children:e.jsx(x,{icon:"solar:phone-bold"})}),e.jsx(v,{children:e.jsx(x,{icon:"solar:videocamera-record-bold"})}),e.jsx(v,{children:e.jsx(x,{icon:"eva:more-vertical-fill"})})]})}Pe.propTypes={participants:m.array};function _e({contacts:s,onAddRecipients:r}){const[t,a]=c.useState(""),o=c.useCallback(n=>{a(""),r(n)},[r]);return e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),e.jsx(vs,{sx:{minWidth:320},multiple:!0,limitTags:3,popupIcon:null,disableCloseOnSelect:!0,noOptionsText:e.jsx(ge,{query:t}),onChange:(n,i)=>o(i),onInputChange:(n,i)=>a(i),options:s,getOptionLabel:n=>n.name,isOptionEqualToValue:(n,i)=>n.id===i.id,renderInput:n=>e.jsx(ye,{...n,placeholder:"+ Recipients"}),renderOption:(n,i,{selected:l})=>c.createElement("li",{...n,key:i.id},e.jsxs(A,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(I,{alt:i.name,src:i.avatarUrl,sx:{width:1,height:1}}),e.jsx(u,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:p=>N(p.palette.grey[900],.8),transition:p=>p.transitions.create(["opacity"],{easing:p.transitions.easing.easeInOut,duration:p.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}},children:e.jsx(x,{icon:"eva:checkmark-fill"})})]},i.id),i.name),renderTags:(n,i)=>n.map((l,p)=>c.createElement(bs,{...i({index:p}),key:l.id,label:l.name,avatar:e.jsx(I,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}_e.propTypes={contacts:m.array,onAddRecipients:m.func};function it(){const s=V(),{user:r}=_(),t=ls(),o=hs().get("id")||"",[n,i]=c.useState([]),{contacts:l}=Fs(),{conversations:p,conversationsLoading:d}=zs(),{conversation:h,conversationError:j}=$s(`${o}`),f=h?h.participants.filter(C=>C.id!==r.id):[];c.useEffect(()=>{(j||!o)&&s.push(E.dashboard.chat)},[j,s,o]);const g=c.useCallback(C=>{i(C)},[]),b=!!h,y=e.jsx(u,{direction:"row",alignItems:"center",flexShrink:0,sx:{pr:1,pl:2.5,py:1,minHeight:72},children:o?e.jsx(e.Fragment,{children:b&&e.jsx(Pe,{participants:f})}):e.jsx(_e,{contacts:l,onAddRecipients:g})}),k=e.jsx(Ie,{contacts:l,conversations:p,loading:d,selectedConversationId:o}),R=e.jsxs(u,{sx:{width:1,height:1,overflow:"hidden"},children:[e.jsx(Ue,{messages:h==null?void 0:h.messages,participants:f}),e.jsx(Ee,{recipients:n,onAddRecipients:g,selectedConversationId:o,disabled:!n.length&&!o})]});return e.jsxs(cs,{maxWidth:t.themeStretch?!1:"xl",children:[e.jsx(T,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Chat"}),e.jsxs(u,{component:ys,direction:"row",sx:{height:"72vh"},children:[k,e.jsxs(u,{sx:{width:1,height:1,overflow:"hidden"},children:[y,e.jsxs(u,{direction:"row",sx:{width:1,height:1,overflow:"hidden",borderTop:C=>`solid 1px ${C.palette.divider}`},children:[R,b&&e.jsx(Oe,{conversation:h,participants:f})]})]})]})]})}function It(){return e.jsxs(e.Fragment,{children:[e.jsx(ds,{children:e.jsx("title",{children:" Dashboard: Chat"})}),e.jsx(it,{})]})}export{It as default};
