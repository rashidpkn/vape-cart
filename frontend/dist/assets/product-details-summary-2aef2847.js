import{aS as oe,aF as ne,F as i,an as q,j as e,B as g,as as D,S as o,bk as ce,dk as le,dl as de,bT as ue,aw as pe,al as b,T as y,ak as E,aC as xe,ao as me}from"./index-0af1dce8.js";import{u as he,F as ge}from"./form-provider-963ee2fc.js";import{p as be}from"./product-details-description-16ed88ad.js";import{R as ye}from"./Rating-fdc10d61.js";function Pe({cart:p,product:x,onAddCart:d,onGotoStep:T,disabledActions:V,setProduct:A,...B}){var I;const L=oe(),N=ne(),{id:f,name:a,regularPrice:O,quantity:$,salePrice:u,totalRatings:z,totalReviews:G,subDescription:j,images:Q,userId:m,type:h,productGroup:w,variables:S}=x,[P,W]=i.useState([]),M=async()=>{if(h==="Variable"&&w==="parent"){const{data:s}=await xe.get("/products",{params:{perPage:2e3}});W(s.products)}};i.useEffect(()=>{M()},[]);const H=(I=p==null?void 0:p.map(s=>s.id))==null?void 0:I.includes(f),v={id:f,name:a,quantity:1,price:u,images:Q},k=he({defaultValues:v}),{reset:J,watch:K,handleSubmit:U}=k,n=K();i.useEffect(()=>{x&&J(v)},[x]);const X=U(async s=>{try{H||d({...s,colors:[n.colors],subTotal:s.price*s.quantity,userId:m}),T(0),L.push(q.product.checkout)}catch(r){console.error(r)}}),Y=i.useCallback(()=>{try{d({...n,subTotal:n.price,userId:m}),console.log(n)}catch(s){console.error(s)}},[d,n]),Z=e.jsxs(g,{sx:{typography:"h5"},children:[u&&e.jsx(g,{component:"span",sx:{color:"text.disabled",textDecoration:"line-through",mr:.5},children:D(O)}),D(u)]}),_=e.jsxs(o,{direction:"row",children:[e.jsx(y,{variant:"subtitle2",sx:{flexGrow:1},children:"Quantity"}),e.jsx(o,{spacing:1,children:e.jsxs(y,{variant:"caption",component:"div",sx:{textAlign:"right"},children:["Available: ",$]})})]}),ee=e.jsxs(o,{direction:"row",spacing:2,children:[e.jsx(b,{fullWidth:!0,size:"large",color:"warning",variant:"contained",startIcon:e.jsx(me,{icon:"solar:cart-plus-bold",width:24}),onClick:Y,sx:{whiteSpace:"nowrap"},children:"Add to Cart"}),e.jsx(b,{fullWidth:!0,size:"large",type:"submit",variant:"contained",disabled:V,children:"Buy Now"})]}),se=!!j&&be(j),te=e.jsxs(o,{direction:"row",alignItems:"center",sx:{color:"text.disabled",typography:"body2"},children:[e.jsx(ye,{size:"small",value:z,precision:.1,readOnly:!0,sx:{mr:1}}),`(${ce(G)} reviews)`]}),[c,re]=i.useState({}),[C,F]=i.useState("");i.useEffect(()=>{F("");let s=a==null?void 0:a.split(" -")[0];Object.keys(c).map(t=>s=`${s} - ${c[t]}`);const r=P.find(t=>t.name.toLowerCase().includes(s.toLowerCase()));r&&A(t=>({...t,name:r.name,images:r.images,quantity:r.quantity,salePrice:r.salePrice,regularPrice:r.regularPrice}))},[c]);const ae=h==="Variable"&&w==="parent"&&e.jsxs(g,{display:"flex",flexDirection:"column",gap:"10px",children:[Object.keys(S).map((s,r)=>e.jsxs(le,{sx:{width:"50%"},size:"small",children:[e.jsx(de,{id:"demo-simple-select-label",children:s}),e.jsx(ue,{label:s,onChange:t=>{re(l=>({...l,[s]:t.target.value}))},children:S[s].map((t,l)=>e.jsx(pe,{value:t,children:t},l))},r)]},r)),e.jsx(b,{sx:{width:"50%"},variant:"contained",color:"success",disabled:!a.split("-")[1],onClick:()=>{let s=a==null?void 0:a.split(" -")[0];Object.keys(c).map(t=>s=`${s} - ${c[t]}`);const r=P.find(t=>t.name.toLowerCase().includes(s.toLowerCase()));if(r){const{id:t,name:l,salePrice:R,images:ie}=r;d({id:t,name:l,price:R,images:ie,subTotal:R,userId:m,quantity:1}),N(q.product.checkout)}else F("Out of stock")},children:"Buy"}),!!C&&e.jsx("p",{style:{color:"#F00A"},children:C})]});return e.jsx(ge,{methods:k,onSubmit:X,children:e.jsxs(o,{spacing:3,sx:{pt:3},...B,children:[e.jsxs(o,{spacing:2,alignItems:"flex-start",children:[e.jsx(y,{variant:"h5",children:a}),te,u!==null&&Z,se]}),ae,e.jsx(E,{sx:{borderStyle:"dashed"}}),_,e.jsx(E,{sx:{borderStyle:"dashed"}}),h==="Simple"&&ee]})})}export{Pe as P};
