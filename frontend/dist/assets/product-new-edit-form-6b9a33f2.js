import{H as l,j as e,aX as we,aY as Be,aF as Ie,b as F,aS as Te,aZ as Re,a_ as qe,ar as be,ao as De,aB as p,T as x,ah as _,S as E,a$ as U,B as C,b0 as Ne,b1 as Ee,b2 as ze,b3 as ne,b4 as Ue,b5 as re,a as z,b6 as $e,b7 as Le,b8 as u,b9 as Oe,ba as pe,aj as Ke,bb as _e,as as je,at as c,al as Ve}from"./index-c2b1ffda.js";import{c as Ye,a as A,b as le,d as Ge,e as oe,f as He,u as Me,R as V,g as Qe,h as Xe,i as Z,j as ue,k as Ze,l as fe,F as Je}from"./form-provider-117db9d8.js";import{o as We,L as Pe}from"./yup-e23feb4a.js";import{C as J}from"./CardHeader-2fc85f12.js";import{F as I,R as W}from"./Radio-e4643b83.js";let he=!1;const xe=l.forwardRef(function(r,T){return he||(console.warn(["MUI: The Autocomplete component was moved from the lab to the core.","","You should use `import { Autocomplete } from '@mui/material'`","or `import Autocomplete from '@mui/material/Autocomplete'`"].join(`
`)),he=!0),e.jsx(we,Be({ref:T},r))});function ns({currentProduct:a}){const r=Ie(),[T,Y]=l.useState(!1),[G,P]=l.useState([]);l.useEffect(()=>{F.get("/attributes").then(s=>{P(s.data)})},[]);const v=Te(),g=Re("up","md"),{enqueueSnackbar:ce}=qe(),{user:b}=be(),$=Ye().shape({name:A().required("Name is required"),subDescription:A().required("Short description is required").test("not-four-digits","Your content contain continues 7 digit number, Please remove",s=>!/\d{7,}/.test(s)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',s=>!/@/.test(s)),content:A().test("not-four-digits","Your content contain continues 7 digit number, Please remove",s=>!/\d{7,}/.test(s)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',s=>!/@/.test(s)),images:le().min(1,"Image is required"),type:A(),category:A().required("Category is required"),tags:le(),SKU:A().required("SKU is required"),brand:A().required("brand is required"),status:A().required("brand is required"),attributes:le(),track:Ge(),quantity:oe(),regularPrice:oe().moreThan(0,"Price should not be AED 0.00"),salePrice:oe().lessThan(He("regularPrice"),"Sale price must be less than the regular price")}),R=l.useMemo(()=>({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",subDescription:(a==null?void 0:a.subDescription)||"",content:(a==null?void 0:a.content)||"",images:(a==null?void 0:a.images)||[],type:(a==null?void 0:a.type)||"Simple",category:(a==null?void 0:a.category)||"Disposables",tags:(a==null?void 0:a.tags)||[],SKU:(a==null?void 0:a.SKU)||"",brand:(a==null?void 0:a.brand)||"SMOK",status:(a==null?void 0:a.status)||"Published",attributes:(a==null?void 0:a.attributes)||[],track:(a==null?void 0:a.track)||!0,quantity:(a==null?void 0:a.quantity)||0,regularPrice:(a==null?void 0:a.regularPrice)||0,salePrice:(a==null?void 0:a.salePrice)||0}),[a]),[h,w]=l.useState({}),[f,B]=l.useState([]),H=Me({resolver:We($),defaultValues:R}),{reset:L,watch:q,setValue:d,handleSubmit:D,formState:{isSubmitting:O,isValid:N}}=H,o=q(),[y,K]=l.useState([]),ee=l.useCallback(async()=>{const{data:s}=await F.get("/products",{params:{name:o.name,productGroup:"parent"}});K(s.products.filter(t=>!t.name.includes("-")))},[o.name]);l.useEffect(()=>{ee()},[o.name]),l.useEffect(()=>{a&&L(R)},[a,R,L]);const se=D(async s=>{try{a?await F.patch("products",{...s,username:b.displayName,userId:b.id,storeName:b.storeName}):await F.post("products",{...s,username:b.displayName,userId:b.id,storeName:b.storeName}),L(),ce(a?"Update success!":"Create success!"),v.push(De.dashboard.product.root)}catch(t){console.log(t)}}),ae=l.useCallback(s=>{const t=o.images||[],i=s.map(n=>Object.assign(n,{preview:URL.createObjectURL(n)}));d("images",[...t,...i],{shouldValidate:!0})},[d,o.images]),te=l.useCallback(s=>{var i;const t=o.images&&((i=o.images)==null?void 0:i.filter(n=>n!==s));d("images",t)},[d,o.images]),m=l.useCallback(()=>{d("images",[])},[d]),k=e.jsxs(e.Fragment,{children:[g&&e.jsxs(p,{md:4,children:[e.jsx(x,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(x,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(_,{children:[!g&&e.jsx(J,{title:"Details"}),e.jsxs(E,{spacing:3,sx:{p:3},children:[e.jsx(xe,{value:o.name,onChange:(s,t)=>{if(t){const i=y.find(n=>n.name===t);i&&(d("images",i.images),d("name",i.name),d("category",i.category),d("brand",i.brand),d("type",i.type))}else d("images",null)},name:"name",label:"Product Name",options:y.map(s=>s.name),getOptionLabel:s=>s,isOptionEqualToValue:(s,t)=>s===t.value,renderInput:s=>e.jsx(U,{...s,label:"Product Name",value:o.name,onChange:t=>d("name",t.target.value)}),renderOption:(s,t)=>e.jsxs(C,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...s,children:[e.jsx("img",{loading:"lazy",width:"20",src:y.find(i=>i.name===t).images[0],alt:""}),t]}),freeSolo:!0}),e.jsx(V,{name:"subDescription",label:"Sub Description",multiline:!0,rows:4}),e.jsxs(E,{spacing:1.5,children:[e.jsx(x,{variant:"subtitle2",children:"Content"}),e.jsx(Qe,{simple:!0,name:"content"})]}),e.jsxs(E,{spacing:1.5,children:[e.jsx(x,{variant:"subtitle2",children:"Images"}),e.jsx(Xe,{multiple:!0,name:"images",maxSize:3145728,onDrop:ae,onRemove:te,onRemoveAll:m,onUpload:async s=>{try{const t=new FormData;o.images.forEach(n=>{t.append("images",n)});const{data:i}=await F.post("upload",t);d("images",i),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})]})]})]})})]}),[j,M]=l.useState({name:"",show:!1}),ye=e.jsxs(e.Fragment,{children:[g&&e.jsxs(p,{md:4,children:[e.jsx(x,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(x,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(_,{children:[!g&&e.jsx(J,{title:"Properties"}),e.jsx(E,{spacing:3,sx:{p:3},children:e.jsxs(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(Z,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:Ne.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(Z,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:Ee.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(ue,{name:"tags",label:"Tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:ze.map(s=>s),getOptionLabel:s=>s,renderOption:(s,t)=>l.createElement("li",{...s,key:t},t),renderTags:(s,t)=>s.map((i,n)=>l.createElement(ne,{...t({index:n}),key:i,label:i,size:"small",color:"info",variant:"soft"}))}),e.jsx(V,{name:"SKU",label:"Product SKU"}),e.jsx(Z,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:Ue.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(C,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(I,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(re,{checked:j.show,onChange:s=>M(t=>({...t,show:s.target.checked}))})}),j.show&&e.jsxs(e.Fragment,{children:[e.jsx(U,{label:"Brand Name",style:{width:300},onChange:s=>M(t=>({...t,name:s.target.value})),value:j.name}),e.jsx(z,{variant:"contained",color:"success",onClick:async()=>{try{j.name?(await F.post("/notifications",{userId:b.id,role:"admin",title:"🚀 New Brand Approval Request! 🚀",message:`Exciting news! A new brand has been submitted for approval. Brand Name: ${j.name}. 🛍️`,type:"product"}),alert("Your request to create a new brand is being processed. Please wait while we verify the brand.")):alert("Please enter brand name")}catch{alert("An error occurred while adding this brand.")}},children:"Add Brand"})]})]}),e.jsx(Z,{native:!0,name:"status",label:"status",InputLabelProps:{shrink:!0},children:$e.map(s=>e.jsx("option",{value:s,children:s},s))})]})})]})})]}),Se=(s,t,i)=>{if(o.type==="Variable"||o.type==="Simple"&&i==="Flavour"){w(X=>({...X,[i]:t}));const n=i==="Bottle Size"&&u.bottleSize||i==="Puffs"&&u.puffs||i==="Flavour"&&u.flavour||i==="Nicotine Strength"&&u.nicotineStrength||i==="Color"&&u.color||i==="Batteries"&&u.batteries||[],S=t[t.length-1];if(!S)return;n.find(X=>X===S)||(console.log("upload"),F.post("/attributes",{username:b.displayName,attribute:i,value:S}).then(X=>{console.log("updated")}))}else{const n=t[t.length-1];console.log({...h,[i]:[n]}),w(S=>({...S,[i]:[n]}))}};console.log(h),console.log(f);const Fe=e.jsxs(e.Fragment,{children:[g&&e.jsxs(p,{md:4,children:[e.jsx(x,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(x,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(_,{children:[!g&&e.jsx(J,{title:"Attributes"}),e.jsx(E,{spacing:3,sx:{p:3},children:e.jsxs(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(C,{sx:{gridColumn:"span 2 "},children:e.jsx(ue,{name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:Le.map(s=>s),getOptionLabel:s=>s,renderOption:(s,t)=>l.createElement("li",{...s,key:t},t),renderTags:(s,t)=>s.map((i,n)=>l.createElement(ne,{...t({index:n}),key:i,label:i,size:"small",color:"info",variant:"soft"}))})}),o.attributes.map(s=>e.jsxs(C,{sx:{gridColumn:"span 1 "},children:[e.jsx(xe,{multiple:!0,freeSolo:!0,options:[...s==="Bottle Size"?u.bottleSize:[],...s==="Puffs"?u.puffs:[],...s==="Flavour"?u.flavour:[],...s==="Nicotine Strength"?u.nicotineStrength:[],...s==="Color"?u.color:[],...s==="Batteries"?u.batteries:[],...G.filter(t=>t.attribute===s).map(t=>t.value)],value:h[s]||[],onChange:(t,i)=>{Se(t,i,s),o.type==="Simple"&&(s==="Flavour"?i.length>=2?f.find(n=>n===s)||B(n=>[...n,s]):B(n=>n.filter(S=>S!==s)):B([s]))},renderInput:t=>e.jsx(U,{...t,label:s,placeholder:s}),renderTags:(t,i)=>t.map((n,S)=>l.createElement(ne,{...i({index:S}),key:n,label:n,size:"small",color:"info",variant:"soft"}))}),o.type==="Variable"&&e.jsx(I,{label:"Use this attribute to create Variations",control:e.jsx(re,{onChange:t=>{t.target.checked?B(i=>[...new Set([...i,s])]):B(i=>[...new Set(i.filter(n=>n!==s))])}})})]},s))]})})]})})]}),ve=e.jsxs(e.Fragment,{children:[g&&e.jsxs(p,{md:4,children:[e.jsx(x,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(x,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(_,{children:[!g&&e.jsx(J,{title:"Pricing"}),e.jsxs(E,{spacing:3,sx:{p:3},children:[e.jsx(Ze,{name:"track",label:"Track"}),o.track&&e.jsx(V,{name:"quantity",label:"Quantity",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0}}),!o.track&&e.jsx(Oe,{children:e.jsxs(fe,{defaultValue:"Instock",row:!0,children:[e.jsx(I,{d:!0,value:"Instock",control:e.jsx(W,{defaultChecked:!0}),label:"Instock"}),e.jsx(I,{value:"Outstock",control:e.jsx(W,{}),label:"Outstock"})]})}),e.jsx(V,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(pe,{position:"start",children:e.jsx(C,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx(V,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(pe,{position:"start",children:e.jsx(C,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})]})})]}),ke=e.jsx(e.Fragment,{children:e.jsx(p,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:e.jsx(Pe,{type:"submit",variant:"contained",size:"large",loading:O,children:a?"Save Changes":"Create Product"})})}),Ce=e.jsx(e.Fragment,{children:e.jsx(p,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:e.jsx(z,{variant:"contained",size:"large",onClick:()=>{r("/dashboard/product")},children:"Save Product"})})}),ie=["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],de=[...ie,...ie.slice(1).flatMap(s=>ie.slice(1).map(t=>s+t))];let Q=1,me=0;const Ae=e.jsxs(e.Fragment,{children:[g&&e.jsx(p,{md:4,children:e.jsx(x,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(p,{xs:12,md:12,children:e.jsx(_,{children:e.jsxs(Ke,{children:[e.jsx(_e,{children:e.jsxs(je,{children:[e.jsx(c,{children:"ID"}),e.jsx(c,{width:150,children:"SKU"}),e.jsx(c,{width:250,children:"Attributes"}),e.jsx(c,{width:150,children:"Track Stock"}),e.jsx(c,{children:"Stock"}),e.jsx(c,{children:"Regular Price"}),e.jsx(c,{children:"Sales Price"}),e.jsx(c,{children:"Image"}),e.jsx(c,{width:200,children:"Add Product"})]})}),e.jsxs(Ve,{children:[e.jsx(ge,{counter:Q++,counter2:me++,skuAlpha:de,va:"Parent",values:o,variables:h,disabled:!0,isSubmitting:O,isValid:N,setProductAdded:()=>{}},Q),f.reduce((s,t)=>s.flatMap(i=>h[t].map(n=>`${i} - ${n}`)),[""]).map(s=>e.jsx(ge,{counter:Q++,counter2:me++,skuAlpha:de,va:s.slice(3),values:o,variables:h,disabled:!1,isSubmitting:O,isValid:N,setProductAdded:Y},Q))]})]})})})]});return e.jsx(Je,{methods:H,onSubmit:se,children:e.jsxs(p,{container:!0,spacing:3,children:[k,ye,Fe,o.type==="Simple"&&ve,o.type==="Variable"&&Ae,o.type==="Simple"&&ke,o.type==="Variable"&&T&&Ce]})})}function ge({counter:a,values:r,skuAlpha:T,counter2:Y,va:G,variables:P,disabled:v,isSubmitting:g,isValid:ce,setProductAdded:b}){const{user:$}=be(),R=T[Y]?`${r.SKU}-${T[Y]}`:r.SKU;let{name:h}=r;const w=G==="Parent";w||(h=`${r.name} - ${G}`);const[f,B]=l.useState(!0),[H,L]=l.useState("instock"),[q,d]=l.useState(null),[D,O]=l.useState(null),[N,o]=l.useState(null),[y,K]=l.useState("pending"),[ee,se]=l.useState(null),ae=async m=>{try{const k=new FormData;k.append("images",m.target.files[0]);const{data:j}=await F.post("upload",k);se([j[0],...r.images])}catch{}},te=async()=>{const m=/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{2B50}\u{2B55}\u{231A}-\u{231B}\u{23E9}-\u{23EC}\u{23F0}\u{23F3}\u{25AA}-\u{25AB}\u{25B6}\u{25C0}\u{25FB}-\u{25FE}\u{2B1B}-\u{2B1C}\u{2934}-\u{2935}\u{2B05}-\u{2B07}\u{2194}-\u{2199}\u{21A9}-\u{21AA}\u{2B06}\u{2B07}\u{2B1B}\u{2B1C}]/u,k=/\d{7,}/,j=/@/;if(m.test(r.subDescription)||m.test(r.content)){alert("Your content contain emojis, Please remove emojis");return}if(k.test(r.subDescription)||k.test(r.content)){alert("Your content contain continues 7 digit number, Please remove");return}if(j.test(r.subDescription)||j.test(r.content)){alert('Your content contains the "@" symbol. Please remove it.');return}if(!w){if(!N&&f)return alert("Quantity is required.");if(!q)return alert("Regular price is required.");if(D&&q<=D)return alert("Sale price must be less than the regular price")}if(y==="pending"){K("loading");try{await F.post("/products",{username:$.displayName,userId:$.id,storeName:$.storeName,name:h,subDescription:r.subDescription,content:r.content,images:ee??r.images,type:r.type,category:r.category,tags:r.tags,parentSku:r.SKU,brand:r.brand,status:r.status,attributes:r.attributes,variables:P,SKU:R,track:f,quantity:N,regularPrice:q,salePrice:D,productGroup:w?"parent":"child"}),K("success"),b(!0)}catch(M){console.log(`Product Creation failed :${M}`),K("failed")}}};return e.jsxs(je,{style:{backgroundColor:v&&"rgba(0,0,0,0.1)"},children:[e.jsx(c,{children:a}),e.jsx(c,{children:R}),e.jsx(c,{children:w?`${h} - Parent`:h}),e.jsx(c,{children:e.jsx(I,{label:"",control:e.jsx(re,{checked:f,onChange:m=>B(m.target.checked),disabled:v})})}),e.jsxs(c,{width:150,children:[f&&e.jsx(U,{inputProps:{min:0},disabled:v,size:"small",label:"Quantity",type:"number",onChange:m=>o(+m.target.value||null),value:N}),!f&&e.jsxs(fe,{"aria-label":"Stock",name:"Stock",value:H,onChange:m=>L(m.target.value),children:[e.jsx(I,{value:"instock",control:e.jsx(W,{}),label:"Instock"}),e.jsx(I,{value:"outstock",control:e.jsx(W,{}),label:"Outstock"})]})]}),e.jsx(c,{width:150,children:e.jsx(U,{inputProps:{min:0},disabled:v,size:"small",label:"Price",type:"number",onChange:m=>d(+m.target.value||null),value:q})}),e.jsx(c,{width:150,children:e.jsx(U,{inputProps:{min:0},disabled:v,size:"small",label:"Price",type:"number",onChange:m=>O(+m.target.value||null),value:D})}),e.jsx(c,{width:150,children:e.jsx("input",{size:"small",label:"Image",type:"file",onChange:ae,disabled:v,style:{width:"150px"}})}),e.jsxs(c,{children:[y==="pending"&&e.jsx(z,{color:"success",variant:"contained",size:"small",onClick:te,type:"submit",children:"Add Product"}),y==="loading"&&e.jsx(z,{color:"success",variant:"contained",size:"small",children:"Loading"}),y==="success"&&e.jsx(z,{color:"success",variant:"contained",size:"small",children:"Product Created"}),y==="failed"&&e.jsx(z,{color:"success",variant:"contained",size:"small",children:"Product creation failed"})]})]})}export{ns as P};
