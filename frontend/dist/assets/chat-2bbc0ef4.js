import{bX as Ae,dC as Y,bW as ee,eJ as Ie,D as c,aw as d,bg as Le,a8 as e,aD as P,aB as S,bh as Me,a9 as p,aZ as O,bz as Pe,aF as m,ah as h,av as Fe,aG as _,eK as Oe,bT as se,bu as z,ac as y,bP as ne,aT as M,a6 as oe,be as G,a5 as te,ag as F,aM as De,ad as T,b8 as D,aS as re,eL as Ee,eM as Ne,eN as _e,ba as Ue,ao as k,aP as W,dc as ae,dL as $e,bw as Ve,eO as ze,eP as Ge,cE as We,bv as Be,ax as qe,aj as He,aH as Ke}from"./index-26f85d8d.js";import{u as Je}from"./use-search-params-3df72157.js";import{_ as Xe}from"./_baseEach-637edbea.js";import{u as B}from"./index-ee4ad988.js";import{f as q,l as V,n as Ze,e as I}from"./axios-0b97a480.js";import{S as Qe}from"./Select-68f8666e.js";import{S as U}from"./Skeleton-dcfa4372.js";import{C as Ye}from"./ClickAwayListener-21e462a8.js";import{T as ie}from"./TextField-6705370b.js";import{D as es}from"./DialogContent-fff5aa70.js";import{u as ss,L as ns}from"./lightbox-3ed2bd5c.js";import{A as os}from"./AvatarGroup-e2245969.js";import{A as ts}from"./Autocomplete-3b44a497.js";import{M as rs}from"./Chip-5f4632f5.js";import{C as as}from"./Card-c4857d5e.js";import"./Menu-7ffb15b5.js";import"./FormControl-9356bb88.js";import"./FormLabel-d4caaf84.js";import"./Close-f740feb0.js";function is(s,n,t,r){for(var a=-1,o=s==null?0:s.length;++a<o;){var i=s[a];n(r,i,t(i),s)}return r}var ls=is,cs=Xe;function ds(s,n,t,r){return cs(s,function(a,o,i){n(r,a,t(a),i)}),r}var hs=ds,ps=ls,xs=hs,us=Ae,gs=Y;function ms(s,n){return function(t,r){var a=gs(t)?ps:xs,o=n?n():{};return a(t,s,us(r),o)}}var fs=ms,js=Ie,bs=fs,vs=bs(function(s,n,t){js(s,t,n)}),ys=vs;const Cs=ee(ys),H={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function ws(){const s=[I.chat,{params:{endpoint:"contacts"}}],{data:n,isLoading:t,error:r,isValidating:a}=B(s,q,H);return c.useMemo(()=>({contacts:(n==null?void 0:n.contacts)||[],contactsLoading:t,contactsError:r,contactsValidating:a,contactsEmpty:!t&&!(n!=null&&n.contacts.length)}),[n==null?void 0:n.contacts,r,t,a])}function ks(){const s=[I.chat,{params:{endpoint:"conversations"}}],{data:n,isLoading:t,error:r,isValidating:a}=B(s,q,H);return c.useMemo(()=>{const i=Cs(n==null?void 0:n.conversations,"id")||{},l=Object.keys(i)||[];return{conversations:{byId:i,allIds:l},conversationsLoading:t,conversationsError:r,conversationsValidating:a,conversationsEmpty:!t&&!l.length}},[n==null?void 0:n.conversations,r,t,a])}function Ss(s){const n=s?[I.chat,{params:{conversationId:s,endpoint:"conversation"}}]:null,{data:t,isLoading:r,error:a,isValidating:o}=B(n,q,H);return c.useMemo(()=>({conversation:t==null?void 0:t.conversation,conversationLoading:r,conversationError:a,conversationValidating:o}),[t==null?void 0:t.conversation,a,r,o])}async function Ts(s,n){const t=[I.chat,{params:{endpoint:"conversations"}}],r=[I.chat,{params:{conversationId:s,endpoint:"conversation"}}];V(r,a=>{const{conversation:o}=a;return{conversation:{...o,messages:[...o.messages,n]}}},!1),V(t,a=>{const{conversations:o}=a;return{conversations:o.map(l=>l.id===s?{...l,messages:[...l.messages,n]}:l)}},!1)}async function Rs(s){const n=[I.chat,{params:{endpoint:"conversations"}}],t={conversationData:s},r=await Ze.post(I.chat,t);return V(n,a=>{const o=[...a.conversations,s];return{...a,conversations:o}},!1),r.data}function le(){const[s,n]=c.useState(!1),[t,r]=c.useState(!1),a=c.useCallback(()=>{r(x=>!x)},[]),o=c.useCallback(()=>{r(!1)},[]),i=c.useCallback(()=>{n(!0)},[]),l=c.useCallback(()=>{n(!1)},[]);return{openMobile:s,collapseDesktop:t,onOpenMobile:i,onCloseMobile:l,onCloseDesktop:o,onCollapseDesktop:a}}function As(s){const n=c.useRef(null),t=c.useCallback(()=>{s&&n.current&&n.current&&(n.current.scrollTop=n.current.scrollHeight)},[s]);return c.useEffect(()=>{t()},[s]),{messagesEndRef:n}}d.bool,d.object,d.func,d.bool;function Is(){const{user:s}=z(),n=Le(),[t,r]=c.useState("online"),a=c.useCallback(o=>{r(o.target.value)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:t,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(S,{src:s==null?void 0:s.photoURL,alt:s==null?void 0:s.displayName,onClick:n.onOpen,sx:{cursor:"pointer",width:48,height:48}})}),e.jsxs(Me,{open:n.open,onClose:n.onClose,arrow:"top-left",sx:{p:0},children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:2,sx:{py:2,pr:1,pl:2.5},children:[e.jsx(O,{primary:s==null?void 0:s.displayName,secondary:s==null?void 0:s.email,secondaryTypographyProps:{component:"span"}}),e.jsx(Pe,{title:"Log out",children:e.jsx(m,{color:"error",children:e.jsx(h,{icon:"ic:round-power-settings-new"})})})]}),e.jsx(Fe,{sx:{borderStyle:"dashed"}}),e.jsxs(p,{sx:{p:1},children:[e.jsxs(_,{children:[e.jsx(P,{variant:t,sx:{[`& .${Oe.badge}`]:{position:"static",m:.75,width:12,height:12,flexShrink:0}}}),e.jsx(Qe,{native:!0,fullWidth:!0,value:t,onChange:a,input:e.jsx(se,{sx:{pl:2}}),inputProps:{sx:{textTransform:"capitalize"}},children:["online","alway","busy","offline"].map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs(_,{children:[e.jsx(h,{icon:"solar:user-id-bold",width:24}),"Profile"]}),e.jsxs(_,{children:[e.jsx(h,{icon:"eva:settings-2-fill",width:24}),"Settings"]})]})]})]})}function ce({sx:s,...n}){return e.jsxs(p,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...s},...n,children:[e.jsx(U,{variant:"circular",sx:{width:48,height:48}}),e.jsxs(p,{spacing:1,flexGrow:1,children:[e.jsx(U,{sx:{width:.75,height:10}}),e.jsx(U,{sx:{width:.5,height:10}})]})]})}ce.propTypes={sx:d.object};function de({query:s,results:n,onClickResult:t}){const r=n.length,a=!r&&!!s;return e.jsxs(e.Fragment,{children:[e.jsxs(y,{paragraph:!0,variant:"h6",sx:{px:2.5},children:["Contacts (",r,")"]}),a?e.jsx(ne,{query:s,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}):e.jsx(e.Fragment,{children:n.map(o=>e.jsxs(M,{onClick:()=>t(o),sx:{px:2.5,py:1.5,typography:"subtitle2"},children:[e.jsx(S,{alt:o.name,src:o.avatarUrl,sx:{mr:2}}),o.name]},o.id))})]})}de.propTypes={query:d.string,results:d.array,onClickResult:d.func};const J=320,Ls=96;function he({loading:s,contacts:n,conversations:t,selectedConversationId:r}){const a=oe(),o=G(),i=te("up","md"),{collapseDesktop:l,onCloseDesktop:x,onCollapseDesktop:u,openMobile:g,onOpenMobile:C,onCloseMobile:f}=le(),[j,v]=c.useState({query:"",results:[]});c.useEffect(()=>{i||x()},[x,i]);const b=c.useCallback(()=>{i?u():f()},[i,f,u]),A=c.useCallback(()=>{i||f(),o.push(F.dashboard.chat)},[i,f,o]),E=c.useCallback(R=>{if(v(L=>({...L,query:R})),R){const L=n.filter(N=>N.name.toLowerCase().includes(R));v(N=>({...N,results:L}))}},[n]),w=c.useCallback(()=>{v({query:"",results:[]})},[]),Ce=c.useCallback(R=>{w(),o.push(`${F.dashboard.chat}?id=${R.id}`)},[w,o]),we=e.jsx(m,{onClick:C,sx:{left:0,top:84,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",bgcolor:a.palette.primary.main,boxShadow:a.customShadows.primary,color:a.palette.primary.contrastText,"&:hover":{bgcolor:a.palette.primary.darker}},children:e.jsx(h,{width:16,icon:"solar:users-group-rounded-bold"})}),ke=e.jsx(e.Fragment,{children:[...Array(12)].map((R,L)=>e.jsx(ce,{},L))}),Se=e.jsx(e.Fragment,{}),Te=e.jsx(de,{query:j.query,results:j.results,onClickResult:Ce}),Re=e.jsx(Ye,{onClickAway:w,children:e.jsx(ie,{fullWidth:!0,value:j.query,onChange:R=>E(R.target.value),placeholder:"Search contacts...",InputProps:{startAdornment:e.jsx(De,{position:"start",children:e.jsx(h,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{mt:2.5}})}),K=e.jsxs(e.Fragment,{children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,pb:0},children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(Is,{}),e.jsx(T,{sx:{flexGrow:1}})]}),e.jsx(m,{onClick:b,children:e.jsx(h,{icon:l?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!l&&e.jsx(m,{onClick:A,children:e.jsx(h,{width:24,icon:"solar:user-plus-bold"})})]}),e.jsx(T,{sx:{p:2.5,pt:0},children:!l&&Re}),e.jsxs(D,{sx:{pb:1},children:[j.query&&Te,s&&ke,!j.query&&!!t.allIds.length&&Se]})]});return e.jsxs(e.Fragment,{children:[!i&&we,i?e.jsx(p,{sx:{height:1,flexShrink:0,width:J,borderRight:`solid 1px ${a.palette.divider}`,transition:a.transitions.create(["width"],{duration:a.transitions.duration.shorter}),...l&&{width:Ls}},children:K}):e.jsx(re,{open:g,onClose:f,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:J}},children:K})]})}he.propTypes={contacts:d.array,conversations:d.object,loading:d.bool,selectedConversationId:d.string};var X=Ee,Ms=Ne,Ps=Y,Z=X?X.isConcatSpreadable:void 0;function Fs(s){return Ps(s)||Ms(s)||!!(Z&&s&&s[Z])}var Os=Fs,Ds=_e,Es=Os;function pe(s,n,t,r,a){var o=-1,i=s.length;for(t||(t=Es),a||(a=[]);++o<i;){var l=s[o];n>0&&t(l)?n>1?pe(l,n-1,t,r,a):Ds(a,l):r||(a[a.length]=l)}return a}var Ns=pe,_s=Ns;function Us(s){var n=s==null?0:s.length;return n?_s(s,1):[]}var $s=Us;const Vs=ee($s);function xe({participant:s,open:n,onClose:t}){return e.jsxs(Ue,{fullWidth:!0,maxWidth:"xs",open:n,onClose:t,children:[e.jsx(m,{onClick:t,sx:{position:"absolute",right:8,top:8},children:e.jsx(h,{icon:"mingcute:close-line"})}),e.jsxs(es,{sx:{py:5,px:3,display:"flex"},children:[e.jsx(S,{alt:s.name,src:s.avatarUrl,sx:{width:96,height:96,mr:3}}),e.jsxs(p,{spacing:1,children:[e.jsx(y,{variant:"caption",sx:{color:"primary.main"},children:s.role}),e.jsx(y,{variant:"subtitle1",children:s.name}),e.jsxs(p,{direction:"row",sx:{typography:"caption",color:"text.disabled"},children:[e.jsx(h,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),s.address]}),e.jsxs(p,{spacing:1,direction:"row",sx:{pt:1.5},children:[e.jsx(m,{size:"small",color:"error",sx:{borderRadius:1,bgcolor:r=>k(r.palette.error.main,.08),"&:hover":{bgcolor:r=>k(r.palette.error.main,.16)}},children:e.jsx(h,{width:18,icon:"solar:phone-bold"})}),e.jsx(m,{size:"small",color:"info",sx:{borderRadius:1,bgcolor:r=>k(r.palette.info.main,.08),"&:hover":{bgcolor:r=>k(r.palette.info.main,.16)}},children:e.jsx(h,{width:18,icon:"solar:chat-round-dots-bold"})}),e.jsx(m,{size:"small",color:"primary",sx:{borderRadius:1,bgcolor:r=>k(r.palette.primary.main,.08),"&:hover":{bgcolor:r=>k(r.palette.primary.main,.16)}},children:e.jsx(h,{width:18,icon:"fluent:mail-24-filled"})}),e.jsx(m,{size:"small",color:"secondary",sx:{borderRadius:1,bgcolor:r=>k(r.palette.secondary.main,.08),"&:hover":{bgcolor:r=>k(r.palette.secondary.main,.16)}},children:e.jsx(h,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}xe.propTypes={onClose:d.func,open:d.bool,participant:d.object};function ue({participants:s}){const[n,t]=c.useState(null),r=W(!0),a=c.useCallback(u=>{t(u)},[]),o=()=>{t(null)},i=s.length,l=e.jsxs(M,{onClick:r.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(T,{component:"span",sx:{flexGrow:1},children:["In room (",i,")"]}),e.jsx(h,{width:16,icon:r.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),x=e.jsx(D,{sx:{height:56*4},children:s.map(u=>e.jsxs(M,{onClick:()=>a(u),children:[e.jsx(P,{variant:u.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(S,{alt:u.name,src:u.avatarUrl})}),e.jsx(O,{sx:{ml:2},primary:u.name,secondary:u.role,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span",typography:"caption"}})]},u.id))});return e.jsxs(e.Fragment,{children:[l,e.jsx("div",{children:e.jsx(ae,{in:r.value,children:x})}),n&&e.jsx(xe,{participant:n,open:!!n,onClose:o})]})}ue.propTypes={participants:d.array};function ge({participant:s}){const n=W(!0),{name:t,avatarUrl:r,role:a,address:o,phoneNumber:i,email:l}=s,x=e.jsxs(p,{alignItems:"center",sx:{py:5},children:[e.jsx(S,{alt:t,src:r,sx:{width:96,height:96,mb:2}}),e.jsx(y,{variant:"subtitle1",children:t}),e.jsx(y,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:a})]}),u=e.jsxs(M,{onClick:n.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsx(T,{component:"span",sx:{flexGrow:1},children:"Information"}),e.jsx(h,{width:16,icon:n.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),g=e.jsxs(p,{spacing:2,sx:{px:2,py:2.5,"& svg":{mr:1,flexShrink:0,color:"text.disabled"}},children:[e.jsxs(p,{direction:"row",children:[e.jsx(h,{icon:"mingcute:location-fill"}),e.jsx(y,{variant:"body2",children:o})]}),e.jsxs(p,{direction:"row",children:[e.jsx(h,{icon:"solar:phone-bold"}),e.jsx(y,{variant:"body2",children:i})]}),e.jsxs(p,{direction:"row",children:[e.jsx(h,{icon:"fluent:mail-24-filled"}),e.jsx(y,{variant:"body2",noWrap:!0,children:l})]})]});return e.jsxs(e.Fragment,{children:[x,u,e.jsx("div",{children:e.jsx(ae,{in:n.value,children:g})})]})}ge.propTypes={participant:d.object};function me({attachments:s}){const n=W(!0),t=s.length,r=e.jsxs(M,{disabled:!s.length,onClick:n.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(T,{component:"span",sx:{flexGrow:1},children:["Attachments (",t,")"]}),e.jsx(h,{width:16,icon:!n.value&&"eva:arrow-ios-forward-fill"||!s.length&&"eva:arrow-ios-forward-fill"||"eva:arrow-ios-downward-fill"})]}),a=e.jsx(D,{sx:{px:2,py:2.5},children:s.map((o,i)=>e.jsxs(p,{spacing:1.5,direction:"row",alignItems:"center",sx:{mb:2},children:[e.jsx(p,{alignItems:"center",justifyContent:"center",sx:{width:40,height:40,flexShrink:0,borderRadius:1,overflow:"hidden",position:"relative",backgroundColor:"background.neutral"},children:e.jsx($e,{imageView:!0,file:o.preview,onDownload:()=>console.info("DOWNLOAD"),sx:{width:28,height:28}})}),e.jsx(O,{primary:o.name,secondary:Ve(o.createdAt),primaryTypographyProps:{noWrap:!0,typography:"body2"},secondaryTypographyProps:{mt:.25,noWrap:!0,component:"span",typography:"caption",color:"text.disabled"}})]},o.name+i))});return e.jsxs(e.Fragment,{children:[r,e.jsx(T,{sx:{overflow:"hidden",height:n.value?1:0,transition:o=>o.transitions.create(["height"],{duration:o.transitions.duration.shorter})},children:a})]})}me.propTypes={attachments:d.array};const $=240;function fe({participants:s,conversation:n}){const t=oe(),r=te("up","lg"),{collapseDesktop:a,onCloseDesktop:o,onCollapseDesktop:i,openMobile:l,onOpenMobile:x,onCloseMobile:u}=le();c.useEffect(()=>{r||o()},[o,r]);const g=c.useCallback(()=>{r?i():x()},[r]),C=s.length>1,f=ze(Vs(n.messages.map(b=>b.attachments))),j=e.jsxs(e.Fragment,{children:[C?e.jsx(ue,{participants:s}):e.jsx(ge,{participant:s[0]}),e.jsx(me,{attachments:f})]}),v=e.jsx(m,{onClick:g,sx:{top:12,right:0,zIndex:9,width:32,height:32,borderRight:0,position:"absolute",borderRadius:"12px 0 0 12px",boxShadow:t.customShadows.z8,bgcolor:t.palette.background.paper,border:`solid 1px ${t.palette.divider}`,"&:hover":{bgcolor:t.palette.background.neutral},...r&&{...!a&&{right:$}}},children:r?e.jsx(h,{width:16,icon:a?"eva:arrow-ios-back-fill":"eva:arrow-ios-forward-fill"}):e.jsx(h,{width:16,icon:"eva:arrow-ios-back-fill"})});return e.jsxs(T,{sx:{position:"relative"},children:[v,r?e.jsx(p,{sx:{height:1,flexShrink:0,width:$,borderLeft:`solid 1px ${t.palette.divider}`,transition:t.transitions.create(["width"],{duration:t.transitions.duration.shorter}),...a&&{width:0}},children:!a&&j}):e.jsx(re,{anchor:"right",open:l,onClose:u,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:$}},children:j})]})}fe.propTypes={conversation:d.object,participants:d.array};d.object,d.func,d.array;function je({messages:s=[],participants:n}){const{messagesEndRef:t}=As(s),r=s.filter(o=>o.contentType==="image").map(o=>({src:o.body})),a=ss(r);return e.jsxs(e.Fragment,{children:[e.jsx(D,{ref:t,sx:{px:3,py:5,height:1},children:e.jsx(T,{})}),e.jsx(ns,{index:a.selected,slides:r,open:a.open,close:a.onClose})]})}je.propTypes={messages:d.array,participants:d.array};function Q(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const n=Math.random()*16|0;return(s==="x"?n:n&3|8).toString(16)})}function be({recipients:s,onAddRecipients:n,disabled:t,selectedConversationId:r}){const a=G(),{user:o}=z(),i=c.useRef(null),[l,x]=c.useState(""),u=c.useMemo(()=>({id:o.id,role:o.role,email:o.email,address:o.address,name:o.displayName,lastActivity:new Date,avatarUrl:o.photoURL,phoneNumber:o.phoneNumber,status:"online"}),[o]),g=c.useMemo(()=>({id:Q(),attachments:[],body:l,contentType:"text",createdAt:Ge(new Date,{minutes:1}),senderId:u.id}),[l,u.id]),C=c.useMemo(()=>({id:Q(),messages:[g],participants:[...s,u],type:s.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[g,u,s]),f=c.useCallback(()=>{i.current&&i.current.click()},[]),j=c.useCallback(b=>{x(b.target.value)},[]),v=c.useCallback(async b=>{try{if(b.key==="Enter"){if(l)if(r)await Ts(r,g);else{const A=await Rs(C);a.push(`${F.dashboard.chat}?id=${A.conversation.id}`),n([])}x("")}}catch(A){console.error(A)}},[C,l,g,n,a,r]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{value:l,onKeyUp:v,onChange:j,placeholder:"Type a message",disabled:t,startAdornment:e.jsx(m,{children:e.jsx(h,{icon:"eva:smiling-face-fill"})}),endAdornment:e.jsxs(p,{direction:"row",sx:{flexShrink:0},children:[e.jsx(m,{onClick:f,children:e.jsx(h,{icon:"solar:gallery-add-bold"})}),e.jsx(m,{onClick:f,children:e.jsx(h,{icon:"eva:attach-2-fill"})}),e.jsx(m,{children:e.jsx(h,{icon:"solar:microphone-bold"})})]}),sx:{px:1,height:56,flexShrink:0,borderTop:b=>`solid 1px ${b.palette.divider}`}}),e.jsx("input",{type:"file",ref:i,style:{display:"none"}})]})}be.propTypes={disabled:d.bool,onAddRecipients:d.func,recipients:d.array,selectedConversationId:d.string};function ve({participants:s}){const n=s.length>1,t=s[0],r=e.jsx(os,{max:3,sx:{[`& .${We.avatar}`]:{width:32,height:32}},children:s.map(o=>e.jsx(S,{alt:o.name,src:o.avatarUrl},o.id))}),a=e.jsxs(p,{flexGrow:1,direction:"row",alignItems:"center",spacing:2,children:[e.jsx(P,{variant:t.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(S,{src:t.avatarUrl,alt:t.name})}),e.jsx(O,{primary:t.name,secondary:t.status==="offline"?Be(t.lastActivity):t.status,secondaryTypographyProps:{component:"span",...t.status!=="offline"&&{textTransform:"capitalize"}}})]});return e.jsxs(e.Fragment,{children:[n?r:a,e.jsx(p,{flexGrow:1}),e.jsx(m,{children:e.jsx(h,{icon:"solar:phone-bold"})}),e.jsx(m,{children:e.jsx(h,{icon:"solar:videocamera-record-bold"})}),e.jsx(m,{children:e.jsx(h,{icon:"eva:more-vertical-fill"})})]})}ve.propTypes={participants:d.array};function ye({contacts:s,onAddRecipients:n}){const[t,r]=c.useState(""),a=c.useCallback(o=>{r(""),n(o)},[n]);return e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),e.jsx(ts,{sx:{minWidth:320},multiple:!0,limitTags:3,popupIcon:null,disableCloseOnSelect:!0,noOptionsText:e.jsx(ne,{query:t}),onChange:(o,i)=>a(i),onInputChange:(o,i)=>r(i),options:s,getOptionLabel:o=>o.name,isOptionEqualToValue:(o,i)=>o.id===i.id,renderInput:o=>e.jsx(ie,{...o,placeholder:"+ Recipients"}),renderOption:(o,i,{selected:l})=>c.createElement("li",{...o,key:i.id},e.jsxs(T,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(S,{alt:i.name,src:i.avatarUrl,sx:{width:1,height:1}}),e.jsx(p,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:x=>k(x.palette.grey[900],.8),transition:x=>x.transitions.create(["opacity"],{easing:x.transitions.easing.easeInOut,duration:x.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}},children:e.jsx(h,{icon:"eva:checkmark-fill"})})]},i.id),i.name),renderTags:(o,i)=>o.map((l,x)=>c.createElement(rs,{...i({index:x}),key:l.id,label:l.name,avatar:e.jsx(S,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}ye.propTypes={contacts:d.array,onAddRecipients:d.func};function zs(){const s=G(),{user:n}=z(),t=qe(),a=Je().get("id")||"",[o,i]=c.useState([]),{contacts:l}=ws(),{conversations:x,conversationsLoading:u}=ks(),{conversation:g,conversationError:C}=Ss(`${a}`),f=g?g.participants.filter(w=>w.id!==n.id):[];c.useEffect(()=>{(C||!a)&&s.push(F.dashboard.chat)},[C,s,a]);const j=c.useCallback(w=>{i(w)},[]),v=!!g,b=e.jsx(p,{direction:"row",alignItems:"center",flexShrink:0,sx:{pr:1,pl:2.5,py:1,minHeight:72},children:a?e.jsx(e.Fragment,{children:v&&e.jsx(ve,{participants:f})}):e.jsx(ye,{contacts:l,onAddRecipients:j})}),A=e.jsx(he,{contacts:l,conversations:x,loading:u,selectedConversationId:a}),E=e.jsxs(p,{sx:{width:1,height:1,overflow:"hidden"},children:[e.jsx(je,{messages:g==null?void 0:g.messages,participants:f}),e.jsx(be,{recipients:o,onAddRecipients:j,selectedConversationId:a,disabled:!o.length&&!a})]});return e.jsxs(He,{maxWidth:t.themeStretch?!1:"xl",children:[e.jsx(y,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Chat"}),e.jsxs(p,{component:as,direction:"row",sx:{height:"72vh"},children:[A,e.jsxs(p,{sx:{width:1,height:1,overflow:"hidden"},children:[b,e.jsxs(p,{direction:"row",sx:{width:1,height:1,overflow:"hidden",borderTop:w=>`solid 1px ${w.palette.divider}`},children:[E,v&&e.jsx(fe,{conversation:g,participants:f})]})]})]})]})}function cn(){return e.jsxs(e.Fragment,{children:[e.jsx(Ke,{children:e.jsx("title",{children:" Dashboard: Chat"})}),e.jsx(zs,{})]})}export{cn as default};
