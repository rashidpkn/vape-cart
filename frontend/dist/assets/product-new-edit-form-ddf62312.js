import{j as e,aF as ae,T as F,c as w,r as p,ap as be,k as O,u as de,G as v,p as S,C as z,v as N,aG as Y,aH as ge,aI as je,aj as ee,aJ as ue,B as K,aK as fe,F as ye,ak as ne,aL as ve,aM as me,aN as T,aa as Se,aO as ke,aP as Ce,ab as le,ac as y,aQ as I,aR as we,aS as P,ad as Ie,ai as Ae,L as re,af as qe,aT as oe,aU as V,am as Fe}from"./index-6b8e36a9.js";import{F as A,R as he,b as Q}from"./product-table-toolbar-23781334.js";import{C as B}from"./Checkbox-2d3e0a17.js";import{b as pe,c as f,a as Ue,T as De,d as Re}from"./TableRow-763f0345.js";import{C as ce}from"./CardHeader-6c8c9ea2.js";import{A as _}from"./Alert-d5e2cf9b.js";function Te({values:a,products:s,setValue:l}){return e.jsx(ae,{value:a.name,onChange:(n,t)=>{if(t){const o=s.find(m=>m.name===t);o&&(l("images",o.images),l("name",o.name),l("category",o.category),l("brand",o.brand),l("type",o.type))}},name:"name",label:"Product Name",options:s.map(n=>n.name),getOptionLabel:n=>n,isOptionEqualToValue:(n,t)=>n===t.value,renderInput:n=>e.jsx(F,{...n,label:"Product Name",value:a.name,onChange:t=>l("name",t.target.value)}),renderOption:(n,t)=>e.jsxs(w,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...n,children:[e.jsx("img",{loading:"lazy",width:"20",src:s.find(o=>o.name===t).images[0],alt:""}),t]}),freeSolo:!0})}function Ne({setValue:a,values:s}){const l=p.useCallback(o=>{const m=s.images||[],i=o.map(c=>Object.assign(c,{preview:URL.createObjectURL(c)}));a("images",[...m,...i],{shouldValidate:!0})},[a,s.images]),n=p.useCallback(o=>{var i;const m=s.images&&((i=s.images)==null?void 0:i.filter(c=>c!==o));a("images",m)},[a,s.images]),t=p.useCallback(()=>{a("images",[])},[a]);return e.jsx(be,{multiple:!0,name:"images",maxSize:3145728,onDrop:l,onRemove:n,onRemoveAll:t,onUpload:async o=>{try{const m=new FormData;s.images.forEach(c=>{m.append("images",c)});const{data:i}=await O.post("upload",m);a("images",i),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})}function Oe({values:a,setValue:s}){const{user:l}=de(),[n,t]=p.useState({name:"",show:!1}),[o,m]=p.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(v,{md:12,width:"100%",item:!0,children:[e.jsx(S,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(S,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(v,{xs:12,md:12,width:"100%",item:!0,children:e.jsx(z,{children:e.jsx(N,{spacing:3,sx:{p:3},children:e.jsxs(w,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(Y,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:ge.map(i=>e.jsx("option",{value:i,children:i},i))}),e.jsx(Y,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:je.map(i=>e.jsx("option",{value:i,children:i},i))}),e.jsxs(w,{children:[e.jsx(ee,{name:"SKU",label:"Product SKU"}),e.jsx(A,{label:"Automatically generate SKUs",control:e.jsx(B,{checked:o,onChange:i=>{i.target.checked?a.name.replaceAll(" ","").trim().length>=8?(s("SKU",`${a.name.replaceAll(" ","").trim().slice(0,8)}-1`),m(!0)):(m(!1),alert("To automatically generate SKUs, ensure that the product name has at least 8 characters.")):(s("SKU",""),m(!1))}})})]}),!n.show&&e.jsx(Y,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:ue.map(i=>e.jsx("option",{value:i,children:i},i))}),e.jsxs(w,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(A,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(B,{checked:n.show,onChange:i=>t(c=>({...c,show:i.target.checked}))})}),n.show&&e.jsxs(e.Fragment,{children:[e.jsx(F,{label:"Brand Name",style:{width:300},onChange:i=>t(c=>({...c,name:i.target.value})),value:n.name}),e.jsx(K,{variant:"contained",color:"success",onClick:async()=>{try{n.name?(await O.post("/notifications",{userId:l.id,role:"admin",title:"🚀 New Brand Approval Request! 🚀",message:`Exciting news! A new brand has been submitted for approval. Brand Name: ${n.name}. 🛍️`,type:"product"}),s("brand",n.name),s("status","In Revision"),alert("Your request to create a new brand is being processed. Please wait while we verify the brand. You can add products, but their status will be 'In Revision.' After reviewing, the products will go live.")):alert("Please enter brand name")}catch(i){console.log(i),alert("An error occurred while adding this brand.")}},children:"Add Brand"})]})]}),a.status!=="In Revision"&&e.jsx(Y,{native:!0,name:"status",label:"status",InputLabelProps:{shrink:!0},children:fe.map(i=>e.jsx("option",{value:i,children:i},i))})]})})})})]})}function Ke({values:a,setValue:s}){return console.log(a),e.jsxs(e.Fragment,{children:[e.jsxs(v,{md:4,width:"100%",item:!0,children:[e.jsx(S,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(S,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(v,{xs:12,md:12,width:"100%",item:!0,children:e.jsx(z,{children:e.jsxs(N,{spacing:3,sx:{p:3},children:[e.jsx(A,{label:"Track Stock",control:e.jsx(B,{defaultChecked:a.track,checked:a.track,onChange:l=>{s("track",l.target.checked),l.target.checked&&s("availability","In Stock")}})}),a.track&&e.jsx(F,{value:a.quantity,onChange:l=>{const n=Math.max(0,Number(l.target.value));s("quantity",n),s("availability","In Stock")},label:"Quantity",placeholder:"0.00",type:"number",inputProps:{min:0}}),!a.track&&e.jsx(ye,{children:e.jsxs(he,{value:a.availability,row:!0,onChange:l=>{s("availability",l.target.value),l.target.value==="In Stock"?s("quantity",100):s("quantity",0)},children:[e.jsx(A,{value:"In Stock",control:e.jsx(Q,{}),label:"In Stock"}),e.jsx(A,{value:"Out Stock",control:e.jsx(Q,{}),label:"Out Stock"})]})}),e.jsx(ee,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ne,{position:"start",children:e.jsx(w,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx(ee,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ne,{position:"start",children:e.jsx(w,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})})})]})}function Ee({selectedAttributes:a=[],counter:s,skuAlpha:l,attributes:n,values:t,currentProduct:o,setValue:m}){const i=l[s]?`${t.SKU}-${l[s]}`:t.SKU,c=!!n&&Object.keys(n).map(x=>n[x]).join("-"),[d,b]=p.useState({track:!0,availability:"In Stock",quantity:null,regularPrice:null,salePrice:null,image:null,attributes:{}});p.useEffect(()=>{const x=t.variations.findIndex(h=>!!n&&Object.keys(n).every(u=>n[u]===h.attributes[u]));if(Object.keys(d.attributes).length<a.length){const h=t.variations[x];b(u=>({...u,...h,attributes:n}))}},[n]),p.useState("instock");const[g,U]=p.useState("pending"),E=x=>h=>{const u=h.target.type==="checkbox"?h.target.checked:h.target.value;b(k=>({...k,[x]:u}))},te=async x=>{try{const h=new FormData;h.append("images",x.target.files[0]);const{data:u}=await O.post("upload",h);b(k=>({...k,image:[u[0],...t.images]}))}catch(h){console.error("Image upload failed:",h)}},j=async()=>{let{track:x,quantity:h,regularPrice:u,salePrice:k}=d;if(k=Number(k),u=Number(u),h=Number(h),x&&!h)return alert("Quantity is required.");if(!u||!k)return alert("Sale Price and regular price are mandatory.");if(k>u)return alert("Sale price must be less than the regular price");if(g==="pending"){U("loading");try{if(!o)m("variations",[...t.variations,d]);else{const{attributes:q}=d;if(t.variations.some(D=>Object.keys(q).every(R=>D.attributes[R]===q[R]))){const D=[...t.variations],R=t.variations.findIndex(G=>Object.keys(q).every($=>q[$]===G.attributes[$]));D[R]={...D[R],...d},m("variations",D)}else m("variations",[...t.variations,d])}U("success")}catch(q){console.error("Product creation failed:",q),U("failed")}}},J=()=>{switch(g){case"loading":return e.jsx(K,{color:"success",variant:"contained",size:"small",children:"Loading"});case"success":return o?e.jsx(K,{color:"success",variant:"contained",size:"small",children:"Product Updated"}):e.jsx(K,{color:"success",variant:"contained",size:"small",children:"Product Created"});case"failed":return e.jsx(K,{color:"error",variant:"contained",size:"small",children:"Product creation failed"});default:return e.jsx(K,{color:"success",variant:"contained",size:"small",onClick:j,children:o?"Save Changes":"Add Product"})}},{track:L,quantity:W,regularPrice:X,salePrice:Z,image:se}=d;return e.jsxs(pe,{children:[e.jsx(f,{children:s}),e.jsx(f,{children:i}),e.jsx(f,{children:c}),e.jsx(f,{children:e.jsx(A,{control:e.jsx(B,{checked:L,onChange:x=>b(h=>({...h,track:x.target.checked,availability:"In Stock"}))})})}),e.jsx(f,{width:150,children:L?e.jsx(F,{size:"small",label:"Quantity",type:"number",inputProps:{min:0},onChange:x=>b(h=>({...h,quantity:+x.target.value})),value:W??""}):e.jsxs(he,{"aria-label":"Stock",name:"Stock",value:d.availability,onChange:x=>b(h=>({...h,availability:x.target.value,quantity:x.target.value==="In Stock"?100:0})),children:[e.jsx(A,{value:"In Stock",control:e.jsx(Q,{}),label:"In Stock"}),e.jsx(A,{value:"Out Stock",control:e.jsx(Q,{}),label:"Out Stock"})]})}),e.jsx(f,{width:150,children:e.jsx(F,{size:"small",label:"Price",type:"number",inputProps:{min:0},onChange:E("regularPrice"),value:X||""})}),e.jsx(f,{width:150,children:e.jsx(F,{size:"small",label:"Sale Price",type:"number",inputProps:{min:0},onChange:E("salePrice"),value:Z||""})}),e.jsx(f,{width:150,children:e.jsx("input",{type:"file",onChange:te,style:{width:"150px"}})}),e.jsx(f,{children:J()})]})}function ze(){return e.jsx(Ue,{children:e.jsxs(pe,{children:[e.jsx(f,{children:"ID"}),e.jsx(f,{width:150,children:"SKU"}),e.jsx(f,{width:250,children:"Attributes"}),e.jsx(f,{width:150,children:"Track Stock"}),e.jsx(f,{children:"Stock"}),e.jsx(f,{children:"Regular Price"}),e.jsx(f,{children:"Sales Price"}),e.jsx(f,{children:"Image"}),e.jsx(f,{width:200,children:"Add Product"})]})})}function Be({setSelectedAttributes:a,selectedAttributes:s,values:l,setValue:n}){return e.jsx(ae,{onChange:(t,o)=>{a(o)},value:s,name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:ve,getOptionLabel:t=>t,renderOption:(t,o)=>p.createElement("li",{...t,key:o},o),renderTags:(t,o)=>t.map((m,i)=>p.createElement(me,{...o({index:i}),key:m,label:m,size:"small",color:"info",variant:"soft"})),renderInput:t=>e.jsx(F,{...t,label:"Attributes",placeholder:"+ Attributes"})})}function Le({currentProduct:a,values:s,setValue:l,setVariation:n,e:t,savedAttibutes:o,variation:m=[]}){var i;return e.jsxs(w,{sx:{gridColumn:"span 1 "},children:[e.jsx(ae,{multiple:!0,freeSolo:!0,options:[...t==="Bottle Size"?T.bottleSize:[],...t==="Puffs"?T.puffs:[],...t==="Flavour"?T.flavour:[],...t==="Nicotine Strength"?T["Nicotine Strength"]:[],...t==="Color"?T.color:[],...t==="Batteries"?T.batteries:[],...t==="Packaging"?T.Packaging:[],...o.filter(c=>c.attribute===t).map(c=>c.value)],value:s.attributes[t]||[],onChange:(c,d)=>{let b={...s.attributes};if(s.type==="Simple"&&t!=="flavour"){if(d.length>1){const g=[d[d.length-1]];b={...s.attributes,[t]:g}}else b={...s.attributes,[t]:d};d.length===0&&delete b[t],l("attributes",b)}else{if(m.find(U=>U===t)&&d.length===1)return alert('Please uncheck "Use this attribute to create Variations" before deleting this attribute.');const g={...s.attributes,[t]:d};d.length===0&&delete g[t],l("attributes",g)}},renderInput:c=>e.jsx(F,{...c,label:t,placeholder:t}),renderTags:(c,d)=>c.map((b,g)=>p.createElement(me,{...d({index:g}),key:b,label:b,size:"small",color:"info",variant:"soft"}))}),s.type==="Variable"&&((i=s.attributes[t])==null?void 0:i.length)>1&&e.jsx(A,{label:"Use this attribute to create Variations",control:e.jsx(B,{defaultChecked:m.find(c=>c===t),onChange:c=>{if(a)if(confirm("Changing the variation of this product will reset all current variations, and you'll have to start over from the beginning. Do you wish to proceed?"))l("variations",[]);else return;c.target.checked?n(d=>[...new Set([...d,t])]):n(d=>[...new Set(d.filter(b=>b!==t))])}})})]},t)}function Qe({currentProduct:a}){const s=Se(),l=ke("up","md"),{enqueueSnackbar:n}=Ce(),{user:t}=de(),o=le().shape({name:y().required("Name is required"),subDescription:y().required("Short description is required").test("not-four-digits","Your content contain continues 7 digit number, Please remove",r=>!/\d{7,}/.test(r)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',r=>!/@/.test(r)),content:y().test("not-four-digits","Your content contain continues 7 digit number, Please remove",r=>!/\d{7,}/.test(r)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',r=>!/@/.test(r)),images:I().min(1,"Image is required"),type:y(),category:y().required("Category is required"),tags:I(),SKU:y().required("SKU is required"),brand:y().required("brand is required"),status:y().required("brand is required"),attributes:le().shape({bottleSize:I().of(y()).optional(),puffs:I().of(y()).optional(),flavour:I().of(y()).optional(),nicotineStrength:I().of(y()).optional(),color:I().of(y()).optional(),batteries:I().of(y()).optional()}),track:we(),availability:y(),quantity:P(),regularPrice:P(),salePrice:P(),variations:I()}),[m,i]=p.useState({id:"",name:"",subDescription:"",content:"",images:[],type:"Simple",category:"Disposables",tags:[],SKU:"",brand:"SMOK",status:"Published",attributes:{},track:!0,availability:"In Stock",quantity:0,regularPrice:100,salePrice:0,variations:[]});p.useEffect(()=>{i({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",subDescription:(a==null?void 0:a.subDescription)||"",content:(a==null?void 0:a.content)||"",images:(a==null?void 0:a.images)||[],type:(a==null?void 0:a.type)||"Simple",category:(a==null?void 0:a.category)||"Disposables",tags:(a==null?void 0:a.tags)||[],SKU:(a==null?void 0:a.SKU)||"",brand:(a==null?void 0:a.brand)||"SMOK",status:(a==null?void 0:a.status)||"Published",attributes:(a==null?void 0:a.attributes)||{},track:a==null?void 0:a.track,availability:(a==null?void 0:a.availability)||"In Stock",quantity:(a==null?void 0:a.quantity)||0,regularPrice:(a==null?void 0:a.regularPrice)||100,salePrice:(a==null?void 0:a.salePrice)||0,variations:(a==null?void 0:a.variations)||[]})},[a]);const c=Ie({resolver:Fe(o),defaultValues:m}),{reset:d,watch:b,setValue:g,handleSubmit:U,formState:{isSubmitting:E,isValid:te}}=c,j=b(),[J,L]=p.useState([]);p.useEffect(()=>{O.get("/attributes").then(r=>{L(r.data)})},[]);const[W,X]=p.useState([]),Z=p.useCallback(async()=>{const{data:r}=await O.get("/products",{params:{name:j.name}});X(r.products.filter(C=>!C.name.includes("-")))},[j.name]);p.useEffect(()=>{Z()},[j.name]),p.useEffect(()=>{a&&d(m)},[a,m,d]);const se=U(async r=>{try{if(r.type==="Simple"){if(!r.salePrice||!r.regularPrice){alert("Sale Price and regular price are mandatory");return}else if(r.salePrice>r.regularPrice){alert("Sale price must be less than the regular price");return}}a?await O.patch("products",{...r,username:t.displayName,userId:t.id,storeName:t.storeName}):await O.post("products",{...r,username:t.displayName,userId:t.id,storeName:t.storeName}),d(),n(a?"Update success!":"Create success!"),s.push(Ae.dashboard.product.root)}catch(C){console.log(C)}}),[x,h]=p.useState([]),[u,k]=p.useState([]);p.useEffect(()=>{var r;if(a){const{attributes:C,variations:H,type:M}=a;C&&h(Object.keys(C)),M==="Variable"&&H.length&&k(Object.keys((r=H[0])==null?void 0:r.attributes))}},[a]);const q=e.jsxs(e.Fragment,{children:[l&&e.jsxs(v,{md:4,item:!0,children:[e.jsx(S,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(S,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(v,{xs:12,md:12,item:!0,children:e.jsxs(z,{children:[!l&&e.jsx(ce,{title:"Details"}),e.jsxs(N,{spacing:3,sx:{p:3},children:[e.jsx(Te,{products:W,setValue:g,values:j}),e.jsx(_,{severity:"info",children:"Please do not include emails, phone numbers, or emojis in the sub-description and content. Products containing these will not be accepted."}),e.jsxs(N,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",children:"Sub Description"}),e.jsx(oe,{simple:!0,name:"subDescription"})]}),e.jsxs(N,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",children:"Content"}),e.jsx(oe,{simple:!0,name:"content"})]}),e.jsx(_,{severity:"info",children:"Uploading at least one image is required."}),e.jsxs(N,{spacing:1.5,children:[e.jsx(S,{variant:"subtitle2",children:"Images"}),e.jsx(Ne,{values:j,setValue:g})]})]})]})})]}),ie=e.jsxs(e.Fragment,{children:[l&&e.jsxs(v,{md:4,item:!0,children:[e.jsx(S,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(S,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(v,{xs:12,md:12,item:!0,children:e.jsxs(z,{children:[!l&&e.jsx(ce,{title:"Attributes"}),e.jsx(N,{spacing:3,sx:{p:3},children:e.jsxs(w,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(w,{sx:{gridColumn:"span 2 "},children:j.type==="Variable"&&e.jsx(_,{severity:"info",children:"Please choose at least one attribute."})}),e.jsx(w,{sx:{gridColumn:"span 2 "},children:e.jsx(Be,{selectedAttributes:x,setSelectedAttributes:h,setValue:g,values:j})}),j.type==="Variable"&&!!x.length&&e.jsx(w,{sx:{gridColumn:"span 2 "},children:e.jsx(_,{severity:"info",children:"Please select at least two variations from the list below to enable the 'Create Variations' option."})}),x.map(r=>e.jsx(Le,{currentProduct:a,setValue:g,setVariation:k,variation:u,values:j,e:r,savedAttibutes:J},r))]})})]})})]}),D=e.jsxs(v,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},gap:2.5,item:!0,children:[e.jsx(re,{type:"submit",variant:"contained",size:"large",loading:E,children:a?"Save Changes":"Create Product"}),j.status!=="In Revision"&&e.jsx(re,{onClick:()=>{g("status","Draft")},type:"submit",variant:"contained",size:"large",loading:E,children:"Save as Draft"})]}),R=[...V,...V.slice(1).flatMap(r=>V.slice(1).map(C=>r+C))];let G=1;const $=e.jsxs(e.Fragment,{children:[l&&e.jsx(v,{md:4,item:!0,children:e.jsx(S,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(v,{xs:12,md:12,item:!0,children:e.jsx(z,{children:e.jsxs(De,{children:[e.jsx(ze,{}),e.jsx(Re,{children:u==null?void 0:u.reduce((r,C)=>r.flatMap(H=>{var M;return(M=j.attributes[C])==null?void 0:M.map(xe=>({...H,[C]:xe}))}),[{}]).map(r=>e.jsx(Ee,{selectedAttributes:x,counter:G++,skuAlpha:R,attributes:r,values:j,currentProduct:a,setValue:g},G))})]})})})]});return e.jsx(qe,{methods:c,onSubmit:se,children:e.jsxs(v,{container:!0,spacing:3,children:[q,e.jsx(Oe,{values:j,setValue:g}),ie,j.type==="Simple"&&e.jsx(Ke,{values:j,setValue:g}),j.type==="Variable"&&$,D]})})}export{Qe as P};
