import{r as m,j as e,ap as me,i as R,aF as ae,u as ee,G as k,o as C,C as $,v as K,b as A,aG as Q,aH as pe,aI as xe,aj as W,T as E,B as L,aJ as be,F as ge,ak as te,aK as re,aL as je,aM as oe,aN as O,aa as ue,aO as fe,aP as ye,ab as se,ac as y,aQ as q,aR as ve,aS as V,ad as Se,ai as ke,L as ie,af as Ce,aT as ne,aU as P,am as we}from"./index-b17e4a08.js";import{F,R as ce,b as X}from"./product-table-toolbar-e2806fe9.js";import{C as H}from"./Checkbox-78d58e64.js";import{b as de,c as b,a as Ie,T as Ae,d as qe}from"./TableRow-f1dd85d9.js";import{C as le}from"./CardHeader-c6d83b54.js";import{A as J}from"./Alert-19dfecca.js";function Fe({setValue:a,values:n}){const c=m.useCallback(r=>{const o=n.images||[],g=r.map(j=>Object.assign(j,{preview:URL.createObjectURL(j)}));a("images",[...o,...g],{shouldValidate:!0})},[a,n.images]),p=m.useCallback(r=>{var g;const o=n.images&&((g=n.images)==null?void 0:g.filter(j=>j!==r));a("images",o)},[a,n.images]),t=m.useCallback(()=>{a("images",[])},[a]);return e.jsx(me,{multiple:!0,name:"images",maxSize:3145728,onDrop:c,onRemove:p,onRemoveAll:t,onUpload:async r=>{try{const o=new FormData;n.images.forEach(j=>{o.append("images",j)});const{data:g}=await R.post("upload",o);a("images",g),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})}function Ue({values:a,setValue:n}){const[c,p]=m.useState(ae);m.useEffect(()=>(R.get("/brands").then(s=>{p(u=>[...ae,s.data.data.map(v=>v.name)])}),()=>{}),[]);const{user:t}=ee(),[r,o]=m.useState({name:"",show:!1}),[g,j]=m.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(k,{md:12,width:"100%",item:!0,children:[e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(C,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(k,{xs:12,md:12,width:"100%",item:!0,children:e.jsx($,{children:e.jsx(K,{spacing:3,sx:{p:3},children:e.jsxs(A,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(Q,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:pe.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(Q,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:xe.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(A,{children:[e.jsx(W,{name:"SKU",label:"Product SKU"}),e.jsx(F,{label:"Automatically generate SKUs",control:e.jsx(H,{checked:g,onChange:s=>{s.target.checked?a.name.replaceAll(" ","").trim().length>=15?(n("SKU",`${a.name.replaceAll(" ","").trim().slice(0,15)}-1`.toUpperCase()),j(!0)):(j(!1),alert("To automatically generate SKUs, ensure that the product name has at least 15 characters.")):(n("SKU",""),j(!1))}})})]}),!r.show&&e.jsx(Q,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:c.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(A,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(F,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(H,{checked:r.show,onChange:s=>o(u=>({...u,show:s.target.checked}))})}),r.show&&e.jsxs(e.Fragment,{children:[e.jsx(E,{label:"Brand Name",style:{width:300},onChange:s=>o(u=>({...u,name:s.target.value})),value:r.name}),e.jsx(L,{variant:"contained",color:"success",onClick:async()=>{try{r.name?(await R.post("/notifications",{userId:t.id,role:"admin",title:"🚀 New Brand Approval Request! 🚀",message:`Exciting news! A new brand has been submitted for approval. Brand Name: ${r.name}. 🛍️`,type:"product"}),n("brand",r.name),n("status","In Revision"),alert("Your request to create a new brand is being processed. Please wait while we verify the brand. You can add products, but their status will be 'In Revision.' After reviewing, the products will go live.")):alert("Please enter brand name")}catch(s){console.log(s),alert("An error occurred while adding this brand.")}},children:"Add Brand"})]})]}),a.status!=="In Revision"&&e.jsx(Q,{native:!0,name:"status",label:"status",InputLabelProps:{shrink:!0},children:be.map(s=>e.jsx("option",{value:s,children:s},s))})]})})})})]})}function De({values:a,setValue:n}){return console.log(a),e.jsxs(e.Fragment,{children:[e.jsxs(k,{md:4,width:"100%",item:!0,children:[e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(C,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(k,{xs:12,md:12,width:"100%",item:!0,children:e.jsx($,{children:e.jsxs(K,{spacing:3,sx:{p:3},children:[e.jsx(F,{label:"Track Stock",control:e.jsx(H,{defaultChecked:a.track,checked:a.track,onChange:c=>{n("track",c.target.checked),c.target.checked&&n("availability","In Stock")}})}),a.track&&e.jsx(E,{value:a.quantity,onChange:c=>{const p=Math.max(0,Number(c.target.value));n("quantity",p),n("availability","In Stock")},label:"Quantity",placeholder:"0.00",type:"number",inputProps:{min:0}}),!a.track&&e.jsx(ge,{children:e.jsxs(ce,{value:a.availability,row:!0,onChange:c=>{n("availability",c.target.value),c.target.value==="In Stock"?n("quantity",100):n("quantity",0)},children:[e.jsx(F,{value:"In Stock",control:e.jsx(X,{}),label:"In Stock"}),e.jsx(F,{value:"Out Stock",control:e.jsx(X,{}),label:"Out Stock"})]})}),e.jsx(W,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(A,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx(W,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(te,{position:"start",children:e.jsx(A,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})})})]})}function Re({selectedAttributes:a=[],counter:n,skuAlpha:c,attributes:p,values:t,currentProduct:r,setValue:o}){const g=c[n]?`${t.SKU}-${c[n]}`:t.SKU,j=!!p&&Object.keys(p).map(x=>p[x]).join("-"),[s,u]=m.useState({track:!0,availability:"In Stock",quantity:null,regularPrice:null,salePrice:null,image:null,attributes:{}});m.useEffect(()=>{const x=t.variations.findIndex(h=>!!p&&Object.keys(p).every(f=>p[f]===h.attributes[f]));if(Object.keys(s.attributes).length<a.length){const h=t.variations[x];u(f=>({...f,...h,attributes:p}))}},[p]);const[v,U]=m.useState("pending"),l=x=>h=>{const f=h.target.type==="checkbox"?h.target.checked:h.target.value;u(I=>({...I,[x]:f}))},d=async x=>{try{const h=new FormData;h.append("images",x.target.files[0]);const{data:f}=await R.post("upload",h);u(I=>({...I,image:[f[0],...t.images]}))}catch(h){console.error("Image upload failed:",h)}},w=async()=>{let{track:x,quantity:h,regularPrice:f,salePrice:I}=s;if(I=Number(I),f=Number(f),h=Number(h),x&&!h)return alert("Quantity is required.");if(!f||!I)return alert("Sale Price and regular price are mandatory.");if(I>f)return alert("Sale price must be less than the regular price");if(v==="pending"){U("loading");try{if(!r)o("variations",[...t.variations,s]);else{const{attributes:D}=s;if(t.variations.some(T=>Object.keys(D).every(i=>T.attributes[i]===D[i]))){const T=[...t.variations],i=t.variations.findIndex(S=>Object.keys(D).every(N=>D[N]===S.attributes[N]));T[i]={...T[i],...s},o("variations",T)}else o("variations",[...t.variations,s])}U("success")}catch(D){console.error("Product creation failed:",D),U("failed")}}},G=()=>{switch(v){case"loading":return e.jsx(L,{color:"success",variant:"contained",size:"small",children:"Loading"});case"success":return r?e.jsx(L,{color:"success",variant:"contained",size:"small",children:"Product Updated"}):e.jsx(L,{color:"success",variant:"contained",size:"small",children:"Product Created"});case"failed":return e.jsx(L,{color:"error",variant:"contained",size:"small",children:"Product creation failed"});default:return e.jsx(L,{color:"success",variant:"contained",size:"small",onClick:w,children:r?"Save Changes":"Add Product"})}},{track:M,quantity:z,regularPrice:Y,salePrice:B}=s;return e.jsxs(de,{children:[e.jsx(b,{children:n}),e.jsx(b,{children:g}),e.jsx(b,{children:j}),e.jsx(b,{children:e.jsx(F,{control:e.jsx(H,{checked:M,onChange:x=>u(h=>({...h,track:x.target.checked,availability:"In Stock"}))})})}),e.jsx(b,{width:150,children:M?e.jsx(E,{size:"small",label:"Quantity",type:"number",inputProps:{min:0},onChange:x=>u(h=>({...h,quantity:+x.target.value})),value:z??""}):e.jsxs(ce,{"aria-label":"Stock",name:"Stock",value:s.availability,onChange:x=>u(h=>({...h,availability:x.target.value,quantity:x.target.value==="In Stock"?100:0})),children:[e.jsx(F,{value:"In Stock",control:e.jsx(X,{}),label:"In Stock"}),e.jsx(F,{value:"Out Stock",control:e.jsx(X,{}),label:"Out Stock"})]})}),e.jsx(b,{width:150,children:e.jsx(E,{size:"small",label:"Price",type:"number",inputProps:{min:0},onChange:l("regularPrice"),value:Y||""})}),e.jsx(b,{width:150,children:e.jsx(E,{size:"small",label:"Sale Price",type:"number",inputProps:{min:0},onChange:l("salePrice"),value:B||""})}),e.jsx(b,{width:150,children:e.jsx("input",{type:"file",onChange:d,style:{width:"150px"}})}),e.jsx(b,{children:G()})]})}function Te(){return e.jsx(Ie,{children:e.jsxs(de,{children:[e.jsx(b,{children:"ID"}),e.jsx(b,{width:150,children:"SKU"}),e.jsx(b,{width:250,children:"Attributes"}),e.jsx(b,{width:150,children:"Track Stock"}),e.jsx(b,{children:"Stock"}),e.jsx(b,{children:"Regular Price"}),e.jsx(b,{children:"Sales Price"}),e.jsx(b,{children:"Image"}),e.jsx(b,{width:200,children:"Add Product"})]})})}function Ne({setSelectedAttributes:a,selectedAttributes:n,values:c,setValue:p}){return e.jsx(re,{onChange:(t,r)=>{a(r)},value:n,name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:je,getOptionLabel:t=>t,renderOption:(t,r)=>m.createElement("li",{...t,key:r},r),renderTags:(t,r)=>t.map((o,g)=>m.createElement(oe,{...r({index:g}),key:o,label:o,size:"small",color:"info",variant:"soft"})),renderInput:t=>e.jsx(E,{...t,label:"Attributes",placeholder:"+ Attributes"})})}function Oe({currentProduct:a,values:n,setValue:c,setVariation:p,e:t,savedAttibutes:r,variation:o=[]}){var U;const{user:g}=ee(),s=[...{"Bottle Size":O.bottleSize,Puffs:O.puffs,Flavour:O.flavour,"Nicotine Strength":O["Nicotine Strength"],Color:O.color,Batteries:O.batteries,Packaging:O.Packaging}[t]||[],...r.filter(l=>l.attribute===t).map(l=>l.value)],u=l=>{const d={...n.attributes};n.type==="Simple"&&t!=="Flavour"?d[t]=l.length>1?[l[l.length-1]]:l:d[t]=l.length===0?void 0:l,c("attributes",d);const w=l[l.length-1];l.length&&(s.includes(w)?console.log("Already Included"):R.post("/attributes",{attribute:t,value:w,username:g.displayName}))},v=l=>{if(a&&l&&!window.confirm("Changing the variation of this product will reset all current variations. Do you wish to proceed?"))return;const d=l?[...new Set([...o,t])]:o.filter(w=>w!==t);p(d),l&&c("variations",[])};return e.jsxs(A,{sx:{gridColumn:"span 1"},children:[e.jsx(re,{multiple:!0,freeSolo:!0,options:s,value:n.attributes[t]||[],onChange:(l,d)=>u(d),renderInput:l=>e.jsx(E,{...l,label:t,placeholder:t}),renderTags:(l,d)=>l.map((w,G)=>m.createElement(oe,{...d({index:G}),key:w,label:w,size:"small",color:"info",variant:"soft"}))}),n.type==="Variable"&&((U=n.attributes[t])==null?void 0:U.length)>1&&e.jsx(F,{label:"Use this attribute to create Variations",control:e.jsx(H,{checked:o.includes(t),onChange:l=>v(l.target.checked)})})]},t)}function $e({currentProduct:a}){const n=ue(),c=fe("up","md"),{enqueueSnackbar:p}=ye(),{user:t}=ee(),r=se().shape({name:y().required("Name is required"),subDescription:y().required("Short description is required").test("not-four-digits","Your content contain continues 7 digit number, Please remove",i=>!/\d{7,}/.test(i)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',i=>!/@/.test(i)),content:y().test("not-four-digits","Your content contain continues 7 digit number, Please remove",i=>!/\d{7,}/.test(i)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',i=>!/@/.test(i)),images:q().min(1,"Image is required"),type:y(),category:y().required("Category is required"),tags:q(),SKU:y().required("SKU is required"),brand:y().required("brand is required"),status:y().required("brand is required"),attributes:se().shape({bottleSize:q().of(y()).optional(),puffs:q().of(y()).optional(),flavour:q().of(y()).optional(),nicotineStrength:q().of(y()).optional(),color:q().of(y()).optional(),batteries:q().of(y()).optional()}),track:ve(),availability:y(),quantity:V(),regularPrice:V(),salePrice:V(),variations:q()}),[o,g]=m.useState({id:"",name:"",subDescription:"",content:"",images:[],type:"Simple",category:"Disposables",tags:[],SKU:"",brand:"SMOK",status:"Published",attributes:{},track:!0,availability:"In Stock",quantity:0,regularPrice:100,salePrice:0,variations:[]});m.useEffect(()=>{g({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",subDescription:(a==null?void 0:a.subDescription)||"",content:(a==null?void 0:a.content)||"",images:(a==null?void 0:a.images)||[],type:(a==null?void 0:a.type)||"Simple",category:(a==null?void 0:a.category)||"Disposables",tags:(a==null?void 0:a.tags)||[],SKU:(a==null?void 0:a.SKU)||"",brand:(a==null?void 0:a.brand)||"SMOK",status:(a==null?void 0:a.status)||"Published",attributes:(a==null?void 0:a.attributes)||{},track:a==null?void 0:a.track,availability:(a==null?void 0:a.availability)||"In Stock",quantity:(a==null?void 0:a.quantity)||0,regularPrice:(a==null?void 0:a.regularPrice)||100,salePrice:(a==null?void 0:a.salePrice)||0,variations:(a==null?void 0:a.variations)||[]})},[a]);const j=Se({resolver:we(r),defaultValues:o}),{reset:s,watch:u,setValue:v,handleSubmit:U,formState:{isSubmitting:l}}=j,d=u(),[w,G]=m.useState([]);m.useEffect(()=>{R.get("/attributes").then(i=>{G(i.data)})},[]),m.useEffect(()=>{a&&s(o)},[a,o,s]);const M=U(async i=>{try{if(i.type==="Simple"){if(!i.salePrice||!i.regularPrice){alert("Sale Price and regular price are mandatory");return}if(i.salePrice>i.regularPrice){alert("Sale price must be less than the regular price");return}}a?await R.patch("products",{...i,username:t.displayName,userId:t.id,storeName:t.storeName}):await R.post("products",{...i,username:t.displayName,userId:t.id,storeName:t.storeName}),s(),p(a?"Update success!":"Create success!"),n.push(ke.dashboard.product.root)}catch(S){console.log(S),alert(S.response.data.message)}}),[z,Y]=m.useState([]),[B,x]=m.useState([]);m.useEffect(()=>{var i;if(a){const{attributes:S,variations:N,type:_}=a;S&&Y(Object.keys(S)),_==="Variable"&&N.length&&x(Object.keys((i=N[0])==null?void 0:i.attributes))}},[a]);const h=e.jsxs(e.Fragment,{children:[c&&e.jsxs(k,{md:4,item:!0,children:[e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(C,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(k,{xs:12,md:12,item:!0,children:e.jsxs($,{children:[!c&&e.jsx(le,{title:"Details"}),e.jsxs(K,{spacing:3,sx:{p:3},children:[e.jsx(W,{name:"name",label:"Product Name"}),e.jsx(J,{severity:"info",children:"Please do not include emails, phone numbers, or emojis in the sub-description and content. Products containing these will not be accepted."}),e.jsxs(K,{spacing:1.5,children:[e.jsx(C,{variant:"subtitle2",children:"Sub Description"}),e.jsx(ne,{simple:!0,name:"subDescription"})]}),e.jsxs(K,{spacing:1.5,children:[e.jsx(C,{variant:"subtitle2",children:"Content"}),e.jsx(ne,{simple:!0,name:"content"})]}),e.jsx(J,{severity:"info",children:"Uploading at least one image is required."}),e.jsxs(K,{spacing:1.5,children:[e.jsx(C,{variant:"subtitle2",children:"Images"}),e.jsx(Fe,{values:d,setValue:v})]})]})]})})]}),f=e.jsxs(e.Fragment,{children:[c&&e.jsxs(k,{md:4,item:!0,children:[e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(C,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(k,{xs:12,md:12,item:!0,children:e.jsxs($,{children:[!c&&e.jsx(le,{title:"Attributes"}),e.jsx(K,{spacing:3,sx:{p:3},children:e.jsxs(A,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(A,{sx:{gridColumn:"span 2 "},children:d.type==="Variable"&&e.jsx(J,{severity:"info",children:"Please choose at least one attribute."})}),e.jsx(A,{sx:{gridColumn:"span 2 "},children:e.jsx(Ne,{selectedAttributes:z,setSelectedAttributes:Y,setValue:v,values:d})}),d.type==="Variable"&&!!z.length&&e.jsx(A,{sx:{gridColumn:"span 2 "},children:e.jsx(J,{severity:"info",children:"Please select at least two variations from the list below to enable the 'Create Variations' option."})}),z.map(i=>e.jsx(Oe,{currentProduct:a,setValue:v,setVariation:x,variation:B,values:d,e:i,savedAttibutes:w},i))]})})]})})]}),I=e.jsxs(k,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},gap:2.5,item:!0,children:[e.jsx(ie,{type:"submit",variant:"contained",size:"large",loading:l,children:a?"Save Changes":"Create Product"}),d.status!=="In Revision"&&e.jsx(ie,{onClick:()=>{v("status","Draft")},type:"submit",variant:"contained",size:"large",loading:l,children:"Save as Draft"})]}),D=[...P,...P.slice(1).flatMap(i=>P.slice(1).map(S=>i+S))];let Z=1;const T=e.jsxs(e.Fragment,{children:[c&&e.jsx(k,{md:4,item:!0,children:e.jsx(C,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(k,{xs:12,md:12,item:!0,children:e.jsx($,{children:e.jsxs(Ae,{children:[e.jsx(Te,{}),e.jsx(qe,{children:B==null?void 0:B.reduce((i,S)=>i.flatMap(N=>{var _;return(_=d.attributes[S])==null?void 0:_.map(he=>({...N,[S]:he}))}),[{}]).map(i=>e.jsx(Re,{selectedAttributes:z,counter:Z++,skuAlpha:D,attributes:i,values:d,currentProduct:a,setValue:v},Z))})]})})})]});return e.jsx(Ce,{methods:j,onSubmit:M,children:e.jsxs(k,{container:!0,spacing:3,children:[h,e.jsx(Ue,{values:d,setValue:v}),f,d.type==="Simple"&&e.jsx(De,{values:d,setValue:v}),d.type==="Variable"&&T,I]})})}export{$e as P};
