import{aS as oe,aF as ne,H as i,ao as E,j as e,B as g,au as F,S as o,bk as ce,dk as le,dl as de,bT as ue,ay as pe,a as y,T as b,am as T,b as xe,ap as me}from"./index-22016ea6.js";import{u as he,F as ge}from"./form-provider-711235d0.js";import{p as ye}from"./product-details-description-cd50cf9a.js";import{R as be}from"./Rating-14e060c0.js";function Pe({cart:p,product:x,onAddCart:d,onGotoStep:V,disabledActions:A,setProduct:B,...D}){var R;const L=oe(),N=ne(),{id:f,name:a,regularPrice:O,quantity:$,salePrice:u,totalRatings:z,totalReviews:G,images:Q,userId:m,type:h,productGroup:j,variables:w,content:S}=x,[P,W]=i.useState([]),H=async()=>{if(h==="Variable"&&j==="parent"){const{data:s}=await xe.get("/products",{params:{perPage:2e3}});W(s.products)}};i.useEffect(()=>{H()},[]);const M=(R=p==null?void 0:p.map(s=>s.id))==null?void 0:R.includes(f),v={id:f,name:a,quantity:1,price:u,images:Q},k=he({defaultValues:v}),{reset:J,watch:K,handleSubmit:U}=k,n=K();i.useEffect(()=>{x&&J(v)},[x]);const X=U(async s=>{try{M||d({...s,colors:[n.colors],subTotal:s.price*s.quantity,userId:m}),V(0),L.push(E.product.checkout)}catch(r){console.error(r)}}),Y=i.useCallback(()=>{try{d({...n,subTotal:n.price,userId:m}),console.log(n)}catch(s){console.error(s)}},[d,n]),Z=e.jsxs(g,{sx:{typography:"h5"},children:[u&&e.jsx(g,{component:"span",sx:{color:"text.disabled",textDecoration:"line-through",mr:.5},children:F(O)}),F(u)]}),_=e.jsxs(o,{direction:"row",children:[e.jsx(b,{variant:"subtitle2",sx:{flexGrow:1},children:"Quantity"}),e.jsx(o,{spacing:1,children:e.jsxs(b,{variant:"caption",component:"div",sx:{textAlign:"right"},children:["Available: ",$]})})]}),ee=e.jsxs(o,{direction:"row",spacing:2,children:[e.jsx(y,{fullWidth:!0,size:"large",color:"warning",variant:"contained",startIcon:e.jsx(me,{icon:"solar:cart-plus-bold",width:24}),onClick:Y,sx:{whiteSpace:"nowrap"},children:"Add to Cart"}),e.jsx(y,{fullWidth:!0,size:"large",type:"submit",variant:"contained",disabled:A,children:"Buy Now"})]}),se=!!S&&ye(S),te=e.jsxs(o,{direction:"row",alignItems:"center",sx:{color:"text.disabled",typography:"body2"},children:[e.jsx(be,{size:"small",value:z,precision:.1,readOnly:!0,sx:{mr:1}}),`(${ce(G)} reviews)`]}),[c,re]=i.useState({}),[C,I]=i.useState("");i.useEffect(()=>{I("");let s=a==null?void 0:a.split(" -")[0];Object.keys(c).map(t=>s=`${s} - ${c[t]}`);const r=P.find(t=>t.name.toLowerCase().includes(s.toLowerCase()));r&&B(t=>({...t,name:r.name,images:r.images,quantity:r.quantity,salePrice:r.salePrice,regularPrice:r.regularPrice}))},[c]);const ae=h==="Variable"&&j==="parent"&&e.jsxs(g,{display:"flex",flexDirection:"column",gap:"10px",children:[Object.keys(w).map((s,r)=>e.jsxs(le,{sx:{width:"50%"},size:"small",children:[e.jsx(de,{id:"demo-simple-select-label",children:s}),e.jsx(ue,{label:s,onChange:t=>{re(l=>({...l,[s]:t.target.value}))},children:w[s].map((t,l)=>e.jsx(pe,{value:t,children:t},l))},r)]},r)),e.jsx(y,{sx:{width:"50%"},variant:"contained",color:"success",disabled:!a.split("-")[1],onClick:()=>{let s=a==null?void 0:a.split(" -")[0];Object.keys(c).map(t=>s=`${s} - ${c[t]}`);const r=P.find(t=>t.name.toLowerCase().includes(s.toLowerCase()));if(r){const{id:t,name:l,salePrice:q,images:ie}=r;d({id:t,name:l,price:q,images:ie,subTotal:q,userId:m,quantity:1}),N(E.product.checkout)}else I("Out of stock")},children:"Buy"}),!!C&&e.jsx("p",{style:{color:"#F00A"},children:C})]});return e.jsx(ge,{methods:k,onSubmit:X,children:e.jsxs(o,{spacing:3,sx:{pt:3},...D,children:[e.jsxs(o,{spacing:2,alignItems:"flex-start",children:[e.jsx(b,{variant:"h5",children:a}),te,u!==null&&Z,se]}),ae,e.jsx(T,{sx:{borderStyle:"dashed"}}),_,e.jsx(T,{sx:{borderStyle:"dashed"}}),h==="Simple"&&ee]})})}export{Pe as P};
