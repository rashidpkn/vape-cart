import{b3 as ne,aC as oe,F as r,b2 as T,j as e,B as b,aq as A,S as i,aT as ce,bR as le,bS as de,bT as ue,at as pe,al as g,T as y,ak as D,aA as me,am as xe}from"./index-f9d9d421.js";import{u as he,F as be}from"./form-provider-70f60d80.js";import{p as ge}from"./product-details-description-2591d73d.js";import{R as ye}from"./Rating-406c67f4.js";function Pe({cart:u,product:p,onAddCart:d,onGotoStep:E,disabledActions:F,setProduct:V,...B}){var q;const L=ne(),N=oe(),{id:f,name:n,regularPrice:O,quantity:z,salePrice:m,totalRatings:G,totalReviews:Q,subDescription:j,images:W,userId:x,type:h,productGroup:w,variables:S}=p,[P,M]=r.useState([]),$=async()=>{if(h==="Variable"&&w==="parent"){const{data:s}=await me.get("/products",{params:{perPage:2e3}});M(s.products)}};r.useEffect(()=>{$()},[]);const H=(q=u==null?void 0:u.map(s=>s.id))==null?void 0:q.includes(f),v={id:f,name:n,quantity:1,price:m,images:W},k=he({defaultValues:v}),{reset:J,watch:K,handleSubmit:U}=k,o=K();r.useEffect(()=>{p&&J(v)},[p]);const X=U(async s=>{try{H||d({...s,colors:[o.colors],subTotal:s.price*s.quantity,userId:x}),E(0),L.push(T.product.checkout)}catch(a){console.error(a)}}),Y=r.useCallback(()=>{try{d({...o,subTotal:o.price,userId:x}),console.log(o)}catch(s){console.error(s)}},[d,o]),Z=e.jsxs(b,{sx:{typography:"h5"},children:[m&&e.jsx(b,{component:"span",sx:{color:"text.disabled",textDecoration:"line-through",mr:.5},children:A(O)}),A(m)]}),_=e.jsxs(i,{direction:"row",children:[e.jsx(y,{variant:"subtitle2",sx:{flexGrow:1},children:"Quantity"}),e.jsx(i,{spacing:1,children:e.jsxs(y,{variant:"caption",component:"div",sx:{textAlign:"right"},children:["Available: ",z]})})]}),ee=e.jsxs(i,{direction:"row",spacing:2,children:[e.jsx(g,{fullWidth:!0,size:"large",color:"warning",variant:"contained",startIcon:e.jsx(xe,{icon:"solar:cart-plus-bold",width:24}),onClick:Y,sx:{whiteSpace:"nowrap"},children:"Add to Cart"}),e.jsx(g,{fullWidth:!0,size:"large",type:"submit",variant:"contained",disabled:F,children:"Buy Now"})]}),se=!!j&&ge(j),te=e.jsxs(i,{direction:"row",alignItems:"center",sx:{color:"text.disabled",typography:"body2"},children:[e.jsx(ye,{size:"small",value:G,precision:.1,readOnly:!0,sx:{mr:1}}),`(${ce(Q)} reviews)`]}),[c,ae]=r.useState({}),[C,R]=r.useState("");r.useEffect(()=>{R("");let s=n.split(" -")[0];Object.keys(c).map(t=>s=s+" - "+c[t]);const a=P.find(t=>t.name.toLowerCase().includes(s.toLowerCase()));a&&V(t=>({...t,name:a.name,images:a.images,quantity:a.quantity,salePrice:a.salePrice,regularPrice:a.regularPrice}))},[c]);const re=h==="Variable"&&w==="parent"&&e.jsxs(b,{display:"flex",flexDirection:"column",gap:"10px",children:[Object.keys(S).map((s,a)=>e.jsxs(le,{sx:{width:"50%"},size:"small",children:[e.jsx(de,{id:"demo-simple-select-label",children:s}),e.jsx(ue,{label:s,onChange:t=>{ae(l=>({...l,[s]:t.target.value}))},children:S[s].map((t,l)=>e.jsx(pe,{value:t,children:t},l))},a)]})),e.jsx(g,{sx:{width:"50%"},variant:"contained",color:"success",disabled:!n.split("-")[1],onClick:()=>{let s=n.split(" -")[0];Object.keys(c).map(t=>s=s+" - "+c[t]);const a=P.find(t=>t.name.toLowerCase().includes(s.toLowerCase()));if(a){const{id:t,name:l,salePrice:I,images:ie}=a;d({id:t,name:l,price:I,images:ie,subTotal:I,userId:x,quantity:1}),N(T.product.checkout)}else R("Out of stock")},children:"Buy"}),!!C&&e.jsx("p",{style:{color:"#F00A"},children:C})]});return e.jsx(be,{methods:k,onSubmit:X,children:e.jsxs(i,{spacing:3,sx:{pt:3},...B,children:[e.jsxs(i,{spacing:2,alignItems:"flex-start",children:[e.jsx(y,{variant:"h5",children:n}),te,Z,se]}),re,e.jsx(D,{sx:{borderStyle:"dashed"}}),_,e.jsx(D,{sx:{borderStyle:"dashed"}}),h==="Simple"&&ee]})})}export{Pe as P};
