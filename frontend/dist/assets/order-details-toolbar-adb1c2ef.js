import{b6 as E,an as V,j as e,ao as H,ap as y,bf as oe,B as c,aG as N,aH as I,bm as M,aq as v,ar as $,b1 as F,am as O,bn as ae,S as x,bo as ne,as as _,at as U,al as W,ae as t,aw as le,F as b,b5 as ie,aA as A,b2 as L,aF as de,af as z,b3 as ce,ad as he,b4 as pe,b8 as xe,b0 as ue,ag as Q,ah as ge,ai as me,aj as je,bp as ye,bq as be,b9 as we,bl as fe,br as k,a$ as Ce,T as q,aS as Te}from"./index-1bfc0e48.js";import{C as G}from"./confirm-dialog-4456da0c.js";import{u as ve,g as Pe,e as Re}from"./use-table-b4740195.js";import"./custom-date-range-picker-73145294.js";import{T as Se}from"./TableContainer-302f11bb.js";import{C as De}from"./CardHeader-4ba62ae9.js";function J({row:n,selected:u,onViewRow:g,onSelectRow:m,onDeleteRow:j}){const{id:o,items:d,status:i,createdAt:w,customer:a,totalQuantity:s,subTotal:f}=n,P=E(),h=E(),R=V(),B=e.jsxs(H,{hover:!0,selected:u,children:[e.jsx(y,{padding:"checkbox",children:e.jsx(oe,{checked:u,onClick:m})}),e.jsx(y,{children:e.jsxs(c,{onClick:g,sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},children:["#",o]})}),e.jsxs(y,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(N,{alt:a==null?void 0:a.name,src:a==null?void 0:a.avatarUrl,sx:{mr:2}}),e.jsx(I,{primary:a==null?void 0:a.name,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled"}})]}),e.jsx(y,{children:e.jsx(I,{primary:M(new Date(w),"dd MMM yyyy"),secondary:M(new Date(w),"p"),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsxs(y,{align:"center",children:[" ",d.length," "]}),e.jsxs(y,{children:[" ",v(d.reduce((p,T)=>p+T.price,0))," "]}),e.jsxs(y,{children:[" ",v(d.reduce((p,T)=>p+T.price,0)*.2)," "]}),e.jsx(y,{children:e.jsx($,{variant:"soft",color:i==="completed"&&"success"||i==="pending"&&"warning"||i==="cancelled"&&"error"||"default",children:i})}),e.jsxs(y,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(F,{color:h.value?"inherit":"default",onClick:h.onToggle,sx:{...h.value&&{bgcolor:"action.hover"}},children:e.jsx(O,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(F,{color:R.open?"inherit":"default",onClick:R.onOpen,children:e.jsx(O,{icon:"eva:more-vertical-fill"})})]})]}),C=e.jsx(H,{children:e.jsx(y,{sx:{p:0,border:"none"},colSpan:8,children:e.jsx(ae,{in:h.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(x,{component:ne,sx:{m:1.5},children:d.map(p=>e.jsxs(x,{direction:"row",alignItems:"center",sx:{p:T=>T.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:T=>`solid 2px ${T.palette.background.neutral}`}},children:[e.jsx(N,{src:p.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(I,{primary:p.name,secondary:p.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs(c,{children:["x",p.quantity]}),e.jsx(c,{sx:{width:110,textAlign:"right"},children:v(p.price)})]},p.id))})})})});return e.jsxs(e.Fragment,{children:[B,C,e.jsxs(_,{open:R.open,onClose:R.onClose,arrow:"right-top",sx:{width:140},children:[e.jsxs(U,{onClick:()=>{g(),R.onClose()},children:[e.jsx(O,{icon:"solar:eye-bold"}),"View"]}),e.jsxs(U,{onClick:()=>{P.onTrue(),R.onClose()},sx:{color:"error.main"},children:[e.jsx(O,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]}),e.jsx(G,{open:P.value,onClose:P.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(W,{variant:"contained",color:"error",onClick:j,children:"Delete"})})]})}J.propTypes={onDeleteRow:t.func,onSelectRow:t.func,onViewRow:t.func,row:t.object,selected:t.bool};t.bool,t.object,t.func,t.func;t.object,t.func,t.func,t.number;t.node,t.string,t.object;const Oe=[{value:"all",label:"All"},...fe],Ae=[{id:"orderNumber",label:"Order",width:116},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Price",width:140},{id:"commission",label:"Commission",width:140},{id:"status",label:"Status",width:110},{id:"",width:88}],ke={name:"",status:"all",startDate:null,endDate:null};function Me(){const{user:{id:n}}=le(),[u,g]=b.useState([]),[m,j]=b.useState([]),[o,d]=b.useState([]),i=async()=>{try{const{data:{products:r}}=await A.get("products",{params:{userId:n,perPage:100}});j(r.map(l=>l.id))}catch{alert("Error occurred while fetching products.")}},w=async()=>{try{const{data:r}=await A.get("/orders");g(r)}catch(r){console.log(r.message)}};b.useEffect(()=>{i(),w()},[]);function a(r,l){return r.map(D=>{const se=D.items.filter(te=>te.userId===l);return{...D,items:se}})}b.useEffect(()=>{let r=u.filter(l=>l.items.some(D=>m.includes(D.id))).reverse();d(a(r,n))},[u,m]);const s=ve({defaultOrderBy:"orderNumber"}),f=ie(),P=E(),[h,R]=b.useState(ke),B=h.startDate&&h.endDate?h.startDate.getTime()>h.endDate.getTime():!1,C=Ie({inputData:o,comparator:Pe(s.order,s.orderBy),filters:h,dateError:B}),p=C.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage),T=s.dense?52:72,K=!!h.name||h.status!=="all"||!!h.startDate&&!!h.endDate,X=!C.length&&K||!C.length,Y=b.useCallback(r=>{A.delete("orders",{data:{id:r}});const l=o.filter(D=>D.id!==r);d(l),s.onUpdatePageDeleteRow(p.length)},[p.length,s,o]),Z=b.useCallback(()=>{A.delete("orders",{data:{id:s.selected}});const r=o.filter(l=>!s.selected.includes(l.id));d(r),s.onUpdatePageDeleteRows({totalRows:o.length,totalRowsInPage:p.length,totalRowsFiltered:C.length})},[C.length,p.length,s,o]),ee=b.useCallback(r=>{f.push(L.dashboard.order.details(r))},[f]),[S,re]=b.useState("all");return e.jsxs(e.Fragment,{children:[e.jsxs(c,{px:5,children:[e.jsx(de,{heading:"Orders",links:[{name:"Dashboard",href:L.dashboard.root},{name:"Orders",href:L.dashboard.order.root}],sx:{mb:{xs:3,md:5}}}),e.jsxs(z,{children:[e.jsx(ce,{value:S,onChange:(r,l)=>re(l),sx:{px:2.5,boxShadow:r=>`inset 0 -2px 0 0 ${he(r.palette.grey[500],.08)}`},children:Oe.map(r=>e.jsx(pe,{iconPosition:"end",value:r.value,label:r.label,icon:e.jsxs($,{variant:(r.value==="all"||r.value===h.status)&&"filled"||"soft",color:r.value==="completed"&&"success"||r.value==="pending"&&"warning"||r.value==="cancelled"&&"error"||"default",children:[r.value==="all"&&o.length,r.value==="pending"&&o.filter(l=>l.status==="Order received"||l.status==="pending").length,r.value==="completed"&&o.filter(l=>l.status==="completed").length,r.value==="cancelled"&&o.filter(l=>l.status==="cancelled").length,r.value==="refunded"&&o.filter(l=>l.status==="refunded").length]})},r.value))}),e.jsxs(Se,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(xe,{dense:s.dense,numSelected:s.selected.length,rowCount:o.length,onSelectAllRows:r=>s.onSelectAllRows(r,o.map(l=>l.id)),action:e.jsx(ue,{title:"Delete",children:e.jsx(F,{color:"primary",onClick:P.onTrue,children:e.jsx(O,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(Q,{children:e.jsxs(ge,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(me,{order:s.order,orderBy:s.orderBy,headLabel:Ae,rowCount:o.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:r=>s.onSelectAllRows(r,o.map(l=>l.id))}),e.jsxs(je,{children:[C.filter(r=>S==="all"||S==="pending"&&(r.status==="pending"||r.status==="Order received")||S==="completed"&&r.status==="completed"||S==="cancelled"&&r.status==="cancelled"||S==="refunded"&&r.status==="refunded").map(r=>e.jsx(J,{row:r,selected:s.selected.includes(r.id),onSelectRow:()=>s.onSelectRow(r.id),onDeleteRow:()=>Y(r.id),onViewRow:()=>ee(r.id)},r.id)),e.jsx(ye,{height:T,emptyRows:Re(s.page,s.rowsPerPage,o.length)}),e.jsx(be,{notFound:X})]})]})})]}),e.jsx(we,{count:C.length,page:s.page,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onRowsPerPageChange:s.onChangeRowsPerPage,onChangeDense:s.onChangeDense})]})]}),e.jsx(G,{open:P.value,onClose:P.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," items?"]}),action:e.jsx(W,{variant:"contained",color:"error",onClick:()=>{Z(),P.onFalse()},children:"Delete"})})]})}function Ie({inputData:n,comparator:u,filters:g,dateError:m}){const{status:j,name:o,startDate:d,endDate:i}=g,w=n.map((a,s)=>[a,s]);return w.sort((a,s)=>{const f=u(a[0],s[0]);return f!==0?f:a[1]-s[1]}),n=w.map(a=>a[0]),o&&(n=n.filter(a=>{var s,f;return a.orderNumber.toLowerCase().indexOf(o.toLowerCase())!==-1||((s=a.customer)==null?void 0:s.name.toLowerCase().indexOf(o.toLowerCase()))!==-1||((f=a.customer)==null?void 0:f.email.toLowerCase().indexOf(o.toLowerCase()))!==-1})),j!=="all"&&(n=n.filter(a=>a.status===j)),m||d&&i&&(n=n.filter(a=>k(a.createdAt)>=k(d)&&k(a.createdAt)<=k(i))),n}t.object,t.object,t.object,t.object;function Fe({items:n=[],shipping:u,discount:g,taxes:m,subTotal:j,totalAmount:o}){const d=e.jsxs(x,{spacing:2,alignItems:"flex-end",sx:{my:3,textAlign:"right",typography:"body2"},children:[e.jsxs(x,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(c,{sx:{width:160,typography:"subtitle2"},children:v(j)||"-"})]}),e.jsxs(x,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Shipping"}),e.jsx(c,{sx:{width:160,...u&&{color:"error.main"}},children:u?`- ${v(u)}`:"-"})]}),e.jsxs(x,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(c,{sx:{width:160,...g&&{color:"error.main"}},children:g?`- ${v(g)}`:"-"})]}),e.jsxs(x,{direction:"row",children:[e.jsx(c,{sx:{color:"text.secondary"},children:"Taxes"}),e.jsx(c,{sx:{width:160},children:m?v(m):"-"})]}),e.jsxs(x,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx(c,{children:"Total"}),e.jsx(c,{sx:{width:160},children:v(o)||"-"})]})]});return e.jsxs(z,{children:[e.jsx(De,{title:"Details"}),e.jsxs(x,{sx:{px:3},children:[e.jsx(Q,{children:n==null?void 0:n.map(i=>e.jsxs(x,{direction:"row",alignItems:"center",sx:{py:3,minWidth:640,borderBottom:w=>`dashed 2px ${w.palette.background.neutral}`},children:[e.jsx(N,{src:i.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(I,{primary:i.name,secondary:i.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs(c,{sx:{typography:"body2"},children:["x",i.quantity]}),e.jsx(c,{sx:{width:110,textAlign:"right",typography:"subtitle2"},children:v(i.salePrice)})]},i.id))}),d]})]})}Fe.propTypes={discount:t.number,items:t.array,shipping:t.number,subTotal:t.number,taxes:t.number,totalAmount:t.number};function Be({status:n,backLink:u,createdAt:g,orderNumber:m,statusOptions:j,onChangeStatus:o}){const d=V();return e.jsxs(e.Fragment,{children:[e.jsx(x,{spacing:3,direction:{xs:"column",md:"row"},sx:{mb:{xs:3,md:5}},children:e.jsxs(x,{spacing:1,direction:"row",alignItems:"flex-start",children:[e.jsx(F,{component:Ce,href:u,children:e.jsx(O,{icon:"eva:arrow-ios-back-fill"})}),e.jsxs(x,{spacing:.5,children:[e.jsxs(x,{spacing:1,direction:"row",alignItems:"center",children:[e.jsxs(q,{variant:"h4",children:[" Order ",m," "]}),e.jsx($,{variant:"soft",color:n==="completed"&&"success"||n==="pending"&&"warning"||n==="cancelled"&&"error"||"default",children:n})]}),e.jsx(q,{variant:"body2",sx:{color:"text.disabled"},children:Te(g)})]})]})}),e.jsx(_,{open:d.open,onClose:d.onClose,arrow:"top-right",sx:{width:140},children:j.map(i=>e.jsx(U,{selected:i.value===n,onClick:()=>{d.onClose(),o(i.value)},children:i.label},i.value))})]})}Be.propTypes={backLink:t.string,createdAt:t.instanceOf(Date),onChangeStatus:t.func,orderNumber:t.string,status:t.string,statusOptions:t.array};export{Me as O,Be as a,Fe as b};
