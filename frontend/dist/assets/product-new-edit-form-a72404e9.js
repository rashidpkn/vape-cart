import{H as r,j as e,aX as Te,aY as De,aF as Re,b as y,aS as qe,aZ as Ue,a_ as Ne,ar as fe,ao as ze,aB as p,T as b,ah as K,S as U,a$ as z,B as f,b0 as Ee,b1 as Ke,b2 as $e,b3 as re,b4 as X,b5 as Le,a as N,b6 as Oe,b7 as Ge,b8 as h,b9 as _e,ba as ue,aj as Ye,bb as He,as as ye,at as d,al as Ve}from"./index-d26ef6f4.js";import{c as Me,a as w,b as oe,d as Qe,e as ce,f as Xe,u as Ze,R as $,g as Je,h as We,i as M,j as he,k as Pe,l as Se,F as ea}from"./form-provider-5acf8a0f.js";import{o as aa,L as xe}from"./yup-446c41e8.js";import{C as Q}from"./CardHeader-ab668787.js";import{F as B,R as Z}from"./Radio-3055c28d.js";let ge=!1;const be=r.forwardRef(function(o,R){return ge||(console.warn(["MUI: The Autocomplete component was moved from the lab to the core.","","You should use `import { Autocomplete } from '@mui/material'`","or `import Autocomplete from '@mui/material/Autocomplete'`"].join(`
`)),ge=!0),e.jsx(Te,De({ref:R},o))});function ra({currentProduct:s}){const o=Re(),[R,L]=r.useState(!1),[O,J]=r.useState([]);r.useEffect(()=>{y.get("/attributes").then(a=>{J(a.data)})},[]);const S=qe(),x=Ue("up","md"),{enqueueSnackbar:W}=Ne(),{user:u}=fe(),G=Me().shape({name:w().required("Name is required"),subDescription:w().required("Short description is required").test("not-four-digits","Your content contain continues 7 digit number, Please remove",a=>!/\d{7,}/.test(a)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',a=>!/@/.test(a)),content:w().test("not-four-digits","Your content contain continues 7 digit number, Please remove",a=>!/\d{7,}/.test(a)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',a=>!/@/.test(a)),images:oe().min(1,"Image is required"),type:w(),category:w().required("Category is required"),tags:oe(),SKU:w().required("SKU is required"),brand:w().required("brand is required"),status:w().required("brand is required"),attributes:oe(),track:Qe(),quantity:ce(),regularPrice:ce().moreThan(0,"Price should not be AED 0.00"),salePrice:ce().lessThan(Xe("regularPrice"),"Sale price must be less than the regular price")}),F=r.useMemo(()=>({id:(s==null?void 0:s.id)||"",name:(s==null?void 0:s.name)||"",subDescription:(s==null?void 0:s.subDescription)||"",content:(s==null?void 0:s.content)||"",images:(s==null?void 0:s.images)||[],type:(s==null?void 0:s.type)||"Simple",category:(s==null?void 0:s.category)||"Disposables",tags:(s==null?void 0:s.tags)||[],SKU:(s==null?void 0:s.SKU)||"",brand:(s==null?void 0:s.brand)||"SMOK",status:(s==null?void 0:s.status)||"Published",attributes:(s==null?void 0:s.attributes)||[],track:(s==null?void 0:s.track)||!0,quantity:(s==null?void 0:s.quantity)||0,regularPrice:(s==null?void 0:s.regularPrice)||0,salePrice:(s==null?void 0:s.salePrice)||0}),[s]),[g,v]=r.useState({}),[E,I]=r.useState([]),_=Ze({resolver:aa(G),defaultValues:F}),{reset:k,watch:P,setValue:c,handleSubmit:ee,formState:{isSubmitting:C,isValid:Y}}=_,i=P(),[T,ae]=r.useState([]),se=r.useCallback(async()=>{const{data:a}=await y.get("/products",{params:{name:i.name,productGroup:"parent"}});ae(a.products.filter(t=>!t.name.includes("-")))},[i.name]);r.useEffect(()=>{se()},[i.name]),r.useEffect(()=>{s&&k(F)},[s,F,k]);const te=ee(async a=>{try{s?await y.patch("products",{...a,username:u.displayName,userId:u.id,storeName:u.storeName}):await y.post("products",{...a,username:u.displayName,userId:u.id,storeName:u.storeName}),k(),W(s?"Update success!":"Create success!"),S.push(ze.dashboard.product.root)}catch(t){console.log(t)}}),ne=r.useCallback(a=>{const t=i.images||[],n=a.map(l=>Object.assign(l,{preview:URL.createObjectURL(l)}));c("images",[...t,...n],{shouldValidate:!0})},[c,i.images]),m=r.useCallback(a=>{var n;const t=i.images&&((n=i.images)==null?void 0:n.filter(l=>l!==a));c("images",t)},[c,i.images]),A=r.useCallback(()=>{c("images",[])},[c]),q=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(b,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(b,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(K,{children:[!x&&e.jsx(Q,{title:"Details"}),e.jsxs(U,{spacing:3,sx:{p:3},children:[e.jsx(be,{value:i.name,onChange:(a,t)=>{if(t){const n=T.find(l=>l.name===t);n&&(c("images",n.images),c("name",n.name),c("category",n.category),c("brand",n.brand),c("type",n.type))}else c("images",null)},name:"name",label:"Product Name",options:T.map(a=>a.name),getOptionLabel:a=>a,isOptionEqualToValue:(a,t)=>a===t.value,renderInput:a=>e.jsx(z,{...a,label:"Product Name",value:i.name,onChange:t=>c("name",t.target.value)}),renderOption:(a,t)=>e.jsxs(f,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...a,children:[e.jsx("img",{loading:"lazy",width:"20",src:T.find(n=>n.name===t).images[0],alt:""}),t]}),freeSolo:!0}),e.jsx($,{name:"subDescription",label:"Sub Description",multiline:!0,rows:4}),e.jsxs(U,{spacing:1.5,children:[e.jsx(b,{variant:"subtitle2",children:"Content"}),e.jsx(Je,{simple:!0,name:"content"})]}),e.jsxs(U,{spacing:1.5,children:[e.jsx(b,{variant:"subtitle2",children:"Images"}),e.jsx(We,{multiple:!0,name:"images",maxSize:3145728,onDrop:ne,onRemove:m,onRemoveAll:A,onUpload:async a=>{try{const t=new FormData;i.images.forEach(l=>{t.append("images",l)});const{data:n}=await y.post("upload",t);c("images",n),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})]})]})]})})]}),[D,de]=r.useState({name:"",show:!1}),[Fe,ie]=r.useState(!1),ve=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(b,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(b,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(K,{children:[!x&&e.jsx(Q,{title:"Properties"}),e.jsx(U,{spacing:3,sx:{p:3},children:e.jsxs(f,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(M,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:Ee.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx(M,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:Ke.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx(he,{name:"tags",label:"Tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:$e.map(a=>a),getOptionLabel:a=>a,renderOption:(a,t)=>r.createElement("li",{...a,key:t},t),renderTags:(a,t)=>a.map((n,l)=>r.createElement(re,{...t({index:l}),key:n,label:n,size:"small",color:"info",variant:"soft"}))}),e.jsxs(f,{children:[e.jsx($,{name:"SKU",label:"Product SKU"}),e.jsx(B,{label:"Automatically generate SKUs",control:e.jsx(X,{checked:Fe,onChange:a=>{a.target.checked?i.name.replaceAll(" ","").trim().length>=8?(c("SKU",i.name.replaceAll(" ","").trim().slice(0,8)+"-1"),ie(!0)):(ie(!1),alert("To automatically generate SKUs, ensure that the product name has at least 8 characters.")):(c("SKU",""),ie(!1))}})})]}),e.jsx(M,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:Le.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(B,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(X,{checked:D.show,onChange:a=>de(t=>({...t,show:a.target.checked}))})}),D.show&&e.jsxs(e.Fragment,{children:[e.jsx(z,{label:"Brand Name",style:{width:300},onChange:a=>de(t=>({...t,name:a.target.value})),value:D.name}),e.jsx(N,{variant:"contained",color:"success",onClick:async()=>{try{D.name?(await y.post("/notifications",{userId:u.id,role:"admin",title:"ðŸš€ New Brand Approval Request! ðŸš€",message:`Exciting news! A new brand has been submitted for approval. Brand Name: ${D.name}. ðŸ›ï¸`,type:"product"}),alert("Your request to create a new brand is being processed. Please wait while we verify the brand.")):alert("Please enter brand name")}catch{alert("An error occurred while adding this brand.")}},children:"Add Brand"})]})]}),e.jsx(M,{native:!0,name:"status",label:"status",InputLabelProps:{shrink:!0},children:Oe.map(a=>e.jsx("option",{value:a,children:a},a))})]})})]})})]}),ke=(a,t,n)=>{if(i.type==="Variable"||i.type==="Simple"&&n==="Flavour"){v(V=>({...V,[n]:t}));const l=n==="Bottle Size"&&h.bottleSize||n==="Puffs"&&h.puffs||n==="Flavour"&&h.flavour||n==="Nicotine Strength"&&h.nicotineStrength||n==="Color"&&h.color||n==="Batteries"&&h.batteries||[],j=t[t.length-1];if(!j)return;l.find(V=>V===j)||(console.log("upload"),y.post("/attributes",{username:u.displayName,attribute:n,value:j}).then(V=>{console.log("updated")}))}else{const l=t[t.length-1];console.log({...g,[n]:[l]}),v(j=>({...j,[n]:[l]}))}};console.log(g),console.log(E);const Ce=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(b,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(b,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(K,{children:[!x&&e.jsx(Q,{title:"Attributes"}),e.jsx(U,{spacing:3,sx:{p:3},children:e.jsxs(f,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(f,{sx:{gridColumn:"span 2 "},children:e.jsx(he,{name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:Ge.map(a=>a),getOptionLabel:a=>a,renderOption:(a,t)=>r.createElement("li",{...a,key:t},t),renderTags:(a,t)=>a.map((n,l)=>r.createElement(re,{...t({index:l}),key:n,label:n,size:"small",color:"info",variant:"soft"}))})}),i.attributes.map(a=>e.jsxs(f,{sx:{gridColumn:"span 1 "},children:[e.jsx(be,{multiple:!0,freeSolo:!0,options:[...a==="Bottle Size"?h.bottleSize:[],...a==="Puffs"?h.puffs:[],...a==="Flavour"?h.flavour:[],...a==="Nicotine Strength"?h.nicotineStrength:[],...a==="Color"?h.color:[],...a==="Batteries"?h.batteries:[],...O.filter(t=>t.attribute===a).map(t=>t.value)],value:g[a]||[],onChange:(t,n)=>{ke(t,n,a),i.type==="Simple"&&(a==="Flavour"?n.length>=2?E.find(l=>l===a)||I(l=>[...l,a]):I(l=>l.filter(j=>j!==a)):I([a]))},renderInput:t=>e.jsx(z,{...t,label:a,placeholder:a}),renderTags:(t,n)=>t.map((l,j)=>r.createElement(re,{...n({index:j}),key:l,label:l,size:"small",color:"info",variant:"soft"}))}),i.type==="Variable"&&e.jsx(B,{label:"Use this attribute to create Variations",control:e.jsx(X,{onChange:t=>{t.target.checked?I(n=>[...new Set([...n,a])]):I(n=>[...new Set(n.filter(l=>l!==a))])}})})]},a))]})})]})})]}),Ae=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(b,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(b,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(K,{children:[!x&&e.jsx(Q,{title:"Pricing"}),e.jsxs(U,{spacing:3,sx:{p:3},children:[e.jsx(Pe,{name:"track",label:"Track"}),i.track&&e.jsx($,{name:"quantity",label:"Quantity",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0}}),!i.track&&e.jsx(_e,{children:e.jsxs(Se,{defaultValue:"Instock",row:!0,children:[e.jsx(B,{d:!0,value:"Instock",control:e.jsx(Z,{defaultChecked:!0}),label:"Instock"}),e.jsx(B,{value:"Outstock",control:e.jsx(Z,{}),label:"Outstock"})]})}),e.jsx($,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ue,{position:"start",children:e.jsx(f,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx($,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ue,{position:"start",children:e.jsx(f,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})]})})]}),we=e.jsx(e.Fragment,{children:e.jsxs(p,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},gap:2.5,children:[e.jsx(xe,{type:"submit",variant:"contained",size:"large",loading:C,children:s?"Save Changes":"Create Product"}),e.jsx(xe,{onClick:()=>{c("status","Draft")},type:"submit",variant:"contained",size:"large",loading:C,children:"Save as Draft"})]})}),Be=e.jsx(e.Fragment,{children:e.jsx(p,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:e.jsx(N,{variant:"contained",size:"large",onClick:()=>{o("/dashboard/product")},children:"Save Product"})})}),le=["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],me=[...le,...le.slice(1).flatMap(a=>le.slice(1).map(t=>a+t))];let H=1,pe=0;const Ie=e.jsxs(e.Fragment,{children:[x&&e.jsx(p,{md:4,children:e.jsx(b,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(p,{xs:12,md:12,children:e.jsx(K,{children:e.jsxs(Ye,{children:[e.jsx(He,{children:e.jsxs(ye,{children:[e.jsx(d,{children:"ID"}),e.jsx(d,{width:150,children:"SKU"}),e.jsx(d,{width:250,children:"Attributes"}),e.jsx(d,{width:150,children:"Track Stock"}),e.jsx(d,{children:"Stock"}),e.jsx(d,{children:"Regular Price"}),e.jsx(d,{children:"Sales Price"}),e.jsx(d,{children:"Image"}),e.jsx(d,{width:200,children:"Add Product"})]})}),e.jsxs(Ve,{children:[e.jsx(je,{counter:H++,counter2:pe++,skuAlpha:me,va:"Parent",values:i,variables:g,disabled:!0,isSubmitting:C,isValid:Y,setProductAdded:()=>{},currentProduct:s},H),E.reduce((a,t)=>a.flatMap(n=>g[t].map(l=>`${n} - ${l}`)),[""]).map(a=>e.jsx(je,{counter:H++,counter2:pe++,skuAlpha:me,va:a.slice(3),values:i,variables:g,disabled:!1,isSubmitting:C,isValid:Y,setProductAdded:L,currentProduct:s},H))]})]})})})]});return e.jsx(ea,{methods:_,onSubmit:te,children:e.jsxs(p,{container:!0,spacing:3,children:[q,ve,Ce,i.type==="Simple"&&Ae,i.type==="Variable"&&Ie,i.type==="Simple"&&we,i.type==="Variable"&&R&&Be]})})}function je({counter:s,values:o,skuAlpha:R,counter2:L,va:O,variables:J,disabled:S,setProductAdded:x,currentProduct:W}){const{user:u}=fe(),G=R[L]?`${o.SKU}-${R[L]}`:o.SKU;let{name:F}=o;const g=O==="Parent";g||(F=`${o.name} - ${O}`);const[v,E]=r.useState(!0),[I,_]=r.useState("instock"),[k,P]=r.useState(null),[c,ee]=r.useState(null),[C,Y]=r.useState(null),[i,T]=r.useState("pending"),[ae,se]=r.useState(null),te=async m=>{try{const A=new FormData;A.append("images",m.target.files[0]);const{data:q}=await y.post("upload",A);se([q[0],...o.images])}catch{}},ne=async()=>{const m=/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{2B50}\u{2B55}\u{231A}-\u{231B}\u{23E9}-\u{23EC}\u{23F0}\u{23F3}\u{25AA}-\u{25AB}\u{25B6}\u{25C0}\u{25FB}-\u{25FE}\u{2B1B}-\u{2B1C}\u{2934}-\u{2935}\u{2B05}-\u{2B07}\u{2194}-\u{2199}\u{21A9}-\u{21AA}\u{2B06}\u{2B07}\u{2B1B}\u{2B1C}]/u,A=/\d{7,}/,q=/@/;if(m.test(o.subDescription)||m.test(o.content)){alert("Your content contain emojis, Please remove emojis");return}if(A.test(o.subDescription)||A.test(o.content)){alert("Your content contain continues 7 digit number, Please remove");return}if(q.test(o.subDescription)||q.test(o.content)){alert('Your content contains the "@" symbol. Please remove it.');return}if(!g){if(!C&&v)return alert("Quantity is required.");if(!k)return alert("Regular price is required.");if(c&&k<=c)return alert("Sale price must be less than the regular price")}if(i==="pending"){T("loading");try{await y.post("/products",{username:u.displayName,userId:u.id,storeName:u.storeName,name:F,subDescription:o.subDescription,content:o.content,images:ae??o.images,type:o.type,category:o.category,tags:o.tags,parentSku:o.SKU,brand:o.brand,status:o.status,attributes:o.attributes,variables:J,SKU:G,track:v,quantity:C,regularPrice:k,salePrice:c,productGroup:g?"parent":"child"}),T("success"),x(!0)}catch(D){console.log(`Product Creation failed :${D}`),T("failed")}}};return e.jsxs(ye,{style:{backgroundColor:S&&"rgba(0,0,0,0.1)"},children:[e.jsx(d,{children:s}),e.jsx(d,{children:G}),e.jsx(d,{children:g?`${F} - Parent`:F}),e.jsx(d,{children:e.jsx(B,{label:"",control:e.jsx(X,{checked:v,onChange:m=>E(m.target.checked),disabled:S})})}),e.jsxs(d,{width:150,children:[v&&e.jsx(z,{inputProps:{min:0},disabled:S,size:"small",label:"Quantity",type:"number",onChange:m=>Y(+m.target.value||null),value:C}),!v&&e.jsxs(Se,{"aria-label":"Stock",name:"Stock",value:I,onChange:m=>_(m.target.value),children:[e.jsx(B,{value:"instock",control:e.jsx(Z,{}),label:"Instock"}),e.jsx(B,{value:"outstock",control:e.jsx(Z,{}),label:"Outstock"})]})]}),e.jsx(d,{width:150,children:e.jsx(z,{inputProps:{min:0},disabled:S,size:"small",label:"Price",type:"number",onChange:m=>P(+m.target.value||null),value:k})}),e.jsx(d,{width:150,children:e.jsx(z,{inputProps:{min:0},disabled:S,size:"small",label:"Price",type:"number",onChange:m=>ee(+m.target.value||null),value:c})}),e.jsx(d,{width:150,children:e.jsx("input",{size:"small",label:"Image",type:"file",onChange:te,disabled:S,style:{width:"150px"}})}),e.jsxs(d,{children:[i==="pending"&&e.jsx(N,{color:"success",variant:"contained",size:"small",onClick:ne,type:"submit",children:W?"Save Changes ":" Add Product"}),i==="loading"&&e.jsx(N,{color:"success",variant:"contained",size:"small",children:"Loading"}),i==="success"&&e.jsx(N,{color:"success",variant:"contained",size:"small",children:"Product Created"}),i==="failed"&&e.jsx(N,{color:"success",variant:"contained",size:"small",children:"Product creation failed"})]})]})}export{ra as P};
