import{x as L,at as U,j as e,c as p,A as E,y as R,b5 as N,e as b,h as $,al as F,z as O,i as te,v as u,P as re,B as k,k as S,au as M,t as H,E as h,u as ae,r as v,aa as oe,ai as B,d as ne,C as V,b9 as le,as as ie,ba as de,aC as ce,S as z,b8 as he,bb as I,ah as pe,p as _,bc as ue}from"./index-19627c7e.js";import{C as W}from"./confirm-dialog-a800d09d.js";import{u as xe,g as ge,e as me}from"./use-table-bd5fff42.js";import{b as ye,T as je,d as we,a as fe,c as be}from"./table-pagination-custom-9ec820f5.js";import{b as q,c as w,T as Te,d as ve}from"./TableRow-028ae33c.js";import{C as Ce}from"./Checkbox-53b24ccf.js";import{T as Pe}from"./TableContainer-32fe2c28.js";import{C as Se}from"./CardHeader-f597a592.js";function Q({row:i,selected:x,onViewRow:y,onSelectRow:j,onDeleteRow:f}){const{id:r,items:l,status:c,createdAt:T,customer:a}=i,t=L(),g=L(),C=U();console.log(l);const m=e.jsxs(q,{hover:!0,selected:x,children:[e.jsx(w,{padding:"checkbox",children:e.jsx(Ce,{checked:x,onClick:j})}),e.jsx(w,{children:e.jsxs(p,{onClick:y,sx:{cursor:"pointer","&:hover":{textDecoration:"underline"}},children:["#",r.toString().padStart(3,"0")]})}),e.jsxs(w,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(E,{alt:a==null?void 0:a.first_name,src:a==null?void 0:a.avatarUrl,sx:{mr:2}}),e.jsx(R,{primary:(a==null?void 0:a.first_name)+(a==null?void 0:a.last_name),primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled"}})]}),e.jsx(w,{children:e.jsx(R,{primary:N(new Date(T),"dd MMM yyyy"),secondary:N(new Date(T),"p"),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsxs(w,{align:"center",children:[" ",l==null?void 0:l.reduce((o,d)=>o+d.quantity,0)," "]}),e.jsxs(w,{children:[" ",b(l==null?void 0:l.reduce((o,d)=>o+d.quantity*d.price,0))," "]}),e.jsxs(w,{children:[" ",b((l==null?void 0:l.reduce((o,d)=>o+d.quantity*d.price,0))*.3)," "]}),e.jsx(w,{children:b((l==null?void 0:l.reduce((o,d)=>o+d.quantity*d.price,0))*.7)}),e.jsx(w,{children:e.jsx($,{variant:"soft",color:c==="completed"&&"success"||c==="pending"&&"warning"||c==="cancelled"&&"error"||"default",children:c})}),e.jsxs(w,{align:"right",sx:{px:1,whiteSpace:"nowrap"},children:[e.jsx(F,{color:g.value?"inherit":"default",onClick:g.onToggle,sx:{...g.value&&{bgcolor:"action.hover"}},children:e.jsx(O,{icon:"eva:arrow-ios-downward-fill"})}),e.jsx(F,{color:C.open?"inherit":"default",children:e.jsx(O,{icon:"eva:more-vertical-fill"})})]})]}),A=e.jsx(q,{children:e.jsx(w,{sx:{p:0,border:"none"},colSpan:10,children:e.jsx(te,{in:g.value,timeout:"auto",unmountOnExit:!0,sx:{bgcolor:"background.neutral"},children:e.jsx(u,{component:re,sx:{m:1.5},children:l.map(o=>e.jsxs(u,{direction:"row",alignItems:"center",sx:{p:d=>d.spacing(1.5,2,1.5,1.5),"&:not(:last-of-type)":{borderBottom:d=>`solid 2px ${d.palette.background.neutral}`}},children:[e.jsx(E,{src:o.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(R,{primary:o.name,secondary:o.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5},sx:{width:"50%"}}),e.jsxs(p,{children:["x",o.quantity]}),e.jsx(p,{sx:{width:110,textAlign:"right"},children:b(o.price)}),e.jsx(k,{variant:"contained",color:"success",sx:{mx:5},onClick:async()=>{try{await S.patch(`/orders/change-item-status/${r}`,{itemId:o.id,status:"Product Is ready"}),await S.post("/notifications",{userId:o.userId,role:"admin",title:`ğŸš€ ${o.name} Product Is ready ğŸš€`,message:`${o.name} is ready for shipping`,type:"product"}),alert("Product Status is update to admin,they will pick the order")}catch{console.log()}},children:"Product is Ready"}),e.jsx(k,{variant:"contained",color:"warning",sx:{mx:5},onClick:async()=>{try{const d=window.prompt("Issues?");await S.patch(`/orders/change-item-status/${r}`,{itemId:o.id,status:"Product has some issue"}),await S.post("/notifications",{userId:o.userId,role:"admin",title:`ğŸš€ ${o.name} Product has some issue ğŸš€`,message:d,type:"product"}),alert("Product Status is update to admin,they will resolve the issue")}catch{}},children:"Product has some issue"})]},o.id))})})})});return e.jsxs(e.Fragment,{children:[m,A,e.jsx(M,{open:C.open,onClose:C.onClose,arrow:"right-top",sx:{width:140},children:e.jsxs(H,{onClick:()=>{t.onTrue(),C.onClose()},sx:{color:"error.main"},children:[e.jsx(O,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})}),e.jsx(W,{open:t.value,onClose:t.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(k,{variant:"contained",color:"error",onClick:f,children:"Delete"})})]})}Q.propTypes={onDeleteRow:h.func,onSelectRow:h.func,onViewRow:h.func,row:h.object,selected:h.bool};const De=[{value:"all",label:"All"},...he],Ie=[{id:"id",label:"Order",width:116},{id:"name",label:"Customer"},{id:"createdAt",label:"Date",width:140},{id:"totalQuantity",label:"Items",width:120,align:"center"},{id:"totalAmount",label:"Total Value",width:140},{id:"commission",label:"Commission",width:140},{id:"Net",label:"Net",width:140},{id:"status",label:"Status",width:110},{id:"",width:88}],Re={name:"",status:"all",startDate:null,endDate:null};function Ue(){const{user:{id:i}}=ae(),[x,y]=v.useState([]),[j,f]=v.useState([]),[r,l]=v.useState([]),c=async()=>{try{const{data:{products:s}}=await S.get("products",{params:{userId:i,perPage:100}});f(s.map(n=>n.id))}catch{alert("Error occurred while fetching products.")}},T=async()=>{try{const{data:s}=await S.get("/orders");y(s)}catch(s){console.log(s.message)}};v.useEffect(()=>{c(),T()},[]);function a(s,n){return s.map(D=>{const ee=D.items.filter(se=>se.userId===n);return{...D,items:ee}})}v.useEffect(()=>{const s=x.filter(n=>n.items.some(D=>j.includes(D.id))).reverse();l(a(s,i))},[x,j]);const t=xe({defaultOrderBy:"id"}),g=oe(),C=L(),m=Re,A=m.startDate&&m.endDate?m.startDate.getTime()>m.endDate.getTime():!1,o=Oe({inputData:r,comparator:ge(t.order,t.orderBy),filters:m,dateError:A}),d=o.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),G=t.dense?52:72,J=!!m.name||m.status!=="all"||!!m.startDate&&!!m.endDate,K=!o.length&&J||!o.length,X=v.useCallback(s=>{S.delete("orders",{data:{id:s}});const n=r.filter(D=>D.id!==s);l(n),t.onUpdatePageDeleteRow(d.length)},[d.length,t,r]),Y=v.useCallback(()=>{S.delete("orders",{data:{id:t.selected}});const s=r.filter(n=>!t.selected.includes(n.id));l(s),t.onUpdatePageDeleteRows({totalRows:r.length,totalRowsInPage:d.length,totalRowsFiltered:o.length})},[o.length,d.length,t,r]);v.useCallback(s=>{g.push(B.dashboard.order.details(s))},[g]);const[P,Z]=v.useState("all");return e.jsxs(e.Fragment,{children:[e.jsxs(p,{px:5,children:[e.jsx(ne,{heading:"Orders",links:[{name:"Dashboard",href:B.dashboard.root},{name:"Orders",href:B.dashboard.order.root}],sx:{mb:{xs:3,md:5}}}),e.jsxs(V,{children:[e.jsx(le,{value:P,onChange:(s,n)=>Z(n),sx:{px:2.5,boxShadow:s=>`inset 0 -2px 0 0 ${ie(s.palette.grey[500],.08)}`},children:De.map(s=>e.jsx(de,{iconPosition:"end",value:s.value,label:s.label,icon:e.jsxs($,{variant:(s.value==="all"||s.value===m.status)&&"filled"||"soft",color:s.value==="processing"&&"info"||s.value==="completed"&&"success"||s.value==="In Transit"&&"info"||s.value==="pending"&&"warning"||s.value==="cancelled"&&"error"||"default",children:[s.value==="all"&&r.length,s.value==="processing"&&r.filter(n=>n.status==="processing").length,s.value==="pending"&&r.filter(n=>n.status==="Order received"||n.status==="pending").length,s.value==="completed"&&r.filter(n=>n.status==="completed").length,s.value==="cancelled"&&r.filter(n=>n.status==="cancelled").length,s.value==="refunded"&&r.filter(n=>n.status==="refunded").length,s.value==="In Transit"&&r.filter(n=>n.status==="In Transit").length]})},s.value))}),e.jsxs(Pe,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(ye,{dense:t.dense,numSelected:t.selected.length,rowCount:r.length,onSelectAllRows:s=>t.onSelectAllRows(s,r.map(n=>n.id)),action:e.jsx(ce,{title:"Delete"})}),e.jsx(z,{children:e.jsxs(Te,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(je,{order:t.order,orderBy:t.orderBy,headLabel:Ie,rowCount:r.length,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:s=>t.onSelectAllRows(s,r.map(n=>n.id))}),e.jsxs(ve,{children:[o.filter(s=>P==="all"||P==="processing"&&s.status==="processing"||P==="pending"&&(s.status==="pending"||s.status==="Order received")||P==="completed"&&s.status==="completed"||P==="cancelled"&&s.status==="cancelled"||P==="refunded"&&s.status==="refunded"||P==="In Transit"&&s.status==="In Transit").map(s=>e.jsx(Q,{row:s,selected:t.selected.includes(s.id),onSelectRow:()=>t.onSelectRow(s.id),onDeleteRow:()=>X(s.id),onViewRow:()=>{}},s.id)),e.jsx(we,{height:G,emptyRows:me(t.page,t.rowsPerPage,r.length)}),e.jsx(fe,{notFound:K})]})]})})]}),e.jsx(be,{count:o.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,onChangeDense:t.onChangeDense})]})]}),e.jsx(W,{open:C.value,onClose:C.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",t.selected.length," "]})," items?"]}),action:e.jsx(k,{variant:"contained",color:"error",onClick:()=>{Y(),C.onFalse()},children:"Delete"})})]})}function Oe({inputData:i,comparator:x,filters:y,dateError:j}){const{status:f,name:r,startDate:l,endDate:c}=y,T=i.map((a,t)=>[a,t]);return T.sort((a,t)=>{const g=x(a[0],t[0]);return g!==0?g:a[1]-t[1]}),i=T.map(a=>a[0]),r&&(i=i.filter(a=>{var t,g;return a.orderNumber.toLowerCase().indexOf(r.toLowerCase())!==-1||((t=a.customer)==null?void 0:t.name.toLowerCase().indexOf(r.toLowerCase()))!==-1||((g=a.customer)==null?void 0:g.email.toLowerCase().indexOf(r.toLowerCase()))!==-1})),f!=="all"&&(i=i.filter(a=>a.status===f)),j||l&&c&&(i=i.filter(a=>I(a.createdAt)>=I(l)&&I(a.createdAt)<=I(c))),i}function ke({items:i=[],shipping:x,discount:y,taxes:j,subTotal:f,totalAmount:r}){const l=e.jsxs(u,{spacing:2,alignItems:"flex-end",sx:{my:3,textAlign:"right",typography:"body2"},children:[e.jsxs(u,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Subtotal"}),e.jsx(p,{sx:{width:160,typography:"subtitle2"},children:b(f)||"-"})]}),e.jsxs(u,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Shipping"}),e.jsx(p,{sx:{width:160,...x&&{color:"error.main"}},children:x?`- ${b(x)}`:"-"})]}),e.jsxs(u,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Discount"}),e.jsx(p,{sx:{width:160,...y&&{color:"error.main"}},children:y?`- ${b(y)}`:"-"})]}),e.jsxs(u,{direction:"row",children:[e.jsx(p,{sx:{color:"text.secondary"},children:"Taxes"}),e.jsx(p,{sx:{width:160},children:j?b(j):"-"})]}),e.jsxs(u,{direction:"row",sx:{typography:"subtitle1"},children:[e.jsx(p,{children:"Total"}),e.jsx(p,{sx:{width:160},children:b(r)||"-"})]})]});return e.jsxs(V,{children:[e.jsx(Se,{title:"Details"}),e.jsxs(u,{sx:{px:3},children:[e.jsx(z,{children:i==null?void 0:i.map(c=>e.jsxs(u,{direction:"row",alignItems:"center",sx:{py:3,minWidth:640,borderBottom:T=>`dashed 2px ${T.palette.background.neutral}`},children:[e.jsx(E,{src:c.images[0],variant:"rounded",sx:{width:48,height:48,mr:2}}),e.jsx(R,{primary:c.name,secondary:c.id,primaryTypographyProps:{typography:"body2"},secondaryTypographyProps:{component:"span",color:"text.disabled",mt:.5}}),e.jsxs(p,{sx:{typography:"body2"},children:["x",c.quantity]}),e.jsx(p,{sx:{width:110,textAlign:"right",typography:"subtitle2"},children:b(c.salePrice)})]},c.id))}),l]})]})}ke.propTypes={discount:h.number,items:h.array,shipping:h.number,subTotal:h.number,taxes:h.number,totalAmount:h.number};function Ae({status:i,backLink:x,createdAt:y,orderNumber:j,statusOptions:f,onChangeStatus:r}){const l=U();return e.jsxs(e.Fragment,{children:[e.jsx(u,{spacing:3,direction:{xs:"column",md:"row"},sx:{mb:{xs:3,md:5}},children:e.jsxs(u,{spacing:1,direction:"row",alignItems:"flex-start",children:[e.jsx(F,{component:pe,href:x,children:e.jsx(O,{icon:"eva:arrow-ios-back-fill"})}),e.jsxs(u,{spacing:.5,children:[e.jsxs(u,{spacing:1,direction:"row",alignItems:"center",children:[e.jsxs(_,{variant:"h4",children:[" Order ",j," "]}),e.jsx($,{variant:"soft",color:i==="completed"&&"success"||i==="pending"&&"warning"||i==="cancelled"&&"error"||"default",children:i})]}),e.jsx(_,{variant:"body2",sx:{color:"text.disabled"},children:ue(y)})]})]})}),e.jsx(M,{open:l.open,onClose:l.onClose,arrow:"top-right",sx:{width:140},children:f.map(c=>e.jsx(H,{selected:c.value===i,onClick:()=>{l.onClose(),r(c.value)},children:c.label},c.value))})]})}Ae.propTypes={backLink:h.string,createdAt:h.instanceOf(Date),onChangeStatus:h.func,orderNumber:h.string,status:h.string,statusOptions:h.array};export{Ue as O,Ae as a,ke as b};
