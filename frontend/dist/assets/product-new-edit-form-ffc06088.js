import{j as e,aD as te,T as R,c as C,r as p,an as pe,k as U,u as de,p as k,C as K,v as N,aE as _,aF as xe,aG as be,aH as ge,_ as je,aI as se,ah as Y,aJ as ue,B as E,aK as fe,F as ye,ai as ne,aL as ve,aM as O,a8 as Se,aN as ke,aO as Ce,a9 as le,aa as f,aP as I,aQ as we,aR as ee,ab as Ae,ag as Ie,L as re,ad as qe,aS as Fe,aT as ae,ak as Te}from"./index-ec998887.js";import{G as y}from"./Grid-c1c0f3e0.js";import{F as q,R as ce,b as Q}from"./product-table-toolbar-38b84145.js";import{C as L}from"./Checkbox-4ed042a5.js";import{b as me,c as g,a as Re,T as De,d as Ue}from"./TableRow-36e71984.js";import{C as oe}from"./CardHeader-d3b65c84.js";import{A as M}from"./Alert-29f93043.js";function Oe({values:a,products:n,setValue:r}){return e.jsx(te,{value:a.name,onChange:(i,t)=>{if(t){const o=n.find(m=>m.name===t);o&&(r("images",o.images),r("name",o.name),r("category",o.category),r("brand",o.brand),r("type",o.type))}},name:"name",label:"Product Name",options:n.map(i=>i.name),getOptionLabel:i=>i,isOptionEqualToValue:(i,t)=>i===t.value,renderInput:i=>e.jsx(R,{...i,label:"Product Name",value:a.name,onChange:t=>r("name",t.target.value)}),renderOption:(i,t)=>e.jsxs(C,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...i,children:[e.jsx("img",{loading:"lazy",width:"20",src:n.find(o=>o.name===t).images[0],alt:""}),t]}),freeSolo:!0})}function Ee({setValue:a,values:n}){const r=p.useCallback(o=>{const m=n.images||[],s=o.map(l=>Object.assign(l,{preview:URL.createObjectURL(l)}));a("images",[...m,...s],{shouldValidate:!0})},[a,n.images]),i=p.useCallback(o=>{var s;const m=n.images&&((s=n.images)==null?void 0:s.filter(l=>l!==o));a("images",m)},[a,n.images]),t=p.useCallback(()=>{a("images",[])},[a]);return e.jsx(pe,{multiple:!0,name:"images",maxSize:3145728,onDrop:r,onRemove:i,onRemoveAll:t,onUpload:async o=>{try{const m=new FormData;n.images.forEach(l=>{m.append("images",l)});const{data:s}=await U.post("upload",m);a("images",s),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})}function Ne({values:a,setValue:n}){const{user:r}=de(),[i,t]=p.useState({name:"",show:!1}),[o,m]=p.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(y,{md:12,width:"100%",item:!0,children:[e.jsx(k,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(k,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(y,{xs:12,md:12,width:"100%",item:!0,children:e.jsx(K,{children:e.jsx(N,{spacing:3,sx:{p:3},children:e.jsxs(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(_,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:xe.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(_,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:be.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(ge,{name:"tags",label:"Tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:je.map(s=>s),getOptionLabel:s=>s,renderOption:(s,l)=>p.createElement("li",{...s,key:l},l),renderTags:(s,l)=>s.map((c,h)=>p.createElement(se,{...l({index:h}),key:c,label:c,size:"small",color:"info",variant:"soft"}))}),e.jsxs(C,{children:[e.jsx(Y,{name:"SKU",label:"Product SKU"}),e.jsx(q,{label:"Automatically generate SKUs",control:e.jsx(L,{checked:o,onChange:s=>{s.target.checked?a.name.replaceAll(" ","").trim().length>=8?(n("SKU",`${a.name.replaceAll(" ","").trim().slice(0,8)}-1`),m(!0)):(m(!1),alert("To automatically generate SKUs, ensure that the product name has at least 8 characters.")):(n("SKU",""),m(!1))}})})]}),!i.show&&e.jsx(_,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:ue.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(C,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(q,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(L,{checked:i.show,onChange:s=>t(l=>({...l,show:s.target.checked}))})}),i.show&&e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"Brand Name",style:{width:300},onChange:s=>t(l=>({...l,name:s.target.value})),value:i.name}),e.jsx(E,{variant:"contained",color:"success",onClick:async()=>{try{i.name?(await U.post("/notifications",{userId:r.id,role:"admin",title:"🚀 New Brand Approval Request! 🚀",message:`Exciting news! A new brand has been submitted for approval. Brand Name: ${i.name}. 🛍️`,type:"product"}),n("brand",i.name),n("status","In Revision"),alert("Your request to create a new brand is being processed. Please wait while we verify the brand. You can add products, but their status will be 'In Revision.' After reviewing, the products will go live.")):alert("Please enter brand name")}catch(s){console.log(s),alert("An error occurred while adding this brand.")}},children:"Add Brand"})]})]}),a.status!=="In Revision"&&e.jsx(_,{native:!0,name:"status",label:"status",InputLabelProps:{shrink:!0},children:fe.map(s=>e.jsx("option",{value:s,children:s},s))})]})})})})]})}function ze({values:a,setValue:n}){return e.jsxs(e.Fragment,{children:[e.jsxs(y,{md:4,width:"100%",item:!0,children:[e.jsx(k,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(k,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(y,{xs:12,md:12,width:"100%",item:!0,children:e.jsx(K,{children:e.jsxs(N,{spacing:3,sx:{p:3},children:[e.jsx(q,{label:"Track Stock",control:e.jsx(L,{checked:a.track,onChange:r=>{n("track",r.target.checked)}})}),a.track&&e.jsx(R,{value:a.quantity,onChange:r=>{const i=Math.max(0,Number(r.target.value));n("quantity",i)},label:"Quantity",placeholder:"0.00",type:"number",inputProps:{min:0}}),!a.track&&e.jsx(ye,{children:e.jsxs(ce,{defaultValue:a.availability||"In Stock",row:!0,onChange:r=>n("availability",r.target.value),children:[e.jsx(q,{value:"In Stock",control:e.jsx(Q,{defaultChecked:!0}),label:"In Stock"}),e.jsx(q,{value:"Out Stock",control:e.jsx(Q,{}),label:"Out Stock"})]})}),e.jsx(Y,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ne,{position:"start",children:e.jsx(C,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx(Y,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ne,{position:"start",children:e.jsx(C,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})})})]})}function Ke({selectedAttributes:a=[],counter:n,skuAlpha:r,attributes:i,values:t,currentProduct:o,setValue:m}){const s=r[n]?`${t.SKU}-${r[n]}`:t.SKU,l=!!i&&Object.keys(i).map(j=>i[j]).join("-"),[c,h]=p.useState({track:!0,availability:"In Stock",quantity:null,regularPrice:null,salePrice:null,image:null,attributes:{}});p.useEffect(()=>{const j=t.variations.findIndex(b=>!!i&&Object.keys(i).every(u=>i[u]===b.attributes[u]));if(Object.keys(c.attributes).length<a.length){const b=t.variations[j];h(u=>({...u,...b,attributes:i}))}},[i]),p.useState("instock");const[v,F]=p.useState("pending"),z=j=>b=>{const u=b.target.type==="checkbox"?b.target.checked:b.target.value;h(A=>({...A,[j]:u}))},x=async j=>{try{const b=new FormData;b.append("images",j.target.files[0]);const{data:u}=await U.post("upload",b);h(A=>({...A,image:[u[0],...t.images]}))}catch(b){console.error("Image upload failed:",b)}},J=async()=>{const{track:j,quantity:b,regularPrice:u,salePrice:A}=c;if(j&&!b)return alert("Quantity is required.");if(!u)return alert("Regular price is required.");if(A){const w=parseFloat(u),G=parseFloat(A);if(w<G)return alert("Sale price must be less than the regular price")}if(v==="pending"){F("loading");try{if(!o)m("variations",[...t.variations,c]);else{const{attributes:w}=c;if(t.variations.some(D=>Object.keys(w).every(T=>D.attributes[T]===w[T]))){const D=[...t.variations],T=t.variations.findIndex(P=>Object.keys(w).every(d=>w[d]===P.attributes[d]));D[T]={...D[T],...c},m("variations",D)}else m("variations",[...t.variations,c])}F("success")}catch(w){console.error("Product creation failed:",w),F("failed")}}},W=()=>{switch(v){case"loading":return e.jsx(E,{color:"success",variant:"contained",size:"small",children:"Loading"});case"success":return o?e.jsx(E,{color:"success",variant:"contained",size:"small",children:"Product Updated"}):e.jsx(E,{color:"success",variant:"contained",size:"small",children:"Product Created"});case"failed":return e.jsx(E,{color:"error",variant:"contained",size:"small",children:"Product creation failed"});default:return e.jsx(E,{color:"success",variant:"contained",size:"small",onClick:J,children:o?"Save Changes":"Add Product"})}},{track:B,quantity:X,regularPrice:Z,salePrice:V,image:ie}=c;return e.jsxs(me,{children:[e.jsx(g,{children:n}),e.jsx(g,{children:s}),e.jsx(g,{children:l}),e.jsx(g,{children:e.jsx(q,{control:e.jsx(L,{checked:B,onChange:z("track")})})}),e.jsx(g,{width:150,children:B?e.jsx(R,{size:"small",label:"Quantity",type:"number",inputProps:{min:0},onChange:z("quantity"),value:X||""}):e.jsxs(ce,{"aria-label":"Stock",name:"Stock",value:c.availability,onChange:j=>h(b=>({...b,availability:j.target.value})),children:[e.jsx(q,{value:"In Stock",control:e.jsx(Q,{}),label:"In Stock"}),e.jsx(q,{value:"Out Stock",control:e.jsx(Q,{}),label:"Out Stock"})]})}),e.jsx(g,{width:150,children:e.jsx(R,{size:"small",label:"Price",type:"number",inputProps:{min:0},onChange:z("regularPrice"),value:Z||""})}),e.jsx(g,{width:150,children:e.jsx(R,{size:"small",label:"Sale Price",type:"number",inputProps:{min:0},onChange:z("salePrice"),value:V||""})}),e.jsx(g,{width:150,children:e.jsx("input",{type:"file",onChange:x,style:{width:"150px"}})}),e.jsx(g,{children:W()})]})}function Le(){return e.jsx(Re,{children:e.jsxs(me,{children:[e.jsx(g,{children:"ID"}),e.jsx(g,{width:150,children:"SKU"}),e.jsx(g,{width:250,children:"Attributes"}),e.jsx(g,{width:150,children:"Track Stock"}),e.jsx(g,{children:"Stock"}),e.jsx(g,{children:"Regular Price"}),e.jsx(g,{children:"Sales Price"}),e.jsx(g,{children:"Image"}),e.jsx(g,{width:200,children:"Add Product"})]})})}function Be({setSelectedAttributes:a,selectedAttributes:n,values:r,setValue:i}){return e.jsx(te,{onChange:(t,o)=>{a(o)},value:n,name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:ve,getOptionLabel:t=>t,renderOption:(t,o)=>p.createElement("li",{...t,key:o},o),renderTags:(t,o)=>t.map((m,s)=>p.createElement(se,{...o({index:s}),key:m,label:m,size:"small",color:"info",variant:"soft"})),renderInput:t=>e.jsx(R,{...t,label:"Attributes",placeholder:"+ Attributes"})})}function Ge({currentProduct:a,values:n,setValue:r,setVariation:i,e:t,savedAttibutes:o,variation:m=[]}){var s;return e.jsxs(C,{sx:{gridColumn:"span 1 "},children:[e.jsx(te,{multiple:!0,freeSolo:!0,options:[...t==="bottleSize"?O.bottleSize:[],...t==="puffs"?O.puffs:[],...t==="flavour"?O.flavour:[],...t==="nicotineStrength"?O.nicotineStrength:[],...t==="color"?O.color:[],...t==="batteries"?O.batteries:[],...o.filter(l=>l.attribute===t).map(l=>l.value)],value:n.attributes[t]||[],onChange:(l,c)=>{let h={...n.attributes};if(n.type==="Simple"&&t!=="flavour"){if(c.length>1){const v=[c[c.length-1]];h={...n.attributes,[t]:v}}else h={...n.attributes,[t]:c};c.length===0&&delete h[t],r("attributes",h)}else{if(m.find(F=>F===t)&&c.length===1)return alert('Please uncheck "Use this attribute to create Variations" before deleting this attribute.');const v={...n.attributes,[t]:c};c.length===0&&delete v[t],r("attributes",v)}},renderInput:l=>e.jsx(R,{...l,label:t,placeholder:t}),renderTags:(l,c)=>l.map((h,v)=>p.createElement(se,{...c({index:v}),key:h,label:h,size:"small",color:"info",variant:"soft"}))}),n.type==="Variable"&&((s=n.attributes[t])==null?void 0:s.length)>1&&e.jsx(q,{label:"Use this attribute to create Variations",control:e.jsx(L,{defaultChecked:m.find(l=>l===t),onChange:l=>{if(a)if(confirm("Changing the variation of this product will reset all current variations, and you'll have to start over from the beginning. Do you wish to proceed?"))r("variations",[]);else return;l.target.checked?i(c=>[...new Set([...c,t])]):i(c=>[...new Set(c.filter(h=>h!==t))])}})})]},t)}function We({currentProduct:a}){const n=Se(),r=ke("up","md"),{enqueueSnackbar:i}=Ce(),{user:t}=de(),o=le().shape({name:f().required("Name is required"),subDescription:f().required("Short description is required").test("not-four-digits","Your content contain continues 7 digit number, Please remove",d=>!/\d{7,}/.test(d)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',d=>!/@/.test(d)),content:f().test("not-four-digits","Your content contain continues 7 digit number, Please remove",d=>!/\d{7,}/.test(d)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',d=>!/@/.test(d)),images:I().min(1,"Image is required"),type:f(),category:f().required("Category is required"),tags:I(),SKU:f().required("SKU is required"),brand:f().required("brand is required"),status:f().required("brand is required"),attributes:le().shape({bottleSize:I().of(f()).optional(),puffs:I().of(f()).optional(),flavour:I().of(f()).optional(),nicotineStrength:I().of(f()).optional(),color:I().of(f()).optional(),batteries:I().of(f()).optional()}),track:we(),availability:f(),quantity:ee(),regularPrice:ee(),salePrice:ee(),variations:I()}),m=p.useMemo(()=>({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",subDescription:(a==null?void 0:a.subDescription)||"",content:(a==null?void 0:a.content)||"",images:(a==null?void 0:a.images)||[],type:(a==null?void 0:a.type)||"Simple",category:(a==null?void 0:a.category)||"Disposables",tags:(a==null?void 0:a.tags)||[],SKU:(a==null?void 0:a.SKU)||"",brand:(a==null?void 0:a.brand)||"SMOK",status:(a==null?void 0:a.status)||"Published",attributes:(a==null?void 0:a.attributes)||{},track:(a==null?void 0:a.track)||!0,availability:(a==null?void 0:a.availability)||"In Stock",quantity:(a==null?void 0:a.quantity)||0,regularPrice:(a==null?void 0:a.regularPrice)||100,salePrice:(a==null?void 0:a.salePrice)||0,variations:(a==null?void 0:a.variations)||[]}),[a]),s=Ae({resolver:Te(o),defaultValues:m}),{reset:l,watch:c,setValue:h,handleSubmit:v,formState:{isSubmitting:F,isValid:z}}=s,x=c(),[J,W]=p.useState([]);p.useEffect(()=>{U.get("/attributes").then(d=>{W(d.data)})},[]);const[B,X]=p.useState([]),Z=p.useCallback(async()=>{const{data:d}=await U.get("/products",{params:{name:x.name}});X(d.products.filter(S=>!S.name.includes("-")))},[x.name]);p.useEffect(()=>{Z()},[x.name]),p.useEffect(()=>{a&&l(m)},[a,m,l]);const V=v(async d=>{try{console.log(`DATA : ${d}`),a?await U.patch("products",{...d,username:t.displayName,userId:t.id,storeName:t.storeName}):await U.post("products",{...d,username:t.displayName,userId:t.id,storeName:t.storeName}),l(),i(a?"Update success!":"Create success!"),n.push(Ie.dashboard.product.root)}catch(S){console.log(S)}}),ie=e.jsxs(e.Fragment,{children:[r&&e.jsxs(y,{md:4,item:!0,children:[e.jsx(k,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(k,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(y,{xs:12,md:12,item:!0,children:e.jsxs(K,{children:[!r&&e.jsx(oe,{title:"Details"}),e.jsxs(N,{spacing:3,sx:{p:3},children:[e.jsx(Oe,{products:B,setValue:h,values:x}),e.jsx(M,{severity:"info",children:"Please do not include emails, phone numbers, or emojis in the sub-description and content. Products containing these will not be accepted."}),e.jsx(Y,{name:"subDescription",label:"Sub Description",multiline:!0,rows:4}),e.jsxs(N,{spacing:1.5,children:[e.jsx(k,{variant:"subtitle2",children:"Content"}),e.jsx(Fe,{simple:!0,name:"content"})]}),e.jsx(M,{severity:"info",children:"Uploading at least one image is required."}),e.jsxs(N,{spacing:1.5,children:[e.jsx(k,{variant:"subtitle2",children:"Images"}),e.jsx(Ee,{values:x,setValue:h})]})]})]})})]}),[j,b]=p.useState([]),[u,A]=p.useState([]);p.useEffect(()=>{var d;if(a){const{attributes:S,variations:$,type:H}=a;S&&b(Object.keys(S)),H==="Variable"&&$.length&&A(Object.keys((d=$[0])==null?void 0:d.attributes))}},[a]);const w=e.jsxs(e.Fragment,{children:[r&&e.jsxs(y,{md:4,item:!0,children:[e.jsx(k,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(k,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(y,{xs:12,md:12,item:!0,children:e.jsxs(K,{children:[!r&&e.jsx(oe,{title:"Attributes"}),e.jsx(N,{spacing:3,sx:{p:3},children:e.jsxs(C,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(C,{sx:{gridColumn:"span 2 "},children:x.type==="Variable"&&e.jsx(M,{severity:"info",children:"Please choose at least one attribute."})}),e.jsx(C,{sx:{gridColumn:"span 2 "},children:e.jsx(Be,{selectedAttributes:j,setSelectedAttributes:b,setValue:h,values:x})}),x.type==="Variable"&&!!j.length&&e.jsx(C,{sx:{gridColumn:"span 2 "},children:e.jsx(M,{severity:"info",children:"Please select at least two variations from the list below to enable the 'Create Variations' option."})}),j.map(d=>e.jsx(Ge,{currentProduct:a,setValue:h,setVariation:A,variation:u,values:x,e:d,savedAttibutes:J},d))]})})]})})]}),G=e.jsxs(y,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},gap:2.5,item:!0,children:[e.jsx(re,{type:"submit",variant:"contained",size:"large",loading:F,children:a?"Save Changes":"Create Product"}),x.status!=="In Revision"&&e.jsx(re,{onClick:()=>{h("status","Draft")},type:"submit",variant:"contained",size:"large",loading:F,children:"Save as Draft"})]}),D=[...ae,...ae.slice(1).flatMap(d=>ae.slice(1).map(S=>d+S))];let T=1;const P=e.jsxs(e.Fragment,{children:[r&&e.jsx(y,{md:4,item:!0,children:e.jsx(k,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(y,{xs:12,md:12,item:!0,children:e.jsx(K,{children:e.jsxs(De,{children:[e.jsx(Le,{}),e.jsx(Ue,{children:u==null?void 0:u.reduce((d,S)=>d.flatMap($=>{var H;return(H=x.attributes[S])==null?void 0:H.map(he=>({...$,[S]:he}))}),[{}]).map(d=>e.jsx(Ke,{selectedAttributes:j,counter:T++,skuAlpha:D,attributes:d,values:x,currentProduct:a,setValue:h},T))})]})})})]});return console.log(x),e.jsx(qe,{methods:s,onSubmit:V,children:e.jsxs(y,{container:!0,spacing:3,children:[ie,e.jsx(Ne,{values:x,setValue:h}),w,x.type==="Simple"&&e.jsx(ze,{values:x,setValue:h}),x.type==="Variable"&&P,G]})})}export{We as P};
