import{F as n,j as e,b9 as fe,aO as ye,aA as f,b5 as Fe,ba as Se,bb as ve,aw as pe,b2 as Ae,ax as h,T as u,af as E,S as I,B as v,bc as ee,bd as he,be as N,al as z,ah as Ce,bf as ke,ao as xe,ap as c,aj as we,bg as oe}from"./index-f9db9ede.js";import{c as Be,a as A,b as se,d as ae,u as Ie,R as te,e as re,f as q,F as Te,g as De,h as Re,i as Ee}from"./form-provider-9e565194.js";import{o as qe,L as ze}from"./yup-91c515ac.js";import{_ as Ne,a as Ue,b as Ke,c as Le,d as Oe,e as x}from"./createProducts-6b8714cd.js";import{C as H}from"./CardHeader-256249fb.js";import{F as V,R as ce}from"./image-1d229714.js";let de=!1;const $e=n.forwardRef(function(o,C){return de||(console.warn(["MUI: The Autocomplete component was moved from the lab to the core.","","You should use `import { Autocomplete } from '@mui/material'`","or `import Autocomplete from '@mui/material/Autocomplete'`"].join(`
`)),de=!0),e.jsx(fe,ye({ref:C},o))});function Qe({currentProduct:a}){const[o,C]=n.useState([]);n.useEffect(()=>{f.get("/attributes").then(s=>{C(s.data)})},[]);const U=Fe(),m=Se("up","md"),{enqueueSnackbar:Y}=ve(),{user:p}=pe(),ie=Be().shape({name:A().required("Name is required"),subDescription:A().required("Short description is required").test("not-four-digits","Your content contain continues 4 digit number, Please remove",s=>!/\d{4,}/.test(s)),content:A().test("not-four-digits","Your content contain continues 4 digit number, Please remove",s=>!/\d{4,}/.test(s)),images:se().min(1,"Image is required"),type:A(),category:A().required("Category is required"),tags:se(),SKU:A().required("SKU is required"),brand:A().required("brand is required"),attributes:se(),quantity:ae(),regularPrice:ae(),salePrice:ae().moreThan(0,"Price should not be AED 0.00")}),K=n.useMemo(()=>({id:(a==null?void 0:a.id)||"",name:(a==null?void 0:a.name)||"",subDescription:(a==null?void 0:a.subDescription)||"",content:(a==null?void 0:a.content)||"",images:(a==null?void 0:a.images)||[],type:(a==null?void 0:a.type)||"Simple",category:(a==null?void 0:a.category)||"Disposables",tags:(a==null?void 0:a.tags)||[],SKU:(a==null?void 0:a.SKU)||"",brand:(a==null?void 0:a.brand)||"SMOK",attributes:(a==null?void 0:a.attributes)||[],quantity:(a==null?void 0:a.quantity)||0,regularPrice:(a==null?void 0:a.regularPrice)||0,salePrice:(a==null?void 0:a.salePrice)||0}),[a]),[b,L]=n.useState({}),[k,y]=n.useState([]),O=Ie({resolver:qe(ie),defaultValues:K}),{reset:T,watch:M,setValue:g,handleSubmit:Q,formState:{isSubmitting:w,isValid:$}}=O,r=M(),J=n.useCallback(async()=>{await f.get("/products",{params:{name:r.name}})},[r.name]);n.useEffect(()=>{J()},[r.name]),n.useEffect(()=>{a&&T(K)},[a,K,T]);const F=Q(async s=>{console.log(s);try{a?await f.patch("products",{...s,username:p.displayName,userId:p.id,storeName:p.storeName}):await f.post("products",{...s,username:p.displayName,userId:p.id,storeName:p.storeName}),T(),Y(a?"Update success!":"Create success!"),U.push(Ae.dashboard.product.root)}catch(t){console.log(t)}}),D=n.useCallback(s=>{const t=r.images||[],i=s.map(l=>Object.assign(l,{preview:URL.createObjectURL(l)}));g("images",[...t,...i],{shouldValidate:!0})},[g,r.images]),W=n.useCallback(s=>{var i;const t=r.images&&((i=r.images)==null?void 0:i.filter(l=>l!==s));g("images",t)},[g,r.images]),X=n.useCallback(()=>{g("images",[])},[g]),Z=e.jsxs(e.Fragment,{children:[m&&e.jsxs(h,{md:4,children:[e.jsx(u,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(h,{xs:12,md:12,children:e.jsxs(E,{children:[!m&&e.jsx(H,{title:"Details"}),e.jsxs(I,{spacing:3,sx:{p:3},children:[e.jsx(q,{name:"name",label:"Product Name"}),e.jsx(q,{name:"subDescription",label:"Sub Description",multiline:!0,rows:4}),e.jsxs(I,{spacing:1.5,children:[e.jsx(u,{variant:"subtitle2",children:"Content"}),e.jsx(De,{simple:!0,name:"content"})]}),e.jsxs(I,{spacing:1.5,children:[e.jsx(u,{variant:"subtitle2",children:"Images"}),e.jsx(Re,{multiple:!0,name:"images",maxSize:3145728,onDrop:D,onRemove:W,onRemoveAll:X,onUpload:async s=>{try{const t=new FormData;r.images.forEach(l=>{t.append("images",l)});const{data:i}=await f.post("upload",t);g("images",i),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})]})]})]})})]}),[B,d]=n.useState({name:"",show:!1}),j=e.jsxs(e.Fragment,{children:[m&&e.jsxs(h,{md:4,children:[e.jsx(u,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(h,{xs:12,md:12,children:e.jsxs(E,{children:[!m&&e.jsx(H,{title:"Properties"}),e.jsx(I,{spacing:3,sx:{p:3},children:e.jsxs(v,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(te,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:Ne.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(te,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:Ue.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx(re,{name:"tags",label:"Tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:Ke.map(s=>s),getOptionLabel:s=>s,renderOption:(s,t)=>n.createElement("li",{...s,key:t},t),renderTags:(s,t)=>s.map((i,l)=>n.createElement(ee,{...t({index:l}),key:i,label:i,size:"small",color:"info",variant:"soft"}))}),e.jsx(q,{name:"SKU",label:"Product SKU"}),e.jsx(te,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:Le.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(v,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(V,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(he,{checked:B.show,onChange:s=>d(t=>({...t,show:s.target.checked}))})}),B.show&&e.jsxs(e.Fragment,{children:[e.jsx(N,{label:"Brand Name",style:{width:300},onChange:s=>d(t=>({...t,name:s.target.value})),value:B.name}),e.jsx(z,{variant:"contained",color:"success",onClick:()=>{B.name?alert("Your request to create a new brand is being processed. Please wait while we verify the brand."):alert("Please enter brand name")},children:"Add Brand"})]})]})]})})]})})]}),R=(s,t,i)=>{L(G=>({...G,[i]:t}));const l=i==="Bottle Size"&&x.bottleSize||i==="Puffs"&&x.puffs||i==="Flavour"&&x.flavour||i==="Nicotine Strength"&&x.nicotineStrength||i==="Color"&&x.color||i==="Batteries"&&x.batteries||[],S=t[t.length-1];S&&(l.find(G=>G===S)||(console.log("upload"),f.post("/attributes",{username:p.displayName,attribute:i,value:S}).then(G=>{console.log("updated")})))},ue=e.jsxs(e.Fragment,{children:[m&&e.jsxs(h,{md:4,children:[e.jsx(u,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(h,{xs:12,md:12,children:e.jsxs(E,{children:[!m&&e.jsx(H,{title:"Attributes"}),e.jsx(I,{spacing:3,sx:{p:3},children:e.jsxs(v,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(v,{sx:{gridColumn:"span 2 "},children:e.jsx(re,{name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:Oe.map(s=>s),getOptionLabel:s=>s,renderOption:(s,t)=>n.createElement("li",{...s,key:t},t),renderTags:(s,t)=>s.map((i,l)=>n.createElement(ee,{...t({index:l}),key:i,label:i,size:"small",color:"info",variant:"soft"}))})}),r.attributes.map(s=>e.jsx(v,{sx:{gridColumn:"span 1 "},children:e.jsx($e,{multiple:!0,freeSolo:!0,options:[...s==="Bottle Size"?x.bottleSize:[],...s==="Puffs"?x.puffs:[],...s==="Flavour"?x.flavour:[],...s==="Nicotine Strength"?x.nicotineStrength:[],...s==="Color"?x.color:[],...s==="Batteries"?x.batteries:[],...o.filter(t=>t.attribute===s).map(t=>t.value)],value:b[s],onChange:(t,i)=>{R(t,i,s),i.length>=2?k.find(l=>l===s)||y(l=>[...l,s]):y(l=>l.filter(S=>S!==s))},renderInput:t=>e.jsx(N,{...t,label:s,placeholder:s}),renderTags:(t,i)=>t.map((l,S)=>n.createElement(ee,{...i({index:S}),key:l,label:l,size:"small",color:"info",variant:"soft"}))})},s))]})})]})})]}),ge=e.jsxs(e.Fragment,{children:[m&&e.jsxs(h,{md:4,children:[e.jsx(u,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(u,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(h,{xs:12,md:12,children:e.jsxs(E,{children:[!m&&e.jsx(H,{title:"Pricing"}),e.jsxs(I,{spacing:3,sx:{p:3},children:[e.jsx(q,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(oe,{position:"start",children:e.jsx(v,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx(q,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(oe,{position:"start",children:e.jsx(v,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})]})})]}),be=e.jsx(e.Fragment,{children:e.jsx(h,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:e.jsx(ze,{type:"submit",variant:"contained",size:"large",loading:w,children:a?"Save Changes":"Create Product"})})}),P=["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],ne=[...P,...P.slice(1).flatMap(s=>P.slice(1).map(t=>s+t))];let _=1,le=0;const je=e.jsxs(e.Fragment,{children:[m&&e.jsx(h,{md:4,children:e.jsx(u,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(h,{xs:12,md:12,children:e.jsx(E,{children:e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsxs(xe,{children:[e.jsx(c,{children:"ID"}),e.jsx(c,{width:150,children:"SKU"}),e.jsx(c,{width:250,children:"Attributes"}),e.jsx(c,{width:150,children:"Track Order"}),e.jsx(c,{children:"Stock"}),e.jsx(c,{children:"Regular Price"}),e.jsx(c,{children:"Sales Price"}),e.jsx(c,{children:"Image"}),e.jsx(c,{width:200,children:"Add Product"})]})}),e.jsxs(we,{children:[e.jsx(me,{counter:_++,counter2:le++,skuAlpha:ne,va:"Parent",values:r,variables:b,disabled:!0,isSubmitting:w,isValid:$},_),Object.keys(b).reduce((s,t)=>s.flatMap(i=>b[t].map(l=>`${i} - ${l}`)),[""]).map(s=>e.jsx(me,{counter:_++,counter2:le++,skuAlpha:ne,va:s.slice(3),values:r,variables:b,disabled:!1,isSubmitting:w,isValid:$},_))]})]})})})]});return e.jsx(Te,{methods:O,onSubmit:F,children:e.jsxs(h,{container:!0,spacing:3,children:[Z,j,r.type==="Variable"&&ue,r.type==="Simple"&&ge,r.type==="Variable"&&je,r.type==="Simple"&&be]})})}function me({counter:a,values:o,skuAlpha:C,counter2:U,va:m,variables:Y,disabled:p,isSubmitting:ie,isValid:K}){const{user:b}=pe(),L=C[U]?`${o.SKU}-${C[U]}`:o.SKU;let k=o.name;m!=="Parent"&&(k=`${o.name} - ${m}`);const[y,O]=n.useState(!0),[T,M]=n.useState("instock"),[g,Q]=n.useState(null),[w,$]=n.useState(null),[r,J]=n.useState(null),[F,D]=n.useState("pending"),[W,X]=n.useState(null),Z=async d=>{try{const j=new FormData;j.append("images",d.target.files[0]);const{data:R}=await f.post("upload",j);X([R[0],...o.images])}catch{}},B=async()=>{const d=/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{2B50}\u{2B55}\u{231A}-\u{231B}\u{23E9}-\u{23EC}\u{23F0}\u{23F3}\u{25AA}-\u{25AB}\u{25B6}\u{25C0}\u{25FB}-\u{25FE}\u{2B1B}-\u{2B1C}\u{2934}-\u{2935}\u{2B05}-\u{2B07}\u{2194}-\u{2199}\u{21A9}-\u{21AA}\u{2B06}\u{2B07}\u{2B1B}\u{2B1C}]/u,j=/\d{4,}/;if(d.test(o.subDescription)||d.test(o.content)){alert("Your content contain emojis, Please remove emojis");return}if(j.test(o.subDescription)||j.test(o.content)){alert("Your content contain continues 4 digit number, Please remove");return}if(F==="pending"){D("loading");try{await f.post("/products",{username:b.displayName,userId:b.id,storeName:b.storeName,name:k,subDescription:o.subDescription,content:o.content,images:W??o.images,type:o.type,category:o.category,tags:o.tags,parentSku:o.SKU,brand:o.brand,attributes:o.attributes,variables:Y,SKU:L,track:y,quantity:r,regularPrice:g,salePrice:w,productGroup:m==="Parent"?"parent":"child"}),D("success")}catch(R){console.log(`Product Creation failed :${R}`),D("failed")}}};return e.jsxs(xe,{style:{backgroundColor:p&&"rgba(0,0,0,0.1)"},children:[e.jsx(c,{children:a}),e.jsx(c,{children:L}),e.jsx(c,{children:m==="Parent"?k+" - Parent":k}),e.jsx(c,{children:e.jsx(V,{label:"",control:e.jsx(he,{checked:y,onChange:d=>O(d.target.checked),disabled:p})})}),e.jsxs(c,{children:[y&&e.jsx(N,{disabled:p,size:"small",label:"Quantity",type:"number",onChange:d=>J(+d.target.value||null),value:r}),!y&&e.jsxs(Ee,{"aria-label":"Stock",name:"Stock",value:T,onChange:d=>M(d.target.value),children:[e.jsx(V,{value:"instock",control:e.jsx(ce,{}),label:"Instock"}),e.jsx(V,{value:"outstock",control:e.jsx(ce,{}),label:"Outstock"})]})]}),e.jsx(c,{children:e.jsx(N,{disabled:p,size:"small",label:"Price",type:"number",onChange:d=>Q(+d.target.value||null),value:g})}),e.jsx(c,{children:e.jsx(N,{disabled:p,size:"small",label:"Price",type:"number",onChange:d=>$(+d.target.value||null),value:w})}),e.jsx(c,{children:e.jsx("input",{size:"small",label:"Image",type:"file",onChange:Z,disabled:p})}),e.jsxs(c,{children:[F==="pending"&&!0&&e.jsx(z,{color:"success",variant:"contained",size:"small",onClick:B,type:"submit",children:"Add Product"}),F==="loading"&&e.jsx(z,{color:"success",variant:"contained",size:"small",children:"Loading"}),F==="success"&&e.jsx(z,{color:"success",variant:"contained",size:"small",children:"Product Created"}),F==="failed"&&e.jsx(z,{color:"success",variant:"contained",size:"small",children:"Product creation failed"})]})]})}export{Qe as P};
