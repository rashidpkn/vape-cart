import{H as n,j as e,aX as Ce,aY as we,aF as Be,b as y,aS as Ie,aZ as Te,a_ as qe,ar as ge,ao as De,aB as p,T as h,ah as K,S as R,a$ as E,B as v,b0 as Re,b1 as Ne,b2 as Ee,b3 as te,b4 as ze,b5 as be,a as N,b6 as Ue,b7 as u,aj as $e,b8 as Le,as as je,at as d,al as Ke,b9 as ce}from"./index-22016ea6.js";import{c as Oe,a as C,b as ie,d as ne,e as Ye,u as _e,R as O,f as Ge,g as Ve,h as le,i as me,F as He,j as Me}from"./form-provider-711235d0.js";import{o as Qe,L as Pe}from"./yup-ee0b3329.js";import{C as P}from"./CardHeader-ce2958b0.js";import{F as X,R as pe}from"./Radio-54b98c04.js";let ue=!1;const he=n.forwardRef(function(r,w){return ue||(console.warn(["MUI: The Autocomplete component was moved from the lab to the core.","","You should use `import { Autocomplete } from '@mui/material'`","or `import Autocomplete from '@mui/material/Autocomplete'`"].join(`
`)),ue=!0),e.jsx(Ce,we({ref:w},r))});function aa({currentProduct:t}){const r=Be(),[w,Y]=n.useState(!1),[_,Z]=n.useState([]);n.useEffect(()=>{y.get("/attributes").then(a=>{Z(a.data)})},[]);const S=Ie(),x=Te("up","md"),{enqueueSnackbar:re}=qe(),{user:g}=ge(),z=Oe().shape({name:C().required("Name is required"),subDescription:C().required("Short description is required").test("not-four-digits","Your content contain continues 7 digit number, Please remove",a=>!/\d{7,}/.test(a)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',a=>!/@/.test(a)),content:C().test("not-four-digits","Your content contain continues 7 digit number, Please remove",a=>!/\d{7,}/.test(a)).test("no-at-symbol",'Your content contains the "@" symbol. Please remove it.',a=>!/@/.test(a)),images:ie().min(1,"Image is required"),type:C(),category:C().required("Category is required"),tags:ie(),SKU:C().required("SKU is required"),brand:C().required("brand is required"),attributes:ie(),quantity:ne().required("Quantity is required"),regularPrice:ne().moreThan(0,"Price should not be AED 0.00"),salePrice:ne().lessThan(Ye("regularPrice"),"Sale price must be less than the regular price")}),B=n.useMemo(()=>({id:(t==null?void 0:t.id)||"",name:(t==null?void 0:t.name)||"",subDescription:(t==null?void 0:t.subDescription)||"",content:(t==null?void 0:t.content)||"",images:(t==null?void 0:t.images)||[],type:(t==null?void 0:t.type)||"Simple",category:(t==null?void 0:t.category)||"Disposables",tags:(t==null?void 0:t.tags)||[],SKU:(t==null?void 0:t.SKU)||"",brand:(t==null?void 0:t.brand)||"SMOK",attributes:(t==null?void 0:t.attributes)||[],quantity:(t==null?void 0:t.quantity)||null,regularPrice:(t==null?void 0:t.regularPrice)||0,salePrice:(t==null?void 0:t.salePrice)||0}),[t]),[b,I]=n.useState({}),[A,G]=n.useState([]),V=_e({resolver:Qe(z),defaultValues:B}),{reset:U,watch:T,setValue:c,handleSubmit:q,formState:{isSubmitting:$,isValid:D}}=V,o=T(),[f,L]=n.useState([]),J=n.useCallback(async()=>{const{data:a}=await y.get("/products",{params:{name:o.name,productGroup:"parent"}});L(a.products.filter(s=>!s.name.includes("-")))},[o.name]);n.useEffect(()=>{J()},[o.name]),n.useEffect(()=>{t&&U(B)},[t,B,U]);const W=q(async a=>{try{t?await y.patch("products",{...a,username:g.displayName,userId:g.id,storeName:g.storeName}):await y.post("products",{...a,username:g.displayName,userId:g.id,storeName:g.storeName}),U(),re(t?"Update success!":"Create success!"),S.push(De.dashboard.product.root)}catch(s){console.log(s)}}),ee=n.useCallback(a=>{const s=o.images||[],i=a.map(l=>Object.assign(l,{preview:URL.createObjectURL(l)}));c("images",[...s,...i],{shouldValidate:!0})},[c,o.images]),ae=n.useCallback(a=>{var i;const s=o.images&&((i=o.images)==null?void 0:i.filter(l=>l!==a));c("images",s)},[c,o.images]),m=n.useCallback(()=>{c("images",[])},[c]),F=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Details"}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"Title, short description, image..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(K,{children:[!x&&e.jsx(P,{title:"Details"}),e.jsxs(R,{spacing:3,sx:{p:3},children:[e.jsx(he,{value:o.name,onChange:(a,s)=>{if(s){const i=f.find(l=>l.name===s);i&&(c("images",i.images),c("name",i.name),c("category",i.category),c("brand",i.brand),c("type",i.type))}else c("images",null)},name:"name",label:"Product Name",options:f.map(a=>a.name),getOptionLabel:a=>a,isOptionEqualToValue:(a,s)=>a===s.value,renderInput:a=>e.jsx(E,{...a,label:"Product Name",value:o.name,onChange:s=>c("name",s.target.value)}),renderOption:(a,s)=>e.jsxs(v,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...a,children:[e.jsx("img",{loading:"lazy",width:"20",src:f.find(i=>i.name===s).images[0],alt:""}),s]}),freeSolo:!0}),e.jsx(O,{name:"subDescription",label:"Sub Description",multiline:!0,rows:4}),e.jsxs(R,{spacing:1.5,children:[e.jsx(h,{variant:"subtitle2",children:"Content"}),e.jsx(Ge,{simple:!0,name:"content"})]}),e.jsxs(R,{spacing:1.5,children:[e.jsx(h,{variant:"subtitle2",children:"Images"}),e.jsx(Ve,{multiple:!0,name:"images",maxSize:3145728,onDrop:ee,onRemove:ae,onRemoveAll:m,onUpload:async a=>{try{const s=new FormData;o.images.forEach(l=>{s.append("images",l)});const{data:i}=await y.post("upload",s);c("images",i),alert("Image upload complete.")}catch{alert(" Image upload failed, try again.")}}})]})]})]})})]}),[j,H]=n.useState({name:"",show:!1}),fe=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Key Properties"}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(K,{children:[!x&&e.jsx(P,{title:"Properties"}),e.jsx(R,{spacing:3,sx:{p:3},children:e.jsxs(v,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(le,{native:!0,name:"type",label:"Product Type",InputLabelProps:{shrink:!0},children:Re.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx(le,{native:!0,name:"category",label:"Category",InputLabelProps:{shrink:!0},children:Ne.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsx(me,{name:"tags",label:"Tags",placeholder:"+ Tags",multiple:!0,freeSolo:!0,options:Ee.map(a=>a),getOptionLabel:a=>a,renderOption:(a,s)=>n.createElement("li",{...a,key:s},s),renderTags:(a,s)=>a.map((i,l)=>n.createElement(te,{...s({index:l}),key:i,label:i,size:"small",color:"info",variant:"soft"}))}),e.jsx(O,{name:"SKU",label:"Product SKU"}),e.jsx(le,{native:!0,name:"brand",label:"Brand",InputLabelProps:{shrink:!0},children:ze.map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsxs(v,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(X,{sx:{width:190},label:"Is your brand missing? Click here to add it.",control:e.jsx(be,{checked:j.show,onChange:a=>H(s=>({...s,show:a.target.checked}))})}),j.show&&e.jsxs(e.Fragment,{children:[e.jsx(E,{label:"Brand Name",style:{width:300},onChange:a=>H(s=>({...s,name:a.target.value})),value:j.name}),e.jsx(N,{variant:"contained",color:"success",onClick:async()=>{try{j.name?(await y.post("/notifications",{userId:g.id,role:"admin",title:"ðŸš€ New Brand Approval Request! ðŸš€",message:`Exciting news! A new brand has been submitted for approval. Brand Name: ${j.name}. ðŸ›ï¸`,type:"product"}),alert("Your request to create a new brand is being processed. Please wait while we verify the brand.")):alert("Please enter brand name")}catch{alert("An error occurred while adding this brand.")}},children:"Add Brand"})]})]})]})})]})})]}),ye=(a,s,i)=>{I(Q=>({...Q,[i]:s}));const l=i==="Bottle Size"&&u.bottleSize||i==="Puffs"&&u.puffs||i==="Flavour"&&u.flavour||i==="Nicotine Strength"&&u.nicotineStrength||i==="Color"&&u.color||i==="Batteries"&&u.batteries||[],k=s[s.length-1];k&&(l.find(Q=>Q===k)||(console.log("upload"),y.post("/attributes",{username:g.displayName,attribute:i,value:k}).then(Q=>{console.log("updated")})))},Se=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Product Attributes"}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"Additional functions and attributes..."})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(K,{children:[!x&&e.jsx(P,{title:"Attributes"}),e.jsx(R,{spacing:3,sx:{p:3},children:e.jsxs(v,{columnGap:2,rowGap:3,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},children:[e.jsx(v,{sx:{gridColumn:"span 2 "},children:e.jsx(me,{name:"attributes",label:"Attributes",placeholder:"+ Attributes",multiple:!0,options:Ue.map(a=>a),getOptionLabel:a=>a,renderOption:(a,s)=>n.createElement("li",{...a,key:s},s),renderTags:(a,s)=>a.map((i,l)=>n.createElement(te,{...s({index:l}),key:i,label:i,size:"small",color:"info",variant:"soft"}))})}),o.attributes.map(a=>e.jsx(v,{sx:{gridColumn:"span 1 "},children:e.jsx(he,{multiple:!0,freeSolo:!0,options:[...a==="Bottle Size"?u.bottleSize:[],...a==="Puffs"?u.puffs:[],...a==="Flavour"?u.flavour:[],...a==="Nicotine Strength"?u.nicotineStrength:[],...a==="Color"?u.color:[],...a==="Batteries"?u.batteries:[],..._.filter(s=>s.attribute===a).map(s=>s.value)],value:b[a],onChange:(s,i)=>{ye(s,i,a),i.length>=2?A.find(l=>l===a)||G(l=>[...l,a]):G(l=>l.filter(k=>k!==a))},renderInput:s=>e.jsx(E,{...s,label:a,placeholder:a}),renderTags:(s,i)=>s.map((l,k)=>n.createElement(te,{...i({index:k}),key:l,label:l,size:"small",color:"info",variant:"soft"}))})},a))]})})]})})]}),Fe=e.jsxs(e.Fragment,{children:[x&&e.jsxs(p,{md:4,children:[e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Pricing"}),e.jsx(h,{variant:"body2",sx:{color:"text.secondary"},children:"Price related inputs"})]}),e.jsx(p,{xs:12,md:12,children:e.jsxs(K,{children:[!x&&e.jsx(P,{title:"Pricing"}),e.jsxs(R,{spacing:3,sx:{p:3},children:[e.jsx(O,{name:"quantity",label:"Quantity",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0}}),e.jsx(O,{name:"regularPrice",label:"Regular Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ce,{position:"start",children:e.jsx(v,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}}),e.jsx(O,{name:"salePrice",label:"Sale Price",placeholder:"0.00",type:"number",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(ce,{position:"start",children:e.jsx(v,{component:"span",sx:{color:"text.disabled"},children:"AED"})})}})]})]})})]}),ve=e.jsx(e.Fragment,{children:e.jsx(p,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:e.jsx(Pe,{type:"submit",variant:"contained",size:"large",loading:$,children:t?"Save Changes":"Create Product"})})}),Ae=e.jsx(e.Fragment,{children:e.jsx(p,{xs:12,md:8,sx:{display:"flex",alignItems:"center"},children:e.jsx(N,{variant:"contained",size:"large",onClick:()=>{r("/dashboard/product")},children:"Save Product"})})}),se=["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],oe=[...se,...se.slice(1).flatMap(a=>se.slice(1).map(s=>a+s))];let M=1,de=0;const ke=e.jsxs(e.Fragment,{children:[x&&e.jsx(p,{md:4,children:e.jsx(h,{variant:"h6",sx:{mb:.5},children:"Variation Table"})}),e.jsx(p,{xs:12,md:12,children:e.jsx(K,{children:e.jsxs($e,{children:[e.jsx(Le,{children:e.jsxs(je,{children:[e.jsx(d,{children:"ID"}),e.jsx(d,{width:150,children:"SKU"}),e.jsx(d,{width:250,children:"Attributes"}),e.jsx(d,{width:150,children:"Track Stock"}),e.jsx(d,{children:"Stock"}),e.jsx(d,{children:"Regular Price"}),e.jsx(d,{children:"Sales Price"}),e.jsx(d,{children:"Image"}),e.jsx(d,{width:200,children:"Add Product"})]})}),e.jsxs(Ke,{children:[e.jsx(xe,{counter:M++,counter2:de++,skuAlpha:oe,va:"Parent",values:o,variables:b,disabled:!0,isSubmitting:$,isValid:D,setProductAdded:()=>{}},M),Object.keys(b).reduce((a,s)=>a.flatMap(i=>b[s].map(l=>`${i} - ${l}`)),[""]).map(a=>e.jsx(xe,{counter:M++,counter2:de++,skuAlpha:oe,va:a.slice(3),values:o,variables:b,disabled:!1,isSubmitting:$,isValid:D,setProductAdded:Y},M))]})]})})})]});return e.jsx(He,{methods:V,onSubmit:W,children:e.jsxs(p,{container:!0,spacing:3,children:[F,fe,o.type==="Variable"&&Se,o.type==="Simple"&&Fe,o.type==="Variable"&&ke,o.type==="Simple"&&ve,o.type==="Variable"&&w&&Ae]})})}function xe({counter:t,values:r,skuAlpha:w,counter2:Y,va:_,variables:Z,disabled:S,isSubmitting:x,isValid:re,setProductAdded:g}){const{user:z}=ge(),B=w[Y]?`${r.SKU}-${w[Y]}`:r.SKU;let{name:b}=r;const I=_==="Parent";I||(b=`${r.name} - ${_}`);const[A,G]=n.useState(!0),[V,U]=n.useState("instock"),[T,c]=n.useState(null),[q,$]=n.useState(null),[D,o]=n.useState(null),[f,L]=n.useState("pending"),[J,W]=n.useState(null),ee=async m=>{try{const F=new FormData;F.append("images",m.target.files[0]);const{data:j}=await y.post("upload",F);W([j[0],...r.images])}catch{}},ae=async()=>{const m=/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{2B50}\u{2B55}\u{231A}-\u{231B}\u{23E9}-\u{23EC}\u{23F0}\u{23F3}\u{25AA}-\u{25AB}\u{25B6}\u{25C0}\u{25FB}-\u{25FE}\u{2B1B}-\u{2B1C}\u{2934}-\u{2935}\u{2B05}-\u{2B07}\u{2194}-\u{2199}\u{21A9}-\u{21AA}\u{2B06}\u{2B07}\u{2B1B}\u{2B1C}]/u,F=/\d{7,}/,j=/@/;if(m.test(r.subDescription)||m.test(r.content)){alert("Your content contain emojis, Please remove emojis");return}if(F.test(r.subDescription)||F.test(r.content)){alert("Your content contain continues 7 digit number, Please remove");return}if(j.test(r.subDescription)||j.test(r.content)){alert('Your content contains the "@" symbol. Please remove it.');return}if(!I){if(!D&&A)return alert("Quantity is required.");if(!T)return alert("Regular price is required.");if(q&&T<=q)return alert("Sale price must be less than the regular price")}if(f==="pending"){L("loading");try{await y.post("/products",{username:z.displayName,userId:z.id,storeName:z.storeName,name:b,subDescription:r.subDescription,content:r.content,images:J??r.images,type:r.type,category:r.category,tags:r.tags,parentSku:r.SKU,brand:r.brand,attributes:r.attributes,variables:Z,SKU:B,track:A,quantity:D,regularPrice:T,salePrice:q,productGroup:I?"parent":"child"}),L("success"),g(!0)}catch(H){console.log(`Product Creation failed :${H}`),L("failed")}}};return e.jsxs(je,{style:{backgroundColor:S&&"rgba(0,0,0,0.1)"},children:[e.jsx(d,{children:t}),e.jsx(d,{children:B}),e.jsx(d,{children:I?`${b} - Parent`:b}),e.jsx(d,{children:e.jsx(X,{label:"",control:e.jsx(be,{checked:A,onChange:m=>G(m.target.checked),disabled:S})})}),e.jsxs(d,{width:150,children:[A&&e.jsx(E,{inputProps:{min:0},disabled:S,size:"small",label:"Quantity",type:"number",onChange:m=>o(+m.target.value||null),value:D}),!A&&e.jsxs(Me,{"aria-label":"Stock",name:"Stock",value:V,onChange:m=>U(m.target.value),children:[e.jsx(X,{value:"instock",control:e.jsx(pe,{}),label:"Instock"}),e.jsx(X,{value:"outstock",control:e.jsx(pe,{}),label:"Outstock"})]})]}),e.jsx(d,{width:150,children:e.jsx(E,{inputProps:{min:0},disabled:S,size:"small",label:"Price",type:"number",onChange:m=>c(+m.target.value||null),value:T})}),e.jsx(d,{width:150,children:e.jsx(E,{inputProps:{min:0},disabled:S,size:"small",label:"Price",type:"number",onChange:m=>$(+m.target.value||null),value:q})}),e.jsx(d,{width:150,children:e.jsx("input",{size:"small",label:"Image",type:"file",onChange:ee,disabled:S,style:{width:"150px"}})}),e.jsxs(d,{children:[f==="pending"&&!0&&e.jsx(N,{color:"success",variant:"contained",size:"small",onClick:ae,type:"submit",children:"Add Product"}),f==="loading"&&e.jsx(N,{color:"success",variant:"contained",size:"small",children:"Loading"}),f==="success"&&e.jsx(N,{color:"success",variant:"contained",size:"small",children:"Product Created"}),f==="failed"&&e.jsx(N,{color:"success",variant:"contained",size:"small",children:"Product creation failed"})]})]})}export{aa as P};
