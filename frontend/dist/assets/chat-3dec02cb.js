import{eC as he,eD as _e,eE as Fe,eF as Ue,eG as Pe,eH as _,eI as te,eJ as ze,bZ as $e,dq as xe,bY as pe,eK as We,D as c,ay as x,bn as Ve,a9 as e,aF as F,aD as S,bo as Ge,aa as p,b1 as z,bB as Be,aI as v,ai as h,ax as qe,aK as Y,eL as He,bW as Ye,bR as ue,es as $,ad as k,dV as ge,aX as O,a7 as me,bl as X,a6 as fe,ah as U,aJ as ve,aQ as Ke,ae as I,bf as W,aW as je,eM as Je,eN as Qe,eO as Xe,bi as Ze,ap as A,aT as Z,bb as be,dz as es,by as ss,eP as ns,eQ as ts,cF as rs,bx as os,az as as,ak as is,at as ls,aL as cs}from"./index-fa50bb9d.js";import{u as ds}from"./use-search-params-1b1b12f2.js";import{_ as hs}from"./_baseEach-75d78291.js";import{u as ee,f as se,m as Q,a as xs,e as D}from"./axios-da326112.js";import{S as K}from"./Skeleton-44a56271.js";import{C as ps}from"./ClickAwayListener-f210edbb.js";import{D as us}from"./DialogContent-e6924823.js";import{u as gs,L as ms}from"./lightbox-9572820d.js";import{A as fs}from"./AvatarGroup-a1c18302.js";import{A as vs}from"./Autocomplete-035c4d5e.js";import{M as js}from"./Chip-9e042041.js";import"./axios-d5068281.js";import"./Close-dc55521d.js";var re=1e3*60,P=60*24,oe=P*30,ae=P*365;function bs(s,n,t){var o,a,r;he(2,arguments);var i=ze(),l=(o=(a=t==null?void 0:t.locale)!==null&&a!==void 0?a:i.locale)!==null&&o!==void 0?o:_e;if(!l.formatDistance)throw new RangeError("locale must contain localize.formatDistance property");var u=Fe(s,n);if(isNaN(u))throw new RangeError("Invalid time value");var d=Ue(Pe(t),{addSuffix:!!(t!=null&&t.addSuffix),comparison:u}),g,y;u>0?(g=_(n),y=_(s)):(g=_(s),y=_(n));var f=String((r=t==null?void 0:t.roundingMethod)!==null&&r!==void 0?r:"round"),m;if(f==="floor")m=Math.floor;else if(f==="ceil")m=Math.ceil;else if(f==="round")m=Math.round;else throw new RangeError("roundingMethod must be 'floor', 'ceil' or 'round'");var j=y.getTime()-g.getTime(),b=j/re,T=te(y)-te(g),R=(j-T)/re,C=t==null?void 0:t.unit,w;if(C?w=String(C):b<1?w="second":b<60?w="minute":b<P?w="hour":R<oe?w="day":R<ae?w="month":w="year",w==="second"){var V=m(j/1e3);return l.formatDistance("xSeconds",V,d)}else if(w==="minute"){var G=m(b);return l.formatDistance("xMinutes",G,d)}else if(w==="hour"){var B=m(b/60);return l.formatDistance("xHours",B,d)}else if(w==="day"){var q=m(R/P);return l.formatDistance("xDays",q,d)}else if(w==="month"){var L=m(R/oe);return L===12&&C!=="month"?l.formatDistance("xYears",1,d):l.formatDistance("xMonths",L,d)}else if(w==="year"){var E=m(R/ae);return l.formatDistance("xYears",E,d)}throw new RangeError("unit must be 'second', 'minute', 'hour', 'day', 'month' or 'year'")}function ys(s,n){return he(1,arguments),bs(s,Date.now(),n)}function ws(s,n,t,o){for(var a=-1,r=s==null?0:s.length;++a<r;){var i=s[a];n(o,i,t(i),s)}return o}var Cs=ws,ks=hs;function Ss(s,n,t,o){return ks(s,function(a,r,i){n(o,a,t(a),i)}),o}var Is=Ss,Ts=Cs,Rs=Is,As=$e,Ms=xe;function Ds(s,n){return function(t,o){var a=Ms(t)?Ts:Rs,r=n?n():{};return a(t,s,As(o),r)}}var Ns=Ds,Os=We,Ls=Ns,Es=Ls(function(s,n,t){Os(s,t,n)}),_s=Es;const Fs=pe(_s),ne={revalidateIfStale:!1,revalidateOnFocus:!1,revalidateOnReconnect:!1};function Us(){const s=[D.chat,{params:{endpoint:"contacts"}}],{data:n,isLoading:t,error:o,isValidating:a}=ee(s,se,ne);return c.useMemo(()=>({contacts:(n==null?void 0:n.contacts)||[],contactsLoading:t,contactsError:o,contactsValidating:a,contactsEmpty:!t&&!(n!=null&&n.contacts.length)}),[n==null?void 0:n.contacts,o,t,a])}function Ps(){const s=[D.chat,{params:{endpoint:"conversations"}}],{data:n,isLoading:t,error:o,isValidating:a}=ee(s,se,ne);return c.useMemo(()=>{const i=Fs(n==null?void 0:n.conversations,"id")||{},l=Object.keys(i)||[];return{conversations:{byId:i,allIds:l},conversationsLoading:t,conversationsError:o,conversationsValidating:a,conversationsEmpty:!t&&!l.length}},[n==null?void 0:n.conversations,o,t,a])}function zs(s){const n=s?[D.chat,{params:{conversationId:s,endpoint:"conversation"}}]:null,{data:t,isLoading:o,error:a,isValidating:r}=ee(n,se,ne);return c.useMemo(()=>({conversation:t==null?void 0:t.conversation,conversationLoading:o,conversationError:a,conversationValidating:r}),[t==null?void 0:t.conversation,a,o,r])}async function $s(s,n){const t=[D.chat,{params:{endpoint:"conversations"}}],o=[D.chat,{params:{conversationId:s,endpoint:"conversation"}}];Q(o,a=>{const{conversation:r}=a;return{conversation:{...r,messages:[...r.messages,n]}}},!1),Q(t,a=>{const{conversations:r}=a;return{conversations:r.map(l=>l.id===s?{...l,messages:[...l.messages,n]}:l)}},!1)}async function Ws(s){const n=[D.chat,{params:{endpoint:"conversations"}}],t={conversationData:s},o=await xs.post(D.chat,t);return Q(n,a=>{const r=[...a.conversations,s];return{...a,conversations:r}},!1),o.data}function Vs({message:s,participants:n,currentUserId:t}){const o=n.find(l=>l.id===s.senderId),a=s.senderId===t?{type:"me"}:{avatarUrl:o==null?void 0:o.avatarUrl,firstName:o==null?void 0:o.name.split(" ")[0]},r=a.type==="me";return{hasImage:s.contentType==="image",me:r,senderDetails:a}}function ye(){const[s,n]=c.useState(!1),[t,o]=c.useState(!1),a=c.useCallback(()=>{o(u=>!u)},[]),r=c.useCallback(()=>{o(!1)},[]),i=c.useCallback(()=>{n(!0)},[]),l=c.useCallback(()=>{n(!1)},[]);return{openMobile:s,collapseDesktop:t,onOpenMobile:i,onCloseMobile:l,onCloseDesktop:r,onCollapseDesktop:a}}function Gs(s){const n=c.useRef(null),t=c.useCallback(()=>{s&&n.current&&n.current&&(n.current.scrollTop=n.current.scrollHeight)},[s]);return c.useEffect(()=>{t()},[s]),{messagesEndRef:n}}x.bool,x.object,x.func,x.bool;function Bs(){const{user:s}=$(),n=Ve(),[t,o]=c.useState("online"),a=c.useCallback(r=>{o(r.target.value)},[]);return e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:t,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(S,{src:s==null?void 0:s.photoURL,alt:s==null?void 0:s.displayName,onClick:n.onOpen,sx:{cursor:"pointer",width:48,height:48}})}),e.jsxs(Ge,{open:n.open,onClose:n.onClose,arrow:"top-left",sx:{p:0},children:[e.jsxs(p,{direction:"row",alignItems:"center",spacing:2,sx:{py:2,pr:1,pl:2.5},children:[e.jsx(z,{primary:s==null?void 0:s.displayName,secondary:s==null?void 0:s.email,secondaryTypographyProps:{component:"span"}}),e.jsx(Be,{title:"Log out",children:e.jsx(v,{color:"error",children:e.jsx(h,{icon:"ic:round-power-settings-new"})})})]}),e.jsx(qe,{sx:{borderStyle:"dashed"}}),e.jsxs(p,{sx:{p:1},children:[e.jsxs(Y,{children:[e.jsx(F,{variant:t,sx:{[`& .${He.badge}`]:{position:"static",m:.75,width:12,height:12,flexShrink:0}}}),e.jsx(Ye,{native:!0,fullWidth:!0,value:t,onChange:a,input:e.jsx(ue,{sx:{pl:2}}),inputProps:{sx:{textTransform:"capitalize"}},children:["online","alway","busy","offline"].map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs(Y,{children:[e.jsx(h,{icon:"solar:user-id-bold",width:24}),"Profile"]}),e.jsxs(Y,{children:[e.jsx(h,{icon:"eva:settings-2-fill",width:24}),"Settings"]})]})]})]})}function we({sx:s,...n}){return e.jsxs(p,{spacing:2,direction:"row",alignItems:"center",sx:{px:2.5,py:1.5,...s},...n,children:[e.jsx(K,{variant:"circular",sx:{width:48,height:48}}),e.jsxs(p,{spacing:1,flexGrow:1,children:[e.jsx(K,{sx:{width:.75,height:10}}),e.jsx(K,{sx:{width:.5,height:10}})]})]})}we.propTypes={sx:x.object};function Ce({query:s,results:n,onClickResult:t}){const o=n.length,a=!o&&!!s;return e.jsxs(e.Fragment,{children:[e.jsxs(k,{paragraph:!0,variant:"h6",sx:{px:2.5},children:["Contacts (",o,")"]}),a?e.jsx(ge,{query:s,sx:{p:3,mx:"auto",width:"calc(100% - 40px)",bgcolor:"background.neutral"}}):e.jsx(e.Fragment,{children:n.map(r=>e.jsxs(O,{onClick:()=>t(r),sx:{px:2.5,py:1.5,typography:"subtitle2"},children:[e.jsx(S,{alt:r.name,src:r.avatarUrl,sx:{mr:2}}),r.name]},r.id))})]})}Ce.propTypes={query:x.string,results:x.array,onClickResult:x.func};const ie=320,qs=96;function ke({loading:s,contacts:n,conversations:t,selectedConversationId:o}){const a=me(),r=X(),i=fe("up","md"),{collapseDesktop:l,onCloseDesktop:u,onCollapseDesktop:d,openMobile:g,onOpenMobile:y,onCloseMobile:f}=ye(),[m,j]=c.useState({query:"",results:[]});c.useEffect(()=>{i||u()},[u,i]);const b=c.useCallback(()=>{i?d():f()},[i,f,d]),T=c.useCallback(()=>{i||f(),r.push(U.dashboard.chat)},[i,f,r]),R=c.useCallback(M=>{if(j(N=>({...N,query:M})),M){const N=n.filter(H=>H.name.toLowerCase().includes(M));j(H=>({...H,results:N}))}},[n]),C=c.useCallback(()=>{j({query:"",results:[]})},[]),w=c.useCallback(M=>{C(),r.push(`${U.dashboard.chat}?id=${M.id}`)},[C,r]),V=e.jsx(v,{onClick:y,sx:{left:0,top:84,zIndex:9,width:32,height:32,position:"absolute",borderRadius:"0 12px 12px 0",bgcolor:a.palette.primary.main,boxShadow:a.customShadows.primary,color:a.palette.primary.contrastText,"&:hover":{bgcolor:a.palette.primary.darker}},children:e.jsx(h,{width:16,icon:"solar:users-group-rounded-bold"})}),G=e.jsx(e.Fragment,{children:[...Array(12)].map((M,N)=>e.jsx(we,{},N))}),B=e.jsx(e.Fragment,{}),q=e.jsx(Ce,{query:m.query,results:m.results,onClickResult:w}),L=e.jsx(ps,{onClickAway:C,children:e.jsx(ve,{fullWidth:!0,value:m.query,onChange:M=>R(M.target.value),placeholder:"Search contacts...",InputProps:{startAdornment:e.jsx(Ke,{position:"start",children:e.jsx(h,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})},sx:{mt:2.5}})}),E=e.jsxs(e.Fragment,{children:[e.jsxs(p,{direction:"row",alignItems:"center",justifyContent:"center",sx:{p:2.5,pb:0},children:[!l&&e.jsxs(e.Fragment,{children:[e.jsx(Bs,{}),e.jsx(I,{sx:{flexGrow:1}})]}),e.jsx(v,{onClick:b,children:e.jsx(h,{icon:l?"eva:arrow-ios-forward-fill":"eva:arrow-ios-back-fill"})}),!l&&e.jsx(v,{onClick:T,children:e.jsx(h,{width:24,icon:"solar:user-plus-bold"})})]}),e.jsx(I,{sx:{p:2.5,pt:0},children:!l&&L}),e.jsxs(W,{sx:{pb:1},children:[m.query&&q,s&&G,!m.query&&!!t.allIds.length&&B]})]});return e.jsxs(e.Fragment,{children:[!i&&V,i?e.jsx(p,{sx:{height:1,flexShrink:0,width:ie,borderRight:`solid 1px ${a.palette.divider}`,transition:a.transitions.create(["width"],{duration:a.transitions.duration.shorter}),...l&&{width:qs}},children:E}):e.jsx(je,{open:g,onClose:f,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:ie}},children:E})]})}ke.propTypes={contacts:x.array,conversations:x.object,loading:x.bool,selectedConversationId:x.string};var le=Je,Hs=Qe,Ys=xe,ce=le?le.isConcatSpreadable:void 0;function Ks(s){return Ys(s)||Hs(s)||!!(ce&&s&&s[ce])}var Js=Ks,Qs=Xe,Xs=Js;function Se(s,n,t,o,a){var r=-1,i=s.length;for(t||(t=Xs),a||(a=[]);++r<i;){var l=s[r];n>0&&t(l)?n>1?Se(l,n-1,t,o,a):Qs(a,l):o||(a[a.length]=l)}return a}var Zs=Se,en=Zs;function sn(s){var n=s==null?0:s.length;return n?en(s,1):[]}var nn=sn;const tn=pe(nn);function Ie({participant:s,open:n,onClose:t}){return e.jsxs(Ze,{fullWidth:!0,maxWidth:"xs",open:n,onClose:t,children:[e.jsx(v,{onClick:t,sx:{position:"absolute",right:8,top:8},children:e.jsx(h,{icon:"mingcute:close-line"})}),e.jsxs(us,{sx:{py:5,px:3,display:"flex"},children:[e.jsx(S,{alt:s.name,src:s.avatarUrl,sx:{width:96,height:96,mr:3}}),e.jsxs(p,{spacing:1,children:[e.jsx(k,{variant:"caption",sx:{color:"primary.main"},children:s.role}),e.jsx(k,{variant:"subtitle1",children:s.name}),e.jsxs(p,{direction:"row",sx:{typography:"caption",color:"text.disabled"},children:[e.jsx(h,{icon:"mingcute:location-fill",width:16,sx:{flexShrink:0,mr:.5,mt:"2px"}}),s.address]}),e.jsxs(p,{spacing:1,direction:"row",sx:{pt:1.5},children:[e.jsx(v,{size:"small",color:"error",sx:{borderRadius:1,bgcolor:o=>A(o.palette.error.main,.08),"&:hover":{bgcolor:o=>A(o.palette.error.main,.16)}},children:e.jsx(h,{width:18,icon:"solar:phone-bold"})}),e.jsx(v,{size:"small",color:"info",sx:{borderRadius:1,bgcolor:o=>A(o.palette.info.main,.08),"&:hover":{bgcolor:o=>A(o.palette.info.main,.16)}},children:e.jsx(h,{width:18,icon:"solar:chat-round-dots-bold"})}),e.jsx(v,{size:"small",color:"primary",sx:{borderRadius:1,bgcolor:o=>A(o.palette.primary.main,.08),"&:hover":{bgcolor:o=>A(o.palette.primary.main,.16)}},children:e.jsx(h,{width:18,icon:"fluent:mail-24-filled"})}),e.jsx(v,{size:"small",color:"secondary",sx:{borderRadius:1,bgcolor:o=>A(o.palette.secondary.main,.08),"&:hover":{bgcolor:o=>A(o.palette.secondary.main,.16)}},children:e.jsx(h,{width:18,icon:"solar:videocamera-record-bold"})})]})]})]})]})}Ie.propTypes={onClose:x.func,open:x.bool,participant:x.object};function Te({participants:s}){const[n,t]=c.useState(null),o=Z(!0),a=c.useCallback(d=>{t(d)},[]),r=()=>{t(null)},i=s.length,l=e.jsxs(O,{onClick:o.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(I,{component:"span",sx:{flexGrow:1},children:["In room (",i,")"]}),e.jsx(h,{width:16,icon:o.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),u=e.jsx(W,{sx:{height:56*4},children:s.map(d=>e.jsxs(O,{onClick:()=>a(d),children:[e.jsx(F,{variant:d.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(S,{alt:d.name,src:d.avatarUrl})}),e.jsx(z,{sx:{ml:2},primary:d.name,secondary:d.role,primaryTypographyProps:{noWrap:!0,typography:"subtitle2"},secondaryTypographyProps:{noWrap:!0,component:"span",typography:"caption"}})]},d.id))});return e.jsxs(e.Fragment,{children:[l,e.jsx("div",{children:e.jsx(be,{in:o.value,children:u})}),n&&e.jsx(Ie,{participant:n,open:!!n,onClose:r})]})}Te.propTypes={participants:x.array};function Re({participant:s}){const n=Z(!0),{name:t,avatarUrl:o,role:a,address:r,phoneNumber:i,email:l}=s,u=e.jsxs(p,{alignItems:"center",sx:{py:5},children:[e.jsx(S,{alt:t,src:o,sx:{width:96,height:96,mb:2}}),e.jsx(k,{variant:"subtitle1",children:t}),e.jsx(k,{variant:"body2",sx:{color:"text.secondary",mt:.5},children:a})]}),d=e.jsxs(O,{onClick:n.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsx(I,{component:"span",sx:{flexGrow:1},children:"Information"}),e.jsx(h,{width:16,icon:n.value?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})]}),g=e.jsxs(p,{spacing:2,sx:{px:2,py:2.5,"& svg":{mr:1,flexShrink:0,color:"text.disabled"}},children:[e.jsxs(p,{direction:"row",children:[e.jsx(h,{icon:"mingcute:location-fill"}),e.jsx(k,{variant:"body2",children:r})]}),e.jsxs(p,{direction:"row",children:[e.jsx(h,{icon:"solar:phone-bold"}),e.jsx(k,{variant:"body2",children:i})]}),e.jsxs(p,{direction:"row",children:[e.jsx(h,{icon:"fluent:mail-24-filled"}),e.jsx(k,{variant:"body2",noWrap:!0,children:l})]})]});return e.jsxs(e.Fragment,{children:[u,d,e.jsx("div",{children:e.jsx(be,{in:n.value,children:g})})]})}Re.propTypes={participant:x.object};function Ae({attachments:s}){const n=Z(!0),t=s.length,o=e.jsxs(O,{disabled:!s.length,onClick:n.onToggle,sx:{pl:2.5,pr:1.5,height:40,flexShrink:0,flexGrow:"unset",typography:"overline",color:"text.secondary",bgcolor:"background.neutral"},children:[e.jsxs(I,{component:"span",sx:{flexGrow:1},children:["Attachments (",t,")"]}),e.jsx(h,{width:16,icon:!n.value&&"eva:arrow-ios-forward-fill"||!s.length&&"eva:arrow-ios-forward-fill"||"eva:arrow-ios-downward-fill"})]}),a=e.jsx(W,{sx:{px:2,py:2.5},children:s.map((r,i)=>e.jsxs(p,{spacing:1.5,direction:"row",alignItems:"center",sx:{mb:2},children:[e.jsx(p,{alignItems:"center",justifyContent:"center",sx:{width:40,height:40,flexShrink:0,borderRadius:1,overflow:"hidden",position:"relative",backgroundColor:"background.neutral"},children:e.jsx(es,{imageView:!0,file:r.preview,onDownload:()=>console.info("DOWNLOAD"),sx:{width:28,height:28}})}),e.jsx(z,{primary:r.name,secondary:ss(r.createdAt),primaryTypographyProps:{noWrap:!0,typography:"body2"},secondaryTypographyProps:{mt:.25,noWrap:!0,component:"span",typography:"caption",color:"text.disabled"}})]},r.name+i))});return e.jsxs(e.Fragment,{children:[o,e.jsx(I,{sx:{overflow:"hidden",height:n.value?1:0,transition:r=>r.transitions.create(["height"],{duration:r.transitions.duration.shorter})},children:a})]})}Ae.propTypes={attachments:x.array};const J=240;function Me({participants:s,conversation:n}){const t=me(),o=fe("up","lg"),{collapseDesktop:a,onCloseDesktop:r,onCollapseDesktop:i,openMobile:l,onOpenMobile:u,onCloseMobile:d}=ye();c.useEffect(()=>{o||r()},[r,o]);const g=c.useCallback(()=>{o?i():u()},[o]),y=s.length>1,f=ns(tn(n.messages.map(b=>b.attachments))),m=e.jsxs(e.Fragment,{children:[y?e.jsx(Te,{participants:s}):e.jsx(Re,{participant:s[0]}),e.jsx(Ae,{attachments:f})]}),j=e.jsx(v,{onClick:g,sx:{top:12,right:0,zIndex:9,width:32,height:32,borderRight:0,position:"absolute",borderRadius:"12px 0 0 12px",boxShadow:t.customShadows.z8,bgcolor:t.palette.background.paper,border:`solid 1px ${t.palette.divider}`,"&:hover":{bgcolor:t.palette.background.neutral},...o&&{...!a&&{right:J}}},children:o?e.jsx(h,{width:16,icon:a?"eva:arrow-ios-back-fill":"eva:arrow-ios-forward-fill"}):e.jsx(h,{width:16,icon:"eva:arrow-ios-back-fill"})});return e.jsxs(I,{sx:{position:"relative"},children:[j,o?e.jsx(p,{sx:{height:1,flexShrink:0,width:J,borderLeft:`solid 1px ${t.palette.divider}`,transition:t.transitions.create(["width"],{duration:t.transitions.duration.shorter}),...a&&{width:0}},children:!a&&m}):e.jsx(je,{anchor:"right",open:l,onClose:d,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{width:J}},children:m})]})}Me.propTypes={conversation:x.object,participants:x.array};function De({message:s,participants:n,onOpenLightbox:t}){const{user:o}=$(),{me:a,senderDetails:r,hasImage:i}=Vs({message:s,participants:n,currentUserId:o.id}),{firstName:l,avatarUrl:u}=r,{body:d,createdAt:g}=s,y=e.jsxs(k,{noWrap:!0,variant:"caption",sx:{mb:1,color:"text.disabled",...!a&&{mr:"auto"}},children:[!a&&`${l},`,"  ",ys(new Date(g),{addSuffix:!0})]}),f=e.jsx(p,{sx:{p:1.5,minWidth:48,maxWidth:320,borderRadius:1,typography:"body2",bgcolor:"background.neutral",...a&&{color:"grey.800",bgcolor:"primary.lighter"},...i&&{p:0,bgcolor:"transparent"}},children:i?e.jsx(I,{component:"img",alt:"attachment",src:d,onClick:()=>t(d),sx:{minHeight:220,borderRadius:1.5,cursor:"pointer","&:hover":{opacity:.9}}}):d}),m=e.jsxs(p,{direction:"row",className:"message-actions",sx:{pt:.5,opacity:0,top:"100%",left:0,position:"absolute",transition:j=>j.transitions.create(["opacity"],{duration:j.transitions.duration.shorter}),...a&&{left:"unset",right:0}},children:[e.jsx(v,{size:"small",children:e.jsx(h,{icon:"solar:reply-bold",width:16})}),e.jsx(v,{size:"small",children:e.jsx(h,{icon:"eva:smiling-face-fill",width:16})}),e.jsx(v,{size:"small",children:e.jsx(h,{icon:"solar:trash-bin-trash-bold",width:16})})]});return e.jsxs(p,{direction:"row",justifyContent:a?"flex-end":"unset",sx:{mb:5},children:[!a&&e.jsx(S,{alt:l,src:u,sx:{width:32,height:32,mr:2}}),e.jsxs(p,{alignItems:"flex-end",children:[y,e.jsxs(p,{direction:"row",alignItems:"center",sx:{position:"relative","&:hover":{"& .message-actions":{opacity:1}}},children:[f,m]})]})]})}De.propTypes={message:x.object,onOpenLightbox:x.func,participants:x.array};function Ne({messages:s=[],participants:n}){const{messagesEndRef:t}=Gs(s),o=s.filter(r=>r.contentType==="image").map(r=>({src:r.body})),a=gs(o);return e.jsxs(e.Fragment,{children:[e.jsx(W,{ref:t,sx:{px:3,py:5,height:1},children:e.jsx(I,{children:s.map(r=>e.jsx(De,{message:r,participants:n,onOpenLightbox:()=>a.onOpen(r.body)},r.id))})}),e.jsx(ms,{index:a.selected,slides:o,open:a.open,close:a.onClose})]})}Ne.propTypes={messages:x.array,participants:x.array};function de(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const n=Math.random()*16|0;return(s==="x"?n:n&3|8).toString(16)})}function Oe({recipients:s,onAddRecipients:n,disabled:t,selectedConversationId:o}){const a=X(),{user:r}=$(),i=c.useRef(null),[l,u]=c.useState(""),d=c.useMemo(()=>({id:r.id,role:r.role,email:r.email,address:r.address,name:r.displayName,lastActivity:new Date,avatarUrl:r.photoURL,phoneNumber:r.phoneNumber,status:"online"}),[r]),g=c.useMemo(()=>({id:de(),attachments:[],body:l,contentType:"text",createdAt:ts(new Date,{minutes:1}),senderId:d.id}),[l,d.id]),y=c.useMemo(()=>({id:de(),messages:[g],participants:[...s,d],type:s.length>1?"GROUP":"ONE_TO_ONE",unreadCount:0}),[g,d,s]),f=c.useCallback(()=>{i.current&&i.current.click()},[]),m=c.useCallback(b=>{u(b.target.value)},[]),j=c.useCallback(async b=>{try{if(b.key==="Enter"){if(l)if(o)await $s(o,g);else{const T=await Ws(y);a.push(`${U.dashboard.chat}?id=${T.conversation.id}`),n([])}u("")}}catch(T){console.error(T)}},[y,l,g,n,a,o]);return e.jsxs(e.Fragment,{children:[e.jsx(ue,{value:l,onKeyUp:j,onChange:m,placeholder:"Type a message",disabled:t,startAdornment:e.jsx(v,{children:e.jsx(h,{icon:"eva:smiling-face-fill"})}),endAdornment:e.jsxs(p,{direction:"row",sx:{flexShrink:0},children:[e.jsx(v,{onClick:f,children:e.jsx(h,{icon:"solar:gallery-add-bold"})}),e.jsx(v,{onClick:f,children:e.jsx(h,{icon:"eva:attach-2-fill"})}),e.jsx(v,{children:e.jsx(h,{icon:"solar:microphone-bold"})})]}),sx:{px:1,height:56,flexShrink:0,borderTop:b=>`solid 1px ${b.palette.divider}`}}),e.jsx("input",{type:"file",ref:i,style:{display:"none"}})]})}Oe.propTypes={disabled:x.bool,onAddRecipients:x.func,recipients:x.array,selectedConversationId:x.string};function Le({participants:s}){const n=s.length>1,t=s[0],o=e.jsx(fs,{max:3,sx:{[`& .${rs.avatar}`]:{width:32,height:32}},children:s.map(r=>e.jsx(S,{alt:r.name,src:r.avatarUrl},r.id))}),a=e.jsxs(p,{flexGrow:1,direction:"row",alignItems:"center",spacing:2,children:[e.jsx(F,{variant:t.status,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(S,{src:t.avatarUrl,alt:t.name})}),e.jsx(z,{primary:t.name,secondary:t.status==="offline"?os(t.lastActivity):t.status,secondaryTypographyProps:{component:"span",...t.status!=="offline"&&{textTransform:"capitalize"}}})]});return e.jsxs(e.Fragment,{children:[n?o:a,e.jsx(p,{flexGrow:1}),e.jsx(v,{children:e.jsx(h,{icon:"solar:phone-bold"})}),e.jsx(v,{children:e.jsx(h,{icon:"solar:videocamera-record-bold"})}),e.jsx(v,{children:e.jsx(h,{icon:"eva:more-vertical-fill"})})]})}Le.propTypes={participants:x.array};function Ee({contacts:s,onAddRecipients:n}){const[t,o]=c.useState(""),a=c.useCallback(r=>{o(""),n(r)},[n]);return e.jsxs(e.Fragment,{children:[e.jsx(k,{variant:"subtitle2",sx:{color:"text.primary",mr:2},children:"To:"}),e.jsx(vs,{sx:{minWidth:320},multiple:!0,limitTags:3,popupIcon:null,disableCloseOnSelect:!0,noOptionsText:e.jsx(ge,{query:t}),onChange:(r,i)=>a(i),onInputChange:(r,i)=>o(i),options:s,getOptionLabel:r=>r.name,isOptionEqualToValue:(r,i)=>r.id===i.id,renderInput:r=>e.jsx(ve,{...r,placeholder:"+ Recipients"}),renderOption:(r,i,{selected:l})=>c.createElement("li",{...r,key:i.id},e.jsxs(I,{sx:{mr:1,width:32,height:32,overflow:"hidden",borderRadius:"50%",position:"relative"},children:[e.jsx(S,{alt:i.name,src:i.avatarUrl,sx:{width:1,height:1}}),e.jsx(p,{alignItems:"center",justifyContent:"center",sx:{top:0,left:0,width:1,height:1,opacity:0,position:"absolute",bgcolor:u=>A(u.palette.grey[900],.8),transition:u=>u.transitions.create(["opacity"],{easing:u.transitions.easing.easeInOut,duration:u.transitions.duration.shorter}),...l&&{opacity:1,color:"primary.main"}},children:e.jsx(h,{icon:"eva:checkmark-fill"})})]},i.id),i.name),renderTags:(r,i)=>r.map((l,u)=>c.createElement(js,{...i({index:u}),key:l.id,label:l.name,avatar:e.jsx(S,{alt:l.name,src:l.avatarUrl}),size:"small",variant:"soft"}))})]})}Ee.propTypes={contacts:x.array,onAddRecipients:x.func};function rn(){const s=X(),{user:n}=$(),t=as(),a=ds().get("id")||"",[r,i]=c.useState([]),{contacts:l}=Us(),{conversations:u,conversationsLoading:d}=Ps(),{conversation:g,conversationError:y}=zs(`${a}`),f=g?g.participants.filter(C=>C.id!==n.id):[];c.useEffect(()=>{(y||!a)&&s.push(U.dashboard.chat)},[y,s,a]);const m=c.useCallback(C=>{i(C)},[]),j=!!g,b=e.jsx(p,{direction:"row",alignItems:"center",flexShrink:0,sx:{pr:1,pl:2.5,py:1,minHeight:72},children:a?e.jsx(e.Fragment,{children:j&&e.jsx(Le,{participants:f})}):e.jsx(Ee,{contacts:l,onAddRecipients:m})}),T=e.jsx(ke,{contacts:l,conversations:u,loading:d,selectedConversationId:a}),R=e.jsxs(p,{sx:{width:1,height:1,overflow:"hidden"},children:[e.jsx(Ne,{messages:g==null?void 0:g.messages,participants:f}),e.jsx(Oe,{recipients:r,onAddRecipients:m,selectedConversationId:a,disabled:!r.length&&!a})]});return e.jsxs(is,{maxWidth:t.themeStretch?!1:"xl",children:[e.jsx(k,{variant:"h4",sx:{mb:{xs:3,md:5}},children:"Support"}),e.jsxs(p,{component:ls,direction:"row",sx:{height:"72vh"},children:[T,e.jsxs(p,{sx:{width:1,height:1,overflow:"hidden"},children:[b,e.jsxs(p,{direction:"row",sx:{width:1,height:1,overflow:"hidden",borderTop:C=>`solid 1px ${C.palette.divider}`},children:[R,j&&e.jsx(Me,{conversation:g,participants:f})]})]})]})]})}function jn(){return e.jsxs(e.Fragment,{children:[e.jsx(cs,{children:e.jsx("title",{children:" Dashboard: Chat"})}),e.jsx(rn,{})]})}export{jn as default};
